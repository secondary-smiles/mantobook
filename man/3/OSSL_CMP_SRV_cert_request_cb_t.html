<!-- Creator     : groff version 1.22.4 -->
<!-- CreationDate: Mon May 29 22:55:42 2023 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title>OSSL_CMP_SRV_CTX_NEW</title>

</head>
<body>
<h1>OSSL_CMP_SRV_cert_request_cb_t</h1>



<h2>NAME
<a name="NAME"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em">OSSL_CMP_SRV_process_request,
OSSL_CMP_CTX_server_perform, OSSL_CMP_SRV_CTX_new,
OSSL_CMP_SRV_CTX_free, OSSL_CMP_SRV_cert_request_cb_t,
OSSL_CMP_SRV_rr_cb_t, OSSL_CMP_SRV_certConf_cb_t,
OSSL_CMP_SRV_genm_cb_t, OSSL_CMP_SRV_error_cb_t,
OSSL_CMP_SRV_pollReq_cb_t, OSSL_CMP_SRV_CTX_init,
OSSL_CMP_SRV_CTX_get0_cmp_ctx,
OSSL_CMP_SRV_CTX_get0_custom_ctx,
OSSL_CMP_SRV_CTX_set_send_unprotected_errors,
OSSL_CMP_SRV_CTX_set_accept_unprotected,
OSSL_CMP_SRV_CTX_set_accept_raverified,
OSSL_CMP_SRV_CTX_set_grant_implicit_confirm &minus; generic
functions to set up and control a CMP server</p>

<h2>SYNOPSIS
<a name="SYNOPSIS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">#include
&lt;openssl/cmp.h&gt; <br>
OSSL_CMP_MSG *OSSL_CMP_SRV_process_request(OSSL_CMP_SRV_CTX
*srv_ctx, <br>
const OSSL_CMP_MSG *req); <br>
OSSL_CMP_MSG *OSSL_CMP_CTX_server_perform(OSSL_CMP_CTX
*client_ctx, <br>
const OSSL_CMP_MSG *req); <br>
OSSL_CMP_SRV_CTX *OSSL_CMP_SRV_CTX_new(OSSL_LIB_CTX *libctx,
const char *propq); <br>
void OSSL_CMP_SRV_CTX_free(OSSL_CMP_SRV_CTX *srv_ctx); <br>
typedef OSSL_CMP_PKISI *(*OSSL_CMP_SRV_cert_request_cb_t)(
<br>
OSSL_CMP_SRV_CTX *srv_ctx, <br>
const OSSL_CMP_MSG *req, <br>
int certReqId, <br>
const OSSL_CRMF_MSG *crm, <br>
const X509_REQ *p10cr, <br>
X509 **certOut, <br>
STACK_OF(X509) **chainOut, <br>
STACK_OF(X509) **caPubs); <br>
typedef OSSL_CMP_PKISI
*(*OSSL_CMP_SRV_rr_cb_t)(OSSL_CMP_SRV_CTX *srv_ctx, <br>
const OSSL_CMP_MSG *req, <br>
const X509_NAME *issuer, <br>
const ASN1_INTEGER *serial); <br>
typedef int (*OSSL_CMP_SRV_genm_cb_t)(OSSL_CMP_SRV_CTX
*srv_ctx, <br>
const OSSL_CMP_MSG *req, <br>
STACK_OF(OSSL_CMP_ITAV) *in, <br>
STACK_OF(OSSL_CMP_ITAV) **out); <br>
typedef void (*OSSL_CMP_SRV_error_cb_t)(OSSL_CMP_SRV_CTX
*srv_ctx, <br>
const OSSL_CMP_MSG *req, <br>
const OSSL_CMP_PKISI *statusInfo, <br>
const ASN1_INTEGER *errorCode, <br>
const OSSL_CMP_PKIFREETEXT *errorDetails); <br>
typedef int (*OSSL_CMP_SRV_certConf_cb_t)(OSSL_CMP_SRV_CTX
*srv_ctx, <br>
const OSSL_CMP_MSG *req, <br>
int certReqId, <br>
const ASN1_OCTET_STRING *certHash, <br>
const OSSL_CMP_PKISI *si); <br>
typedef int (*OSSL_CMP_SRV_pollReq_cb_t)(OSSL_CMP_SRV_CTX
*srv_ctx, <br>
const OSSL_CMP_MSG *req, <br>
int certReqId, <br>
OSSL_CMP_MSG **certReq, <br>
int64_t *check_after); <br>
int OSSL_CMP_SRV_CTX_init(OSSL_CMP_SRV_CTX *srv_ctx, void
*custom_ctx, <br>
OSSL_CMP_SRV_cert_request_cb_t process_cert_request, <br>
OSSL_CMP_SRV_rr_cb_t process_rr, <br>
OSSL_CMP_SRV_genm_cb_t process_genm, <br>
OSSL_CMP_SRV_error_cb_t process_error, <br>
OSSL_CMP_SRV_certConf_cb_t process_certConf, <br>
OSSL_CMP_SRV_pollReq_cb_t process_pollReq); <br>
OSSL_CMP_CTX *OSSL_CMP_SRV_CTX_get0_cmp_ctx(const
OSSL_CMP_SRV_CTX *srv_ctx); <br>
void *OSSL_CMP_SRV_CTX_get0_custom_ctx(const
OSSL_CMP_SRV_CTX *srv_ctx); <br>
int
OSSL_CMP_SRV_CTX_set_send_unprotected_errors(OSSL_CMP_SRV_CTX
*srv_ctx, <br>
int val); <br>
int OSSL_CMP_SRV_CTX_set_accept_unprotected(OSSL_CMP_SRV_CTX
*srv_ctx, int val); <br>
int OSSL_CMP_SRV_CTX_set_accept_raverified(OSSL_CMP_SRV_CTX
*srv_ctx, int val); <br>
int
OSSL_CMP_SRV_CTX_set_grant_implicit_confirm(OSSL_CMP_SRV_CTX
*srv_ctx, <br>
int val);</p>

<h2>DESCRIPTION
<a name="DESCRIPTION"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em"><b>OSSL_CMP_SRV_process_request()</b>
implements the generic aspects of a <small>CMP</small>
server. Its arguments are the
<b><small>OSSL_CMP_SRV_CTX</small></b> <i>srv_ctx</i> and
the <small>CMP</small> request message <i>req</i>. It does
the typical generic checks on <i>req</i>, calls the
respective callback function (if present) for more specific
processing, and then assembles a result message, which may
be a <small>CMP</small> error message. If after return of
the function the expression
<i>OSSL_CMP_CTX_get_status(OSSL_CMP_SRV_CTX_get0_cmp_ctx(srv_ctx))</i>
yields &minus;1 then the function has closed the current
transaction, which may be due to normal successful end of
the transaction or due to an error.</p>


<p style="margin-left:11%; margin-top: 1em"><b>OSSL_CMP_CTX_server_perform()</b>
is an interface to <b>OSSL_CMP_SRV_process_request()</b>
that can be used by a <small>CMP</small> client in the same
way as <b>OSSL_CMP_MSG_http_perform</b>(3). The
<b><small>OSSL_CMP_SRV_CTX</small></b> must be set as
<i>transfer_cb_arg</i> of <i>client_ctx</i>.</p>


<p style="margin-left:11%; margin-top: 1em"><b>OSSL_CMP_SRV_CTX_new()</b>
creates and initializes an
<b><small>OSSL_CMP_SRV_CTX</small></b> structure associated
with the library context <i>libctx</i> and property query
string <i>propq</i>, both of which may be
<small>NULL</small> to select the defaults.</p>


<p style="margin-left:11%; margin-top: 1em"><b>OSSL_CMP_SRV_CTX_free()</b>
deletes the given <i>srv_ctx</i>.</p>


<p style="margin-left:11%; margin-top: 1em"><b>OSSL_CMP_SRV_CTX_init()</b>
sets in the given <i>srv_ctx</i> a custom server context
pointer as well as callback functions performing the
specific processing of <small>CMP</small> certificate
requests, revocation requests, certificate confirmation
requests, general messages, error messages, and poll
requests. All arguments except <i>srv_ctx</i> may be
<small>NULL.</small> If a callback for some message type is
not given this means that the respective type of
<small>CMP</small> message is not supported by the
server.</p>


<p style="margin-left:11%; margin-top: 1em"><b>OSSL_CMP_SRV_CTX_get0_cmp_ctx()</b>
returns the <b><small>OSSL_CMP_CTX</small></b> from the
<i>srv_ctx</i>.</p>


<p style="margin-left:11%; margin-top: 1em"><b>OSSL_CMP_SRV_CTX_get0_custom_ctx()</b>
returns the custom server context from <i>srv_ctx</i> that
has been set using <b>OSSL_CMP_SRV_CTX_init()</b>.</p>


<p style="margin-left:11%; margin-top: 1em"><b>OSSL_CMP_SRV_CTX_set_send_unprotected_errors()</b>
enables sending error messages and other forms of negative
responses unprotected.</p>


<p style="margin-left:11%; margin-top: 1em"><b>OSSL_CMP_SRV_CTX_set_accept_unprotected()</b>
enables acceptance of requests without protection of with
invalid protection.</p>


<p style="margin-left:11%; margin-top: 1em"><b>OSSL_CMP_SRV_CTX_set_accept_raverified()</b>
enables acceptance of ir/cr/kur messages with
<small>POPO</small> &rsquo;RAVerified&rsquo;.</p>


<p style="margin-left:11%; margin-top: 1em"><b>OSSL_CMP_SRV_CTX_set_grant_implicit_confirm()</b>
enables granting implicit confirmation of newly enrolled
certificates if requested.</p>

<h2>NOTES
<a name="NOTES"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em"><small>CMP</small>
is defined in <small>RFC 4210</small> (and
<small>CRMF</small> in <small>RFC 4211</small> ).</p>

<p style="margin-left:11%; margin-top: 1em">So far the
<small>CMP</small> server implementation is limited to one
request per <small>CMP</small> message (and consequently to
at most one response component per <small>CMP</small>
message).</p>

<h2>RETURN VALUES
<a name="RETURN VALUES"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em"><b>OSSL_CMP_SRV_CTX_new()</b>
returns a <b><small>OSSL_CMP_SRV_CTX</small></b> structure
on success, <small>NULL</small> on error.</p>


<p style="margin-left:11%; margin-top: 1em"><b>OSSL_CMP_SRV_CTX_free()</b>
does not return a value.</p>


<p style="margin-left:11%; margin-top: 1em"><b>OSSL_CMP_SRV_CTX_get0_cmp_ctx()</b>
returns a <b><small>OSSL_CMP_CTX</small></b> structure on
success, <small>NULL</small> on error.</p>


<p style="margin-left:11%; margin-top: 1em"><b>OSSL_CMP_SRV_CTX_get0_custom_ctx()</b>
returns the custom server context that has been set using
<b>OSSL_CMP_SRV_CTX_init()</b>.</p>

<p style="margin-left:11%; margin-top: 1em">All other
functions return 1 on success, 0 on error.</p>

<h2>HISTORY
<a name="HISTORY"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">The OpenSSL
<small>CMP</small> support was added in OpenSSL 3.0.</p>

<h2>COPYRIGHT
<a name="COPYRIGHT"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Copyright
2007&minus;2021 The OpenSSL Project Authors. All Rights
Reserved.</p>

<p style="margin-left:11%; margin-top: 1em">Licensed under
the Apache License 2.0 (the &quot;License&quot;). You may
not use this file except in compliance with the License. You
can obtain a copy in the file <small>LICENSE</small> in the
source distribution or at
&lt;https://www.openssl.org/source/license.html&gt;.</p>
<hr>
</body>
</html>
