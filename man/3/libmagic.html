<!-- Creator     : groff version 1.22.4 -->
<!-- CreationDate: Mon May 29 22:55:29 2023 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title></title>
</head>
<body>
<h1>libmagic</h1>

<hr>


<p>LIBMAGIC(3) BSD Library Functions Manual LIBMAGIC(3)</p>

<p style="margin-top: 1em"><b>NAME</b></p>

<p style="margin-left:6%;"><b>magic_open</b>,
<b>magic_close</b>, <b>magic_error</b>, <b>magic_errno</b>,
<b>magic_descriptor</b>, <b>magic_buffer</b>,
<b>magic_getflags</b>, <b>magic_setflags</b>,
<b>magic_check</b>, <b>magic_compile</b>, <b>magic_list</b>,
<b>magic_load</b>, <b>magic_load_buffers</b>,
<b>magic_setparam</b>, <b>magic_getparam</b>,
<b>magic_version</b> &mdash; Magic number recognition
library</p>

<p style="margin-top: 1em"><b>LIBRARY</b></p>

<p style="margin-left:6%;">Magic Number Recognition Library
(libmagic, &minus;lmagic)</p>

<p style="margin-top: 1em"><b>SYNOPSIS</b></p>

<p style="margin-left:6%;"><b>#include
&lt;magic.h&gt;</b></p>


<p style="margin-left:6%; margin-top: 1em"><i>magic_t</i></p>


<p style="margin-left:12%;"><b>magic_open</b>(<i>int&nbsp;flags</i>);</p>

<p style="margin-left:6%; margin-top: 1em"><i>void</i></p>


<p style="margin-left:12%;"><b>magic_close</b>(<i>magic_t&nbsp;cookie</i>);</p>

<p style="margin-left:6%; margin-top: 1em"><i>const char
*</i></p>


<p style="margin-left:12%;"><b>magic_error</b>(<i>magic_t&nbsp;cookie</i>);</p>

<p style="margin-left:6%; margin-top: 1em"><i>int</i></p>


<p style="margin-left:12%;"><b>magic_errno</b>(<i>magic_t&nbsp;cookie</i>);</p>

<p style="margin-left:6%; margin-top: 1em"><i>const char
*</i></p>


<p style="margin-left:12%;"><b>magic_descriptor</b>(<i>magic_t&nbsp;cookie</i>,
<i>int&nbsp;fd</i>);</p>

<p style="margin-left:6%; margin-top: 1em"><i>const char
*</i></p>


<p style="margin-left:12%;"><b>magic_file</b>(<i>magic_t&nbsp;cookie</i>,
<i>const&nbsp;char&nbsp;*filename</i>);</p>

<p style="margin-left:6%; margin-top: 1em"><i>const char
*</i></p>


<p style="margin-left:12%;"><b>magic_buffer</b>(<i>magic_t&nbsp;cookie</i>,
<i>const&nbsp;void&nbsp;*buffer</i>,
<i>size_t&nbsp;length</i>);</p>

<p style="margin-left:6%; margin-top: 1em"><i>int</i></p>


<p style="margin-left:12%;"><b>magic_getflags</b>(<i>magic_t&nbsp;cookie</i>);</p>

<p style="margin-left:6%; margin-top: 1em"><i>int</i></p>


<p style="margin-left:12%;"><b>magic_setflags</b>(<i>magic_t&nbsp;cookie</i>,
<i>int&nbsp;flags</i>);</p>

<p style="margin-left:6%; margin-top: 1em"><i>int</i></p>


<p style="margin-left:12%;"><b>magic_check</b>(<i>magic_t&nbsp;cookie</i>,
<i>const&nbsp;char&nbsp;*filename</i>);</p>

<p style="margin-left:6%; margin-top: 1em"><i>int</i></p>


<p style="margin-left:12%;"><b>magic_compile</b>(<i>magic_t&nbsp;cookie</i>,
<i>const&nbsp;char&nbsp;*filename</i>);</p>

<p style="margin-left:6%; margin-top: 1em"><i>int</i></p>


<p style="margin-left:12%;"><b>magic_list</b>(<i>magic_t&nbsp;cookie</i>,
<i>const&nbsp;char&nbsp;*filename</i>);</p>

<p style="margin-left:6%; margin-top: 1em"><i>int</i></p>


<p style="margin-left:12%;"><b>magic_load</b>(<i>magic_t&nbsp;cookie</i>,
<i>const&nbsp;char&nbsp;*filename</i>);</p>

<p style="margin-left:6%; margin-top: 1em"><i>int</i></p>


<p style="margin-left:12%;"><b>magic_load_buffers</b>(<i>magic_t&nbsp;cookie</i>,
<i>void&nbsp;**buffers</i>, <i>size_t&nbsp;*sizes</i>,
<i>size_t&nbsp;nbuffers</i>);</p>

<p style="margin-left:6%; margin-top: 1em"><i>int</i></p>


<p style="margin-left:12%;"><b>magic_getparam</b>(<i>magic_t&nbsp;cookie</i>,
<i>int&nbsp;param</i>, <i>void&nbsp;*value</i>);</p>

<p style="margin-left:6%; margin-top: 1em"><i>int</i></p>


<p style="margin-left:12%;"><b>magic_setparam</b>(<i>magic_t&nbsp;cookie</i>,
<i>int&nbsp;param</i>,
<i>const&nbsp;void&nbsp;*value</i>);</p>

<p style="margin-left:6%; margin-top: 1em"><i>int</i></p>


<p style="margin-left:12%;"><b>magic_version</b>(<i>void</i>);</p>

<p style="margin-top: 1em"><b>DESCRIPTION</b></p>

<p style="margin-left:6%;">These functions operate on the
magic database file which is described in magic(5).</p>

<p style="margin-left:6%; margin-top: 1em">The function
<b>magic_open</b>() creates a magic cookie pointer and
returns it. It returns NULL if there was an error allocating
the magic cookie. The <i>flags</i> argument specifies how
the other magic functions should behave:</p>

<p style="margin-top: 1em">MAGIC_NONE</p>

<p style="margin-left:27%; margin-top: 1em">No special
handling.</p>

<p style="margin-top: 1em">MAGIC_DEBUG</p>

<p style="margin-left:27%; margin-top: 1em">Print debugging
messages to stderr.</p>

<p style="margin-top: 1em">MAGIC_SYMLINK</p>

<p style="margin-left:27%; margin-top: 1em">If the file
queried is a symlink, follow it.</p>

<p style="margin-top: 1em">MAGIC_COMPRESS</p>

<p style="margin-left:27%; margin-top: 1em">If the file is
compressed, unpack it and look at the contents.</p>

<p style="margin-top: 1em">MAGIC_DEVICES</p>

<p style="margin-left:27%; margin-top: 1em">If the file is
a block or character special device, then open the device
and try to look in its contents.</p>

<p style="margin-top: 1em">MAGIC_MIME_TYPE</p>

<p style="margin-left:27%;">Return a MIME type string,
instead of a textual description.</p>

<p style="margin-top: 1em">MAGIC_MIME_ENCODING</p>

<p style="margin-left:27%;">Return a MIME encoding, instead
of a textual description.</p>

<p style="margin-top: 1em">MAGIC_MIME</p>

<p style="margin-left:27%; margin-top: 1em">A shorthand for
MAGIC_MIME_TYPE | MAGIC_MIME_ENCODING.</p>

<p style="margin-top: 1em">MAGIC_CONTINUE</p>

<p style="margin-left:27%; margin-top: 1em">Return all
matches, not just the first.</p>

<p style="margin-top: 1em">MAGIC_CHECK</p>

<p style="margin-left:27%; margin-top: 1em">Check the magic
database for consistency and print warnings to stderr.</p>

<p style="margin-top: 1em">MAGIC_PRESERVE_ATIME</p>

<p style="margin-left:27%;">On systems that support
utime(3) or utimes(2), attempt to preserve the access time
of files analysed.</p>

<p style="margin-top: 1em">MAGIC_RAW</p>

<p style="margin-left:27%; margin-top: 1em">Don&rsquo;t
translate unprintable characters to a \ooo octal
representation.</p>

<p style="margin-top: 1em">MAGIC_ERROR</p>

<p style="margin-left:27%; margin-top: 1em">Treat operating
system errors while trying to open files and follow symlinks
as real errors, instead of printing them in the magic
buffer.</p>

<p style="margin-top: 1em">MAGIC_APPLE</p>

<p style="margin-left:27%; margin-top: 1em">Return the
Apple creator and type.</p>

<p style="margin-top: 1em">MAGIC_EXTENSION</p>

<p style="margin-left:27%;">Return a slash-separated list
of extensions for this file type.</p>

<p style="margin-top: 1em">MAGIC_COMPRESS_TRANSP</p>

<p style="margin-left:27%;">Don&rsquo;t report on
compression, only report about the uncompressed data.</p>

<p style="margin-top: 1em">MAGIC_NO_CHECK_APPTYPE</p>

<p style="margin-left:27%;">Don&rsquo;t check for EMX
application type (only on EMX).</p>

<p style="margin-top: 1em">MAGIC_NO_COMPRESS_FORK</p>

<p style="margin-left:27%;">Don&rsquo;t allow decompressors
that use fork.</p>

<p style="margin-top: 1em">MAGIC_NO_CHECK_CDF</p>

<p style="margin-left:27%;">Don&rsquo;t get extra
information on MS Composite Document Files.</p>

<p style="margin-top: 1em">MAGIC_NO_CHECK_COMPRESS</p>

<p style="margin-left:27%;">Don&rsquo;t look inside
compressed files.</p>

<p style="margin-top: 1em">MAGIC_NO_CHECK_ELF</p>

<p style="margin-left:27%;">Don&rsquo;t print ELF
details.</p>

<p style="margin-top: 1em">MAGIC_NO_CHECK_ENCODING</p>

<p style="margin-left:27%;">Don&rsquo;t check text
encodings.</p>

<p style="margin-top: 1em">MAGIC_NO_CHECK_SOFT</p>

<p style="margin-left:27%;">Don&rsquo;t consult magic
files.</p>

<p style="margin-top: 1em">MAGIC_NO_CHECK_TAR</p>

<p style="margin-left:27%;">Don&rsquo;t examine tar
files.</p>

<p style="margin-top: 1em">MAGIC_NO_CHECK_TEXT</p>

<p style="margin-left:27%;">Don&rsquo;t check for various
types of text files.</p>

<p style="margin-top: 1em">MAGIC_NO_CHECK_TOKENS</p>

<p style="margin-left:27%;">Don&rsquo;t look for known
tokens inside ascii files.</p>

<p style="margin-top: 1em">MAGIC_NO_CHECK_JSON</p>

<p style="margin-left:27%;">Don&rsquo;t examine JSON
files.</p>

<p style="margin-top: 1em">MAGIC_NO_CHECK_CSV</p>

<p style="margin-left:27%;">Don&rsquo;t examine CSV
files.</p>

<p style="margin-left:6%; margin-top: 1em">The
<b>magic_close</b>() function closes the magic(5) database
and deallocates any resources used.</p>

<p style="margin-left:6%; margin-top: 1em">The
<b>magic_error</b>() function returns a textual explanation
of the last error, or NULL if there was no error.</p>

<p style="margin-left:6%; margin-top: 1em">The
<b>magic_errno</b>() function returns the last operating
system error number (errno(2)) that was encountered by a
system call.</p>

<p style="margin-left:6%; margin-top: 1em">The
<b>magic_file</b>() function returns a textual description
of the contents of the <i>filename</i> argument, or NULL if
an error occurred. If the <i>filename</i> is NULL, then
stdin is used.</p>

<p style="margin-left:6%; margin-top: 1em">The
<b>magic_descriptor</b>() function returns a textual
description of the contents of the <i>fd</i> argument, or
NULL if an error occurred.</p>

<p style="margin-left:6%; margin-top: 1em">The
<b>magic_buffer</b>() function returns a textual description
of the contents of the <i>buffer</i> argument with
<i>length</i> bytes size.</p>

<p style="margin-left:6%; margin-top: 1em">The
<b>magic_getflags</b>() functions returns a value
representing current <i>flags</i> set.</p>

<p style="margin-left:6%; margin-top: 1em">The
<b>magic_setflags</b>() function sets the <i>flags</i>
described above. Note that using both MIME flags together
can also return extra information on the charset.</p>

<p style="margin-left:6%; margin-top: 1em">The
<b>magic_check</b>() function can be used to check the
validity of entries in the colon separated database files
passed in as <i>filename</i>, or NULL for the default
database. It returns 0 on success and &minus;1 on
failure.</p>

<p style="margin-left:6%; margin-top: 1em">The
<b>magic_compile</b>() function can be used to compile the
colon separated list of database files passed in as
<i>filename</i>, or NULL for the default database. It
returns 0 on success and &minus;1 on failure. The compiled
files created are named from the basename(1) of each file
argument with &ldquo;.mgc&rdquo; appended to it.</p>

<p style="margin-left:6%; margin-top: 1em">The
<b>magic_list</b>() function dumps all magic entries in a
human readable format, dumping first the entries that are
matched against binary files and then the ones that match
text files. It takes and optional <i>filename</i> argument
which is a colon separated list of database files, or NULL
for the default database.</p>

<p style="margin-left:6%; margin-top: 1em">The
<b>magic_load</b>() function must be used to load the colon
separated list of database files passed in as
<i>filename</i>, or NULL for the default database file
before any magic queries can performed.</p>

<p style="margin-left:6%; margin-top: 1em">The default
database file is named by the MAGIC environment variable. If
that variable is not set, the default database file name is
/usr/share/file/misc/magic. <b>magic_load</b>() adds
&ldquo;.mgc&rdquo; to the database filename as
appropriate.</p>

<p style="margin-left:6%; margin-top: 1em">The
<b>magic_load_buffers</b>() function takes an array of size
<i>nbuffers</i> of <i>buffers</i> with a respective size for
each in the array of <i>sizes</i> loaded with the contents
of the magic databases from the filesystem. This function
can be used in environment where the magic library does not
have direct access to the filesystem, but can access the
magic database via shared memory or other IPC means.</p>

<p style="margin-left:6%; margin-top: 1em">The
<b>magic_getparam</b>() and <b>magic_setparam</b>() allow
getting and setting various limits related to the magic
library.</p>

<p style="margin-left:78%; margin-top: 1em"><b>Parameter
Type Default</b> <br>
MAGIC_PARAM_INDIR_MAX size_t 15 <br>
MAGIC_PARAM_NAME_MAX size_t 30 <br>
MAGIC_PARAM_ELF_NOTES_MAX size_t 256 <br>
MAGIC_PARAM_ELF_PHNUM_MAX size_t 128 <br>
MAGIC_PARAM_ELF_SHNUM_MAX size_t 32768 <br>
MAGIC_PARAM_REGEX_MAX size_t 8192 <br>
MAGIC_PARAM_BYTES_MAX size_t 1048576</p>

<p style="margin-left:6%; margin-top: 1em">The
MAGIC_PARAM_INDIR_RECURSION parameter controls how many
levels of recursion will be followed for indirect magic
entries.</p>

<p style="margin-left:6%; margin-top: 1em">The
MAGIC_PARAM_NAME_RECURSION parameter controls how many
levels of recursion will be followed for for name/use
calls.</p>

<p style="margin-left:6%; margin-top: 1em">The
MAGIC_PARAM_NAME_MAX parameter controls the maximum number
of calls for name/use.</p>

<p style="margin-left:6%; margin-top: 1em">The
MAGIC_PARAM_NOTES_MAX parameter controls how many ELF notes
will be processed.</p>

<p style="margin-left:6%; margin-top: 1em">The
MAGIC_PARAM_PHNUM_MAX parameter controls how many ELF
program sections will be processed.</p>

<p style="margin-left:6%; margin-top: 1em">The
MAGIC_PARAM_SHNUM_MAX parameter controls how many ELF
sections will be processed.</p>

<p style="margin-left:6%; margin-top: 1em">The
<b>magic_version</b>() command returns the version number of
this library which is compiled into the shared library using
the constant MAGIC_VERSION from &lt;<i>magic.h</i>&gt;. This
can be used by client programs to verify that the version
they compile against is the same as the version that they
run against.</p>

<p style="margin-top: 1em"><b>RETURN VALUES</b></p>

<p style="margin-left:6%;">The function <b>magic_open</b>()
returns a magic cookie on success and NULL on failure
setting errno to an appropriate value. It will set errno to
EINVAL if an unsupported value for flags was given. The
<b>magic_list</b>(), <b>magic_load</b>(),
<b>magic_compile</b>(), and <b>magic_check</b>() functions
return 0 on success and &minus;1 on failure. The
<b>magic_buffer</b>(), <b>magic_getpath</b>(), and
<b>magic_file</b>(), functions return a string on success
and NULL on failure. The <b>magic_error</b>() function
returns a textual description of the errors of the above
functions, or NULL if there was no error. The
<b>magic_version</b>() always returns the version number of
the library. Finally, <b>magic_setflags</b>() returns
&minus;1 on systems that don&rsquo;t support utime(3), or
utimes(2) when MAGIC_PRESERVE_ATIME is set.</p>

<p style="margin-top: 1em"><b>FILES</b> <br>
/usr/share/file/misc/magic</p>

<p style="margin-left:47%; margin-top: 1em">The
non-compiled default magic database.</p>

<p>/usr/share/file/misc/magic.mgc</p>

<p style="margin-left:47%; margin-top: 1em">The compiled
default magic database.</p>

<p style="margin-top: 1em"><b>SEE ALSO</b></p>

<p style="margin-left:6%;">file(1), magic(5)</p>

<p style="margin-top: 1em"><b>BUGS</b></p>

<p style="margin-left:6%;">The results from
<b>magic_buffer</b>() and <b>magic_file</b>() where the
buffer and the file contain the same data can produce
different results, because in the <b>magic_file</b>() case,
the program can lseek(2) and stat(2) the file
descriptor.</p>

<p style="margin-top: 1em"><b>AUTHORS</b></p>

<p style="margin-left:6%;">M&aring;ns Rullg&aring;rd
Initial libmagic implementation, and configuration. <br>
Christos Zoulas API cleanup, error code and allocation
handling.</p>

<p style="margin-left:6%; margin-top: 1em">BSD
September&nbsp;15, 2022 BSD</p>
<hr>
</body>
</html>
