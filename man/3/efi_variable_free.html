<!-- Creator     : groff version 1.22.4 -->
<!-- CreationDate: Mon May 29 22:54:47 2023 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title>EFI_VARIABLE_T</title>

</head>
<body>
<h1>efi_variable_free</h1>



<h2>NAME
<a name="NAME"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em">efi_variable_import,
efi_variable_export, efi_variable_alloc, efi_variable_free,
efi_variable_set_name, efi_variable_get_name,
efi_variable_set_guid, efi_variable_get_guid,
efi_variable_set_data, efi_variable_get_data,
efi_variable_set_attributes, efi_variable_get_attributes,
efi_variable_realize &minus; utility functions to import and
export UEFI variables to files.</p>

<h2>SYNOPSIS
<a name="SYNOPSIS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em"><b>#include
&lt;efivar.h&gt;</b></p>

<p style="margin-left:11%; margin-top: 1em"><i>typedef
struct efi_variable</i> <b>efi_variable_t</b><i>;</i></p>

<p style="margin-left:11%; margin-top: 1em"><i>ssize_t</i>
<b>efi_variable_import</b>(<i>uint8_t *</i><b>data</b>,
<i>size_t</i> <b>size</b>, <i>efi_variable_t
**</i><b>var</b>); <i><br>
ssize_t</i> <b>efi_variable_export</b>(<i>efi_variable_t
*</i><b>var</b>, <i>uint8_t **</i><b>data</b>, <i>size_t
*</i><b>size</b>);</p>


<p style="margin-left:11%; margin-top: 1em"><i>efi_variable_t
*</i><b>efi_variable_alloc</b>(<i>void</i>); <i><br>
void</i> <b>efi_variable_free</b>(<i>efi_variable_t
*</i><b>var</b>, <i>int</i> <b>free_data</b>);</p>

<p style="margin-left:11%; margin-top: 1em"><i>int</i>
<b>efi_variable_set_name</b>(<i>efi_variable_t
*</i><b>var</b>, <i>char *</i><b>name</b>); <i><br>
char *</i><b>efi_variable_get_name</b>(<i>efi_variable_t
*</i><b>var</b>);</p>

<p style="margin-left:11%; margin-top: 1em"><i>int</i>
<b>efi_variable_set_guid</b>(<i>efi_variable_t
*</i><b>var</b>, <i>efi_guid_t *</i><b>guid</b>); <i><br>
int</i> <b>efi_variable_get_guid</b>(<i>efi_variable_t
*</i><b>var</b>, <i>efi_guid_t **</i><b>guid</b>);</p>

<p style="margin-left:11%; margin-top: 1em"><i>int</i>
<b>efi_variable_set_data</b>(<i>efi_variable_t
*</i><b>var</b>, <i>uint8_t *</i><b>data</b>, <i>size_t</i>
<b>size</b>); <i><br>
int</i> <b>efi_variable_get_data</b>(<i>efi_variable_t
*</i><b>var</b>, <i>uint8_t **</i><b>data</b>, <i>size_t
*</i><b>size</b>);</p>

<p style="margin-left:11%; margin-top: 1em"><i>#define</i>
<b>EFI_VARIABLE_NON_VOLATILE</b> <i>0x0000000000000001 <br>
#define</i> <b>EFI_VARIABLE_BOOTSERVICE_ACCESS</b>
<i>0x0000000000000002 <br>
#define</i> <b>EFI_VARIABLE_RUNTIME_ACCESS</b>
<i>0x0000000000000004 <br>
#define</i> <b>EFI_VARIABLE_HARDWARE_ERROR_RECORD</b>
<i>0x0000000000000008 <br>
#define</i> <b>EFI_VARIABLE_AUTHENTICATED_WRITE_ACCESS</b>
<i>0x0000000000000010 <br>
#define</i>
<b>EFI_VARIABLE_TIME_BASED_AUTHENTICATED_WRITE_ACCESS</b>
<i>0x0000000000000020 <br>
#define</i> <b>EFI_VARIABLE_APPEND_WRITE</b>
<i>0x0000000000000040 <br>
#define</i> <b>EFI_VARIABLE_HAS_AUTH_HEADER</b>
<i>0x0000000100000000 <br>
#define</i> <b>EFI_VARIABLE_HAS_SIGNATURE</b>
<i>0x0000000200000000</i></p>

<p style="margin-left:11%; margin-top: 1em"><i>int</i>
<b>efi_variable_set_attributes</b>(<i>efi_variable_t
*</i><b>var</b>, <i>uint64_t</i> <b>attrs</b>); <i><br>
int</i> <b>efi_variable_get_attributes</b>(<i>efi_variable_t
*</i><b>var</b>, <i>uint64_t *</i><b>attrs</b>);</p>

<p style="margin-left:11%; margin-top: 1em"><i>int</i>
<b>efi_variable_realize</b>(<i>efi_variable_t
*</i><b>var</b>);</p>

<h2>DESCRIPTION
<a name="DESCRIPTION"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em"><b>efi_variable_t</b>
is an opaque data type used to store variables in-memory for
use with this API.</p>


<p style="margin-left:11%; margin-top: 1em"><b>efi_variable_import</b>()
is used to import raw data read from a file. This function
returns the amount of data consumed with this variable, and
may be used successively, using its return code as an
offset, to parse a list of variables. Note that the internal
guid, name, and data values are allocated separately, and
must be freed either individually or using the
<b>free_data</b> parameter of <b>efi_variable_free</b>().
<b>_get</b>() accessors for those values return data
suitable for freeing individually, except in such cases
where a <b>_set</b>() accessor has been passed an object
already unsuitable for that.</p>


<p style="margin-left:11%; margin-top: 1em"><b>efi_variable_export</b>()
is used to marshall <b>efi_variable_t</b> objects into
linear data which can be written to a file. If <b>data</b>
or <b>size</b> parameters are not provided, this function
will return how much storage a caller must allocate.
Otherwise, <b>efi_variable_export</b>() will use the storage
referred to as its buffer; if <b>size</b> is smaller than
the amount of needed storage , the buffer will not be
modified, and the difference between the needed space and
<b>size</b> will be returned.</p>


<p style="margin-left:11%; margin-top: 1em"><b>efi_variable_alloc</b>()
is used to allocate an unpopulated <b>efi_variable_t</b>
object suitable to be used throughout this API.
<b>efi_variable_free</b>() is used to free an
<b>efi_variable_t</b> object, and if <b>free_data</b> is
nonzero, to free its constituent data.</p>

<p style="margin-left:11%; margin-top: 1em">Each pair of
<b>_set</b>() and <b>_get</b>() accessors have essentially
the same semantics. Neither operation performs any memory
management, including freeing of previously set values or
values set by <b>efi_variable_import</b>(), and so in some
cases it may be necessary to use a <b>_get</b>() accessor to
retrieve an object to be freed. In cases where no value has
been set, <b>_get</b>() accessors will set <b>errno</b> to
<b>ENOENT</b> and return a negative value or NULL.</p>


<p style="margin-left:11%; margin-top: 1em"><b>efi_variable_set_name</b>()
and <b>efi_variable_get_name</b>() are used to set and
retrieve the name of the variable referred to by the
<b>efi_variable_t</b> object.</p>


<p style="margin-left:11%; margin-top: 1em"><b>efi_variable_set_guid</b>()
and <b>efi_variable_get_guid</b>() are used to set and
retrieve the Vendor GUID value of the variable referred to
by the <b>efi_variable_t</b> object.</p>


<p style="margin-left:11%; margin-top: 1em"><b>efi_variable_set_data</b>()
and <b>efi_variable_get_data</b>() are used to set and
retrieve an <b>efi_variable_t</b> object&rsquo;s variable
data.</p>


<p style="margin-left:11%; margin-top: 1em"><b>efi_variable_set_attributes</b>()
and <b>efi_variable_get_attributes</b> are used to set and
retrieve an <b>efi_variable_t</b> object&rsquo;s attributes.
All bits except <b>EFI_VARIABLE_HAS_AUTH_HEADER</b> and
<b>EFI_VARIABLE_HAS_SIGNATURE</b> are defined in the UEFI
specification and should be used accordingly.
<b>EFI_VARIABLE_HAS_AUTH_HEADER</b> should be used by
applications to track whether the variable data contents
include an authentication header.
<b>EFI_VARIABLE_HAS_SIGNATURE</b> should be used by
applications to track if the variable&rsquo;s data contents
include a signature, and should not be set unless
<b>EFI_VARIABLE_HAS_AUTH_HEADER</b> is also set. These
attributes are used to track if an exported variable is in a
state of partial construction, for example if an
authenticated variable has been created but is intended to
be signed at a later date.</p>


<p style="margin-left:11%; margin-top: 1em"><b>efi_variable_realize</b>()
is a convenience function to set or append a UEFI variable
on the running system from an <b>efi_variable_t</b> object.
its return codes are the same as
<b>efi_append_variable</b>(3) if EFI_VARIABLE_APPEND_WRITE
is set, and <b>efi_set_variable</b>() if that bit is not
set. Additionally, in the case that any of the
authentication bits are set, <b>efi_variable_realize</b>()
will return error and set <b>errno</b> to <b>EPERM</b>
unless both <b>EFI_VARIABLE_HAS_AUTH_HEADER</b> and
<b>EFI_VARIABLE_HAS_SIGNATURE</b> attribute bits are been
set.</p>

<h2>RETURN VALUE
<a name="RETURN VALUE"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em"><b>efi_variable_import</b>()
returns 0 on success, and -1 on failure. In cases where it
cannot parse the data, <b>errno</b> will be set to
<b>EINVAL</b>. In cases where memory has been exhausted,
<b>errno</b> will be set to <b>ENOMEM</b>.</p>


<p style="margin-left:11%; margin-top: 1em"><b>efi_variable_export</b>()
returns the size of the buffer data on success, or a
negative value in the case of an error. If <b>data</b> or
<b>size</b> parameters are not provided, this function will
return how much storage a caller must allocate. Otherwise,
this function will use the storage provided in <b>data</b>;
if <b>size</b> is less than the needed space, the buffer
will not be modified, and the return value will be the
difficiency in size.</p>


<p style="margin-left:11%; margin-top: 1em"><b>efi_variable_alloc</b>()
returns a newly allocated <b>efi_variable_t</b> object, but
does not peform any allocation for that object&rsquo;s
<b>name</b>, <b>guid</b>, or <b>data</b>. In the case that
memory is exhausted, <b>NULL</b> will be returned, and
<b>errno</b> will be set to <b>ENOMEM</b>.</p>


<p style="margin-left:11%; margin-top: 1em"><b>efi_variable_get_name</b>()
returns a pointer the NUL-terminated string containing the
<b>efi_variable_t</b> object&rsquo;s name information.</p>


<p style="margin-left:11%; margin-top: 1em"><b>efi_variable_set_name</b>(),
<b>efi_variable_set_guid</b>(),
<b>efi_variable_get_guid</b>(),
<b>efi_variable_set_data</b>(),
<b>efi_variable_get_data</b>(),
<b>efi_variable_set_attributes</b>(),
<b>efi_variable_get_attributes</b>(), and
<b>efi_variable_realize</b>() return 0 on success and -1 on
error.</p>

<h2>AUTHORS
<a name="AUTHORS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Peter Jones
&lt;pjones@redhat.com&gt;</p>
<hr>
</body>
</html>
