<!-- Creator     : groff version 1.22.4 -->
<!-- CreationDate: Mon May 29 22:55:22 2023 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title>IPQ_MESSAGE_TYPE</title>

</head>
<body>
<h1>ipq_message_type</h1>



<h2>NAME
<a name="NAME"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em">ipq_message_type,
ipq_get_packet, ipq_getmsgerr &mdash; query queue
messages</p>

<h2>SYNOPSIS
<a name="SYNOPSIS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em"><b>#include
&lt;linux/netfilter.h&gt; <br>
#include &lt;libipq.h&gt;</b></p>

<p style="margin-left:11%; margin-top: 1em"><b>int
ipq_message_type(const unsigned char *</b><i>buf</i><b>);
<br>
ipq_packet_msg_t *ipq_get_packet(const unsigned char
*</b><i>buf</i><b>); <br>
int ipq_get_msgerr(const unsigned char
*</b><i>buf</i><b>);</b></p>

<h2>DESCRIPTION
<a name="DESCRIPTION"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">The
<b>ipq_message_type</b> function returns the type of queue
message returned to userspace via <b>ipq_read</b>.</p>


<p style="margin-left:11%; margin-top: 1em"><b>ipq_message_type</b>
should always be called following a successful call to
<b>ipq_read</b> to determine whether the message is a packet
message or an error message. The <i>buf</i> parameter should
be the same data obtained from the previous call to
<b>ipq_read</b>.</p>


<p style="margin-left:11%; margin-top: 1em"><b>ipq_message_type</b>
will return one of the following values: <b><br>
NLMSG_ERROR</b></p>

<p style="margin-left:22%;">An error message generated by
the Netlink transport.</p>

<p style="margin-left:11%;"><b>IPQM_PACKET</b></p>

<p style="margin-left:22%;">A packet message containing
packet metadata and optional packet payload data.</p>

<p style="margin-left:11%; margin-top: 1em">The
<b>ipq_get_packet</b> function should be called if
<b>ipq_message_type</b> returns <b>IPQM_PACKET</b>. The
<i>buf</i> parameter should point to the same data used for
the call to <b>ipq_message_type</b>. The pointer returned by
<b>ipq_get_packet</b> points to a packet message, which is
declared as follows:</p>

<p style="margin-left:22%; margin-top: 1em">typedef struct
ipq_packet_msg {</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="8%"></td>
<td width="7%"></td>
<td width="85%">


<p>unsigned long packet_id; /* ID of queued packet */</p></td></tr>
<tr valign="top" align="left">
<td width="8%"></td>
<td width="7%"></td>
<td width="85%">


<p>unsigned long mark; /* Netfilter mark value */</p></td></tr>
<tr valign="top" align="left">
<td width="8%"></td>
<td width="7%"></td>
<td width="85%">


<p>long timestamp_sec; /* Packet arrival time (seconds)
*/</p> </td></tr>
<tr valign="top" align="left">
<td width="8%"></td>
<td width="7%"></td>
<td width="85%">


<p>long timestamp_usec; /* Packet arrvial time (+useconds)
*/</p> </td></tr>
<tr valign="top" align="left">
<td width="8%"></td>
<td width="7%"></td>
<td width="85%">


<p>unsigned int hook; /* Netfilter hook we rode in on
*/</p> </td></tr>
<tr valign="top" align="left">
<td width="8%"></td>
<td width="7%"></td>
<td width="85%">


<p>char indev_name[IFNAMSIZ]; /* Name of incoming interface
*/</p> </td></tr>
<tr valign="top" align="left">
<td width="8%"></td>
<td width="7%"></td>
<td width="85%">


<p>char outdev_name[IFNAMSIZ]; /* Name of outgoing
interface */</p></td></tr>
<tr valign="top" align="left">
<td width="8%"></td>
<td width="7%"></td>
<td width="85%">


<p>unsigned short hw_protocol; /* Hardware protocol
(network order) */</p></td></tr>
<tr valign="top" align="left">
<td width="8%"></td>
<td width="7%"></td>
<td width="85%">


<p>unsigned short hw_type; /* Hardware type */</p></td></tr>
<tr valign="top" align="left">
<td width="8%"></td>
<td width="7%"></td>
<td width="85%">


<p>unsigned char hw_addrlen; /* Hardware address length
*/</p> </td></tr>
<tr valign="top" align="left">
<td width="8%"></td>
<td width="7%"></td>
<td width="85%">


<p>unsigned char hw_addr[8]; /* Hardware address */</p></td></tr>
<tr valign="top" align="left">
<td width="8%"></td>
<td width="7%"></td>
<td width="85%">


<p>size_t data_len; /* Length of packet data */</p></td></tr>
<tr valign="top" align="left">
<td width="8%"></td>
<td width="7%"></td>
<td width="85%">


<p>unsigned char payload[0]; /* Optional packet data */</p></td></tr>
</table>

<p style="margin-left:22%;">} ipq_packet_msg_t;</p>

<p style="margin-left:11%; margin-top: 1em">Each of these
fields may be read by the application. If the queue mode is
<b>IPQ_COPY_PACKET</b> and the <i>data_len</i> value is
greater than zero, the packet payload contents may be
accessed in the memory following the <b>ipq_packet_msg_t</b>
structure to a range of <i>data_len.</i></p>

<p style="margin-left:11%; margin-top: 1em">The
<i>packet_id</i> field contains a packet identifier to be
used when calling <b>ipq_set_verdict</b>.</p>

<p style="margin-left:11%; margin-top: 1em">The
<b>ipq_get_msgerr</b> function should be called if
<b>ipq_message_type</b> returns <b>NLMSG_ERROR.</b> The
<i>buf</i> parameter should point to the same data used for
the call to <b>ipq_message_type</b>. The value returned by
<b>ipq_get_msgerr</b> is set by higher level kernel code and
corresponds to standard <b>errno</b> values.</p>

<h2>BUGS
<a name="BUGS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">None known.</p>

<h2>AUTHOR
<a name="AUTHOR"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">James Morris
&lt;jmorris@intercode.com.au&gt;</p>

<h2>COPYRIGHT
<a name="COPYRIGHT"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Copyright (c)
2000-2001 Netfilter Core Team.</p>

<p style="margin-left:11%; margin-top: 1em">Distributed
under the GNU General Public License.</p>

<h2>SEE ALSO
<a name="SEE ALSO"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em"><b>iptables</b>(8),
<b>libipq</b>(3).</p>
<hr>
</body>
</html>
