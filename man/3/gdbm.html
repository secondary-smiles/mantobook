<!-- Creator     : groff version 1.22.4 -->
<!-- CreationDate: Mon May 29 22:54:11 2023 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title>GDBM</title>

</head>
<body>
<h1>gdbm</h1>



<h2>NAME
<a name="NAME"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">GDBM &minus;
The GNU database manager. Includes <b>dbm</b> and
<b>ndbm</b> compatibility.</p>

<h2>SYNOPSIS
<a name="SYNOPSIS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em"><b>#include
&lt;gdbm.h&gt;</b></p>

<p style="margin-left:11%; margin-top: 1em"><b>extern
gdbm_error</b> <i>gdbm_errno</i><b>; <br>
extern char *</b><i>gdbm_version</i><b>; <br>
extern int</b> <i>gdbm_version[3]</i><b>; <br>
GDBM_FILE gdbm_open (const char *</b><i>name</i><b>, int</b>
<i>block_size</i><b>, <br>
int</b> <i>flags</i><b>, int</b> <i>mode</i><b>, <br>
void (*</b><i>fatal_func</i><b>)(const char *))</b><i>;</i>
<b><br>
int gdbm_close (GDBM_FILE</b> <i>dbf</i><b>); <br>
int gdbm_store (GDBM_FILE</b> <i>dbf</i><b>, datum</b>
<i>key</i><b>, datum</b> <i>content</i><b>, int</b>
<i>flag</i><b>); <br>
datum gdbm_fetch (GDBM_FILE</b> <i>dbf</i><b>, datum</b>
<i>key</i><b>); <br>
int gdbm_delete (GDBM_FILE</b> <i>dbf</i><b>, datum</b>
<i>key</i><b>); <br>
datum gdbm_firstkey (GDBM_FILE</b> <i>dbf</i><b>); <br>
datum gdbm_nextkey (GDBM_FILE</b> <i>dbf</i><b>, datum</b>
<i>key</i><b>); <br>
int gdbm_recover (GDBM_FILE</b> <i>dbf</i><b>, gdbm_recovery
*</b><i>rcvr</i><b>, int</b><i>flags</i><b>); <br>
int gdbm_reorganize (GDBM_FILE</b> <i>dbf</i><b>); <br>
int gdbm_sync (GDBM_FILE</b> <i>dbf</i><b>); <br>
int gdbm_exists (GDBM_FILE</b> <i>dbf</i><b>, datum</b>
<i>key</i><b>); <br>
const char *gdbm_strerror (gdbm_error</b> <i>errno</i><b>);
<br>
int gdbm_setopt (GDBM_FILE</b> <i>dbf</i><b>, int</b>
<i>option</i><b>, int</b> <i>value</i><b>, int</b>
<i>size</i><b>); <br>
int gdbm_fdesc (GDBM_FILE</b> <i>dbf</i><b>); <br>
int gdbm_count (GDBM_FILE</b> <i>dbf</i><b>, gdbm_count_t
*</b><i>pcount</i><b>); <br>
int gdbm_bucket_count (GDBM_FILE</b> <i>dbf</i><b>, size_t
*</b><i>pcount</i><b>); <br>
int gdbm_avail_verify (GDBM_FILE</b> <i>dbf</i><b>);</b></p>

<p style="margin-left:11%; margin-top: 1em"><b>Crash
Tolerance (see below): <br>
int gdbm_failure_atomic (GDBM_FILE</b> <i>dbf</i><b>, const
char *</b><i>even</i><b>, const char *</b><i>odd</i><b>);
<br>
int gdbm_latest_snapshot (const char *</b><i>even</i><b>,
const char *</b><i>odd</i><b>, const char
**</b><i>result</i><b>);</b></p>

<h2>NOTICE
<a name="NOTICE"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">This manpage is
a short description of the <b>GDBM</b> library. For a
detailed discussion, including examples and usage
recommendations, refer to the <b>GDBM Manual</b> available
in Texinfo format. To access it, run:</p>

<p style="margin-left:11%; margin-top: 1em"><b>info
gdbm</b></p>

<p style="margin-left:11%; margin-top: 1em">The
documentation is also available online at</p>


<p style="margin-left:11%; margin-top: 1em"><b>https://www.gnu.org/software/gdbm/manual</b></p>

<p style="margin-left:11%; margin-top: 1em">Should any
discrepancies occur between this manpage and the <b>GDBM
Manual</b>, the later shall be considered the authoritative
source.</p>

<h2>DESCRIPTION
<a name="DESCRIPTION"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em"><b>GNU dbm</b>
is a library of routines that manages data files that
contain key/data pairs. The access provided is that of
storing, retrieval, and deletion by key and a non-sorted
traversal of all keys. A process is allowed to use multiple
data files at the same time.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Opening a
database</b> <br>
A process that opens a gdbm file is designated as a
&quot;reader&quot; or a &quot;writer&quot;. Only one writer
may open a gdbm file and many readers may open the file.
Readers and writers can not open the gdbm file at the same
time. The procedure for opening a gdbm file is:</p>

<p style="margin-left:11%; margin-top: 1em"><b>GDBM_FILE
gdbm_open (const char *</b><i>name</i><b>, int</b>
<i>block_size</i><b>, <br>
int</b> <i>flags</i><b>, int</b> <i>mode</i><b>, <br>
void (*</b><i>fatal_func</i><b>)(const char
*))</b><i>;</i></p>

<p style="margin-left:11%; margin-top: 1em"><i>Name</i> is
the name of the file (the complete name, <b>gdbm</b> does
not append any characters to this name).</p>


<p style="margin-left:11%; margin-top: 1em"><i>Block_size</i>
is the size of a single transfer from disk to memory. If the
value is less than 512, the file system block size is used
instead. The size is adjusted so that the block can hold
exact number of directory entries, so that the effective
block size can be slightly greater than requested. This
adjustment is disabled if the <b>GDBM_BSEXACT</b>
<i>flag</i> is used.</p>

<p style="margin-left:11%; margin-top: 1em">The
<i>flags</i> parameter is a bitmask, composed of the
<i>access mode</i> and one or more modifier flags. The
<i>access mode</i> bit designates the process as a reader or
writer and must be one of the following: <b><br>
GDBM_READER</b></p>

<p style="margin-left:22%;">reader</p>

<p style="margin-left:11%;"><b>GDBM_WRITER</b></p>

<p style="margin-left:22%;">writer</p>

<p style="margin-left:11%;"><b>GDBM_WRCREAT</b></p>

<p style="margin-left:22%;">writer - if database does not
exist create new one</p>

<p style="margin-left:11%;"><b>GDBM_NEWDB</b></p>

<p style="margin-left:22%;">writer - create new database
regardless if one exists</p>

<p style="margin-left:11%; margin-top: 1em">Additional
flags (<i>modifiers</i>) can be combined with these values
by bitwise <b>OR</b>. Not all of them are meaningful with
all access modes.</p>

<p style="margin-left:11%; margin-top: 1em">Flags that are
valid for any value of access mode are: <b><br>
GDBM_CLOEXEC</b></p>

<p style="margin-left:22%;">Set the <i>close-on-exec</i>
flag on the database file descriptor.</p>

<p style="margin-left:11%;"><b>GDBM_NOLOCK</b></p>

<p style="margin-left:22%;">Prevents the library from
performing any locking on the database file.</p>

<p style="margin-left:11%;"><b>GDBM_NOMMAP</b></p>

<p style="margin-left:22%;">Instructs <b>gdbm_open</b> to
disable the use of <b>mmap</b>(2).</p>

<p style="margin-left:11%;"><b>GDBM_PREREAD</b></p>

<p style="margin-left:22%;">When mapping GDBM file to
memory, read its contents immediately, instead of when
needed (<i>prefault reading</i>). This can be advantageous
if you open a <i>read-only</i> database and are going to do
a lot of look-ups on it. In this case entire database will
be read at once and searches will operate on an in-memory
copy. In contrast, <b>GDBM_PREREAD</b> should not be used if
you open a database (even in read-only mode) only to
retrieve a couple of keys.</p>

<p style="margin-left:22%; margin-top: 1em">Finally, never
use <b>GDBM_PREREAD</b> when opening a database for updates,
especially for inserts: this will degrade performance.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="22%"></td>
<td width="-14%">


<p>This flag has no effect if <b>GDBM_NOMMAP</b> is given,
or if the operating system does not support prefault
reading. It is known to work on Linux and FreeBSD
kernels.</p> </td>
<td width="54%"></td>
<td width="7%"></td>
<td width="8%"></td>
<td width="8%"></td>
<td width="7%"></td>
<td width="8%">
</td></tr>
</table>

<p style="margin-left:11%;"><b>GDBM_XVERIFY</b></p>

<p style="margin-left:22%;">Enable additional consistency
checks. With this flag, eventual corruptions of the database
are discovered when opening it, instead of when a corrupted
structure is read during normal operation. However, on large
databases, it can slow down the opening process.</p>

<p style="margin-left:11%; margin-top: 1em">The following
additional flags are valid when the database is opened for
writing (<b>GDBM_WRITER</b>, <b>GDBM_WRCREAT</b>, or
<b>GDBM_NEWDB</b>): <b><br>
GDBM_SYNC</b></p>

<p style="margin-left:22%;">Causes all database operations
to be synchronized to the disk.</p>

<p style="margin-left:22%; margin-top: 1em"><b>NOTE</b>:
this option entails severe performance degradation and does
not necessarily ensure that the resulting database state is
consistent, therefore we discourage its use. For a
discussion of how to ensure database consistency with
minimal performance overhead, see <b>CRASH TOLERANCE</b>
below.</p>

<p style="margin-left:11%;"><b>GDBM_FAST</b></p>

<p style="margin-left:22%;">A reverse of <b>GDBM_SYNC</b>:
synchronize writes only when needed. This is the default.
This flag is provided only for compatibility with previous
versions of GDBM.</p>

<p style="margin-left:11%; margin-top: 1em">The following
flags can be used together with <b>GDBM_NEWDB</b>. They also
take effect when used with <b>GDBM_WRCREAT</b>, if the
requested database file doesn&rsquo;t exist: <b><br>
GDBM_BSEXACT</b></p>

<p style="margin-left:22%;">If this flag is set and the
requested <i>block_size</i> value cannot be used,
<b>gdbm_open</b> will refuse to create the database. In this
case it will set the <b>gdbm_errno</b> variable to
<b>GDBM_BLOCK_SIZE_ERROR</b> and return <b>NULL</b>.</p>

<p style="margin-left:22%; margin-top: 1em">Without this
flag, <b>gdbm_open</b> will silently adjust the
<i>block_size</i> to a usable value, as described above.</p>

<p style="margin-left:11%;"><b>GDBM_NUMSYNC</b></p>

<p style="margin-left:22%;">Create new database in
<i>extended database format</i>, a format best suited for
effective crash recovery. For a detailed discussion, see the
<b>CRASH RECOVERY</b> chapter below.</p>

<p style="margin-left:11%; margin-top: 1em"><i>Mode</i> is
the file mode (see <b>chmod</b>(2) and <b>open</b>(2)). It
is used if the file is created.</p>


<p style="margin-left:11%; margin-top: 1em"><i>Fatal_func</i>
is a function to be called when <b>gdbm</b> if it encounters
a fatal error. This parameter is deprecated and must always
be <b>NULL</b>.</p>

<p style="margin-left:11%; margin-top: 1em">The return
value is the pointer needed by all other routines to access
that gdbm file. If the return is the <b>NULL</b> pointer,
<b>gdbm_open</b> was not successful. In this case, the
reason of the failure can be found in the <i>gdbm_errno</i>
variable. If the following call returns <i>true</i>
(non-zero value):</p>


<p style="margin-left:18%; margin-top: 1em">gdbm_check_syserr(gdbm_open)</p>

<p style="margin-left:11%; margin-top: 1em">the system
<i>errno</i> variable must be examined in order to obtain
more detail about the failure.</p>

<p style="margin-left:11%; margin-top: 1em"><b>GDBM_FILE
gdbm_fd_open (int</b> <i>FD</i><b>, const char
*</b><i>name</i><b>, int</b> <i>block_size</i><b>, <br>
int</b> <i>flags</i><b>, int</b> <i>mode</i><b>, <br>
void (*</b><i>fatal_func</i><b>)(const char
*))</b><i>;</i></p>

<p style="margin-left:11%; margin-top: 1em">This is an
alternative entry point to <b>gdbm_open</b>. <i>FD</i> is a
valid file descriptor obtained as a result of a call to
<b>open</b>(2) or <b>creat</b>(2). The function opens (or
creates) a DBM database this descriptor refers to. The
descriptor is not <b>dup</b>&rsquo;ed, and will be closed
when the returned <b>GDBM_FILE</b> is closed. Use <b>dup
(2)</b> if that is not desirable.</p>

<p style="margin-left:11%; margin-top: 1em">In case of
error, the function behaves like <b>gdbm_open</b> and
<b>does not close</b> <i>FD</i>. This can be altered by the
following value passed in <i>flags</i>: <b><br>
GDBM_CLOERROR</b></p>

<p style="margin-left:22%;">Close <i>FD</i> before exiting
on error.</p>

<p style="margin-left:22%; margin-top: 1em">The rest of
arguments are the same as for <b>gdbm_open</b>.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Calling
convention</b> <br>
All <b>GDBM</b> functions take as their first parameter the
<i>database handle</i> (<b>GDBM_FILE</b>), returned from
<b>gdbm_open</b> or <b>gdbm_fd_open</b>.</p>

<p style="margin-left:11%; margin-top: 1em">Any value
stored in the <b>GDBM</b> database is described by
<i>datum</i>, an aggregate type defined as:</p>

<p style="margin-left:18%; margin-top: 1em">typedef struct
<br>
{ <br>
char *dptr; <br>
int dsize; <br>
} datum;</p>

<p style="margin-left:11%; margin-top: 1em">The <i>dptr</i>
field points to the actual data. Its type is <b>char *</b>
for historical reasons. Actually it should have been typed
<b>void *</b>. Programmers are free to store data of
arbitrary complexity, both scalar and aggregate, in this
field.</p>

<p style="margin-left:11%; margin-top: 1em">The
<i>dsize</i> field contains the number of bytes stored in
<b>dptr</b>.</p>

<p style="margin-left:11%; margin-top: 1em">The
<b>datum</b> type is used to describe both <i>keys</i> and
<i>content</i> (values) in the database. Values of this type
can be passed as arguments or returned from <b>GDBM</b>
function calls.</p>

<p style="margin-left:11%; margin-top: 1em"><b>GDBM</b>
functions that return <b>datum</b> indicate failure by
setting its <i>dptr</i> field to <b>NULL</b>.</p>

<p style="margin-left:11%; margin-top: 1em">Functions
returning integer value, indicate success by returning 0 and
failure by returning a non-zero value (the only exception to
this rule is <b>gdbm_exists</b>, for which the return value
is reversed).</p>

<p style="margin-left:11%; margin-top: 1em">If the returned
value indicates failure, the <b>gdbm_errno</b> variable
contains an integer value indicating what went wrong. A
similar value is associated with the <i>dbf</i> handle and
can be accessed using the <b>gdbm_last_errno</b> function.
Immediately after return from a function, both values are
exactly equal. Subsequent <b>GDBM</b> calls with another
<i>dbf</i> as argument may alter the value of the global
<b>gdbm_errno</b>, but the value returned by
<b>gdbm_last_errno</b> will always indicate the most recent
code of an error that occurred for <i>that particular
database</i>. Programmers are encouraged to use such
per-database error codes.</p>

<p style="margin-left:11%; margin-top: 1em">Sometimes the
actual reason of the failure can be clarified by examining
the system <b>errno</b> value. To make sure its value is
meaningful for a given <b>GDBM</b> error code, use the
<b>gdbm_check_syserr</b> function. The function takes error
code as argument and returns 1 if the <b>errno</b> is
meaningful for that error, or 0 if it is irrelevant.</p>

<p style="margin-left:11%; margin-top: 1em">Similarly to
<b>gdbm_errno</b>, the latest <b>errno</b> value associated
with a particular database can be obtained using the
<b>gdbm_last_syserr</b> function.</p>

<p style="margin-left:11%; margin-top: 1em">The
<b>gdbm_clear_error</b> clears the error indicator (both
<b>GDBM</b> and system error codes) associated with a
database handle.</p>

<p style="margin-left:11%; margin-top: 1em">Some critical
errors leave the database in a <i>structurally inconsistent
state</i>. If that happens, all subsequent <b>GDBM</b> calls
accessing that database will fail with the <b>GDBM</b> error
code of <b>GDBM_NEED_RECOVERY</b> (a special function
<b>gdbm_needs_recovery</b> is also provided, which returns
true if the database handle given as its argument is
structurally inconsistent). To return such databases to
consistent state, use the <b>gdbm_recover</b> function (see
below).</p>

<p style="margin-left:11%; margin-top: 1em">The
<b>GDBM_NEED_RECOVERY</b> error cannot be cleared using
<b>gdbm_clear_error</b>.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Error
functions</b> <br>
This section describes the error handling functions outlined
above. <b><br>
gdbm_error gdbm_last_errno (GDBM_FILE</b>
<i>dbf</i><b>)</b></p>

<p style="margin-left:22%;">Returns the error code of the
most recent failure encountered when operating on
<i>dbf</i>.</p>

<p style="margin-left:11%;"><b>int gdbm_last_syserr
(GDBM_FILE</b> <i>dbf</i><b>)</b></p>

<p style="margin-left:22%;">Returns the value of the system
<b>errno</b> variable associated with the most recent
failure that occurred on <i>dbf</i>.</p>

<p style="margin-left:22%; margin-top: 1em">Notice that not
all <b>gdbm_error</b> codes have a relevant system error
code. Use the following function to determine if a given
code has.</p>

<p style="margin-left:11%;"><b>int gdbm_check_syserr
(gdbm_error</b> <i>err</i><b>)</b></p>

<p style="margin-left:22%;">Returns <b>1</b>, if system
<b>errno</b> value should be checked to get more info on the
error described by GDBM code <i>err</i>.</p>

<p style="margin-left:11%;"><b>void gdbm_clear_error
(GDBM_FILE</b> <i>dbf</i><b>)</b></p>

<p style="margin-left:22%;">Clears the error state for the
database <i>dbf</i>. This function is called implicitly upon
entry to any GDBM function that operates on
<b>GDBM_FILE</b>.</p>

<p style="margin-left:22%; margin-top: 1em">The
<b>GDBM_NEED_RECOVERY</b> error cannot be cleared.</p>

<p style="margin-left:11%;"><b>int gdbm_needs_recovery
(GDBM_FILE</b> <i>dbf</i><b>)</b></p>

<p style="margin-left:22%;">Return <b>1</b> if the database
file <i>dbf</i> is in inconsistent state and needs
recovery.</p>

<p style="margin-left:11%;"><b>const char *gdbm_strerror
(gdbm_error</b> <i>err</i><b>)</b></p>

<p style="margin-left:22%;">Returns a textual description
of the error code <i>err</i>.</p>

<p style="margin-left:11%;"><b>const char *gdbm_db_strerror
(GDBM_FILE</b> <i>dbf</i><b>)</b></p>

<p style="margin-left:22%;">Returns a textual description
of the recent error in database <i>dbf</i>. This description
includes the system <b>errno</b> value, if relevant.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Closing the
database</b> <br>
It is important that every database file opened is also
closed. This is needed to update the reader/writer count on
the file. This is done by: <b><br>
int gdbm_close (GDBM_FILE</b> <i>dbf</i><b>);</b></p>

<p style="margin-left:11%; margin-top: 1em"><b>Database
lookups <br>
int gdbm_exists (GDBM_FILE</b> <i>dbf</i><b>, datum</b>
<i>key</i><b>);</b></p>

<p style="margin-left:22%;">If the <i>key</i> is found
within the database, the return value will be <i>true</i>
(<b>1</b>). If nothing appropriate is found, <i>false</i>
(<b>0</b>) is returned and <b>gdbm_errno</b> set to
<b>GDBM_NO_ERROR</b>.</p>

<p style="margin-left:22%; margin-top: 1em">On error,
returns 0 and sets <b>gdbm_errno</b>.</p>

<p style="margin-left:11%;"><b>datum gdbm_fetch
(GDBM_FILE</b> <i>dbf</i><b>, datum</b>
<i>key</i><b>);</b></p>

<p style="margin-left:22%;"><i>Dbf</i> is the pointer
returned by <b>gdbm_open</b>. <i>Key</i> is the key
data.</p>

<p style="margin-left:22%; margin-top: 1em">If the
<i>dptr</i> element of the return value is <b>NULL</b>, the
<b>gdbm_errno</b> variable should be examined. The value of
<b>GDBM_ITEM_NOT_FOUND</b> means no data was found for that
<i>key</i>. Other value means an error occurred.</p>

<p style="margin-left:22%; margin-top: 1em">Otherwise the
return value is a pointer to the found data. The storage
space for the <i>dptr</i> element is allocated using
<b>malloc(3)</b>. <b>GDBM</b> does not automatically free
this data. It is the programmer&rsquo;s responsibility to
free this storage when it is no longer needed.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Iterating
over the database</b> <br>
The following two routines allow for iterating over all
items in the database. Such iteration is not key sequential,
but it is guaranteed to visit every key in the database
exactly once. (The order has to do with the hash values.)
<b><br>
datum gdbm_firstkey (GDBM_FILE</b> <i>dbf</i><b>);</b></p>

<p style="margin-left:22%;">Returns first key in the
database.</p>

<p style="margin-left:11%;"><b>datum gdbm_nextkey
(GDBM_FILE</b> <i>dbf</i><b>, datum</b>
<i>key</i><b>);</b></p>

<p style="margin-left:22%;">Given a <i>key</i>, returns the
database key that follows it. End of iteration is marked by
returning <i>datum</i> with <i>dptr</i> field set to
<b>NULL</b> and setting the <b>gdbm_errno</b> value to
<b>GDBM_ITEM_NOT_FOUND</b>.</p>

<p style="margin-left:11%; margin-top: 1em">After
successful return from both functions, <i>dptr</i> points to
data allocated by <b>malloc</b>(3). It is the caller
responsibility to free the data when no longer needed.</p>

<p style="margin-left:11%; margin-top: 1em">A typical
iteration loop looks like:</p>

<p style="margin-left:18%; margin-top: 1em">datum key,
nextkey, content; <br>
key = gdbm_firstkey (dbf); <br>
while (key.dptr) <br>
{ <br>
content = gdbm_fetch (dbf, key); <br>
/* Do something with key and/or content */ <br>
nextkey = gdbm_nextkey (dbf, key); <br>
free (key.dptr); <br>
key = nextkey; <br>
}</p>

<p style="margin-left:11%; margin-top: 1em">These functions
are intended to visit the database in read-only algorithms.
Avoid any database modifications within the iteration loop.
File <i>visiting</i> is based on a hash table. The
<b>gdbm_delete</b> and, in most cases, <b>gdbm_store</b>,
functions rearrange the hash table to make sure that any
collisions in the table do not leave some item
&lsquo;un-findable&rsquo;. Thus, a call to either of these
functions changes the order in which the keys are ordered.
Therefore, these functions should not be used when iterating
over all the keys in the database. For example, the
following loop is wrong: it is possible that some keys will
not be visited or will be visited twice if it is
executed:</p>

<p style="margin-left:18%; margin-top: 1em">key =
gdbm_firstkey (dbf); <br>
while (key.dptr) <br>
{ <br>
nextkey = gdbm_nextkey (dbf, key); <br>
if (some condition) <br>
gdbm_delete ( dbf, key ); <br>
free (key.dptr); <br>
key = nextkey; <br>
}</p>

<p style="margin-left:11%; margin-top: 1em"><b>Updating the
database <br>
int gdbm_store (GDBM_FILE</b> <i>dbf</i><b>, datum</b>
<i>key</i><b>, datum</b> <i>content</i><b>, int</b>
<i>flag</i><b>);</b></p>

<p style="margin-left:22%;"><i>Dbf</i> is the pointer
returned by <b>gdbm_open</b>. <i>Key</i> is the key data.
<i>Content</i> is the data to be associated with the
<i>key</i>. <i>Flag</i> can have one of the following
values:</p>

<p style="margin-left:17%;"><b>GDBM_INSERT</b></p>

<p style="margin-left:28%;">Insert only, generate an error
if key exists;</p>

<p style="margin-left:17%;"><b>GDBM_REPLACE</b></p>

<p style="margin-left:28%;">Replace contents if key
exists.</p>

<p style="margin-left:22%; margin-top: 1em">The function
returns 0 on success and &minus;1 on failure. If the key
already exists in the database and the <i>flag</i> is
<b>GDBM_INSERT</b>, the function does not modify the
database. It sets <b>gdbm_errno</b> to
<b>GDBM_CANNOT_REPLACE</b> and returns 1.</p>

<p style="margin-left:11%;"><b>int gdbm_delete
(GDBM_FILE</b> <i>dbf</i><b>, datum</b>
<i>key</i><b>);</b></p>

<p style="margin-left:22%;">Looks up and deletes the given
<i>key</i> from the database <i>dbf</i>.</p>

<p style="margin-left:22%; margin-top: 1em">The return
value is 0 if there was a successful delete or &minus;1 on
error. In the latter case, the <b>gdbm_errno</b> value
<b>GDBM_ITEM_NOT_FOUND</b> indicates that the key is not
present in the database. Other <b>gdbm_errno</b> values
indicate failure.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Recovering
structural consistency</b> <br>
If a function leaves the database in structurally
inconsistent state, it can be recovered using the
<b>gdbm_recover</b> function. <b><br>
int gdbm_recover (GDBM_FILE</b> <i>dbf</i><b>, gdbm_recovery
*</b> <i>rcvr</i><b>, int</b> <i>flags</i><b>)</b></p>

<p style="margin-left:22%;">Check the database file DBF and
fix eventual inconsistencies. The <i>rcvr</i> argument can
be used both to control the recovery and to return
additional statistics about the process, as indicated by
<i>flags</i>. For a detailed discussion of these arguments
and their usage, see the <b>GDBM Manual</b>, chapter
<b>Recovering structural consistency</b>.</p>

<p style="margin-left:22%; margin-top: 1em">You can pass
<b>NULL</b> as <i>rcvr</i> and <b>0</b> as <i>flags</i>, if
no such control is needed.</p>

<p style="margin-left:22%; margin-top: 1em">By default,
this function first checks the database for inconsistencies
and attempts recovery only if some were found. The special
<i>flags</i> bit <b>GDBM_RCVR_FORCE</b> instructs
<b>gdbm_recovery</b> to skip this check and to perform
database recovery unconditionally.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Export and
import <br>
GDBM</b> database files can be exported (dumped) to so
called <i>flat files</i> or imported (loaded) from them. A
flat file contains exactly the same data as the original
database, but it cannot be used for searches or updates. Its
purpose is to keep the data from the database for restoring
it when the need arrives. As such, flat files are used for
backup purposes, and for sending databases over the
wire.</p>

<p style="margin-left:11%; margin-top: 1em">As of
<b>GDBM</b> version 1.21, there are two flat file formats.
The <b>ASCII</b> file format encodes all data in Base64 and
stores not only key/data pairs, but also the original
database file metadata, such as file name, mode and
ownership. Files in this format can be sent without
additional encapsulation over transmission channels that
normally allow only ASCII data, such as, e.g. SMTP. Due to
additional metadata they allow for restoring an exact copy
of the database, including file ownership and privileges,
which is especially important if the database in question
contained some security-related data. This is the preferred
format.</p>

<p style="margin-left:11%; margin-top: 1em">Another flat
file format is the <b>binary</b> format. It stores only
key/data pairs and does not keep information about the
database file itself. It cannot be used to copy databases
between different architectures. The binary format was
introduced in <b>GDBM</b> version 1.9.1 and is retained
mainly for backward compatibility.</p>

<p style="margin-left:11%; margin-top: 1em">The following
functions are used to export or import <b>GDBM</b> database
files. <b><br>
int gdbm_dump (GDBM_FILE</b> <i>dbf</i><b>, const char
*</b><i>filename</i><b>, <br>
int</b> <i>format</i><b>, int</b> <i>open_flag</i><b>,
int</b> <i>mode</i><b>)</b></p>

<p style="margin-left:22%;">Dumps the database file
<i>dbf</i> to the file <i>filename</i> in requested
<i>format</i>. Allowed values for <i>format</i> are:
<b>GDBM_DUMP_FMT_ASCII</b>, to create an ASCII dump file,
and <b>GDBM_DUMP_FMT_BINARY</b>, to create a binary
dump.</p>

<p style="margin-left:22%; margin-top: 1em">The value of
<i>open_flag</i> tells <b>gdbm_dump</b> what to do if
<i>filename</i> already exists. If it is <b>GDBM_NEWDB</b>,
the function will create a new output file, replacing it if
it already exists. If its value is <b>GDBM_WRCREAT</b>, the
file will be created if it does not exist. If it does exist,
<b>gdbm_dump</b> will return error.</p>

<p style="margin-left:22%; margin-top: 1em">The file mode
to use when creating the output file is defined by the
<i>mode</i> parameter. Its meaning is the same as for
<b>open</b>(2).</p>

<p style="margin-left:11%;"><b>int gdbm_load (GDBM_FILE
*</b><i>pdbf</i><b>, const char *</b><i>filename</i><b>,
<br>
int</b> <i>flag</i><b>, int</b> <i>meta_mask</i><b>,
unsigned long *</b><i>errline</i><b>)</b></p>

<p style="margin-left:22%;">Loads data from the dump file
<i>filename</i> into the database pointed to by <i>pdbf</i>.
If <i>pdbf</i> is <b>NULL</b>, the function will try to
create a new database. On success, the new <b>GDBM_FILE</b>
object will be stored in the memory location pointed to by
<i>pdbf</i>. If the dump file carries no information about
the original database file name, the function will set
<b>gdbm_errno</b> to <b>GDBM_NO_DBNAME</b> and return -1,
indicating failure.</p>

<p style="margin-left:22%; margin-top: 1em">Otherwise, if
<i>pdbf</i> points to an already open <b>GDBM_FILE</b>, the
function will load data from <i>filename</i> into that
database.</p>

<p style="margin-left:22%; margin-top: 1em">The <i>flag</i>
parameter controls the function behavior if a key from the
dump file already exists in the database. See the
<b>gdbm_store</b> function for its possible values.</p>

<p style="margin-left:22%; margin-top: 1em">The
<i>meta_mask</i> parameter can be used to disable restoring
certain bits of file&rsquo;s meta-data from the information
in the input dump file. It is a binary OR of zero or more of
the following:</p>

<p style="margin-left:17%;"><b>GDBM_META_MASK_MODE</b></p>

<p style="margin-left:28%;">Do not restore file mode.</p>


<p style="margin-left:17%;"><b>GDBM_META_MASK_OWNER</b></p>

<p style="margin-left:28%;">Do not restore file owner.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Other
functions <br>
int gdbm_reorganize (GDBM_FILE</b> <i>dbf</i><b>);</b></p>

<p style="margin-left:22%;">If you have had a lot of
deletions and would like to shrink the space used by the
<b>GDBM</b> file, this routine will reorganize the
database.</p>

<p style="margin-left:11%;"><b>int gdbm_sync (GDBM_FILE</b>
<i>dbf</i><b>);</b></p>

<p style="margin-left:22%;">Synchronizes the changes in
<i>dbf</i> with its disk file.</p>

<p style="margin-left:22%; margin-top: 1em">It will not
return until the disk file state is synchronized with the
in-memory state of the database.</p>

<p style="margin-left:11%;"><b>int gdbm_setopt
(GDBM_FILE</b> <i>dbf</i><b>, int</b> <i>option</i><b>, void
*</b><i>value</i><b>, int</b> <i>size</i><b>);</b></p>

<p style="margin-left:22%;">Query or change some parameter
of an already opened database. The <i>option</i> argument
defines what parameter to set or retrieve. If the <i>set</i>
operation is requested, <i>value</i> points to the new
value. Its actual data type depends on <i>option</i>. If the
<i>get</i> operation is requested, <i>value</i> points to a
memory region where to store the return value. In both
cases, <i>size</i> contains the actual size of the memory
pointed to by <i>value</i>.</p>

<p style="margin-left:22%; margin-top: 1em">Possible values
of <i>option</i> are:</p>

<p style="margin-left:17%;"><b>GDBM_SETCACHESIZE <br>
GDBM_CACHESIZE</b></p>

<p style="margin-left:28%;">Set the size of the internal
bucket cache. The <i>value</i> should point to a
<b>size_t</b> holding the desired cache size, or the
constant <b>GDBM_CACHE_AUTO</b>, to select the best cache
size automatically.</p>

<p style="margin-left:28%; margin-top: 1em">By default, a
newly open database is configured to adapt the cache size to
the number of index buckets in the database file. This
provides for the best performance.</p>

<p style="margin-left:28%; margin-top: 1em">Use this option
if you wish to limit the memory usage at the expense of
performance. If you chose to do so, please bear in mind that
cache becomes effective when its size is greater then 2/3 of
the number of index bucket counts in the database. The best
performance results are achieved when cache size equals the
number of buckets.</p>

<p style="margin-left:17%;"><b>GDBM_GETCACHESIZE</b></p>

<p style="margin-left:28%;">Return the size of the internal
bucket cache. The <i>value</i> should point to a
<b>size_t</b> variable, where the size will be stored.</p>

<p style="margin-left:17%;"><b>GDBM_GETFLAGS</b></p>

<p style="margin-left:28%;">Return the flags describing
current state of the database. The <i>value</i> should point
to an <b>int</b> variable where to store the flags. On
success, its value will be similar to the flags used when
opening the database, except that it will reflect the
current state (which may have been altered by another calls
to <b>gdbm_setopt</b>).</p>

<p style="margin-left:17%;"><b>GDBM_FASTMODE</b></p>

<p style="margin-left:28%;">Enable or disable the <i>fast
writes mode</i>, similar to the <b>GDBM_FAST</b> option to
<b>gdbm_open</b>.</p>

<p style="margin-left:28%; margin-top: 1em">This option is
retained for compatibility with previous versions of
<b>GDBM</b>.</p>

<p style="margin-left:17%;"><b>GDBM_SETSYNCMODE <br>
GDBM_SYNCMODE</b></p>

<p style="margin-left:28%;">Turn on or off immediate disk
synchronization after updates. The <i>value</i> should point
to an integer: 1 to turn synchronization on, and 0 to turn
it off.</p>

<p style="margin-left:28%; margin-top: 1em"><b>NOTE</b>:
setting this option entails severe performance degradation
and does not necessarily ensure that the resulting database
state is consistent, therefore we discourage its use. For a
discussion of how to ensure database consistency with
minimal performance overhead, see <b>CRASH TOLERANCE</b>
below.</p>

<p style="margin-left:17%;"><b>GDBM_GETSYNCMODE</b></p>

<p style="margin-left:28%;">Return the current
synchronization status. The <i>value</i> should point to an
<b>int</b> where the status will be stored.</p>

<p style="margin-left:17%;"><b>GDBM_SETCENTFREE <br>
GDBM_CENTFREE</b></p>

<p style="margin-left:28%;">Enable or disable central free
block pool. The default is off, which is how previous
versions of <b>GDBM</b> handled free blocks. If set, this
option causes all subsequent free blocks to be placed in the
<i>global</i> pool, allowing (in theory) more file space to
be reused more quickly. The <i>value</i> should point to an
integer: <b>TRUE</b> to turn central block pool on, and
<b>FALSE</b> to turn it off.</p>

<p style="margin-left:28%; margin-top: 1em">The
<b>GDBM_CENTFREE</b> alias is provided for compatibility
with earlier versions.</p>

<p style="margin-left:17%;"><b>GDBM_SETCOALESCEBLKS <br>
GDBM_COALESCEBLKS</b></p>

<p style="margin-left:28%;">Set free block merging to
either on or off. The default is off, which is how previous
versions of <b>GDBM</b> handled free blocks. If set, this
option causes adjacent free blocks to be merged. This can
become a CPU expensive process with time, though, especially
if used in conjunction with <b>GDBM_CENTFREE</b>. The
<i>value</i> should point to an integer: <b>TRUE</b> to turn
free block merging on, and <b>FALSE</b> to turn it off.</p>


<p style="margin-left:17%;"><b>GDBM_GETCOALESCEBLKS</b></p>

<p style="margin-left:28%;">Return the current status of
free block merging. The <i>value</i> should point to an
<b>int</b> where the status will be stored.</p>

<p style="margin-left:17%;"><b>GDBM_SETMAXMAPSIZE</b></p>

<p style="margin-left:28%;">Sets maximum size of a memory
mapped region. The <i>value</i> should point to a value of
type <b>size_t</b>, <b>unsigned long</b> or <b>unsigned</b>.
The actual value is rounded to the nearest page boundary
(the page size is obtained from
<b>sysconf(_SC_PAGESIZE)</b>).</p>

<p style="margin-left:17%;"><b>GDBM_GETMAXMAPSIZE</b></p>

<p style="margin-left:28%;">Return the maximum size of a
memory mapped region. The <i>value</i> should point to a
value of type <b>size_t</b> where to return the data.</p>

<p style="margin-left:17%;"><b>GDBM_SETMMAP</b></p>

<p style="margin-left:28%;">Enable or disable memory
mapping mode. The <i>value</i> should point to an integer:
<b>TRUE</b> to enable memory mapping or <b>FALSE</b> to
disable it.</p>

<p style="margin-left:17%;"><b>GDBM_GETMMAP</b></p>

<p style="margin-left:28%;">Check whether memory mapping is
enabled. The <i>value</i> should point to an integer where
to return the status.</p>

<p style="margin-left:17%;"><b>GDBM_GETDBNAME</b></p>

<p style="margin-left:28%;">Return the name of the database
disk file. The <i>value</i> should point to a variable of
type <b>char**</b>. A pointer to the newly allocated copy of
the file name will be placed there. The caller is
responsible for freeing this memory when no longer
needed.</p>

<p style="margin-left:17%;"><b>GDBM_GETBLOCKSIZE</b></p>

<p style="margin-left:28%;">Return the block size in bytes.
The <i>value</i> should point to <b>int</b>.</p>

<p style="margin-left:11%;"><b>int gdbm_fdesc
(GDBM_FILE</b> <i>dbf</i><b>);</b></p>

<p style="margin-left:22%;">Returns the file descriptor of
the database <i>dbf</i>.</p>

<h2>CRASH TOLERANCE
<a name="CRASH TOLERANCE"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">By default
<b>GNU dbm</b> does not protect the integrity of its
databases from corruption or destruction due to failures
such as power outages, operating system kernel panics, or
application process crashes. Such failures could damage or
destroy the underlying database.</p>

<p style="margin-left:11%; margin-top: 1em">Starting with
release 1.21 <b>GNU dbm</b> includes a mechanism that, if
used correctly, enables post-crash recovery to a consistent
state of the underlying database. This mechanism requires OS
and filesystem support and must be requested when
<b>gdbm</b> is compiled. The crash-tolerance mechanism is a
&quot;pure opt-in&quot; feature, in the sense that it has no
effects whatsoever except on those applications that
explicitly request it. For details, see the chapter <b>Crash
Tolerance</b> in the <b>GDBM manual</b>.</p>

<h2>GLOBAL VARIABLES
<a name="GLOBAL VARIABLES"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em"><b>gdbm_error
gdbm_errno</b></p>

<p style="margin-left:22%;">This variable contains code of
the most recent error that occurred. Note, that it is not C
variable in the proper sense: you can use its value, assign
any value to it, but taking its address will result in
syntax error. It is a per-thread memory location.</p>

<p style="margin-left:11%;"><b>const char
*gdbm_version</b></p>

<p style="margin-left:22%;">A string containing the library
version number and build date.</p>

<p style="margin-left:11%;"><b>int const
gdbm_version_number[3]</b></p>

<p style="margin-left:22%;">This variable contains library
version numbers: major, minor, and patchlevel.</p>

<h2>VERSIONING
<a name="VERSIONING"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">The version
information is kept in two places. The version of the
library is kept in the <b>gdbm_version_number</b> variable,
described above. Additionally, the header file <b>gdbm.h</b>
defines the following macros: <b><br>
GDBM_VERSION_MAJOR</b></p>

<p style="margin-left:22%;">Major version number.</p>

<p style="margin-left:11%;"><b>GDBM_VERSION_MINOR</b></p>

<p style="margin-left:22%;">Minor version number.</p>

<p style="margin-left:11%;"><b>GDBM_VERSION_PATCH</b></p>

<p style="margin-left:22%;">Patchlevel number. <b>0</b>
means no patchlevel.</p>

<p style="margin-left:11%; margin-top: 1em">You can use
this to compare whether your header file corresponds to the
library the program is linked with.</p>

<p style="margin-left:11%; margin-top: 1em">The following
function can be used to compare two version numbers: <b><br>
int gdbm_version_cmp (int const</b> <i>a</i><b>[3], int
const</b> <i>b</i><b>[3])</b></p>

<p style="margin-left:22%;">Compare two version numbers
formatted as <b>gdbm_version_number</b>. Return negative
number if <b>a</b> is older than <b>b</b>, positive number
if <b>a</b> is newer than <b>b</b>, and 0 if they are
equal.</p>

<h2>ERROR CODES
<a name="ERROR CODES"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em"><b>GDBM_NO_ERROR</b></p>

<p style="margin-left:22%;">No error occurred.</p>

<p style="margin-left:11%;"><b>GDBM_MALLOC_ERROR</b></p>

<p style="margin-left:22%;">Memory allocation failed.</p>


<p style="margin-left:11%;"><b>GDBM_BLOCK_SIZE_ERROR</b></p>

<p style="margin-left:22%;">This error is set by the
<b>gdbm_open</b> function, if the value of its
<i>block_size</i> argument is incorrect and the
<b>GDBM_BSEXACT</b> flag is set.</p>


<p style="margin-left:11%;"><b>GDBM_FILE_OPEN_ERROR</b></p>

<p style="margin-left:22%;">The library was not able to
open a disk file. This can be set by <b>gdbm_open</b>,
<b>gdbm_fd_open</b>, <b>gdbm_dump</b> and <b>gdbm_load</b>
functions.</p>

<p style="margin-left:22%; margin-top: 1em">Inspect the
value of the system <b>errno</b> variable to get more
detailed diagnostics.</p>


<p style="margin-left:11%;"><b>GDBM_FILE_WRITE_ERROR</b></p>

<p style="margin-left:22%;">Writing to a disk file failed.
This can be set by <b>gdbm_open</b>, <b>gdbm_fd_open</b>,
<b>gdbm_dump</b> and <b>gdbm_load</b> functions.</p>

<p style="margin-left:22%; margin-top: 1em">Inspect the
value of the system <b>errno</b> variable to get more
detailed diagnostics.</p>


<p style="margin-left:11%;"><b>GDBM_FILE_SEEK_ERROR</b></p>

<p style="margin-left:22%;">Positioning in a disk file
failed. This can be set by <b>gdbm_open</b> function.</p>

<p style="margin-left:22%; margin-top: 1em">Inspect the
value of the system <b>errno</b> variable to get a more
detailed diagnostics.</p>


<p style="margin-left:11%;"><b>GDBM_FILE_READ_ERROR</b></p>

<p style="margin-left:22%;">Reading from a disk file
failed. This can be set by <b>gdbm_open</b>,
<b>gdbm_dump</b> and <b>gdbm_load</b> functions.</p>

<p style="margin-left:22%; margin-top: 1em">Inspect the
value of the system <b>errno</b> variable to get a more
detailed diagnostics.</p>


<p style="margin-left:11%;"><b>GDBM_BAD_MAGIC_NUMBER</b></p>

<p style="margin-left:22%;">The file given as argument to
<b>gdbm_open</b> function is not a valid <b>gdbm</b> file:
it has a wrong magic number.</p>

<p style="margin-left:11%;"><b>GDBM_EMPTY_DATABASE</b></p>

<p style="margin-left:22%;">The file given as argument to
<b>gdbm_open</b> function is not a valid <b>gdbm</b> file:
it has zero length. This error is returned unless the
<i>flags</i> argument has <b>GDBM_NEWDB</b> bit set.</p>

<p style="margin-left:11%;"><b>GDBM_CANT_BE_READER</b></p>

<p style="margin-left:22%;">This error code is set by the
<b>gdbm_open</b> function if it is not able to lock file
when called in <b>GDBM_READER</b> mode.</p>

<p style="margin-left:11%;"><b>GDBM_CANT_BE_WRITER</b></p>

<p style="margin-left:22%;">This error code is set by the
<b>gdbm_open</b> function if it is not able to lock file
when called in writer mode.</p>


<p style="margin-left:11%;"><b>GDBM_READER_CANT_DELETE</b></p>

<p style="margin-left:22%;">Set by the <b>gdbm_delete</b>,
if it attempted to operate on a database that is open in
read-only mode.</p>


<p style="margin-left:11%;"><b>GDBM_READER_CANT_STORE</b></p>

<p style="margin-left:22%;">Set by the <b>gdbm_store</b> if
it attempted to operate on a database that is open in
read-only mode.</p>


<p style="margin-left:11%;"><b>GDBM_READER_CANT_REORGANIZE</b></p>

<p style="margin-left:22%;">Set by the
<b>gdbm_reorganize</b> if it attempted to operate on a
database that is open in read-only mode.</p>

<p style="margin-left:11%;"><b>GDBM_ITEM_NOT_FOUND</b></p>

<p style="margin-left:22%;">Requested item was not found.
This error is set by <b>gdbm_delete</b> and
<b>gdbm_fetch</b> when the requested key value is not found
in the database.</p>


<p style="margin-left:11%;"><b>GDBM_REORGANIZE_FAILED</b></p>

<p style="margin-left:22%;">The <b>gdbm_reorganize</b>
function is not able to create a temporary database.</p>

<p style="margin-left:11%;"><b>GDBM_CANNOT_REPLACE</b></p>

<p style="margin-left:22%;">Cannot replace existing item.
This error is set by the <b>gdbm_store</b> if the requested
key value is found in the database and the <i>flag</i>
parameter is not <b>GDBM_REPLACE</b>.</p>

<p style="margin-left:11%;"><b>GDBM_MALFORMED_DATA</b></p>

<p style="margin-left:22%;">Input data was malformed in
some way. When returned by <b>gdbm_load</b>, this means that
the input file was not a valid <b>gdbm</b> dump file. When
returned by <b>gdbm_store</b>, this means that either
<i>key</i> or <i>content</i> parameter had its <b>dptr</b>
field set to <b>NULL</b>.</p>

<p style="margin-left:22%; margin-top: 1em">The
<b>GDBM_ILLEGAL_DATA</b> is an alias for this error code,
maintained for backward compatibility.</p>


<p style="margin-left:11%;"><b>GDBM_OPT_ALREADY_SET</b></p>

<p style="margin-left:22%;">Requested option can be set
only once and was already set. As of version 1.21, this
error code is no longer used. In prior versions it could
have been returned by the <b>gdbm_setopt</b> function when
setting the <b>GDBM_CACHESIZE</b> value.</p>

<p style="margin-left:11%;"><b>GDBM_OPT_BADVAL</b></p>

<p style="margin-left:22%;">The <i>option</i> argument is
not valid or the <i>value</i> argument points to an invalid
value in a call to <b>gdbm_setopt</b> function.</p>


<p style="margin-left:22%; margin-top: 1em"><b>GDBM_OPT_ILLEGAL</b>
is an alias for this error code, maintained for backward
compatibility. Modern applications should not use it.</p>

<p style="margin-left:11%;"><b>GDBM_BYTE_SWAPPED</b></p>

<p style="margin-left:22%;">The <b>gdbm_open</b> function
attempts to open a database which is created on a machine
with different byte ordering.</p>


<p style="margin-left:11%;"><b>GDBM_BAD_FILE_OFFSET</b></p>

<p style="margin-left:22%;">The <b>gdbm_open</b> function
sets this error code if the file it tries to open has a
wrong magic number.</p>

<p style="margin-left:11%;"><b>GDBM_BAD_OPEN_FLAGS</b></p>

<p style="margin-left:22%;">Set by the <b>gdbm_dump</b>
function if supplied an invalid <i>flags</i> argument.</p>


<p style="margin-left:11%;"><b>GDBM_FILE_STAT_ERROR</b></p>

<p style="margin-left:22%;">Getting information about a
disk file failed. The system <b>errno</b> will give more
details about the error.</p>

<p style="margin-left:22%; margin-top: 1em">This error can
be set by the following functions: <b>gdbm_open</b>,
<b>gdbm_reorganize</b>.</p>

<p style="margin-left:11%;"><b>GDBM_FILE_EOF</b></p>

<p style="margin-left:22%;">End of file was encountered
where more data was expected to be present. This error can
occur when fetching data from the database and usually means
that the database is truncated or otherwise corrupted.</p>

<p style="margin-left:22%; margin-top: 1em">This error can
be set by any GDBM function that does I/O. Some of these
functions are: <b>gdbm_delete</b>, <b>gdbm_exists</b>,
<b>gdbm_fetch</b>, <b>gdbm_export</b>, <b>gdbm_import</b>,
<b>gdbm_reorganize</b>, <b>gdbm_firstkey</b>,
<b>gdbm_nextkey</b>, <b>gdbm_store</b>.</p>

<p style="margin-left:11%;"><b>GDBM_NO_DBNAME</b></p>

<p style="margin-left:22%;">Output database name is not
specified. This error code is set by <b>gdbm_load</b> if the
first argument points to <b>NULL</b> and the input file does
not specify the database name.</p>

<p style="margin-left:11%;"><b>GDBM_ERR_FILE_OWNER</b></p>

<p style="margin-left:22%;">This error code is set by
<b>gdbm_load</b> if it is unable to restore the database
file owner. It is a mild error condition, meaning that the
data have been restored successfully, only changing the
target file owner failed. Inspect the system <b>errno</b>
variable to get a more detailed diagnostics.</p>

<p style="margin-left:11%;"><b>GDBM_ERR_FILE_MODE</b></p>

<p style="margin-left:22%;">This error code is set by
<b>gdbm_load</b> if it is unable to restore database file
mode. It is a mild error condition, meaning that the data
have been restored successfully, only changing the target
file owner failed. Inspect the system <b>errno</b> variable
to get a more detailed diagnostics.</p>

<p style="margin-left:11%;"><b>GDBM_NEED_RECOVERY</b></p>

<p style="margin-left:22%;">Database is in inconsistent
state and needs recovery. Call <b>gdbm_recover</b> if you
get this error.</p>

<p style="margin-left:11%;"><b>GDBM_BACKUP_FAILED</b></p>

<p style="margin-left:22%;">The GDBM engine is unable to
create backup copy of the file.</p>

<p style="margin-left:11%;"><b>GDBM_DIR_OVERFLOW</b></p>

<p style="margin-left:22%;">Bucket directory would overflow
the size limit during an attempt to split hash bucket. This
error can occur while storing a new key.</p>

<p style="margin-left:11%;"><b>GDBM_BAD_BUCKET</b></p>

<p style="margin-left:22%;">Invalid index bucket is
encountered in the database. Database recovery is
needed.</p>

<p style="margin-left:11%;"><b>GDBM_BAD_HEADER</b></p>

<p style="margin-left:22%;">This error is set by
<b>gdbm_open</b> and <b>gdbm_fd_open</b>, if the first block
read from the database file does not contain a valid GDBM
header.</p>

<p style="margin-left:11%;"><b>GDBM_BAD_AVAIL</b></p>

<p style="margin-left:22%;">The available space stack is
invalid. This error can be set by <b>gdbm_open</b> and
<b>gdbm_fd_open</b>, if the extended database verification
was requested (<b>GDBM_XVERIFY</b>). It is also set by the
<b>gdbm_avail_verify</b> function.</p>

<p style="margin-left:22%; margin-top: 1em">The database
needs recovery.</p>

<p style="margin-left:11%;"><b>GDBM_BAD_HASH_TABLE</b></p>

<p style="margin-left:22%;">Hash table in a bucket is
invalid. This error can be set by the following functions:
<b>gdbm_delete</b>, <b>gdbm_exists</b>, <b>gdbm_fetch</b>,
<b>gdbm_firstkey</b>, <b>gdbm_nextkey</b>, and
<b>gdbm_store</b>.</p>

<p style="margin-left:22%; margin-top: 1em">The database
needs recovery.</p>

<p style="margin-left:11%;"><b>GDBM_BAD_DIR_ENTRY</b></p>

<p style="margin-left:22%;">Bad directory entry found in
the bucket. The database recovery is needed.</p>


<p style="margin-left:11%;"><b>GDBM_FILE_CLOSE_ERROR</b></p>

<p style="margin-left:22%;">The <b>gdbm_close</b> function
was unable to close the database file descriptor. The system
<b>errno</b> variable contains the corresponding error
code.</p>


<p style="margin-left:11%;"><b>GDBM_FILE_SYNC_ERROR</b></p>

<p style="margin-left:22%;">Cached content couldn&rsquo;t
be synchronized to disk. Examine the <b>errno</b> variable
to get more info,</p>

<p style="margin-left:22%; margin-top: 1em">Database
recovery is needed.</p>


<p style="margin-left:11%;"><b>GDBM_FILE_TRUNCATE_ERROR</b></p>

<p style="margin-left:22%;">File cannot be truncated.
Examine the <b>errno</b> variable to get more info.</p>

<p style="margin-left:22%; margin-top: 1em">This error is
set by <b>gdbm_open</b> and <b>gdbm_fd_open</b> when called
with the <b>GDBM_NEWDB</b> flag.</p>


<p style="margin-left:11%;"><b>GDBM_BUCKET_CACHE_CORRUPTED</b></p>

<p style="margin-left:22%;">The bucket cache structure is
corrupted. Database recovery is needed.</p>

<p style="margin-left:11%;"><b>GDBM_BAD_HASH_ENTRY</b></p>

<p style="margin-left:22%;">This error is set during
sequential access (@pxref{Sequential}), if the next hash
table entry does not contain the expected key. This means
that the bucket is malformed or corrupted and the database
needs recovery.</p>


<p style="margin-left:11%;"><b>GDBM_ERR_SNAPSHOT_CLONE</b></p>

<p style="margin-left:22%;">Set by the
<b>gdbm_failure_atomic</b> function if it was unable to
clone the database file into a snapshot. Inspect the system
<b>errno</b> variable for the underlying cause of the error.
If <b>errno</b> is <b>EINVAL</b> or <b>ENOSYS</b>, crash
tolerance settings will be removed from the database.</p>

<p style="margin-left:11%;"><b>GDBM_ERR_REALPATH</b></p>

<p style="margin-left:22%;">Set by the
<b>gdbm_failure_atomic</b> function if the call to
<b>realpath</b> function failed. <b>realpath</b> is used to
determine actual path names of the snapshot files. Examine
the system <b>errno</b> variable for details.</p>

<p style="margin-left:11%;"><b>GDBM_ERR_USAGE</b></p>

<p style="margin-left:22%;">Function usage error. That
includes invalid argument values, and the like.</p>

<h2>DBM COMPATIBILITY ROUTINES
<a name="DBM COMPATIBILITY ROUTINES"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em"><b>GDBM</b>
includes a compatibility library <b>libgdbm_compat</b>, for
use with programs that expect traditional UNIX <b>dbm</b> or
<b>ndbm</b> interfaces, such as, e.g. <b>Sendmail</b>. The
library is optional and thus may be absent in some binary
distributions.</p>

<p style="margin-left:11%; margin-top: 1em">As the detailed
discussion of the compatibility API is beyond the scope of
this document, below we provide only a short reference. For
details, see the <b>GDBM Manual</b>, chapter
<b>Compatibility with standard dbm and ndbm</b>.</p>

<p style="margin-left:11%; margin-top: 1em"><b>DBM
compatibility routines</b> <br>
In <b>dbm</b> compatibility mode only one file may be opened
at a time. All users are assumed to be writers. If the
database file is read only, it will fail as a writer, but
will be opened as a reader. All returned pointers in datum
structures point to data that the compatibility library
<b>will free</b>. They should be treated as static pointers
(as standard UNIX <b>dbm</b> does).</p>

<p style="margin-left:11%; margin-top: 1em">The following
interfaces are provided:</p>

<p style="margin-left:11%; margin-top: 1em"><b>#include
&lt;dbm.h&gt;</b></p>

<p style="margin-left:11%; margin-top: 1em"><b>int dbminit
(const char *</b><i>name</i><b>); <br>
int store (datum</b> <i>key</i><b>, datum</b>
<i>content</i><b>); <br>
datum fetch (datum</b> <i>key</i><b>); <br>
int delete (datum</b> <i>key</i><b>); <br>
datum firstkey (void); <br>
datum nextkey (datum</b> <i>key</i><b>); <br>
int dbmclose (void);</b></p>

<p style="margin-left:11%; margin-top: 1em"><b>NDBM
Compatibility routines:</b> <br>
In this mode, multiple databases can be opened. Each
database is identified by a handle of type <b>DBM *</b>. As
in the original <b>NDBM</b>, all returned pointers in datum
structures point to data that will be freed by the
compatibility library. They should be treated as static
pointers.</p>

<p style="margin-left:11%; margin-top: 1em">The following
interfaces are provided:</p>

<p style="margin-left:11%; margin-top: 1em"><b>#include
&lt;ndbm.h&gt;</b></p>

<p style="margin-left:11%; margin-top: 1em"><b>DBM
*dbm_open (const char *</b><i>name</i><b>, int</b>
<i>flags</i><b>, int</b> <i>mode</i><b>); <br>
void dbm_close (DBM *</b><i>file</i><b>); <br>
datum dbm_fetch (DBM *</b><i>file</i><b>, datum</b>
<i>key</i><b>); <br>
int dbm_store (DBM *</b><i>file</i><b>, datum</b>
<i>key</i><b>, datum</b> <i>content</i><b>, int</b>
<i>flags</i><b>); <br>
int dbm_delete (DBM *</b><i>file</i><b>, datum</b>
<i>key</i><b>); <br>
datum dbm_firstkey (DBM *</b><i>file</i><b>); <br>
datum dbm_nextkey (DBM *</b><i>file</i><b>, datum</b>
<i>key</i><b>); <br>
int dbm_error (DBM *</b><i>file</i><b>); <br>
int dbm_clearerr (DBM *</b><i>file</i><b>); <br>
int dbm_pagfno (DBM *</b><i>file</i><b>); <br>
int dbm_dirfno (DBM *</b><i>file</i><b>); <br>
int dbm_rdonly (DBM *</b><i>file</i><b>);</b></p>

<h2>LINKING
<a name="LINKING"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">This library is
accessed by specifying <i>&minus;lgdbm</i> as the last
parameter to the compile line, e.g.:</p>

<p style="margin-left:18%; margin-top: 1em">gcc &minus;o
prog prog.c &minus;lgdbm</p>

<p style="margin-left:11%; margin-top: 1em">If you wish to
use the <b>dbm</b> or <b>ndbm</b> compatibility routines,
you must link in the <i>gdbm_compat</i> library as well. For
example:</p>

<p style="margin-left:18%; margin-top: 1em">gcc &minus;o
prog proc.c &minus;lgdbm &minus;lgdbm_compat</p>

<h2>BUG REPORTS
<a name="BUG REPORTS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Send bug
reports to &lt;bug&minus;gdbm@gnu.org&gt;.</p>

<h2>SEE ALSO
<a name="SEE ALSO"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em"><b>gdbm_dump</b>(1),
<b>gdbm_load</b>(1), <b>gdbmtool</b>(1).</p>

<h2>AUTHORS
<a name="AUTHORS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">by Philip A.
Nelson, Jason Downs and Sergey Poznyakoff; crash tolerance
by Terence Kelly.</p>

<h2>COPYRIGHT
<a name="COPYRIGHT"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Copyright
&copy; 1990 - 2021 Free Software Foundation, Inc.</p>

<p style="margin-left:11%; margin-top: 1em">GDBM is free
software; you can redistribute it and/or modify it under the
terms of the GNU General Public License as published by the
Free Software Foundation; either version 1, or (at your
option) any later version.</p>

<p style="margin-left:11%; margin-top: 1em">GDBM is
distributed in the hope that it will be useful, but WITHOUT
ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
GNU General Public License for more details.</p>

<p style="margin-left:11%; margin-top: 1em">You should have
received a copy of the GNU General Public License along with
GDBM. If not, see
&lt;http://gnu.org/licenses/gpl.html&gt;</p>

<h2>CONTACTS
<a name="CONTACTS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">You may contact
the original author by: <br>
e-mail: phil@cs.wwu.edu <br>
us-mail: Philip A. Nelson <br>
Computer Science Department <br>
Western Washington University <br>
Bellingham, WA 98226</p>

<p style="margin-left:11%; margin-top: 1em">You may contact
the current maintainers by: <br>
e-mail: downsj@downsj.com <br>
and <br>
e-mail: gray@gnu.org</p>

<p style="margin-left:11%; margin-top: 1em">For questions
and feedback regarding crash tolerance, you may contact
Terence Kelly at: <br>
e-mail: tpkelly @ { acm.org, cs.princeton.edu,
eecs.umich.edu }</p>
<hr>
</body>
</html>
