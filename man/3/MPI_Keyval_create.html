<!-- Creator     : groff version 1.22.4 -->
<!-- CreationDate: Mon May 29 22:55:35 2023 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title>MPI_Keyval_create</title>

</head>
<body>
<h1>MPI_Keyval_create</h1>



<h2>NAME
<a name="NAME"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em"><b>MPI_Keyval_create</b>
&minus; Generates a new attribute key -- use of this routine
is deprecated.</p>

<h2>SYNTAX
<a name="SYNTAX"></a>
</h2>


<h2>C Syntax
<a name="C Syntax"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">#include
&lt;mpi.h&gt; <br>
int MPI_Keyval_create(MPI_Copy_function *<i>copy_fn</i>,</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="8%"></td>
<td width="7%"></td>
<td width="85%">


<p>MPI_Delete_function *<i>delete_fn</i>, int
*<i>keyval</i>, void *<i>extra_state</i>)</p></td></tr>
</table>

<h2>Fortran Syntax
<a name="Fortran Syntax"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">INCLUDE
&rsquo;mpif.h&rsquo; <br>
MPI_KEYVAL_CREATE(<i>COPY_FN, DELETE_FN, KEYVAL,
EXTRA_STATE, IERROR</i>)</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="8%"></td>
<td width="7%">
</td>
<td width="8%"></td>
<td width="8%"></td>
<td width="69%">
</td></tr>
<tr valign="top" align="left">
<td width="8%"></td>
<td width="7%">


<p>EXTERNAL</p></td>
<td width="8%"></td>
<td width="8%"></td>
<td width="69%">


<p><i>COPY_FN, DELETE_FN</i></p></td></tr>
<tr valign="top" align="left">
<td width="8%"></td>
<td width="7%">
</td>
<td width="8%"></td>
<td width="8%"></td>
<td width="69%">
</td></tr>
<tr valign="top" align="left">
<td width="8%"></td>
<td width="7%">


<p>INTEGER</p></td>
<td width="8%"></td>
<td width="8%"></td>
<td width="69%">


<p><i>KEYVAL, EXTRA_STATE, IERROR</i></p></td></tr>
</table>

<h2>INPUT PARAMETERS
<a name="INPUT PARAMETERS"></a>
</h2>


<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="14%">


<p style="margin-top: 1em">copy_fn</p></td>
<td width="1%"></td>
<td width="56%">


<p style="margin-top: 1em">Copy callback function for
keyval.</p> </td>
<td width="18%">
</td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="14%">


<p>delete_fn</p></td>
<td width="1%"></td>
<td width="56%">


<p>Delete callback function for keyval.</p></td>
<td width="18%">
</td></tr>
</table>

<p style="margin-left:11%;">extra_state</p>

<p style="margin-left:26%;">Extra state for callback
functions.</p>

<h2>OUTPUT PARAMETERS
<a name="OUTPUT PARAMETERS"></a>
</h2>


<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="9%">


<p style="margin-top: 1em">keyval</p></td>
<td width="6%"></td>
<td width="59%">


<p style="margin-top: 1em">Key value for future access
(integer).</p> </td>
<td width="15%">
</td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="9%">


<p>IERROR</p></td>
<td width="6%"></td>
<td width="59%">


<p>Fortran only: Error status (integer).</p></td>
<td width="15%">
</td></tr>
</table>

<h2>DESCRIPTION
<a name="DESCRIPTION"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Note that use
of this routine is <i>deprecated</i> as of MPI-2. Please use
MPI_Comm_create_keyval instead.</p>

<p style="margin-left:11%; margin-top: 1em">This deprecated
routine is not available in C++.</p>

<p style="margin-left:11%; margin-top: 1em">Generates a new
attribute key. Keys are locally unique in a process and
opaque to the user, though they are explicitly stored in
integers. Once allocated, the key value can be used to
associate attributes and access them on any locally defined
communicator.</p>

<p style="margin-left:11%; margin-top: 1em">The copy_fn
function is invoked when a communicator is duplicated by
MPI_COMM_DUP. copy_fn should be of type MPI_Copy_function,
which is defined as follows:</p>

<p style="margin-left:11%; margin-top: 1em">typedef int
MPI_Copy_function(MPI_Comm oldcomm, int keyval, <br>
void *extra_state, void *attribute_val_in, <br>
void *attribute_val_out, int *flag)</p>

<p style="margin-left:11%; margin-top: 1em">A Fortran
declaration for such a function is as follows:</p>

<p style="margin-left:11%; margin-top: 1em">SUBROUTINE
COPY_FUNCTION(OLDCOMM, KEYVAL, EXTRA_STATE,
ATTRIBUTE_VAL_IN, <br>
ATTRIBUTE_VAL_OUT, FLAG, IERR) <br>
INTEGER OLDCOMM, KEYVAL, EXTRA_STATE, <br>
ATTRIBUTE_VAL_IN, ATTRIBUTE_VAL_OUT, IERR <br>
LOGICAL FLAG</p>

<p style="margin-left:11%; margin-top: 1em">The copy
callback function is invoked for each key value in oldcomm
in arbitrary order. Each call to the copy callback is made
with a key value and its corresponding attribute. If it
returns flag = 0, then the attribute is deleted in the
duplicated communicator. Otherwise ( flag = 1), the new
attribute value is set to the value returned in
attribute_val_out. The function returns MPI_SUCCESS on
success and an error code on failure (in which case
MPI_Comm_dup will fail).</p>

<p style="margin-left:11%; margin-top: 1em">copy_fn may be
specified as MPI_NULL_COPY_FN or MPI_DUP_FN from either C or
Fortran; MPI_NULL_COPY_FN is a function that does nothing
other than return flag = 0, and MPI_SUCCESS. MPI_DUP_FN is a
simple-minded copy function that sets flag = 1, returns the
value of attribute_val_in in attribute_val_out, and returns
MPI_SUCCESS.</p>

<h2>NOTES
<a name="NOTES"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Key values are
global (available for any and all communicators).</p>

<p style="margin-left:11%; margin-top: 1em">There are
subtle differences between C and Fortran that require that
the copy_fn be written in the same language that
MPI_Keyval_create is called from. This should not be a
problem for most users; only programmers using both Fortran
and C in the same program need to be sure that they follow
this rule.</p>

<p style="margin-left:11%; margin-top: 1em">Even though
both formal arguments attribute_val_in and attribute_val_out
are of type void*, their usage differs. The C copy function
is passed by MPI in attribute_val_in the value of the
attribute, and in attribute_val_out the address of the
attribute, so as to allow the function to return the (new)
attribute value. The use of type void* for both is to avoid
messy type casts.</p>

<p style="margin-left:11%; margin-top: 1em">A valid copy
function is one that completely duplicates the information
by making a full duplicate copy of the data structures
implied by an attribute; another might just make another
reference to that data structure, while using a
reference-count mechanism. Other types of attributes might
not copy at all (they might be specific to oldcomm
only).</p>

<p style="margin-left:11%; margin-top: 1em">Analogous to
copy_fn is a callback deletion function, defined as follows.
The delete_fn function is invoked when a communicator is
deleted by MPI_Comm_free or when a call is made explicitly
to MPI_Attr_delete. delete_fn should be of type
MPI_Delete_function, which is defined as follows:</p>

<p style="margin-left:11%; margin-top: 1em">typedef int
MPI_Delete_function(MPI_Comm comm, int keyval, <br>
void *attribute_val, void *extra_state);</p>

<p style="margin-left:11%; margin-top: 1em">A Fortran
declaration for such a function is as follows:</p>

<p style="margin-left:11%; margin-top: 1em">SUBROUTINE
DELETE_FUNCTION(COMM, KEYVAL,ATTRIBUTE_VAL, EXTRA_STATE,
IERR) <br>
INTEGER COMM, KEYVAL, ATTRIBUTE_VAL, EXTRA_STATE, IERR</p>

<p style="margin-left:11%; margin-top: 1em">This function
is called by MPI_Comm_free, MPI_Attr_delete, and
MPI_Attr_put to do whatever is needed to remove an
attribute. The function returns MPI_SUCCESS on success and
an error code on failure (in which case MPI_COMM_FREE will
fail).</p>

<p style="margin-left:11%; margin-top: 1em">delete_fn may
be specified as MPI_NULL_DELETE_FN from either C or FORTRAN;
MPI_NULL_DELETE_FN is a function that does nothing, other
than returning MPI_SUCCESS.</p>

<p style="margin-left:11%; margin-top: 1em">The special key
value MPI_KEYVAL_INVALID is never returned by
MPI_Keyval_create. Therefore, it can be used for static
initialization of key values.</p>

<h2>ERRORS
<a name="ERRORS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Almost all MPI
routines return an error value; C routines as the value of
the function and Fortran routines in the last argument. C++
functions do not return errors. If the default error handler
is set to MPI::ERRORS_THROW_EXCEPTIONS, then on error the
C++ exception mechanism will be used to throw an
MPI::Exception object.</p>

<p style="margin-left:11%; margin-top: 1em">Before the
error value is returned, the current MPI error handler is
called. By default, this error handler aborts the MPI job,
except for I/O function errors. The error handler may be
changed with MPI_Comm_set_errhandler; the predefined error
handler MPI_ERRORS_RETURN may be used to cause error values
to be returned. Note that MPI does not guarantee that an MPI
program can continue past an error.</p>

<h2>SEE ALSO
<a name="SEE ALSO"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em">MPI_Keyval_free
<br>
 MPI_Comm_create_keyval</p>
<hr>
</body>
</html>
