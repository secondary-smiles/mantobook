<!-- Creator     : groff version 1.22.4 -->
<!-- CreationDate: Mon May 29 22:56:54 2023 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title>LOADER.CONF</title>

</head>
<body>
<h1>loader.conf</h1>



<h2>NAME
<a name="NAME"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">loader.conf
&minus; Configuration file for systemd&minus;boot</p>

<h2>SYNOPSIS
<a name="SYNOPSIS"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em"><i>ESP</i>/loader/loader.conf,
<i>ESP</i>/loader/entries/*.conf
<i>XBOOTLDR</i>/loader/entries/*.conf</p>

<h2>DESCRIPTION
<a name="DESCRIPTION"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em"><b>systemd-boot</b>(7)
will read <i>ESP</i>/loader/loader.conf, and any files with
the &quot;.conf&quot; extension under
<i>ESP</i>/loader/entries/ on the EFI system partition
(ESP), and <i>XBOOTLDR</i>/loader/entries/ on the extended
boot loader partition (XBOOTLDR) as defined by
<b><font color="#0000FF">Boot Loader
Specification</font></b>
<small><font color="#000000">[1]</font></small>
<font color="#000000">.</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000">Each
of these configuration files must consist of series of
newline (i.e. ASCII code 10) separated lines, each
consisting of an option name, followed by whitespace, and
the option value. &quot;#&quot; may be used to start a
comment line. Empty and comment lines are ignored. The files
use UTF&minus;8 encoding.</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000">Boolean
arguments may be written as
&quot;yes&quot;/&quot;y&quot;/&quot;true&quot;/&quot;t&quot;/&quot;on&quot;/&quot;1&quot;
or
&quot;no&quot;/&quot;n&quot;/&quot;false&quot;/&quot;f&quot;/&quot;off&quot;/&quot;0&quot;.</font></p>

<h2>OPTIONS
<a name="OPTIONS"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em"><font color="#000000">The
configuration options supported by
<i>ESP</i>/loader/entries/*.conf and
<i>XBOOTLDR</i>/loader/entries/*.conf files are defined as
part of the</font> <b><font color="#0000FF">Boot Loader
Specification</font></b>
<small><font color="#000000">[1]</font></small>
<font color="#000000">.</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000">The
following configuration are supported by the loader.conf
configuration file:</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000">default</font></p>

<p style="margin-left:17%;"><font color="#000000">A glob
pattern to select the default entry. The default entry may
be changed in the boot menu itself, in which case the name
of the selected entry will be stored as an EFI variable,
overriding this option.</font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000">If
set to &quot;@saved&quot; the chosen entry will be saved as
an EFI variable on every boot and automatically selected the
next time the boot loader starts.</font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000"><b>Table&nbsp;1.&nbsp;Automatically
detected entries will use the following
names:</b></font></p>


<p align="center"><font color="#000000"><b><img src="grohtml-35812181.png" alt="Image grohtml-35812181.png"></b></font></p>


<p style="margin-left:17%;"><font color="#000000">Supported
glob wildcard patterns are &quot;?&quot;, &quot;*&quot;, and
&quot;[...]&quot; (including ranges). Note that these
patterns use the same syntax as <b>glob</b>(7), but do not
support all features. In particular, set negation and named
character classes are not supported. The matching is done
case&minus;insensitively on the entry ID (as shown by
<b>bootctl list</b>).</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000">timeout</font></p>

<p style="margin-left:17%;"><font color="#000000">How long
the boot menu should be shown before the default entry is
booted, in seconds. This may be changed in the boot menu
itself and will be stored as an EFI variable in that case,
overriding this option.</font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000">If
set to &quot;menu&minus;hidden&quot; or &quot;0&quot; (the
default) no menu is shown and the default entry will be
booted immediately. The menu can be shown by pressing and
holding a key before systemd&minus;boot is launched. Setting
this to &quot;menu&minus;force&quot; disables the timeout
while always showing the menu.</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000">console&minus;mode</font></p>

<p style="margin-left:17%;"><font color="#000000">This
option configures the resolution of the console. Takes a
number or one of the special values listed below. The
following values may be used:</font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000">0</font></p>

<p style="margin-left:23%;"><font color="#000000">Standard
UEFI 80x25 mode</font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000">1</font></p>

<p style="margin-left:23%;"><font color="#000000">80x50
mode, not supported by all devices</font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000">2</font></p>

<p style="margin-left:23%;"><font color="#000000">the first
non&minus;standard mode provided by the device firmware, if
any</font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000">auto</font></p>

<p style="margin-left:23%;"><font color="#000000">Pick a
suitable mode automatically using heuristics</font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000">max</font></p>

<p style="margin-left:23%;"><font color="#000000">Pick the
highest&minus;numbered available mode</font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000">keep</font></p>

<p style="margin-left:23%;"><font color="#000000">Keep the
mode selected by firmware (the default)</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000">editor</font></p>

<p style="margin-left:17%;"><font color="#000000">Takes a
boolean argument. Enable (the default) or disable the
editor. The editor should be disabled if the machine can be
accessed by unauthorized persons.</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000">auto&minus;entries</font></p>

<p style="margin-left:17%;"><font color="#000000">Takes a
boolean argument. Enable (the default) or disable entries
for other boot entries found on the boot partition. In
particular, this may be useful when loader entries are
created to show replacement descriptions for those
entries.</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000">auto&minus;firmware</font></p>

<p style="margin-left:17%;"><font color="#000000">A boolean
controlling the presence of the &quot;Reboot into
firmware&quot; entry (enabled by default). If this is
disabled, the firmware interface may still be reached by
using the f key.</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000">beep</font></p>

<p style="margin-left:17%;"><font color="#000000">Takes a
boolean argument. If timeout enabled beep every second,
otherwise beep n times when n&minus;th entry in boot menu is
selected (default disabled). Currently, only x86 is
supported, where it uses the PC speaker.</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000">secure&minus;boot&minus;enroll</font></p>

<p style="margin-left:17%;"><font color="#000000">Danger:
this feature might soft&minus;brick your device if used
improperly.</font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000">Controls
enrollment of secure boot keys found on the ESP if the
system is in setup mode:</font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000"><b>off</b></font></p>

<p style="margin-left:23%;"><font color="#000000">No action
is taken.</font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000"><b>manual</b></font></p>

<p style="margin-left:23%;"><font color="#000000">Boot
entries for found secure boot keys are created that allow
manual enrollment.</font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000"><b>if&minus;safe</b></font></p>

<p style="margin-left:23%;"><font color="#000000">Same
behavior as <b>manual</b>, but will try to automatically
enroll the key &quot;auto&quot; if it is considered to be
safe. Currently, this is only the case if the system is
running inside a virtual machine.</font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000"><b>force</b></font></p>

<p style="margin-left:23%;"><font color="#000000">Always
enroll the &quot;auto&quot; key if found. Note that a
warning message with a timeout will still be shown if this
operation is unknown to be safe.</font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000">The
different sets of variables can be set up under
/loader/keys/<i>NAME</i> where <i>NAME</i> is the name that
is going to be used as the name of the entry. This allows
one to ship multiple sets of Secure Boot variables and
choose which one to enroll at runtime.</font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000">Supported
Secure Boot variables are one database for authorized
images, one key exchange key (KEK) and one platform key
(PK). For more information, refer to the</font>
<b><font color="#0000FF">UEFI specification</font></b>
<small><font color="#000000">[2]</font></small>
<font color="#000000">, under Secure Boot and Driver
Signing. Another resource that describe the interplay of the
different variables is the</font>
<b><font color="#0000FF">EDK2 documentation</font></b>
<small><font color="#000000">[3]</font></small>
<font color="#000000">.</font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000">A
complete set of UEFI variable includes db.auth, KEK.auth and
PK.auth. Note that these files need to be authenticated UEFI
variables. See below for an example of how to generate them
from regular X.509 keys.</font></p>


<p style="margin-left:23%; margin-top: 1em"><font color="#000000">uuid=$(systemd&minus;id128
new &minus;&minus;uuid) <br>
for key in PK KEK db; do <br>
openssl req &minus;new &minus;x509 &minus;subj
&quot;/CN=${key}/&quot; &minus;keyout &quot;${key}.key&quot;
&minus;out &quot;${key}.crt&quot; <br>
openssl x509 &minus;outform DER &minus;in
&quot;${key}.crt&quot; &minus;out &quot;${key}.der&quot;
<br>
sbsiglist &minus;&minus;owner &quot;${uuid}&quot;
&minus;&minus;type x509 &minus;&minus;output
&quot;${key}.esl&quot; &quot;${key}.der&quot; <br>
done</font></p>


<p style="margin-left:23%; margin-top: 1em"><font color="#000000">for
key in MicWinProPCA2011_2011&minus;10&minus;19.crt
MicCorUEFCA2011_2011&minus;06&minus;27.crt
MicCorKEKCA2011_2011&minus;06&minus;24.crt; do <br>
curl
&quot;https://www.microsoft.com/pkiops/certs/${key}&quot;
&minus;&minus;output &quot;${key}&quot; <br>
sbsiglist &minus;&minus;owner
77fa9abd&minus;0359&minus;4d32&minus;bd60&minus;28f4e78f784b
&minus;&minus;type x509 &minus;&minus;output
&quot;${key%crt}esl&quot; &quot;${key}&quot; <br>
done</font></p>


<p style="margin-left:23%; margin-top: 1em"><font color="#000000">#
Optionally add Microsoft Windows Production CA 2011 (needed
to boot into Windows). <br>
cat MicWinProPCA2011_2011&minus;10&minus;19.esl
&gt;&gt;db.esl</font></p>


<p style="margin-left:23%; margin-top: 1em"><font color="#000000">#
Optionally add Microsoft Corporation UEFI CA 2011 for
firmware drivers / option ROMs <br>
# and third&minus;party boot loaders (including shim). This
is highly recommended on real <br>
# hardware as not including this may soft&minus;brick your
device (see next paragraph). <br>
cat MicCorUEFCA2011_2011&minus;06&minus;27.esl
&gt;&gt;db.esl</font></p>


<p style="margin-left:23%; margin-top: 1em"><font color="#000000">#
Optionally add Microsoft Corporation KEK CA 2011.
Recommended if either of the <br>
# Microsoft keys is used as the official UEFI revocation
database is signed with this <br>
# key. The revocation database can be updated with
<b>fwupdmgr</b>(1). <br>
cat MicCorKEKCA2011_2011&minus;06&minus;24.esl
&gt;&gt;KEK.esl</font></p>


<p style="margin-left:23%; margin-top: 1em"><font color="#000000">attr=NON_VOLATILE,RUNTIME_ACCESS,BOOTSERVICE_ACCESS,TIME_BASED_AUTHENTICATED_WRITE_ACCESS
<br>
sbvarsign &minus;&minus;attr ${attr} &minus;&minus;key
PK.key &minus;&minus;cert PK.crt &minus;&minus;output
PK.auth PK PK.esl <br>
sbvarsign &minus;&minus;attr ${attr} &minus;&minus;key
PK.key &minus;&minus;cert PK.crt &minus;&minus;output
KEK.auth KEK KEK.esl <br>
sbvarsign &minus;&minus;attr ${attr} &minus;&minus;key
KEK.key &minus;&minus;cert KEK.crt &minus;&minus;output
db.auth db db.esl</font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000">This
feature is considered dangerous because even if all the
required files are signed with the keys being loaded, some
files necessary for the system to function properly still
won't be. This is especially the case with Option ROMs (e.g.
for storage controllers or graphics cards). See</font>
<b><font color="#0000FF">Secure Boot and Option
ROMs</font></b>
<small><font color="#000000">[4]</font></small>
<font color="#000000">for more details.</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000">reboot&minus;for&minus;bitlocker</font></p>

<p style="margin-left:17%;"><font color="#000000">Caveat:
This feature is experimental, and is likely to be changed
(or removed in its current form) in a future version of
systemd.</font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000">Work
around BitLocker requiring a recovery key when the boot
loader was updated (disabled by default).</font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000">Try
to detect BitLocker encrypted drives along with an active
TPM. If both are found and Windows Boot Manager is selected
in the boot menu, set the &quot;BootNext&quot; EFI variable
and restart the system. The firmware will then start Windows
Boot Manager directly, leaving the TPM PCRs in expected
states so that Windows can unseal the encryption key. This
allows <b>systemd-boot</b>(7) to be updated without having
to provide the recovery key for BitLocker drive
unlocking.</font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000">Note
that the PCRs that Windows uses can be configured with the
&quot;Configure TPM platform validation profile for native
UEFI firmware configurations&quot; group policy under
&quot;Computer Configuration\Administrative
Templates\Windows Components\BitLocker Drive
Encryption&quot;. When Secure Boot is enabled, changing this
to PCRs &quot;0,2,7,11&quot; should be safe. The TPM key
protector needs to be removed and then added back for the
PCRs on an already encrypted drive to change. If PCR 4 is
not measured, this setting can be disabled to speed up
booting into Windows.</font></p>

<h2>EXAMPLE
<a name="EXAMPLE"></a>
</h2>



<p style="margin-left:17%; margin-top: 1em"><font color="#000000">#
/boot/efi/loader/loader.conf <br>
timeout 0 <br>
default 01234567890abcdef1234567890abdf0&minus;* <br>
editor no</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000">The
menu will not be shown by default (the menu can still be
shown by pressing and holding a key during boot). One of the
entries with files with a name starting with
&quot;01234567890abcdef1234567890abdf0&minus;&quot; will be
selected by default. If more than one entry matches, the one
with the highest priority will be selected (generally the
one with the highest version number). The editor will be
disabled, so it is not possible to alter the kernel command
line.</font></p>

<h2>SEE ALSO
<a name="SEE ALSO"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em"><font color="#000000"><b>systemd-boot</b>(7),
<b>bootctl</b>(1)</font></p>

<h2>NOTES
<a name="NOTES"></a>
</h2>


<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="12%"></td>
<td width="3%">



<p style="margin-top: 1em"><font color="#000000">1.</font></p> </td>
<td width="2%"></td>
<td width="38%">


<p style="margin-top: 1em"><font color="#000000">Boot
Loader Specification</font></p></td>
<td width="45%">
</td></tr>
</table>


<p style="margin-left:17%;"><font color="#000000">https://uapi-group.org/specifications/specs/boot_loader_specification</font></p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="12%"></td>
<td width="3%">



<p style="margin-top: 1em"><font color="#000000">2.</font></p> </td>
<td width="2%"></td>
<td width="28%">


<p style="margin-top: 1em"><font color="#000000">UEFI
specification</font></p> </td>
<td width="55%">
</td></tr>
</table>


<p style="margin-left:17%;"><font color="#000000">https://uefi.org/specifications</font></p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="12%"></td>
<td width="3%">



<p style="margin-top: 1em"><font color="#000000">3.</font></p> </td>
<td width="2%"></td>
<td width="28%">


<p style="margin-top: 1em"><font color="#000000">EDK2
documentation</font></p> </td>
<td width="55%">
</td></tr>
</table>


<p style="margin-left:17%;"><font color="#000000">https://edk2-docs.gitbook.io/understanding-the-uefi-secure-boot-chain/secure_boot_chain_in_uefi/uefi_secure_boot</font></p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="12%"></td>
<td width="3%">



<p style="margin-top: 1em"><font color="#000000">4.</font></p> </td>
<td width="2%"></td>
<td width="41%">


<p style="margin-top: 1em"><font color="#000000">Secure
Boot and Option ROMs</font></p></td>
<td width="42%">
</td></tr>
</table>


<p style="margin-left:17%;"><font color="#000000">https://github.com/Foxboron/sbctl/wiki/FAQ#option-rom</font></p>
<hr>
</body>
</html>
