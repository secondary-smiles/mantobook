<!-- Creator     : groff version 1.22.4 -->
<!-- CreationDate: Mon May 29 22:56:55 2023 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title>SOCKD.CONF</title>

</head>
<body>
<h1>sockd.conf</h1>



<h2>NAME
<a name="NAME"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">sockd.conf
&minus; <b>Dante</b> server configuration file syntax</p>

<h2>DESCRIPTION
<a name="DESCRIPTION"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">The
configuration file for the <b>Dante</b> server controls both
access controls and logging. It is divided into three parts;
server settings, rules, and routes.</p>

<p style="margin-left:11%; margin-top: 1em">Note that
server settings <b>must</b> come before rules and
routes.</p>

<p style="margin-left:11%; margin-top: 1em">A line can be
commented out using the standard comment character
<b>#</b>.</p>

<h2>SERVER SETTINGS
<a name="SERVER SETTINGS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">The server
settings control the generic behaviour of the server. Each
keyword is separated from its value by a
<b>&rsquo;:&rsquo;</b> character.</p>

<p style="margin-left:11%; margin-top: 1em">The following
keywords are available: <b><br>
clientmethod</b></p>

<p style="margin-left:22%;">A list of acceptable
authentication methods for client-rules, listed in order of
preference. These are authentication methods that are to be
checked immediately after the SOCKS client has connected to
<b>Dante, and before any socks-negotiation has
started.</b></p>

<p style="margin-left:22%; margin-top: 1em"><b>Supported
values are pam.address, pam.any, none, and rfc931 .</b></p>

<p style="margin-left:22%; margin-top: 1em"><b>For all
methods the authentication will be based on solely on the
IP-address of the client, possibly in combination with a
rfc931 (&quot;ident&quot;) lookup towards the host the
client is running on.</b></p>

<p style="margin-left:22%; margin-top: 1em"><b>Any
credentials provided during this pass will also be available
for use in later socks-rules, when the socks-request from
the client is evaluated.</b></p>

<p style="margin-left:22%; margin-top: 1em"><b>The default
value for this keyword is all methods that may be necessary
for the later socks-based authentication methods, as
specified as values to the global socksmethod keyword.
Normally you should not need to set this keyword, as Dante
will set it to the correct value by it self.</b></p>

<p style="margin-left:11%;"><b>compatibility</b></p>

<p style="margin-left:22%;">With the <b>sameport</b>
keyword, the server attempts to use the same port on the
server&rsquo;s external side as the client used on the
server&rsquo;s internal side. This is normally the default,
but when this option is given it will be done with
privileged ports also, meaning if a client connects to
<b>Dante</b> from a privileged port, <b>Dante</b> will
attempt to connect to the target destination from a
privileged port too. There can be security issues involved
with this, so normally this option should not be set.</p>

<p style="margin-left:22%; margin-top: 1em">The
<b>draft-5.05</b> keyword will enable usage of parts of the
socks v5-05 draft. The only feature from this draft that
<b>Dante</b> supports is the &quot;USECLIENTSPORT&quot;
extension. Note that there is a conflicting interpretation
of this extension, so enabling it might prevent clients
using the conflicting interpretation from working correctly.
Only affects UDP.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="4%">


<p><b>cpu</b></p></td>
<td width="7%"></td>
<td width="78%">


<p>The CPU settings for the various type of <b>Dante</b>
processes. Note that the possibility for configuring these
settings depend on the platform <b>Dante</b> is running on.
Not all platforms may provide support for these type of CPU
settings.</p> </td></tr>
</table>

<p style="margin-left:22%; margin-top: 1em">There are four
process types: <b>mother, negotiate, request</b>, and
<b>io</b>.</p>

<p style="margin-left:22%; margin-top: 1em">The currently
supported options are:</p>


<p style="margin-left:22%; margin-top: 1em"><b>schedule</b>.&lt;process
type&gt;: &lt;scheduling policy&gt;/&lt;priority&gt;.</p>

<p style="margin-left:22%; margin-top: 1em">Example:
<b>cpu.schedule.mother: SCHED_FIFO/20</b> The above requests
that the kernel schedules the mother process(s) using a
first-in, first-out policy, at priority 20.</p>

<p style="margin-left:22%; margin-top: 1em">The default is
to not request any specific scheduling.</p>


<p style="margin-left:22%; margin-top: 1em"><b>mask</b>.&lt;process
type&gt;: &lt;cpu id 1&gt; [cpu id 1 ...]/any.</p>

<p style="margin-left:22%; margin-top: 1em">Example:
<b>cpu.mask.mother: any</b> Example: <b>cpu.mask.io: 0
1</b></p>

<p style="margin-left:22%; margin-top: 1em">The mask gives
control over the CPU/cores on which the different process
types will run. Specifying the default (<b>all</b>) allows
the process type to run on any CPU id. Specifying one or
more numeric CPU id limits the process to that set of
CPUs.</p>

<p style="margin-left:22%; margin-top: 1em">The cpu
keywords (<b>schedule</b> and <b>mask</b>) should in most
cases not be necessary. If they are to be used, the
<b>io</b> processes are where most of the work is done and
adjusting the priority or CPU usage is what is likely to
have the most significant performance effect client
performance and overhead from the server. The other
processes are primarily used during connection/session
establishment and changes to settings for the non-io process
types will primarily affect these operations.</p>

<p style="margin-left:22%; margin-top: 1em">The default is
to not limit processes to any specific cpu.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="7%">


<p style="margin-top: 1em"><b>debug</b></p></td>
<td width="4%"></td>
<td width="78%">


<p style="margin-top: 1em">Print debug info to the logs.
The value sets the debug level.</p></td></tr>
</table>

<p style="margin-left:11%;"><b>errorlog</b></p>

<p style="margin-left:22%;">This value can be set to
receive only error-related logoutput. Note that this does
not include client-specific errors, but only more serious
&quot;global&quot; errors.</p>

<p style="margin-left:22%; margin-top: 1em">The possible
values are the same as for the <b>logoutput</b> keyword
mentioned below.</p>

<p style="margin-left:22%; margin-top: 1em">The intent is
to have a special place that only serious errors are logged
so that they can discovered quickly. The default is to not
have any special place to log errors.</p>

<p style="margin-left:11%;"><b>external</b></p>

<p style="margin-left:22%;">The address to be used for
outgoing connections. The address given may be either an IP
address or an interface name. Can be given multiple times
for different addresses.</p>


<p style="margin-left:11%;"><b>external.log.&lt;loglevel&gt;.error</b></p>

<p style="margin-left:22%;">See
<b>internal.log.&lt;loglevel&gt;.error</b>. This option has
an identical syntax and semantics, but applies to error
related to the external interface side.</p>

<p style="margin-left:11%;"><b>external.protocol</b></p>

<p style="margin-left:22%;">By default <b>Dante</b> will
use the address families specified and available, and there
is no need to set this keyword.</p>

<p style="margin-left:22%; margin-top: 1em">In some cases
the operator may however wish to specify an address in a
form that may include more than one address family, yet not
wish for Dante to use all the address families available for
that address form.</p>

<p style="margin-left:22%; margin-top: 1em">This will
typically happen if the operator wishes to specify that
Dante should use the addresses on a network interface card
which has both IPv4 and IPv6 addresses configured, yet the
operator wishes Dante to only use one of these two address
families. The operator can then specify the address family
he wants Dante too look for when expanding the interface
name for IP-addresses to use.</p>

<p style="margin-left:22%; margin-top: 1em">Valid values
for this keyword are: <b>ipv4</b> and <b>ipv6</b>,
indicating that Dante should only use the IPv4 address
family or only the IPv6 address family, respectively. The
default is to use both families, if available.</p>

<p style="margin-left:22%; margin-top: 1em">A corresponding
keyword exists for the internal side (see
<b>internal.protocol</b>).</p>

<p style="margin-left:11%;"><b>external.rotation</b></p>

<p style="margin-left:22%;">If more than one external
address is given, this governs which of the given addresses
is selected as the source address for outgoing
connections/packets. Note that regardless of which external
rotation value is used, all external addresses that are to
be used must be listed via the <b>external</b> keyword
first.</p>

<p style="margin-left:22%; margin-top: 1em">Valid values
are <b>none</b> (the default), <b>route</b>, and
<b>same-same</b>.</p>

<p style="margin-left:22%; margin-top: 1em"><b>none</b>
indicates the first address on the list of external
addresses should be used.</p>

<p style="margin-left:22%; margin-top: 1em"><b>route</b>
indicates the kernels routing table should be consulted to
find out what the source address for a given destination
will be, and might require you to set <b>user.privileged</b>
to <b>root</b>. Note that <b>route</b> might create problems
for ftp-clients using active ftp if the <b>Dante</b> bind
extension is enabled for the ftp-client.</p>


<p style="margin-left:22%; margin-top: 1em"><b>same-same</b>
indicates the source address for a given destination should
be the same address as the <b>Dante</b> server accepted the
clients connection on.</p>

<p style="margin-left:11%;"><b>internal</b></p>

<p style="margin-left:22%;">The internal addresses.
Connections will only be accepted on these addresses. The
address given may be either an IP address or an interface
name.</p>


<p style="margin-left:11%;"><b>internal.log.&lt;loglevel&gt;.error</b></p>

<p style="margin-left:22%;">Specifies that certain system
call failures, listed as symbolic errno values, or certain
dns failures, listed as symbolic libresolv failure-codes,
should be logged, possibly an extra time, at the log-level
<b>log-level</b>.</p>

<p style="margin-left:22%; margin-top: 1em">Note that this
only applies to errors on the internal interface side
only.</p>

<p style="margin-left:22%; margin-top: 1em">A corresponding
keyword exists for the external side (see
<b>external.log</b>).</p>

<p style="margin-left:22%; margin-top: 1em">In addition to
the standard errno and getaddrinfo(3) error symbols, the
following special symbols are accepted: <b><br>
no-route</b></p>

<p style="margin-left:32%;">Any error related to no
route.</p>

<p style="margin-left:22%;"><b>dns-any</b></p>

<p style="margin-left:32%;">Any error related to
DNS/hostname-resolving.</p>

<p style="margin-left:22%;"><b>system-any</b></p>

<p style="margin-left:32%;">Any system error. I.e., any
errno value.</p>

<p style="margin-left:11%;"><b>internal.protocol</b></p>

<p style="margin-left:22%;">See <b>external.protocol</b>.
This option has an identical syntax and semantics, but
applies to the internal interface, for addresses to listen
to connections from clients on.</p>


<p style="margin-left:11%;"><b>libwrap.hosts_access</b></p>

<p style="margin-left:22%;">If the server is compiled with
libwrap support, determines whether the
<b>hosts_access()</b> function should be used for access
control. When enabled by setting this value to <b>yes</b>,
the libwrap library determines if TCP connections or UDP
packets should be immediately dropped or not, typically by
consulting <b>/etc/hosts.allow</b> and
<b>/etc/hosts.deny</b>. These checks are applied to all
traffic, before the rule processing starts. The default
value is <b>no</b> (disabled).</p>

<p style="margin-left:11%;"><b>logoutput</b></p>

<p style="margin-left:22%;">This value controls where the
server sends logoutput. It can be set to
<b>syslog</b>[/<b>facility</b>], <b>stdout</b>,
<b>stderr</b>, a filename, or a combination. The default is
nowhere. Note that if <b>errorlog</b> is also set, there
will be a overlap between what is logged there (errors
only), and what will be logged here (errors, and everything
else).</p>

<p style="margin-left:11%;"><b>socksmethod</b></p>

<p style="margin-left:22%;">A list of acceptable
authentication methods for socks-rules, listed in order of
preference. It is thus important that you specify these in
the desired order, normally with the more secure methods
first.</p>

<p style="margin-left:22%; margin-top: 1em">Supported
values are <b>bsdauth</b>, <b>gssapi</b>, <b>none</b>,
<b>pam.any</b>, <b>pam.address</b>, <b>pam.username</b>,
<b>rfc931</b>, and <b>username</b>,</p>

<p style="margin-left:22%; margin-top: 1em">If a method is
not set in this list it will never be selected. The default
is no methods, which means all socks-requests will be
blocked.</p>

<p style="margin-left:22%; margin-top: 1em">See the section
on <b>AUTHENTICATION METHODS</b> for an explanation of the
different methods and their meaning.</p>

<p style="margin-left:11%;"><b>srchost</b></p>

<p style="margin-left:22%;">This keyword allows you to
configure a few options that relate to the srchost, i.e.,
the host the <b>Dante</b> server accepts the connections
from.</p>

<p style="margin-left:22%; margin-top: 1em">With the
<b>nodnsmismatch</b> keyword, the server will not accept
connections from addresses having a mismatch between DNS IP
address and hostname. Default is to accept them.</p>

<p style="margin-left:22%; margin-top: 1em">With the
<b>nodnsunknown</b> keyword, the server will not accept
connections from addresses without a DNS record. Default is
to accept them.</p>

<p style="margin-left:22%; margin-top: 1em">With the
<b>checkreplyauth</b> keyword, the server will check that
the authentication on bind-replies and udp-replies matches
that which is set in the rule and global socksmethod.
Normally, authentication is not desired on replies, as they
are replies sent to the socks-clients from non-socks
clients, and thus only a limited set of authentication
methods are possible.</p>

<p style="margin-left:22%; margin-top: 1em">The methods
possible for TCP are the the methods not involving the socks
protocol in any way, and are listed in the
<b>clientmethod</b> section previously mentioned. For
UDP-replies, no methods can be used.</p>

<p style="margin-left:22%; margin-top: 1em">Default is not
to check the authentication on replies.</p>

<p style="margin-left:11%;"><b>timeout.connect</b></p>

<p style="margin-left:22%;">The number of seconds the
server will wait for a connect initiated on behalf of the
socks-client to complete. The default is 30. Setting it to 0
will use the systems default.</p>

<p style="margin-left:11%;"><b>timeout.io</b></p>

<p style="margin-left:22%;">The number of seconds an
established connection can be idle. The default is 0,
meaning forever. See also the &quot;-n&quot; option in the
sockd(8) manpage.</p>

<p style="margin-left:22%; margin-top: 1em">Individual
timeouts can be set for TCP and UDP by suffixing io with
&quot;.&lt;protocolname&gt;&quot;, i.e.
<b>timeout.io.tcp</b> or <b>timeout.io.udp</b>.</p>

<p style="margin-left:22%; margin-top: 1em">Individual
timeouts can also be set within rules, using the same
syntax. The timeout set in the rule will then override the
default timeouts for clients matching the rule.</p>

<p style="margin-left:11%;"><b>timeout.negotiate</b></p>

<p style="margin-left:22%;">The number of seconds a client
can spend negotiating with the <b>Dante</b> server for a
socks session before <b>Dante</b> will close the connection
to the client. The default is 30. Set it to 0 for forever,
though that is strongly discouraged.</p>


<p style="margin-left:11%;"><b>timeout.tcp_fin_wait</b></p>

<p style="margin-left:22%;">The timeout for the equivalent
of TCP&rsquo;s FIN-WAIT-2. The default is 0, which means use
the systems default (normally, no timeout).</p>

<p style="margin-left:11%;"><b>udp.connectdst</b></p>

<p style="margin-left:22%;">Enables or disables whether the
server should attempt connecting UDP sockets to the
destination. Valid values are <b>yes</b> and <b>no</b>.</p>

<p style="margin-left:22%; margin-top: 1em">The default is
<b>yes</b>, which improves UDP performance, but may not be
compatible with some UDP-based application protocols as it
means the server can only receive packets from the
destination address.</p>

<p style="margin-left:22%; margin-top: 1em">The socket will
only remain connected as long as the client only sends UDP
packets to one destination address. If packets are sent to
multiple destinations the socket will no longer remain
connected and replies can be received from any
destination.</p>

<p style="margin-left:11%;"><b>Userids</b></p>

<p style="margin-left:22%;">On platforms providing a
privilege-model supported by <b>Dante</b>, the <b>Dante</b>
server does not use userid-switching via the seteuid(2)
system call. On other platforms, it is prudent to set the
userid to be used by the <b>Dante</b> server to appropriate
values. The <b>Dante</b> server can use two different
userids, or three if compiled with libwrap support. They are
as follows:</p>

<p style="margin-left:11%;"><b>user.privileged</b></p>

<p style="margin-left:22%;">Username which will be used for
doing privileged operations. If you need special privileges
to read the sockd.conf file or to write the sockd.pid file
(you can create it manually before starting sockd), have
anything in your configuration that requires binding
privileged TCP/UDP ports (ports below 1024), or use some
sort of password-based authentication, this probably needs
to be set to root.</p>

<p style="margin-left:22%; margin-top: 1em">If not, you can
probably set it to the same value as
<b>user.unprivileged</b>.</p>

<p style="margin-left:11%;"><b>user.unprivileged</b></p>

<p style="margin-left:22%;">User which the server runs as
most of the time. This should be an id with as little
privileges as possible. It is recommended that a separate
userid is created for this purpose.</p>

<p style="margin-left:11%;"><b>user.libwrap</b></p>

<p style="margin-left:22%;">User used to execute libwrap
commands. Normally this should be the same as
<b>user.unprivileged</b></p>

<h2>MODULES
<a name="MODULES"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">The following
modules are supported by <b>Dante</b>. Modules are purchased
separately from Inferno Nettverk A/S and may add extra
functionality that is not needed by most users. See the
<b>Dante</b> homepage for more information. <b><br>
bandwidth</b></p>

<p style="margin-left:22%;">The <b>bandwidth</b> module
gives control over how much bandwidth the <b>Dante</b>
server uses on behalf of different clients or to different
targets.</p>

<p style="margin-left:11%;"><b>redirect</b></p>

<p style="margin-left:22%;">The <b>redirect</b> module
gives you control over what addresses the server will use on
behalf of the clients, as well as allowing you to redirect
client requests to a different addresses.</p>

<h2>SOCKET OPTIONS
<a name="SOCKET OPTIONS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">The server has
support for setting a large number of low-level socket
options on both incoming and outgoing traffic. <i>Most users
will not need to set any of these options, but some might
want to do it, to enable special network features, or to
perform various experiments.</i></p>

<p style="margin-left:11%; margin-top: 1em">Options can be
set globally as defaults for all traffic, or be set in the
access control rules to only affect clients and targets
matching the given rule.</p>

<p style="margin-left:11%; margin-top: 1em">The socket
options that are available vary between platforms, so during
configuration and building of the server the options that
are available will be determined. Currently, the following
options should be detected, when available, for the
specified protocol levels:</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="22%"></td>
<td width="9%">


<p><b>SOCKET</b></p></td>
<td width="1%"></td>
<td width="68%">


<p>so_bindany, so_broadcast, so_debug, so_dontroute,
so_jumbo, so_keepalive, so_oobinline, so_priority,
so_rcvbuf, so_rcvbufforce, so_rcvlowat, so_sndbuf,
so_sndbufforce, so_sndlowat, so_useloopback</p></td></tr>
<tr valign="top" align="left">
<td width="22%"></td>
<td width="9%">


<p><b>TCP</b></p></td>
<td width="1%"></td>
<td width="68%">


<p>tcp_cork, tcp_cwnd, tcp_init_cwnd, tcp_keepcnt,
tcp_keepidle, tcp_keepintvl, tcp_linger2, tcp_maxrt,
tcp_maxseg, tcp_md5sig, tcp_nodelay, tcp_noopt, tcp_nopush,
tcp_sack_enable, tcp_stdurg, tcp_syncnt,
tcp_window_clamp</p> </td></tr>
<tr valign="top" align="left">
<td width="22%"></td>
<td width="9%">


<p><b>UDP</b></p></td>
<td width="1%"></td>
<td width="68%">


<p>udp_cork</p></td></tr>
<tr valign="top" align="left">
<td width="22%"></td>
<td width="9%">


<p><b>IP</b></p></td>
<td width="1%"></td>
<td width="68%">


<p>ip_auth_level, ip_dontfrag, ip_esp_network_level,
ip_esp_trans_level, ip_freebind, ip_ipcomp_level, ip_minttl,
ip_mtu_discover, ip_portrange, ip_recvtos, ip_tos,
ip_ttl</p> </td></tr>
</table>

<p style="margin-left:11%; margin-top: 1em">The syntax for
setting socket options is as follows:</p>


<p style="margin-left:11%; margin-top: 1em">&lt;direction&gt;.&lt;level&gt;.&lt;option&gt;:
&lt;value&gt;</p>

<p style="margin-left:11%; margin-top: 1em">The
<b>value</b> field corresponds to the value that the socket
option should be set to. For many socket options this is an
integer value. The <b>level</b> and <b>option</b> values
correspond to the socket names and protocol levels listed
above. Both should be in lower-case.</p>

<p style="margin-left:11%; margin-top: 1em">The
<b>direction</b> keywords is used to specify whether the
socket option should be set for traffic on the internal or
the external interface and can have the values
<b>internal</b> and <b>external</b>. For example, to set the
IP_TOS socket option on outgoing traffic, the following
syntax can be used:</p>


<p style="margin-left:11%; margin-top: 1em">external.ip.ip_tos:
0x10</p>

<p style="margin-left:11%; margin-top: 1em">In this
example, the argument value (0x10) is specified as a hex
value. For some of the socket options the value can also be
set symbolically. Currently this is possible for the
following options, with the listed values:</p>

<p style="margin-left:22%;"><b>ip_portrange</b></p>

<p style="margin-left:32%;">ip_portrange_default,
ip_portrange_low, ip_portrange_high</p>

<p style="margin-left:11%; margin-top: 1em">The IP_TOS
socket option also supports this, but handling this option
is somewhat complicated by the same bits having different
meanings in different RFCs. Handling this is done with a
subfield that indicates the type of argument that should be
used. The following subfields are defined and should be
added to the name of the socket option as specified
below:</p>

<p style="margin-left:22%;"><b>ip_tos.dscp</b></p>

<p style="margin-left:32%;">af11 af12 af13 af21 af22 af23
af31 af32 af33 af41 af42 af43 cs0 cs1 cs2 cs3 cs4 cs5 cs6
cs7 ef</p>

<p style="margin-left:22%;"><b>ip_tos.prec</b></p>

<p style="margin-left:32%;">netcontrol internetcontrol
critic_ecp flashoverride flash immediate priority
routine</p>

<p style="margin-left:22%;"><b>ip_tos.tos</b></p>

<p style="margin-left:32%;">lowdelay throughput
reliability</p>

<p style="margin-left:11%; margin-top: 1em">When numerical
arguments are given to subfields, the values are shifted to
apply only to the subfield bit range. The following example
shows the different ways of setting IP_TOS to
<b>lowdelay</b> on external traffic:</p>


<p style="margin-left:11%; margin-top: 1em">external.ip.ip_tos:
0x10 #base value, numerically <br>
external.ip.ip_tos.tos: 0x08 #subfield, numerically <br>
external.ip.ip_tos.tos: lowdelay #subfield, symbolically</p>

<p style="margin-left:11%; margin-top: 1em">The first value
sets the value directly, the second sets only the TOS bits,
which are shifted relative to the base value. The final line
sets the TOS value symbolically.</p>

<p style="margin-left:11%; margin-top: 1em">This
functionality gives a large amount of control over socket
options, but it should not be used without some
understanding of how the kernel allows the socket option to
be set, and the limitations that apply when the socket
options are set as either defaults or in rules.</p>

<p style="margin-left:11%; margin-top: 1em">Setting a
socket option in a client pass or socks-rules will cause any
defaults to be overridden. Global options are set before
bind() is called on internal sockets, or before connect() is
called on external sockets. Options set in client rules are
also applied before bind() is called on the internal socket,
but cannot be set for the external socket. For socks-rules,
both external and internal options can be set, but because
the socks-request must be interpreted before the rules can
be evaluated, socket options can only be set on internal
sockets after the connection has been received.</p>

<p style="margin-left:11%; margin-top: 1em">Some socket
options must be set before a connection has been
established, while others can only be set after a connection
has been established. Others can be set at any time.</p>

<p style="margin-left:11%; margin-top: 1em">Socket options
that are not listed above can also be set by specifying the
socket option name numerically, for example:</p>


<p style="margin-left:11%; margin-top: 1em">external.ip.10:
0x12</p>

<p style="margin-left:11%; margin-top: 1em">In this example
the socket option corresponding to the value 10 will be set.
These numbers are platform dependent but can typically be
determined by looking at the appropriate system header
files. Specifying options numerically might result in some
warnings, but allows any socket option to be specified, as
long as it takes a numerical argument. This is not the
recommended approach for setting socket options, but
represents a simple way of setting socket options that are
not directly supported by the server, such as local kernel
extensions.</p>

<h2>AUTHENTICATION METHODS
<a name="AUTHENTICATION METHODS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">The
<b>Dante</b> server supports the following authentication
methods. Some installations of <b>Dante</b> may support only
a subset of these, depending on platform support.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="6%">


<p><b>none</b></p></td>
<td width="5%"></td>
<td width="72%">


<p>This method requires no form of authentication.</p></td>
<td width="6%">
</td></tr>
</table>

<p style="margin-left:11%;"><b>username</b></p>

<p style="margin-left:22%;">This method requires the client
to provide a username and password. This information must
match the username and password given in the system password
file.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="9%">


<p><b>gssapi</b></p></td>
<td width="2%"></td>
<td width="78%">


<p>This method requires the setup of a Kerberos environment
and can provide strong encryption and authentication,
depending on the gssapi settings you choose.</p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="9%">


<p><b>rfc931</b></p></td>
<td width="2%"></td>
<td width="78%">


<p>This method requires the host the socks client runs on
to provide a rfc931 (&quot;ident&quot;) username for the
client. This username match a username given in the system
password file.</p></td></tr>
</table>

<p style="margin-left:11%;"><b>pam.address</b></p>

<p style="margin-left:22%;">IP-based (rhosts) PAM
authentication.</p>

<p style="margin-left:11%;"><b>pam.any</b></p>

<p style="margin-left:22%;">Will try to match against any
type of PAM authentication, depending on the information
that is currently available. Normally of limited use, and
you should instead set the pam-based method(s) you actually
want.</p>

<p style="margin-left:11%;"><b>pam.username</b></p>

<p style="margin-left:22%;">Username/password-based PAM
authentication. Similar to the method <b>username</b>, but
the information is passed to the PAM subsystem for
authentication, rather than <b>Dante</b> using the system
password file directly. When using PAM, be wary of memory
leakages and other bugs in the external PAM library
<b>Dante</b> will have to use on your platform.</p>

<p style="margin-left:11%;"><b>bsdauth</b></p>

<p style="margin-left:22%;">This method requires the
available client data to be verified by the BSD
Authentication system. Similar to the method
<b>username</b>, but passed to the BSD authentication system
instead.</p>

<h2>ADDRESSES
<a name="ADDRESSES"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Each address
field can consist of an IP address (and where required, a
netmask, separated from the IP address by a
&rsquo;<b>/</b>&rsquo; sign), a hostname, a domainname
(designated so by the leading &rsquo;<b>.</b>&rsquo;), or an
interface name.</p>

<p style="margin-left:11%; margin-top: 1em">An IP address
can be given on on IPv4 form, IPv6 form, or as the special
value <b>0/0</b>, which matches all IP addresses, be they
IPv4 or IPv6. The latter is intended for use in <b>rules</b>
that should match both IPv4 and IPv6 clients or targets.</p>

<p style="margin-left:11%; margin-top: 1em">Each address,
except the <b>external</b> address, can include an optional
<b>port</b> specifier.</p>

<h2>RULES
<a name="RULES"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">There are two
sets of rules and they work at different levels. Rules
prefixed with <b>client</b> are checked first and are used
to see if the client is allowed to connect to the
<b>Dante</b> server. We call them &quot;client-rules&quot;.
These rules will start with <b>client pass</b> for a rule
that allows the client, or <b>client block</b> for a rule
that blocks the client.</p>

<p style="margin-left:11%; margin-top: 1em">It is
recommended that the client-rules do not use hostnames but
only IP-addresses, both for security and performance
reasons. These rules operate at the TCP level.</p>

<p style="margin-left:11%; margin-top: 1em">The other
rules, which we call &quot;socks-rules&quot;, are prefixed
with <b>socks</b> and operate at the socks protocol
level.</p>

<p style="margin-left:11%; margin-top: 1em">These rules
will start with <b>socks pass</b> for a rule that allows the
client, or <b>socks block</b> for a rule that blocks the
client.</p>

<p style="margin-left:11%; margin-top: 1em">These rules are
only checked if the client connection has been allowed by
the client-rules. The socks-rules are used to evaluate the
socks request that the client sends.</p>

<p style="margin-left:11%; margin-top: 1em">While it is
less important that these rules use only IP-addresses,
provided the client-rules have been configured to only allow
access from a pre-defined range of client IP-addresses, it
is still recommended.</p>

<p style="margin-left:11%; margin-top: 1em">Both set of
rules include a <b>pass</b> or <b>deny</b> keyword. The
<b>pass</b>/<b>deny</b> keyword determines whether
connections matching the rule are to be passed through or be
blocked.</p>

<p style="margin-left:11%; margin-top: 1em">Both the
client-rules and the socks-rules also specify a
<b>from</b>/<b>to</b> address pair which gives the addresses
the rule will match.</p>

<p style="margin-left:11%; margin-top: 1em">In both
contexts, <b>from</b> refers to the clients address, i.e.,
the address the client is connecting to the <b>Dante</b>
server from. The <b>to</b> address however refers to
different things depending on whether it is used in a
client-rule or in a socks-rule.</p>

<p style="margin-left:11%; margin-top: 1em">In the
client-rule context, <b>to</b> means the address the request
is accepted on, i.e., a address the <b>Dante</b> server
listens on.</p>

<p style="margin-left:11%; margin-top: 1em">In the
socks-rule context, <b>to</b> means the client&rsquo;s
destination address, as expressed in the client&rsquo;s
socks request. I.e., the address the <b>Dante</b> server
should connect to (for TCP sessions) or send packets to (for
UDP session) on behalf of the client.</p>

<p style="margin-left:11%; margin-top: 1em">Both set of
rules are evaluated on a &quot;first match is best
match&quot; basis. That means, the first rule matched for a
particular client or socks request is the rule that will be
used.</p>

<p style="margin-left:11%; margin-top: 1em">In addition to
the addresses there is a set of optional keywords which can
be given. There are two forms of keywords; conditions and
actions. For each rule, all conditions are checked and if
they match the request, all actions are executed.</p>

<p style="margin-left:11%; margin-top: 1em">The list of
condition keywords is: <b>clientcompatibility</b>,
<b>clientmethod</b>, <b>command</b>, <b>from</b>,
<b>group</b>, <b>socksmethod</b>, <b>protocol</b>,
<b>proxyprotocol</b>, <b>to</b>, <b>user</b>.</p>

<p style="margin-left:11%; margin-top: 1em">The list of
action keywords is: <b>bandwidth</b>, <b>libwrap</b>,
<b>log</b>, <b>session</b>, <b>redirect</b>,
<b>timeout.connect</b>, <b>timeout.negotiate</b>,
<b>timeout.io</b>, <b>timeout.tcp_fin_wait</b>, and
<b>udp.portrange</b>.</p>

<p style="margin-left:11%; margin-top: 1em">The format and
content of the the keyword as used in client-rules or
socks-rules is identical, but client-rules can contain only
a subset of the keyword that socks-rules may contain.</p>

<p style="margin-left:22%; margin-top: 1em">The contents of
a <b>client-rule</b> can be:</p>

<p style="margin-left:11%;"><b>bandwidth</b></p>

<p style="margin-left:22%;">The clients matching this rule
will all share the given amount of bandwidth, measured in
bytes per second. Requires the bandwidth module.</p>

<p style="margin-left:11%;"><b>clientcompatibility</b></p>

<p style="margin-left:22%;">Enables certain options for
compatibility with broken clients. Valid values are:
<b>necgssapi</b>, for compatibility with clients
implementing GSSAPI the NEC socks way.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="7%">


<p><b>from</b></p></td>
<td width="4%"></td>
<td width="78%">


<p>The rule applies to requests coming from the specified
address.</p> </td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="7%">


<p><b>group</b></p></td>
<td width="4%"></td>
<td width="78%">


<p>The user must belong to one of the groups given as
value.</p> </td></tr>
</table>

<p style="margin-left:22%; margin-top: 1em">Note that if
gssapi-based authentication is used, the username as
provided to the <b>Dante</b> server normally includes the
Kerberos domain. The name must be listed on the same form
here and in the system groupfile (usually /etc/passwd) if it
is to be used.</p>

<p style="margin-left:11%;"><b>gssapi.enctype</b></p>

<p style="margin-left:22%;">Which encryption to enforce for
GSSAPI-authenticated communication. Possible values are
<b>clear</b>, <b>integrity</b>, or <b>confidentiality</b>.
The default is to accept whatever the client offers except
<b>clear</b>, as <b>clear</b> is not part of the SOCKS
GSSAPI standard.</p>

<p style="margin-left:11%;"><b>gssapi.keytab</b></p>

<p style="margin-left:22%;">Value for keytab to use. The
default is &quot;FILE:/etc/sockd.keytab&quot;.</p>

<p style="margin-left:11%;"><b>gssapi.servicename</b></p>

<p style="margin-left:22%;">Which servicename to use when
involving GSSAPI. Default is &quot;rcmd&quot;.</p>

<p style="margin-left:11%;"><b>libwrap</b></p>

<p style="margin-left:22%;">The server will pass the
specified parameter line to libwrap for execution.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="4%">


<p><b>log</b></p></td>
<td width="7%"></td>
<td width="78%">


<p>Used to control logging. Accepted keywords are
<b>connect</b>, <b>disconnect</b>, <b>data</b>,
<b>error</b>, <b>ioop</b>, and <b>tcpinfo</b>. The default
is no logging.</p></td></tr>
</table>

<p style="margin-left:11%;"><b>session</b></p>

<p style="margin-left:22%;">Control the max number of
sessions or session establishment rate. See below for
details.</p>

<p style="margin-left:11%;"><b>clientmethod</b></p>

<p style="margin-left:22%;">Require that the connection be
&quot;authenticated&quot; using one of the given
clientmethods.</p>

<p style="margin-left:11%;"><b>pam.servicename</b></p>

<p style="margin-left:22%;">Which servicename to use when
involving pam. Default is &quot;sockd&quot;.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="6%">


<p><b>port</b></p></td>
<td width="5%"></td>
<td width="78%">


<p>Parameter to <b>from</b>, <b>to</b> and <b>via</b>.
Accepts the keywords <b>eq/=, neq/!=, ge/&gt;=, le/&lt;=,
gt/&gt;, lt/&lt;</b> followed by a number. A port range can
also be given as &quot;port &lt;start #&gt; - &lt;end
#&gt;&quot;, which will match all port numbers within the
range &lt;start #&gt; and &lt;end #&gt;.</p></td></tr>
</table>

<p style="margin-left:22%; margin-top: 1em">The default is
to match all ports.</p>

<p style="margin-left:11%;"><b>redirect</b></p>

<p style="margin-left:22%;">The source and/or destination
can be redirected using the <b>redirect</b> statement.
Requires the redirect module.</p>

<p style="margin-left:22%; margin-top: 1em">The syntax of
the redirect statement is as follows:</p>


<p style="margin-left:22%; margin-top: 1em"><b>redirect</b>
from: <b>ADDRESS</b></p>

<p style="margin-left:22%; margin-top: 1em">See the
redirect manual for detailed information.</p>

<p style="margin-left:11%;"><b>socksmethod</b></p>

<p style="margin-left:22%;">If the client offers more than
one authentication method, <b>Dante</b> will select the
method to use based on the order the methods are listed
here. Valid values are the same as in the global
<b>socksmethod</b> line. Normally there will be no need to
set this keyword in a client-rule, but if it is set and the
client offers none of the methods listed, the client will be
blocked at this stage.</p>

<p style="margin-left:11%;"><b>timeout.negotiate</b></p>

<p style="margin-left:22%;">See the global
<b>timeout.negotiate</b> option.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="6%">


<p><b>to</b></p></td>
<td width="5%"></td>
<td width="78%">


<p>The rule applies to requests going to the address given
as value.</p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="6%">


<p><b>user</b></p></td>
<td width="5%"></td>
<td width="78%">


<p>The user must match one of the names given as value. If
no <b>user</b> value is given for a rule requiring
usernames, the effect will be the same as listing every user
in the password file.</p></td></tr>
</table>

<p style="margin-left:22%; margin-top: 1em">Note that if
gssapi-based authentication is used, the username as
provided to the <b>Dante</b> server normally includes the
Kerberos domain. The name must be listed on the same form
here if it is to be used.</p>

<p style="margin-left:22%; margin-top: 1em">The contents of
a <b>socks-rule</b> can be:</p>

<p style="margin-left:11%;"><b>bandwidth</b></p>

<p style="margin-left:22%;">The clients matching this rule
will all share the given amount of bandwidth, measured in
bytes per second. Requires the bandwidth module.</p>

<p style="margin-left:11%;"><b>bsdauth.stylename</b></p>

<p style="margin-left:22%;">The name of the BSD
authentication style to use. The default is to not specify a
value, causing the default system style to be used.</p>

<p style="margin-left:11%;"><b>command</b></p>

<p style="margin-left:22%;">The rule applies to the given
commands. Valid commands are <b>bind</b>, <b>bindreply</b>,
<b>connect</b>, <b>udpassociate</b> and <b>udpreply</b>. Can
be used instead of, or to complement, <b>protocol</b>. The
default is all commands valid for the protocols allowed by
the rule.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="7%">


<p><b>from</b></p></td>
<td width="4%"></td>
<td width="78%">


<p>The rule applies to requests coming from the address
given as value.</p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="7%">


<p><b>group</b></p></td>
<td width="4%"></td>
<td width="78%">


<p>The user must belong to one of the groups given as
value.</p> </td></tr>
</table>

<p style="margin-left:11%;"><b>libwrap</b></p>

<p style="margin-left:22%;">The server will pass the line
to libwrap for execution.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="4%">


<p><b>log</b></p></td>
<td width="7%"></td>
<td width="78%">


<p>Used to control logging. Accepted keywords are
<b>connect</b>, <b>disconnect</b>, <b>data</b>, <b>ioop</b>,
and <b>tcpinfo</b>.</p></td></tr>
</table>

<p style="margin-left:11%;"><b>session</b></p>

<p style="margin-left:22%;">Control the max number of
sessions or session establishment rate. See</p>

<p style="margin-left:11%;"><b>socksmethod</b></p>

<p style="margin-left:22%;">Require that the connection be
established using one of the given authentication methods. A
<b>method</b> normally refers to the socks client part of
the rule, and thus authenticates the client, and not the
target destination (see <b>checkreplyauth</b> for
information about authentication the target destination).
Valid values are the same as in the global
<b>socksmethod</b> line.</p>

<p style="margin-left:11%;"><b>pam.servicename</b></p>

<p style="margin-left:22%;">What servicename to use when
involving pam. Default is &quot;sockd&quot;.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="6%">


<p><b>port</b></p></td>
<td width="5%"></td>
<td width="78%">


<p>Parameter to <b>from</b>, <b>to</b> and <b>via</b>.
Accepts the keywords <b>eq/=, neq/!=, ge/&gt;=, le/&lt;=,
gt/&gt;, lt/&lt;</b> followed by a number. A portrange can
also be given as &quot;port &lt;start #&gt; - &lt;end
#&gt;&quot;, which will match all port numbers within the
range &lt;start #&gt; and &lt;end #&gt;.</p></td></tr>
</table>

<p style="margin-left:22%; margin-top: 1em">The default is
all ports.</p>

<p style="margin-left:11%;"><b>protocol</b></p>

<p style="margin-left:22%;">The rule applies to the given
protocols. Valid values are <b>tcp</b> and <b>udp</b>. The
default is all supported protocols that can apply to the
given <b>commands</b>.</p>

<p style="margin-left:11%;"><b>proxyprotocol</b></p>

<p style="margin-left:22%;">The rule applies to requests
using the given proxy protocol. Valid proxy protocols are
<b>socks_v4</b> and <b>socks_v5</b>. The default is all
supported proxy protocols.</p>

<p style="margin-left:11%;"><b>redirect</b></p>

<p style="margin-left:22%;">The source and/or destination
can be redirected using the <b>redirect</b> statement.
Requires the redirect module.</p>

<p style="margin-left:22%; margin-top: 1em">The syntax of
the redirect statement is as follows:</p>


<p style="margin-left:22%; margin-top: 1em"><b>redirect</b>
from: <b>ADDRESS</b></p>


<p style="margin-left:22%; margin-top: 1em"><b>redirect</b>
to: <b>ADDRESS</b></p>

<p style="margin-left:22%; margin-top: 1em">The semantics
of <b>from</b> and <b>to</b> vary according to
<b>command</b>. See the redirect manual for detailed
information.</p>

<p style="margin-left:11%;"><b>timeout.connect</b></p>

<p style="margin-left:22%;">See the global
<b>timeout.connect</b> option.</p>

<p style="margin-left:11%;"><b>timeout.io</b></p>

<p style="margin-left:22%;">See the global
<b>timeout.io</b> option.</p>


<p style="margin-left:11%;"><b>timeout.tcp_fin_wait</b></p>

<p style="margin-left:22%;">See the global
<b>timeout.tcp_fin_wait</b> option.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="3%">


<p><b>to</b></p></td>
<td width="8%"></td>
<td width="78%">


<p>The rule applies to requests going to or using the
address given as value. Note that the meaning of this
address is affected by <b>command</b>.</p></td></tr>
</table>

<p style="margin-left:11%;"><b>udp.portrange</b></p>

<p style="margin-left:22%;">The argument to this keyword is
two port numbers, separated by a dash (&rsquo;-&rsquo;).
They specify the UDP port-range that will be used between
the <b>socks-client</b> and the <b>Dante-server for UDP
packets. Note that this has no relation to the UDP
port-range used between the Dante-server and external,
non-socks, clients/servers.</b></p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="6%">


<p><b>user</b></p></td>
<td width="5%"></td>
<td width="78%">


<p>The user must match one of the names given as value. If
no <b>user</b> value is given for a rule requiring
usernames, the effect will be the same as listing every user
in the password file.</p></td></tr>
</table>

<h2>SESSION
<a name="SESSION"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">The
<b>session</b> keyword can be used any any rule to limit the
number of active sessions and the rate at which they are
established. There are two main commands for this;
<b>session.max</b>, that controls the max number of sessions
that can be matched, and <b>session.throttle</b>, that
controls the connection rate. These commands can be applied
both for the total limit for all matching clients and can be
set as global defaults or in any of the rule types. The
<b>session.max</b> keyword takes a number corresponding to
the highest number of allowed simultaneous connections as an
argument. The <b>session.throttle</b> keyword takes two
number separated by a slash character, with the first
representing the number of connections and the latter a time
duration in seconds. If more than the specified number of
connections are received in the specified number of seconds,
additional connections will be dropped.</p>

<p style="margin-left:11%; margin-top: 1em">Stateful
session tracking on a per IP-address basis is also
supported. For stateful tracking, the limits apply to each
connection with a matching IP-address, with the
<b>session.state.key</b> keyword is used to control how the
IP-address is determined. Currently two values are
supported, <b>from</b> and <b>hostid</b>. The former causes
the limit to be applied to all hosts with the same source
IP-address and the latter to all TCP connections with the
same hostid value. If a hostid value is used, the
<b>session.state.key.hostindex</b> keyword can be used to
choose which of the to hostid values are used, with the
first value being the default.</p>

<p style="margin-left:11%; margin-top: 1em">Limits are
evaluated first for client rules, then for hostid rules, and
finally for socks rules. By default, a limit set in a
matching client rule will be used also any subsequent
matching hostid or socks rules, unless either of these rules
also have session limit keywords. This session inheritance
can be disabled in client and hostid rules, causing them to
only apply in the rule in which they appear. This is done by
setting the <b>session.inheritable</b> to <b>no</b>.</p>

<p style="margin-left:11%; margin-top: 1em">The session
keywords must be set in a rule (either client, hostid, or
socks), setting them globally is not supported.</p>

<h2>TRAFFIC MONITORING
<a name="TRAFFIC MONITORING"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">The Dante
server can be configured to monitor the traffic passing
through it, and trigger alarms based on the observed network
traffic.</p>

<p style="margin-left:11%; margin-top: 1em">The alarms are
specified in so-called monitors. These objects have the same
general format as the rules Dante uses for access control
and enable perform passive monitoring of network traffic, or
the lack of network traffic.</p>

<p style="margin-left:11%; margin-top: 1em">The following
example shows the general monitor syntax, specifying a
monitor without any monitoring operations:</p>

<p style="margin-left:11%; margin-top: 1em">monitor { <br>
from: 0.0.0.0/0 to: www.example.org port = 80 <br>
protocol: tcp <br>
}</p>

<p style="margin-left:11%; margin-top: 1em">A monitor can
include many of the same keywords that are available in the
Dante ACL rules. The following subset is currently
supported:</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="22%"></td>
<td width="6%">


<p style="margin-top: 1em"><b>from</b></p></td>
<td width="4%"></td>
<td width="68%">


<p style="margin-top: 1em">Normally specifies what SOCKS
client addresses/networks to monitor.</p></td></tr>
<tr valign="top" align="left">
<td width="22%"></td>
<td width="6%">


<p><b>to</b></p></td>
<td width="4%"></td>
<td width="68%">


<p>Normally specifies what target addresses/networks to
monitor.</p> </td></tr>
</table>

<p style="margin-left:22%;"><b>protocol</b></p>

<p style="margin-left:32%;">Can be used to restrict
monitoring to a certain protocol (TCP, UDP or both). Note:
only TCP should be used for now.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="22%"></td>
<td width="9%">


<p><b>hostid</b></p></td>
<td width="1%"></td>
<td width="68%">


<p>Can be used to restrict monitoring to only clients with
a specific hostid value set.</p></td></tr>
</table>

<p style="margin-left:22%;"><b>hostindex</b></p>

<p style="margin-left:32%;">Used along with the hostid
keyword to control which of the two possible hostid values
will be used when matching.</p>

<p style="margin-left:11%; margin-top: 1em">NOTE: It is
currently recommended that the protocol keyword is always
specified and set to tcp because there is currently only
limited support for monitoring of UDP traffic, and testing
of UDP traffic monitoring has not been done.</p>

<p style="margin-left:11%; margin-top: 1em">The main
function of monitors is to provide a container for one or
more alarms, which are specified using a new set of keywords
not available for other rules. Alarms specify a condition
that will cause Dante to log a warning if the condition is
triggered.</p>

<p style="margin-left:11%; margin-top: 1em">Active TCP
sessions will at most match one monitor, but multiple alarms
can be specified in a single monitor. This makes it possible
to specify multiple sets of conditions for the same TCP
sessions, depending on what network interface the traffic is
transferred on and whether the traffic is being received or
transmitted.</p>

<p style="margin-left:11%; margin-top: 1em">Alarms can
trigger as a result of periods of no or little data being
transmitted, or a large numbers of TCP connections
disconnecting during a short period of time, or for other
reasons. See below for a complete list of what conditions
alarms can be enabled for.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Data
alarms</b> <br>
Adding an alarm.data keyword to a monitor will result in
warnings being logged if there are periods with too little
network traffic.</p>

<p style="margin-left:11%; margin-top: 1em">Dante has four
network paths and data alarms can be configured
independently for each of them:</p>


<p style="margin-left:22%;"><b>internal.alarm.data.recv</b></p>

<p style="margin-left:32%;">Data received on Dante&rsquo;s
internal interface (data sent from the SOCKS clients to
Dante).</p>


<p style="margin-left:22%;"><b>internal.alarm.data.send</b></p>

<p style="margin-left:32%;">Data sent out on Dante&rsquo;s
internal interface (data sent from Dante to the SOCKS
clients).</p>


<p style="margin-left:22%;"><b>external.alarm.data.recv</b></p>

<p style="margin-left:32%;">Data received on Dante&rsquo;s
external interface (data sent from the target servers to
Dante).</p>


<p style="margin-left:22%;"><b>external.alarm.data.send</b></p>

<p style="margin-left:32%;">Data sent out on Dante&rsquo;s
external interface (data sent from Dante to the target
servers).</p>

<p style="margin-left:11%; margin-top: 1em">The data.alarm
keyword takes two parameters: a byte count and a duration in
seconds. The alarm will trigger if the specified number of
seconds pass with only the specified number of bytes (or
less) being transmitted.</p>

<p style="margin-left:11%; margin-top: 1em">The syntax is
as follows:</p>


<p style="margin-left:11%; margin-top: 1em"><b>internal.alarm.data.recv:
DATALIMIT in INTERVAL</b></p>

<p style="margin-left:11%; margin-top: 1em">The DATALIMIT
is a number that specifies the byte limit. The INTERVAL is a
number that specifies the duration. If only DATALIMIT bytes
(or less) have been transferred during a period of INTERVAL
seconds, an alarm will trigger in Dante.</p>

<p style="margin-left:11%; margin-top: 1em">Data alarms
trigger when a period of data idleness has been detected.
Once a data alarm has triggered it will remain active until
it is cleared. A warning will be logged when the alarm
triggers and than again when the alarm condition is cleared.
In between these two points no warnings related to this
alarm will be logged. This avoids repeating the same
alarm/warning multiple times during network problems that
last for an extended amount of time. When the alarm is
cleared, Dante will also include information about how long
the alarm condition lasted.</p>

<p style="margin-left:11%; margin-top: 1em">A data alarm
can be cleared in two ways; automatically, once enough data
has been transferred in a short enough amount of time, or
manually, by sending the Dante server a SIGHUP signal. A
SIGHUP will cause all active alarms to be cleared. No log
messages indicating that the alarms have cleared will be
logged when alarms are cleared in this way.</p>

<p style="margin-left:11%; margin-top: 1em">Once an alarm
has been cleared, it can trigger again if enough data is not
being transferred.</p>

<p style="margin-left:11%; margin-top: 1em">Note that data
alarms will trigger regardless of whether there are active
sessions matching the monitor or not; if enough data is not
being transmitted or received, a data alarm will trigger.
Alarms will trigger also shortly after server startup, if
the Dante server does not receive sufficient traffic to
prevent the alarms from triggering.</p>

<p style="margin-left:11%; margin-top: 1em">Note that the
message indicating that an alarm has cleared is not logged
if the alarm was cleared due to a SIGHUP signal being
received.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Disconnect
alarms</b> <br>
The disconnect alarms are related to connection disconnects
and by using the alarm.disconnect keyword the Dante server
can log warnings based on the number and rate of terminated
connections.</p>

<p style="margin-left:11%; margin-top: 1em">There are two
variants of the alarm keyword, one for the internal network
interface, between the SOCKS clients and Dante, and one for
the external interface, between the Dante server and the
target servers:</p>


<p style="margin-left:22%;"><b>internal.alarm.disconnect</b></p>

<p style="margin-left:32%;">Connections between SOCKS
clients and the Dante server.</p>


<p style="margin-left:22%;"><b>external.alarm.disconnect</b></p>

<p style="margin-left:32%;">Connections between the Dante
server and target servers.</p>

<p style="margin-left:11%; margin-top: 1em">Each alarm
keyword takes three parameters, a minimum count, a ratio
value, and a time interval. The following format is
used:</p>


<p style="margin-left:11%; margin-top: 1em">internal.alarm.disconnect:
MINCOUNT/RATIO in INTERVAL</p>

<p style="margin-left:11%; margin-top: 1em">The MINCOUNT is
the minimum number of connections that must be disconnected
for the alarm to trigger. The RATIO is used together with
the MINCOUNT to express the number of connections, relative
to the total number of connections that have existed in the
time period, that must be disconnected for the alarm to
trigger. The INTERVAL is the time in seconds within which
the disconnects must occur for the alarm to trigger.</p>

<p style="margin-left:11%; margin-top: 1em">To set values
that are useful, some knowledge about the expected amount of
network traffic and number of sessions is required. If the
rate of disconnects, as a percentage, is lower than the
ratio specified, an alarm will not trigger. Conversely, if
the MINCOUNT is set too low, alarms might trigger too
frequently because only a small number of disconnects might
be sufficient to achieve the required number of disconnects
and disconnect ratio at times when there are only a few
active sessions.</p>

<p style="margin-left:11%; margin-top: 1em">Only
connections that are terminated on the specified interface
are counted, i.e., an external.alarm.disconnect alarm will
only trigger for connections that are terminated on the
network interface between the Dante server and the target
server, either by the target server closing the connection
to Dante or by Dante receiving a fatal network error from
that side of the connection (e.g., a TCP RST packet).</p>

<p style="margin-left:11%; margin-top: 1em">Connections
that are closed on the internal interface (by the SOCKS
clients) will not count towards a disconnect alarm on the
external side. Likewise, connections closed by target
servers will not count towards a disconnect alarm on the
internal side.</p>

<p style="margin-left:11%; margin-top: 1em">A practical
consequence of this is that if a large number of connections
are simultaneously closed by both the client and the target
server, each connection will only be counted as a disconnect
on one of the sides; either the external side or the
internal side, depending on which side closes the connection
first.</p>

<p style="margin-left:11%; margin-top: 1em">Alarms trigger
each time a sufficient number disconnects occur. Each
sufficiently large burst of disconnects will result in an
alarm, but normally at most one warning per alarm will be
logged during each time interval, though this might change
in a later version of Dante.</p>

<p style="margin-left:11%; margin-top: 1em">Separate alarms
are produced for each distinct alarm keyword when multiple
alarms are specified in a monitor rule.</p>

<h2>ROUTES
<a name="ROUTES"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">The routes are
specified with a <b>route</b> keyword. Inside a pair of
curly braces ({}) a set of keywords control the behavior of
the route. See socks.conf(5) for a description. This is used
to perform so-called &quot;server-chaining&quot;, where one
socks-server connects to another socks-server further
upstream.</p>

<p style="margin-left:11%; margin-top: 1em">The syntax for
these routes is the same as the routes used by the client.
Please see socks.conf(5) for information about the route
syntax.</p>

<p style="margin-left:11%; margin-top: 1em">There are
however some special things one need to be aware of
regarding serverchaining and routes specified for the
server:</p>

<p style="margin-left:22%; margin-top: 1em">At present
serverchaining is only supported for the <b>tcp connect</b>
command.</p>

<p style="margin-left:22%; margin-top: 1em">If the route
specifies that a username/password-method should be offered
to the upstream proxy, <b>Dante</b> will forward the
username/password received from it&rsquo;s own client to the
foreign upstream proxy, meaning the upstream proxy will
receive the user&rsquo;s username and password in cleartext
from <b>Dante.</b></p>

<p style="margin-left:22%; margin-top: 1em">At present
serverchaining does not scale well in <b>Dante</b> and
should not be used for anything but minimal client
loads.</p>

<h2>EXAMPLES
<a name="EXAMPLES"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">See the
example/ directory in the distribution.</p>

<h2>FILES
<a name="FILES"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em">/etc/sockd.conf
<b>Dante</b> server configuration file. <br>
/etc/passwd systemfile used when doing standard
username/password <br>
authentication.</p>

<h2>AUTHORS
<a name="AUTHORS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">For inferno
Nettverk A/S: <br>
Michael Shuldman <br>
Karl-Andre&rsquo; Skevik</p>

<h2>SEE ALSO
<a name="SEE ALSO"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">sockd(8),
socks.conf(5), hosts_access(5)</p>

<p style="margin-left:11%; margin-top: 1em">Information
about new releases and other related issues can be found on
the <b>Dante</b> WWW home page:
http://www.inet.no/dante/</p>

<p style="margin-left:11%; margin-top: 1em">Information
about commercial support can be found on the <b>Dante</b>
WWW support page: http://www.inet.no/dante/support.html</p>
<hr>
</body>
</html>
