<!-- Creator     : groff version 1.22.4 -->
<!-- CreationDate: Mon May 29 22:53:51 2023 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title>HWLOC-ANNOTATE</title>

</head>
<body>
<h1>hwloc-annotate</h1>



<h2>NAME
<a name="NAME"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">hwloc-annotate
&minus; Modify attributes in a XML topology</p>

<h2>SYNOPSIS
<a name="SYNOPSIS"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em"><b>hwloc-annotate</b>
[<i>options</i>] <i>&lt;input.xml&gt; &lt;output.xml&gt;</i>
-- <i>&lt;location1&gt; &lt;location2&gt;</i> ... --
<i>&lt;mode&gt; &lt;annotation&gt;</i></p>


<p style="margin-left:11%; margin-top: 1em"><b>hwloc-annotate</b>
[<i>options</i>] <i>&lt;input.xml&gt; &lt;output.xml&gt;
&lt;location&gt; &lt;mode&gt; &lt;annotation&gt;</i></p>

<p style="margin-left:11%; margin-top: 1em">Note that
hwloc(7) provides a detailed explanation of the hwloc system
and of valid &lt;location&gt; formats; it should be read
before reading this man page.</p>

<h2>OPTIONS
<a name="OPTIONS"></a>
</h2>


<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="14%">


<p style="margin-top: 1em"><b>&minus;&minus;ri</b></p></td>
<td width="1%"></td>
<td width="74%">


<p style="margin-top: 1em">Remove all info attributes that
exist with the same name before adding the new one. This
option is only accepted in &quot;info&quot; mode. If the
info value is omitted, existing infos are replaced with
nothing.</p> </td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="14%">


<p><b>&minus;&minus;ci</b></p></td>
<td width="1%"></td>
<td width="74%">


<p>Clear the existing info attributes in the target objects
before annotating. If no new annotation has to be added
after clearing, <i>mode</i> should be set to
<i>none</i>.</p> </td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="14%">


<p><b>&minus;&minus;cu</b></p></td>
<td width="1%"></td>
<td width="74%">


<p>Clear the existing userdata from the target objects. If
nothing else has to be performed after clearing, <i>mode</i>
should be set to <i>none</i>.</p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="14%">


<p><b>&minus;&minus;cd</b></p></td>
<td width="1%"></td>
<td width="74%">


<p>Clear the existing distances from the topology. If
nothing else has to be performed after clearing, <i>mode</i>
should be set to <i>none</i>.</p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="14%">


<p><b>&minus;&minus;version</b></p></td>
<td width="1%"></td>
<td width="74%">


<p>Report version and exit.</p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="14%">


<p><b>&minus;h &minus;&minus;help</b></p></td>
<td width="1%"></td>
<td width="74%">


<p>Display help message and exit.</p></td></tr>
</table>

<h2>DESCRIPTION
<a name="DESCRIPTION"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">hwloc-annotate
loads a topology from a XML file, adds some annotations, and
export the resulting topology to another XML file. The input
and output files may be the same.</p>

<p style="margin-left:11%; margin-top: 1em">The annotation
may be string info attributes. This is specified by the
<i>mode</i>: <b><br>
info &lt;name&gt; &lt;value&gt;</b></p>

<p style="margin-left:22%;">Specifies a new string info
attribute whose name is <i>name</i> and value is
<i>value</i>.</p>

<p style="margin-left:11%;"><b>subtype
&lt;subtype&gt;</b></p>

<p style="margin-left:22%;">Specifies that the subtype
attribute of the object should now be <i>subtype</i>. If an
empty string is given, the subtype is removed.</p>

<p style="margin-left:11%;"><b>size &lt;size&gt;</b></p>

<p style="margin-left:22%;">Specifies the size of a cache
or NUMA node. The value may be suffixed with <b>kB</b>,
<b>KiB</b>, <b>MB</b>, <b>MiB</b>, <b>GB</b>, <b>GiB</b>,
etc.</p>

<p style="margin-left:11%;"><b>misc &lt;name&gt;</b></p>

<p style="margin-left:22%;">Specifies a new Misc object
name.</p>

<p style="margin-left:11%;"><b>memattr &lt;name&gt;
&lt;&iuml;&not;ags&gt;</b></p>

<p style="margin-left:22%;">Register a new memory attribute
whose name is <i>name</i> and flags is <i>flags</i>.
<i>location</i> is ignored in this mode.</p>

<p style="margin-left:22%; margin-top: 1em">Flags may be
given as numeric values or as a comma-separated list of flag
names that are passed to <i>hwloc_memattr_register()</i>.
Those names may be substrings of actual flag names as long
as a single one matches. For instance, a value of <b>1</b>
(or <b>higher</b>) means that highest values are considered
best for this attribute.</p>

<p style="margin-left:11%;"><b>memattr &lt;name&gt;
&lt;initiator&gt; &lt;value&gt;</b></p>

<p style="margin-left:22%;">Set the memory attribute (whose
name is <i>name</i>) from initiator <i>initiator</i> (either
an object or a CPU-set) to target NUMA node <i>location</i>
to value <i>value</i>.</p>

<p style="margin-left:22%; margin-top: 1em">If this
attribute does not require specific initiators,
<i>initiator</i> is ignored.</p>

<p style="margin-left:22%; margin-top: 1em">Standard
attribute names are <i>Capacity</i>, <i>Locality</i>,
<i>Bandwidth</i>, and <i>Latency</i>. All existing
attributes in the input topology may be listed with</p>

<p style="margin-left:22%; margin-top: 1em">$ lstopo
--memattrs -i input.xml</p>

<p style="margin-left:11%;"><b>cpukind &lt;cpuset&gt;
&lt;efficiency&gt; &lt;flags&gt; [&lt;infoname&gt;
&lt;infovalue&gt;]</b></p>

<p style="margin-left:22%;">Specifies the kind of CPU for
PUs listed in the given cpuset. <i>location</i> is ignored
in this mode.</p>


<p style="margin-left:22%; margin-top: 1em"><i>efficiency</i>
is an abstracted efficiency value that will enforce ranking
of kinds. It should be -1 if unknown.</p>

<p style="margin-left:22%; margin-top: 1em"><i>flags</i>
must be 0 for now.</p>

<p style="margin-left:22%; margin-top: 1em">If
<i>infoname</i> and <i>infovalue</i> are given and
non-empty, they are added as info attributes to this kind of
CPU.</p>

<p style="margin-left:22%; margin-top: 1em">See the
function hwloc_cpukinds_register() for details.</p>

<p style="margin-left:11%;"><b>distances &lt;filename&gt;
[&lt;flags&gt;]</b></p>

<p style="margin-left:22%;">Specifies new distances to be
added to the topology using specifications in
<i>&lt;filename&gt;</i>. The optional <i>flags</i> (0 unless
specified) corresponds to the flags given to the function
<b>hwloc_distances_set()</b>. <i>location</i> is ignored in
this mode.</p>

<p style="margin-left:22%; margin-top: 1em">The real first
line of the pointed file must be a integer representing a
distances <b>kind</b> as defined in
<b>hwloc/distances.h</b>. The second line is the number of
objects involved in the distances. The next lines contain
one object each. The next lines contain one distance value
each, or a single line may be given with a integer
combination of format <b>x*y</b> or <b>x*y*z</b>. An
optional line before all others may start with <b>name=</b>
to specify the name of the distances structure if any.</p>

<p style="margin-left:11%;"><b>distances-transform
&lt;name&gt; links</b></p>

<p style="margin-left:22%;">Transform a bandwidth distances
structure named &lt;name&gt; into links. See the
documentation of HWLOC_DISTANCES_TRANSFORM_LINKS in
hwloc/distances.h for details.</p>

<p style="margin-left:11%;"><b>distances-transform
&lt;name&gt; merge-switch-ports</b></p>

<p style="margin-left:22%;">When switches appear in the
matrix as different ports, merge all of them into a single
port for clarity. This currently only applies to the
NVLinkBandwidth matrix between NVIDIA GPUs. See the
documentation of
HWLOC_DISTANCES_TRANSFORM_MERGE_SWITCH_PORTS in
hwloc/distances.h for details.</p>

<p style="margin-left:11%;"><b>distances-transform
&lt;name&gt; transitive-closure</b></p>

<p style="margin-left:22%;">If objects are connected across
a switch, apply a transitive-closure to report the bandwidth
through that switch. This currently only applies to the
NVLinkBandwidth matrix between NVIDIA GPUs. The bandwidth
between all pairs of GPUs will be exposed instead of
bandwidths between single GPUs and single NVSwitch ports.
See the documentation of
HWLOC_DISTANCES_TRANSFORM_TRANSITIVE_CLOSURE in
hwloc/distances.h for details.</p>

<p style="margin-left:11%;"><b>distances-transform
&lt;name&gt; remove-obj &lt;obj&gt;</b></p>

<p style="margin-left:22%;">Remove the given object from
the distances structure named &lt;name&gt;.</p>

<p style="margin-left:11%;"><b>distances-transform
&lt;name&gt; replace-objs &lt;oldtype&gt;
&lt;newtype&gt;</b></p>

<p style="margin-left:22%;">Replace objects of type
&lt;oldtype&gt; in distances structure named &lt;name&gt;
with objects of type &lt;newtype&gt; with same locality. If
&lt;oldtype&gt; or &lt;newtype&gt; are not object types,
they are assumed subtypes of OS devices, e.g.
&quot;NVML&quot; or &quot;OpenCL&quot;. See the
documentation of hwloc_get_obj_with_same_locality() in
hwloc/helper.h for details.</p>

<p style="margin-left:22%; margin-top: 1em">If
&lt;newtype&gt; is &quot;NULL&quot;, objects are removed
from the distances structure.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="6%">


<p><b>none</b></p></td>
<td width="5%"></td>
<td width="78%">


<p>No new annotation is added. This is useful when clearing
existing attributes.</p></td></tr>
</table>

<p style="margin-left:11%; margin-top: 1em">Annotations may
be added to one specific object in the topology, all of
them, or all of a given type. This is specified by the
<i>location</i> (see also EXAMPLES below). Multiple
locations may be affected if they are specified between
<b>--</b>. Objects may be specified as location tuples, as
explained in hwloc(7). However hexadecimal bitmasks are not
accepted since they may correspond to multiple objects.</p>

<p style="margin-left:11%; margin-top: 1em"><b>NOTE:</b>
The existing annotations may be listed with hwloc-info.</p>

<p style="margin-left:11%; margin-top: 1em"><b>NOTE:</b> It
is highly recommended that you read the hwloc(7) overview
page before reading this man page. Most of the concepts
described in hwloc(7) directly apply to the hwloc-annotate
utility.</p>

<h2>EXAMPLES
<a name="EXAMPLES"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em">hwloc-annotate&rsquo;s
operation is best described through several examples.</p>

<p style="margin-left:11%; margin-top: 1em">Add an info
attribute to all Core and PU objects:</p>

<p style="margin-left:11%; margin-top: 1em">$
hwloc-annotate input.xml output.xml -- Core:all PU:all --
info infoname infovalue</p>

<p style="margin-left:11%; margin-top: 1em">Only add to all
Core objects:</p>

<p style="margin-left:11%; margin-top: 1em">$
hwloc-annotate input.xml output.xml Core:all info infoname
infovalue</p>

<p style="margin-left:11%; margin-top: 1em">Add a Misc
object named &quot;foobar&quot; under the root object of the
topology and modify the input XML directly:</p>

<p style="margin-left:11%; margin-top: 1em">$
hwloc-annotate file.xml file.xml root misc foobar</p>

<p style="margin-left:11%; margin-top: 1em">Add an info
attribute to OS device #2 and #3:</p>

<p style="margin-left:11%; margin-top: 1em">$
hwloc-annotate input.xml output.xml os:2-3 info infoname
infovalue</p>

<p style="margin-left:11%; margin-top: 1em">Change package
objects to green with red text in the lstopo graphical
output:</p>

<p style="margin-left:11%; margin-top: 1em">$
hwloc-annotate topo.xml topo.xml package:all info
lstopoStyle &quot;Background=#00ff00;Text=#ff0000&quot; <br>
$ lstopo -i topo.xml</p>

<p style="margin-left:11%; margin-top: 1em">Set the memory
attribute latency to 123 nanoseconds from the PUs in the
first package to the first NUMA node:</p>

<p style="margin-left:11%; margin-top: 1em">$
hwloc-annotate topo.xml topo.xml numanode:0 memattr Latency
$(hwloc-calc package:0) 123</p>

<p style="margin-left:11%; margin-top: 1em">Register a
memory attribute <b>MyApplicationPerformance</b> (with flags
specifying that it requires an initiator and reports higher
values first) and set its value for initiator CPU-set 0x11
to NUMA node #2 to 2345:</p>

<p style="margin-left:11%; margin-top: 1em">$
hwloc-annotate topo.xml topo.xml ignored memattr
MyApplicationPerformance need_init,higher <br>
$ hwloc-annotate topo.xml topo.xml numanode:2 memattr
MyApplicationPerformance 0x11 2345</p>

<p style="margin-left:11%; margin-top: 1em">To clarify that
NUMA node #0 is DDR while NUMA node #1 is HBM:</p>

<p style="margin-left:11%; margin-top: 1em">$
hwloc-annotate topo.xml topo.xml numa:0 subtype DDR <br>
$ hwloc-annotate topo.xml topo.xml numa:1 subtype HBM</p>

<p style="margin-left:11%; margin-top: 1em">Specify that PU
0-3 and PU 4-7 are of different kinds, and the latter is
more efficient:</p>

<p style="margin-left:11%; margin-top: 1em">$
hwloc-annotate topo.xml topo.xml dummy cpukind 0x0f 0 0
CoreType Small <br>
$ hwloc-annotate topo.xml topo.xml dummy cpukind 0xf0 1 0
CoreType Big</p>

<p style="margin-left:11%; margin-top: 1em">Replace NUMA
nodes with Packages in the NUMALatency distances matrix,
when they have the exact same locality.</p>

<p style="margin-left:11%; margin-top: 1em">$
hwloc-annotate topo.xml topo.xml -- dummy --
distances-transform NUMALatency replace-objs numanode
packages</p>

<p style="margin-left:11%; margin-top: 1em">Remove NUMA
node #3 from the NUMALatency distances matrix:</p>

<p style="margin-left:11%; margin-top: 1em">$
hwloc-annotate topo.xml topo.xml -- dummy --
distances-transform NUMALatency remove-obj numa:3</p>

<p style="margin-left:11%; margin-top: 1em">Merge all
NVSwitch ports bandwidth information into a single port in
the NVLinkBandwidth matrix:</p>

<p style="margin-left:11%; margin-top: 1em">$
hwloc-annotate topo.xml topo.xml -- dummy --
distances-transform NVLinkBandwidth merge-switch-ports</p>

<p style="margin-left:11%; margin-top: 1em">Apply a
transitive closure to get inter-GPU bandwidth across
NVSwitches in the NVLinkBandwidth matrix:</p>

<p style="margin-left:11%; margin-top: 1em">$
hwloc-annotate topo.xml topo.xml -- dummy --
distances-transform NVLinkBandwidth transitive-closure</p>

<h2>RETURN VALUE
<a name="RETURN VALUE"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Upon successful
execution, hwloc-annotate generates the output topology. The
return value is 0.</p>

<p style="margin-left:11%; margin-top: 1em">hwloc-annotate
will return nonzero if any kind of error occurs, such as
(but not limited to) failure to parse the command line.</p>

<h2>SEE ALSO
<a name="SEE ALSO"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">hwloc(7),
lstopo(1), hwloc-info(1)</p>
<hr>
</body>
</html>
