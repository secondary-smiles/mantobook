<!-- Creator     : groff version 1.22.4 -->
<!-- CreationDate: Mon May 29 22:54:03 2023 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title>SYSTEMD&minus;NSPAWN</title>

</head>
<body>
<h1>systemd-nspawn</h1>



<h2>NAME
<a name="NAME"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">systemd-nspawn
&minus; Spawn a command or OS in a light&minus;weight
container</p>

<h2>SYNOPSIS
<a name="SYNOPSIS"></a>
</h2>


<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="72%">


<p style="margin-top: 1em"><b>systemd&minus;nspawn</b>
[OPTIONS...] [<i>COMMAND&nbsp;</i>[ARGS...]]</p></td>
<td width="17%">
</td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="72%">


<p style="margin-top: 1em"><b>systemd&minus;nspawn</b>
&minus;&minus;boot [OPTIONS...] [ARGS...]</p></td>
<td width="17%">
</td></tr>
</table>

<h2>DESCRIPTION
<a name="DESCRIPTION"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em"><b>systemd&minus;nspawn</b>
may be used to run a command or OS in a light&minus;weight
namespace container. In many ways it is similar to
<b>chroot</b>(1), but more powerful since it fully
virtualizes the file system hierarchy, as well as the
process tree, the various IPC subsystems and the host and
domain name.</p>


<p style="margin-left:11%; margin-top: 1em"><b>systemd&minus;nspawn</b>
may be invoked on any directory tree containing an operating
system tree, using the <b>&minus;&minus;directory=</b>
command line option. By using the
<b>&minus;&minus;machine=</b> option an OS tree is
automatically searched for in a couple of locations, most
importantly in /var/lib/machines/, the suggested directory
to place OS container images installed on the system.</p>

<p style="margin-left:11%; margin-top: 1em">In contrast to
<b>chroot</b>(1)&nbsp;<b>systemd&minus;nspawn</b> may be
used to boot full Linux&minus;based operating systems in a
container.</p>


<p style="margin-left:11%; margin-top: 1em"><b>systemd&minus;nspawn</b>
limits access to various kernel interfaces in the container
to read&minus;only, such as /sys/, /proc/sys/ or
/sys/fs/selinux/. The host's network interfaces and the
system clock may not be changed from within the container.
Device nodes may not be created. The host system cannot be
rebooted and kernel modules may not be loaded from within
the container.</p>

<p style="margin-left:11%; margin-top: 1em">Use a tool like
<b>dnf</b>(8), <b>debootstrap</b>(8), or <b>pacman</b>(8) to
set up an OS directory tree suitable as file system
hierarchy for <b>systemd&minus;nspawn</b> containers. See
the Examples section below for details on suitable
invocation of these commands.</p>

<p style="margin-left:11%; margin-top: 1em">As a safety
check <b>systemd&minus;nspawn</b> will verify the existence
of /usr/lib/os&minus;release or /etc/os&minus;release in the
container tree before booting a container (see
<b>os-release</b>(5)). It might be necessary to add this
file to the container tree manually if the OS of the
container is too old to contain this file
out&minus;of&minus;the&minus;box.</p>


<p style="margin-left:11%; margin-top: 1em"><b>systemd&minus;nspawn</b>
may be invoked directly from the interactive command line or
run as system service in the background. In this mode each
container instance runs as its own service instance; a
default template unit file systemd&minus;nspawn@.service is
provided to make this easy, taking the container name as
instance identifier. Note that different default options
apply when <b>systemd&minus;nspawn</b> is invoked by the
template unit file than interactively on the command line.
Most importantly the template unit file makes use of the
<b>&minus;&minus;boot</b> option which is not the default in
case <b>systemd&minus;nspawn</b> is invoked from the
interactive command line. Further differences with the
defaults are documented along with the various supported
options below.</p>

<p style="margin-left:11%; margin-top: 1em">The
<b>machinectl</b>(1) tool may be used to execute a number of
operations on containers. In particular it provides
easy&minus;to&minus;use commands to run containers as system
services using the systemd&minus;nspawn@.service template
unit file.</p>

<p style="margin-left:11%; margin-top: 1em">Along with each
container a settings file with the .nspawn suffix may exist,
containing additional settings to apply when running the
container. See <b>systemd.nspawn</b>(5) for details.
Settings files override the default options used by the
systemd&minus;nspawn@.service template unit file, making it
usually unnecessary to alter this template file
directly.</p>

<p style="margin-left:11%; margin-top: 1em">Note that
<b>systemd&minus;nspawn</b> will mount file systems private
to the container to /dev/, /run/ and similar. These will not
be visible outside of the container, and their contents will
be lost when the container exits.</p>

<p style="margin-left:11%; margin-top: 1em">Note that
running two <b>systemd&minus;nspawn</b> containers from the
same directory tree will not make processes in them see each
other. The PID namespace separation of the two containers is
complete and the containers will share very few runtime
objects except for the underlying file system. Rather use
<b>machinectl</b>(1)'s <b>login</b> or <b>shell</b> commands
to request an additional login session in a running
container.</p>


<p style="margin-left:11%; margin-top: 1em"><b>systemd&minus;nspawn</b>
implements the <b><font color="#0000FF">Container
Interface</font></b>
<small><font color="#000000">[1]</font></small>
<font color="#000000">specification.</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000">While
running, containers invoked with <b>systemd&minus;nspawn</b>
are registered with the <b>systemd-machined</b>(8) service
that keeps track of running containers, and provides
programming interfaces to interact with them.</font></p>

<h2>OPTIONS
<a name="OPTIONS"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em"><font color="#000000">If
option <b>&minus;&minus;boot</b> is specified, the arguments
are used as arguments for the init program. Otherwise,
<i>COMMAND</i> specifies the program to launch in the
container, and the remaining arguments are used as arguments
for this program. If <b>&minus;&minus;boot</b> is not used
and no arguments are specified, a shell is launched in the
container.</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000">The
following options are understood:</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000"><b>&minus;q</b>,
<b>&minus;&minus;quiet</b></font></p>

<p style="margin-left:17%;"><font color="#000000">Turns off
any status output by the tool itself. When this switch is
used, the only output from nspawn will be the console output
of the container OS itself.</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000"><b>&minus;&minus;settings=</b><i>MODE</i></font></p>

<p style="margin-left:17%;"><font color="#000000">Controls
whether <b>systemd&minus;nspawn</b> shall search for and use
additional per&minus;container settings from .nspawn files.
Takes a boolean or the special values <b>override</b> or
<b>trusted</b>.</font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000">If
enabled (the default), a settings file named after the
machine (as specified with the <b>&minus;&minus;machine=</b>
setting, or derived from the directory or image file name)
with the suffix .nspawn is searched in /etc/systemd/nspawn/
and /run/systemd/nspawn/. If it is found there, its settings
are read and used. If it is not found there, it is
subsequently searched in the same directory as the image
file or in the immediate parent of the root directory of the
container. In this case, if the file is found, its settings
will be also read and used, but potentially unsafe settings
are ignored. Note that in both these cases, settings on the
command line take precedence over the corresponding settings
from loaded .nspawn files, if both are specified. Unsafe
settings are considered all settings that elevate the
container's privileges or grant access to additional
resources such as files or directories of the host. For
details about the format and contents of .nspawn files,
consult <b>systemd.nspawn</b>(5).</font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000">If
this option is set to <b>override</b>, the file is searched,
read and used the same way, however, the order of precedence
is reversed: settings read from the .nspawn file will take
precedence over the corresponding command line options, if
both are specified.</font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000">If
this option is set to <b>trusted</b>, the file is searched,
read and used the same way, but regardless of being found in
/etc/systemd/nspawn/, /run/systemd/nspawn/ or next to the
image file or container root directory, all settings will
take effect, however, command line arguments still take
precedence over corresponding settings.</font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000">If
disabled, no .nspawn file is read and no settings except the
ones on the command line are in effect.</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000"><b>Image
Options <br>
&minus;D</b>, <b>&minus;&minus;directory=</b></font></p>


<p style="margin-left:17%;"><font color="#000000">Directory
to use as file system root for the container.</font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000">If
neither <b>&minus;&minus;directory=</b>, nor
<b>&minus;&minus;image=</b> is specified the directory is
determined by searching for a directory named the same as
the machine name specified with
<b>&minus;&minus;machine=</b>. See <b>machinectl</b>(1)
section &quot;Files and Directories&quot; for the precise
search path.</font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000">If
neither <b>&minus;&minus;directory=</b>,
<b>&minus;&minus;image=</b>, nor
<b>&minus;&minus;machine=</b> are specified, the current
directory will be used. May not be specified together with
<b>&minus;&minus;image=</b>.</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000"><b>&minus;&minus;template=</b></font></p>


<p style="margin-left:17%;"><font color="#000000">Directory
or &quot;btrfs&quot; subvolume to use as template for the
container's root directory. If this is specified and the
container's root directory (as configured by
<b>&minus;&minus;directory=</b>) does not yet exist it is
created as &quot;btrfs&quot; snapshot (if supported) or
plain directory (otherwise) and populated from this template
tree. Ideally, the specified template path refers to the
root of a &quot;btrfs&quot; subvolume, in which case a
simple copy&minus;on&minus;write snapshot is taken, and
populating the root directory is instant. If the specified
template path does not refer to the root of a
&quot;btrfs&quot; subvolume (or not even to a
&quot;btrfs&quot; file system at all), the tree is copied
(though possibly in a 'reflink' copy&minus;on&minus;write
scheme &mdash; if the file system supports that), which can
be substantially more time&minus;consuming. Note that the
snapshot taken is of the specified directory or subvolume,
including all subdirectories and subvolumes below it, but
excluding any sub&minus;mounts. May not be specified
together with <b>&minus;&minus;image=</b> or
<b>&minus;&minus;ephemeral</b>.</font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000">Note
that this switch leaves hostname, machine ID and all other
settings that could identify the instance
unmodified.</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000"><b>&minus;x</b>,
<b>&minus;&minus;ephemeral</b></font></p>

<p style="margin-left:17%;"><font color="#000000">If
specified, the container is run with a temporary snapshot of
its file system that is removed immediately when the
container terminates. May not be specified together with
<b>&minus;&minus;template=</b>.</font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000">Note
that this switch leaves hostname, machine ID and all other
settings that could identify the instance unmodified. Please
note that &mdash; as with <b>&minus;&minus;template=</b>
&mdash; taking the temporary snapshot is more efficient on
file systems that support subvolume snapshots or 'reflinks'
natively (&quot;btrfs&quot; or new &quot;xfs&quot;) than on
more traditional file systems that do not
(&quot;ext4&quot;). Note that the snapshot taken is of the
specified directory or subvolume, including all
subdirectories and subvolumes below it, but excluding any
sub&minus;mounts.</font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000">With
this option no modifications of the container image are
retained. Use <b>&minus;&minus;volatile=</b> (described
below) for other mechanisms to restrict persistency of
container images during runtime.</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000"><b>&minus;i</b>,
<b>&minus;&minus;image=</b></font></p>

<p style="margin-left:17%;"><font color="#000000">Disk
image to mount the root directory for the container from.
Takes a path to a regular file or to a block device node.
The file or block device must contain either:</font></p>


<p style="margin-left:23%; margin-top: 1em"><font color="#000000">&bull;
An MBR partition table with a single partition of type 0x83
that is marked bootable.</font></p>


<p style="margin-left:23%; margin-top: 1em"><font color="#000000">&bull;
A GUID partition table (GPT) with a single partition of type
0fc63daf&minus;8483&minus;4772&minus;8e79&minus;3d69d8477de4.</font></p>


<p style="margin-left:23%; margin-top: 1em"><font color="#000000">&bull;
A GUID partition table (GPT) with a marked root partition
which is mounted as the root directory of the container.
Optionally, GPT images may contain a home and/or a server
data partition which are mounted to the appropriate places
in the container. All these partitions must be identified by
the partition types defined by the</font>
<b><font color="#0000FF">Discoverable Partitions
Specification</font></b>
<small><font color="#000000">[2]</font></small>
<font color="#000000">.</font></p>


<p style="margin-left:23%; margin-top: 1em"><font color="#000000">&bull;
No partition table, and a single file system spanning the
whole image.</font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000">On
GPT images, if an EFI System Partition (ESP) is discovered,
it is automatically mounted to /efi (or /boot as fallback)
in case a directory by this name exists and is
empty.</font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000">Partitions
encrypted with LUKS are automatically decrypted. Also, on
GPT images dm&minus;verity data integrity hash partitions
are set up if the root hash for them is specified using the
<b>&minus;&minus;root&minus;hash=</b> option.</font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000">Single
file system images (i.e. file systems without a surrounding
partition table) can be opened using dm&minus;verity if the
integrity data is passed using the
<b>&minus;&minus;root&minus;hash=</b> and
<b>&minus;&minus;verity&minus;data=</b> (and optionally
<b>&minus;&minus;root&minus;hash&minus;sig=</b>)
options.</font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000">Any
other partitions, such as foreign partitions or swap
partitions are not mounted. May not be specified together
with <b>&minus;&minus;directory=</b>,
<b>&minus;&minus;template=</b>.</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000"><b>&minus;&minus;oci&minus;bundle=</b></font></p>

<p style="margin-left:17%;"><font color="#000000">Takes the
path to an OCI runtime bundle to invoke, as specified in
the</font> <b><font color="#0000FF">OCI Runtime
Specification</font></b>
<small><font color="#000000">[3]</font></small>
<font color="#000000">. In this case no .nspawn file is
loaded, and the root directory and various settings are read
from the OCI runtime JSON data (but data passed on the
command line takes precedence).</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000"><b>&minus;&minus;read&minus;only</b></font></p>

<p style="margin-left:17%;"><font color="#000000">Mount the
container's root file system (and any other file systems
container in the container image) read&minus;only. This has
no effect on additional mounts made with
<b>&minus;&minus;bind=</b>, <b>&minus;&minus;tmpfs=</b> and
similar options. This mode is implied if the container image
file or directory is marked read&minus;only itself. It is
also implied if <b>&minus;&minus;volatile=</b> is used. In
this case the container image on disk is strictly
read&minus;only, while changes are permitted but kept
non&minus;persistently in memory only. For further details,
see below.</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000"><b>&minus;&minus;volatile</b>,
<b>&minus;&minus;volatile=</b><i>MODE</i></font></p>

<p style="margin-left:17%;"><font color="#000000">Boots the
container in volatile mode. When no mode parameter is passed
or when mode is specified as <b>yes</b>, full volatile mode
is enabled. This means the root directory is mounted as a
mostly unpopulated &quot;tmpfs&quot; instance, and /usr/
from the OS tree is mounted into it in read&minus;only mode
(the system thus starts up with read&minus;only OS image,
but pristine state and configuration, any changes are lost
on shutdown). When the mode parameter is specified as
<b>state</b>, the OS tree is mounted read&minus;only, but
/var/ is mounted as a writable &quot;tmpfs&quot; instance
into it (the system thus starts up with read&minus;only OS
resources and configuration, but pristine state, and any
changes to the latter are lost on shutdown). When the mode
parameter is specified as <b>overlay</b> the read&minus;only
root file system is combined with a writable tmpfs instance
through &quot;overlayfs&quot;, so that it appears at it
normally would, but any changes are applied to the temporary
file system only and lost when the container is terminated.
When the mode parameter is specified as <b>no</b> (the
default), the whole OS tree is made available writable
(unless <b>&minus;&minus;read&minus;only</b> is specified,
see above).</font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000">Note
that if one of the volatile modes is chosen, its effect is
limited to the root file system (or /var/ in case of
<b>state</b>), and any other mounts placed in the hierarchy
are unaffected &mdash; regardless if they are established
automatically (e.g. the EFI system partition that might be
mounted to /efi/ or /boot/) or explicitly (e.g. through an
additional command line option such as
<b>&minus;&minus;bind=</b>, see below). This means, even if
<b>&minus;&minus;volatile=overlay</b> is used changes to
/efi/ or /boot/ are prohibited in case such a partition
exists in the container image operated on, and even if
<b>&minus;&minus;volatile=state</b> is used the hypothetical
file /etc/foobar is potentially writable if
<b>&minus;&minus;bind=/etc/foobar</b> if used to mount it
from outside the read&minus;only container /etc/
directory.</font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000">The
<b>&minus;&minus;ephemeral</b> option is closely related to
this setting, and provides similar behaviour by making a
temporary, ephemeral copy of the whole OS image and
executing that. For further details, see above.</font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000">The
<b>&minus;&minus;tmpfs=</b> and
<b>&minus;&minus;overlay=</b> options provide similar
functionality, but for specific sub&minus;directories of the
OS image only. For details, see below.</font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000">This
option provides similar functionality for containers as the
&quot;systemd.volatile=&quot; kernel command line switch
provides for host systems. See <b>kernel-command-line</b>(7)
for details.</font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000">Note
that setting this option to <b>yes</b> or <b>state</b> will
only work correctly with operating systems in the container
that can boot up with only /usr/ mounted, and are able to
automatically populate /var/ (and /etc/ in case of
&quot;&minus;&minus;volatile=yes&quot;). Specifically, this
means that operating systems that follow the historic split
of /bin/ and /lib/ (and related directories) from /usr/
(i.e. where the former are not symlinks into the latter) are
not supported by &quot;&minus;&minus;volatile=yes&quot; as
container payload. The <b>overlay</b> option does not
require any particular preparations in the OS, but do note
that &quot;overlayfs&quot; behaviour differs from regular
file systems in a number of ways, and hence compatibility is
limited.</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000"><b>&minus;&minus;root&minus;hash=</b></font></p>

<p style="margin-left:17%;"><font color="#000000">Takes a
data integrity (dm&minus;verity) root hash specified in
hexadecimal. This option enables data integrity checks using
dm&minus;verity, if the used image contains the appropriate
integrity data (see above). The specified hash must match
the root hash of integrity data, and is usually at least 256
bits (and hence 64 formatted hexadecimal characters) long
(in case of SHA256 for example). If this option is not
specified, but the image file carries the
&quot;user.verity.roothash&quot; extended file attribute
(see <b>xattr</b>(7)), then the root hash is read from it,
also as formatted hexadecimal characters. If the extended
file attribute is not found (or is not supported by the
underlying file system), but a file with the .roothash
suffix is found next to the image file, bearing otherwise
the same name (except if the image has the .raw suffix, in
which case the root hash file must not have it in its name),
the root hash is read from it and automatically used, also
as formatted hexadecimal characters.</font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000">Note
that this configures the root hash for the root file system.
Disk images may also contain separate file systems for the
/usr/ hierarchy, which may be Verity protected as well. The
root hash for this protection may be configured via the
&quot;user.verity.usrhash&quot; extended file attribute or
via a .usrhash file adjacent to the disk image, following
the same format and logic as for the root hash for the root
file system described here. Note that there's currently no
switch to configure the root hash for the /usr/ from the
command line.</font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000">Also
see the <i>RootHash=</i> option in
<b>systemd.exec</b>(5).</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000"><b>&minus;&minus;root&minus;hash&minus;sig=</b></font></p>

<p style="margin-left:17%;"><font color="#000000">Takes a
PKCS7 signature of the <b>&minus;&minus;root&minus;hash=</b>
option. The semantics are the same as for the
<i>RootHashSignature=</i> option, see
<b>systemd.exec</b>(5).</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000"><b>&minus;&minus;verity&minus;data=</b></font></p>

<p style="margin-left:17%;"><font color="#000000">Takes the
path to a data integrity (dm&minus;verity) file. This option
enables data integrity checks using dm&minus;verity, if a
root&minus;hash is passed and if the used image itself does
not contain the integrity data. The integrity data must be
matched by the root hash. If this option is not specified,
but a file with the .verity suffix is found next to the
image file, bearing otherwise the same name (except if the
image has the .raw suffix, in which case the verity data
file must not have it in its name), the verity data is read
from it and automatically used.</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000"><b>&minus;&minus;pivot&minus;root=</b></font></p>

<p style="margin-left:17%;"><font color="#000000">Pivot the
specified directory to / inside the container, and either
unmount the container's old root, or pivot it to another
specified directory. Takes one of: a path argument &mdash;
in which case the specified path will be pivoted to / and
the old root will be unmounted; or a colon&minus;separated
pair of new root path and pivot destination for the old
root. The new root path will be pivoted to /, and the old /
will be pivoted to the other directory. Both paths must be
absolute, and are resolved in the container's file system
namespace.</font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000">This
is for containers which have several bootable directories in
them; for example, several</font>
<b><font color="#0000FF">OSTree</font></b>
<small><font color="#000000">[4]</font></small>
<font color="#000000">deployments. It emulates the behavior
of the boot loader and the initrd which normally select
which directory to mount as the root and start the
container's PID 1 in.</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000"><b>Execution
Options <br>
&minus;a</b>, <b>&minus;&minus;as&minus;pid2</b></font></p>

<p style="margin-left:17%;"><font color="#000000">Invoke
the shell or specified program as process ID (PID) 2 instead
of PID 1 (init). By default, if neither this option nor
<b>&minus;&minus;boot</b> is used, the selected program is
run as the process with PID 1, a mode only suitable for
programs that are aware of the special semantics that the
process with PID 1 has on UNIX. For example, it needs to
reap all processes reparented to it, and should implement
<b>sysvinit</b> compatible signal handling (specifically: it
needs to reboot on SIGINT, reexecute on SIGTERM, reload
configuration on SIGHUP, and so on). With
<b>&minus;&minus;as&minus;pid2</b> a minimal stub init
process is run as PID 1 and the selected program is executed
as PID 2 (and hence does not need to implement any special
semantics). The stub init process will reap processes as
necessary and react appropriately to signals. It is
recommended to use this mode to invoke arbitrary commands in
containers, unless they have been modified to run correctly
as PID 1. Or in other words: this switch should be used for
pretty much all commands, except when the command refers to
an init or shell implementation, as these are generally
capable of running correctly as PID 1. This option may not
be combined with <b>&minus;&minus;boot</b>.</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000"><b>&minus;b</b>,
<b>&minus;&minus;boot</b></font></p>


<p style="margin-left:17%;"><font color="#000000">Automatically
search for an init program and invoke it as PID 1, instead
of a shell or a user supplied program. If this option is
used, arguments specified on the command line are used as
arguments for the init program. This option may not be
combined with <b>&minus;&minus;as&minus;pid2</b>.</font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000">The
following table explains the different modes of invocation
and relationship to <b>&minus;&minus;as&minus;pid2</b> (see
above):</font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000"><b>Table&nbsp;1.&nbsp;Invocation
Mode</b></font></p> </table>


<p align="center"><font color="#000000"><b><img src="grohtml-30704561.png" alt="Image grohtml-30704561.png"></b></font></p>

<p style="margin-left:17%;"><font color="#000000">Note that
<b>&minus;&minus;boot</b> is the default mode of operation
if the systemd&minus;nspawn@.service template unit file is
used.</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000"><b>&minus;&minus;chdir=</b></font></p>

<p style="margin-left:17%;"><font color="#000000">Change to
the specified working directory before invoking the process
in the container. Expects an absolute path in the
container's file system namespace.</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000"><b>&minus;E</b>
<i>NAME</i><b>[=</b><i>VALUE</i><b>]</b>,
<b>&minus;&minus;setenv=</b><i>NAME</i><b>[=</b><i>VALUE</i><b>]</b></font></p>


<p style="margin-left:17%;"><font color="#000000">Specifies
an environment variable to pass to the init process in the
container. This may be used to override the default
variables or to set additional variables. It may be used
more than once to set multiple variables. When &quot;=&quot;
and <i>VALUE</i> are omitted, the value of the variable with
the same name in the program environment will be
used.</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000"><b>&minus;u</b>,
<b>&minus;&minus;user=</b></font></p>

<p style="margin-left:17%;"><font color="#000000">After
transitioning into the container, change to the specified
user defined in the container's user database. Like all
other systemd&minus;nspawn features, this is not a security
feature and provides protection against accidental
destructive operations only.</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000"><b>&minus;&minus;kill&minus;signal=</b></font></p>

<p style="margin-left:17%;"><font color="#000000">Specify
the process signal to send to the container's PID 1 when
nspawn itself receives <b>SIGTERM</b>, in order to trigger
an orderly shutdown of the container. Defaults to
<b>SIGRTMIN+3</b> if <b>&minus;&minus;boot</b> is used (on
systemd&minus;compatible init systems <b>SIGRTMIN+3</b>
triggers an orderly shutdown). If <b>&minus;&minus;boot</b>
is not used and this option is not specified the container's
processes are terminated abruptly via <b>SIGKILL</b>. For a
list of valid signals, see <b>signal</b>(7).</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000"><b>&minus;&minus;notify&minus;ready=</b></font></p>


<p style="margin-left:17%;"><font color="#000000">Configures
support for notifications from the container's init process.
<b>&minus;&minus;notify&minus;ready=</b> takes a boolean
(<b>no</b> and <b>yes</b>). With option <b>no</b>
systemd&minus;nspawn notifies systemd with a
&quot;READY=1&quot; message when the init process is
created. With option <b>yes</b> systemd&minus;nspawn waits
for the &quot;READY=1&quot; message from the init process in
the container before sending its own to systemd. For more
details about notifications see
<b>sd_notify</b>(3).</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000"><b>&minus;&minus;suppress&minus;sync=</b></font></p>

<p style="margin-left:17%;"><font color="#000000">Expects a
boolean argument. If true, turns off any form of
on&minus;disk file system synchronization for the container
payload. This means all system calls such as <b>sync</b>(2),
<b>fsync()</b>, <b>syncfs()</b>, ... will execute no
operation, and the <b>O_SYNC</b>/<b>O_DSYNC</b> flags to
<b>open</b>(2) and related calls will be made unavailable.
This is potentially dangerous, as assumed data integrity
guarantees to the container payload are not actually
enforced (i.e. data assumed to have been written to disk
might be lost if the system is shut down abnormally).
However, this can dramatically improve container runtime
performance &ndash; as long as these guarantees are not
required or desirable, for example because any data written
by the container is of temporary, redundant nature, or just
an intermediary artifact that will be further processed and
finalized by a later step in a pipeline. Defaults to
false.</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000"><b>System
Identity Options <br>
&minus;M</b>, <b>&minus;&minus;machine=</b></font></p>

<p style="margin-left:17%;"><font color="#000000">Sets the
machine name for this container. This name may be used to
identify this container during its runtime (for example in
tools like <b>machinectl</b>(1) and similar), and is used to
initialize the container's hostname (which the container can
choose to override, however). If not specified, the last
component of the root directory path of the container is
used, possibly suffixed with a random identifier in case
<b>&minus;&minus;ephemeral</b> mode is selected. If the root
directory selected is the host's root directory the host's
hostname is used as default instead.</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000"><b>&minus;&minus;hostname=</b></font></p>

<p style="margin-left:17%;"><font color="#000000">Controls
the hostname to set within the container, if different from
the machine name. Expects a valid hostname as argument. If
this option is used, the kernel hostname of the container
will be set to this value, otherwise it will be initialized
to the machine name as controlled by the
<b>&minus;&minus;machine=</b> option described above. The
machine name is used for various aspect of identification of
the container from the outside, the kernel hostname
configurable with this option is useful for the container to
identify itself from the inside. It is usually a good idea
to keep both forms of identification synchronized, in order
to avoid confusion. It is hence recommended to avoid usage
of this option, and use <b>&minus;&minus;machine=</b>
exclusively. Note that regardless whether the container's
hostname is initialized from the name set with
<b>&minus;&minus;hostname=</b> or the one set with
<b>&minus;&minus;machine=</b>, the container can later
override its kernel hostname freely on its own as
well.</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000"><b>&minus;&minus;uuid=</b></font></p>

<p style="margin-left:17%;"><font color="#000000">Set the
specified UUID for the container. The init system will
initialize /etc/machine&minus;id from this if this file is
not set yet. Note that this option takes effect only if
/etc/machine&minus;id in the container is
unpopulated.</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000"><b>Property
Options <br>
&minus;S</b>, <b>&minus;&minus;slice=</b></font></p>

<p style="margin-left:17%;"><font color="#000000">Make the
container part of the specified slice, instead of the
default machine.slice. This applies only if the machine is
run in its own scope unit, i.e. if
<b>&minus;&minus;keep&minus;unit</b> isn't used.</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000"><b>&minus;&minus;property=</b></font></p>

<p style="margin-left:17%;"><font color="#000000">Set a
unit property on the scope unit to register for the machine.
This applies only if the machine is run in its own scope
unit, i.e. if <b>&minus;&minus;keep&minus;unit</b> isn't
used. Takes unit property assignments in the same format as
<b>systemctl set&minus;property</b>. This is useful to set
memory limits and similar for the container.</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000"><b>&minus;&minus;register=</b></font></p>

<p style="margin-left:17%;"><font color="#000000">Controls
whether the container is registered with
<b>systemd-machined</b>(8). Takes a boolean argument, which
defaults to &quot;yes&quot;. This option should be enabled
when the container runs a full Operating System (more
specifically: a system and service manager as PID 1), and is
useful to ensure that the container is accessible via
<b>machinectl</b>(1) and shown by tools such as
<b>ps</b>(1). If the container does not run a service
manager, it is recommended to set this option to
&quot;no&quot;.</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000"><b>&minus;&minus;keep&minus;unit</b></font></p>

<p style="margin-left:17%;"><font color="#000000">Instead
of creating a transient scope unit to run the container in,
simply use the service or scope unit
<b>systemd&minus;nspawn</b> has been invoked in. If
<b>&minus;&minus;register=yes</b> is set this unit is
registered with <b>systemd-machined</b>(8). This switch
should be used if <b>systemd&minus;nspawn</b> is invoked
from within a service unit, and the service unit's sole
purpose is to run a single <b>systemd&minus;nspawn</b>
container. This option is not available if run from a user
session.</font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000">Note
that passing <b>&minus;&minus;keep&minus;unit</b> disables
the effect of <b>&minus;&minus;slice=</b> and
<b>&minus;&minus;property=</b>. Use
<b>&minus;&minus;keep&minus;unit</b> and
<b>&minus;&minus;register=no</b> in combination to disable
any kind of unit allocation or registration with
<b>systemd&minus;machined</b>.</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000"><b>User
Namespacing Options <br>
&minus;&minus;private&minus;users=</b></font></p>

<p style="margin-left:17%;"><font color="#000000">Controls
user namespacing. If enabled, the container will run with
its own private set of UNIX user and group ids (UIDs and
GIDs). This involves mapping the private UIDs/GIDs used in
the container (starting with the container's root user 0 and
up) to a range of UIDs/GIDs on the host that are not used
for other purposes (usually in the range beyond the host's
UID/GID 65536). The parameter may be specified as
follows:</font></p>


<p style="margin-left:23%; margin-top: 1em"><font color="#000000">1.
If one or two colon&minus;separated numbers are specified,
user namespacing is turned on. The first parameter specifies
the first host UID/GID to assign to the container, the
second parameter specifies the number of host UIDs/GIDs to
assign to the container. If the second parameter is omitted,
65536 UIDs/GIDs are assigned.</font></p>


<p style="margin-left:23%; margin-top: 1em"><font color="#000000">2.
If the parameter is &quot;yes&quot;, user namespacing is
turned on. The UID/GID range to use is determined
automatically from the file ownership of the root directory
of the container's directory tree. To use this option, make
sure to prepare the directory tree in advance, and ensure
that all files and directories in it are owned by UIDs/GIDs
in the range you'd like to use. Also, make sure that used
file ACLs exclusively reference UIDs/GIDs in the appropriate
range. In this mode, the number of UIDs/GIDs assigned to the
container is 65536, and the owner UID/GID of the root
directory must be a multiple of 65536.</font></p>


<p style="margin-left:23%; margin-top: 1em"><font color="#000000">3.
If the parameter is &quot;no&quot;, user namespacing is
turned off. This is the default.</font></p>


<p style="margin-left:23%; margin-top: 1em"><font color="#000000">4.
If the parameter is &quot;identity&quot;, user namespacing
is employed with an identity mapping for the first 65536
UIDs/GIDs. This is mostly equivalent to
<b>&minus;&minus;private&minus;users=0:65536</b>. While it
does not provide UID/GID isolation, since all host and
container UIDs/GIDs are chosen identically it does provide
process capability isolation, and hence is often a good
choice if proper user namespacing with distinct UID maps is
not appropriate.</font></p>


<p style="margin-left:23%; margin-top: 1em"><font color="#000000">5.
The special value &quot;pick&quot; turns on user
namespacing. In this case the UID/GID range is automatically
chosen. As first step, the file owner UID/GID of the root
directory of the container's directory tree is read, and it
is checked that no other container is currently using it. If
this check is successful, the UID/GID range determined this
way is used, similarly to the behavior if &quot;yes&quot; is
specified. If the check is not successful (and thus the
UID/GID range indicated in the root directory's file owner
is already used elsewhere) a new &ndash; currently unused
&ndash; UID/GID range of 65536 UIDs/GIDs is randomly chosen
between the host UID/GIDs of 524288 and 1878982656, always
starting at a multiple of 65536, and, if possible,
consistently hashed from the machine name. This setting
implies
<b>&minus;&minus;private&minus;users&minus;ownership=auto</b>
(see below), which possibly has the effect that the files
and directories in the container's directory tree will be
owned by the appropriate users of the range picked. Using
this option makes user namespace behavior fully automatic.
Note that the first invocation of a previously unused
container image might result in picking a new UID/GID range
for it, and thus in the (possibly expensive) file ownership
adjustment operation. However, subsequent invocations of the
container will be cheap (unless of course the picked UID/GID
range is assigned to a different use by then).</font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000">It
is recommended to assign at least 65536 UIDs/GIDs to each
container, so that the usable UID/GID range in the container
covers 16 bit. For best security, do not assign overlapping
UID/GID ranges to multiple containers. It is hence a good
idea to use the upper 16 bit of the host 32&minus;bit
UIDs/GIDs as container identifier, while the lower 16 bit
encode the container UID/GID used. This is in fact the
behavior enforced by the
<b>&minus;&minus;private&minus;users=pick</b>
option.</font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000">When
user namespaces are used, the GID range assigned to each
container is always chosen identical to the UID
range.</font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000">In
most cases, using
<b>&minus;&minus;private&minus;users=pick</b> is the
recommended option as it enhances container security
massively and operates fully automatically in most
cases.</font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000">Note
that the picked UID/GID range is not written to /etc/passwd
or /etc/group. In fact, the allocation of the range is not
stored persistently anywhere, except in the file ownership
of the files and directories of the container.</font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000">Note
that when user namespacing is used file ownership on disk
reflects this, and all of the container's files and
directories are owned by the container's effective user and
group IDs. This means that copying files from and to the
container image requires correction of the numeric UID/GID
values, according to the UID/GID shift applied.</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000"><b>&minus;&minus;private&minus;users&minus;ownership=</b></font></p>

<p style="margin-left:17%;"><font color="#000000">Controls
how to adjust the container image's UIDs and GIDs to match
the UID/GID range chosen with
<b>&minus;&minus;private&minus;users=</b>, see above. Takes
one of &quot;off&quot; (to leave the image as is),
&quot;chown&quot; (to recursively <b>chown()</b> the
container's directory tree as needed), &quot;map&quot; (in
order to use transparent ID mapping mounts) or
&quot;auto&quot; for automatically using &quot;map&quot;
where available and &quot;chown&quot; where not.</font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000">If
&quot;chown&quot; is selected, all files and directories in
the container's directory tree will be adjusted so that they
are owned by the appropriate UIDs/GIDs selected for the
container (see above). This operation is potentially
expensive, as it involves iterating through the full
directory tree of the container. Besides actual file
ownership, file ACLs are adjusted as well.</font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000">Typically
&quot;map&quot; is the best choice, since it transparently
maps UIDs/GIDs in memory as needed without modifying the
image, and without requiring an expensive recursive
adjustment operation. However, it is not available for all
file systems, currently.</font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000">The
<b>&minus;&minus;private&minus;users&minus;ownership=auto</b>
option is implied if
<b>&minus;&minus;private&minus;users=pick</b> is used. This
option has no effect if user namespacing is not
used.</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000"><b>&minus;U</b></font></p>

<p style="margin-left:17%;"><font color="#000000">If the
kernel supports the user namespaces feature, equivalent to
<b>&minus;&minus;private&minus;users=pick
&minus;&minus;private&minus;users&minus;ownership=auto</b>,
otherwise equivalent to
<b>&minus;&minus;private&minus;users=no</b>.</font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000">Note
that <b>&minus;U</b> is the default if the
systemd&minus;nspawn@.service template unit file is
used.</font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000">Note:
it is possible to undo the effect of
<b>&minus;&minus;private&minus;users&minus;ownership=chown</b>
(or <b>&minus;U</b>) on the file system by redoing the
operation with the first UID of 0:</font></p>


<p style="margin-left:23%; margin-top: 1em"><font color="#000000">systemd&minus;nspawn
... &minus;&minus;private&minus;users=0
&minus;&minus;private&minus;users&minus;ownership=chown</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000"><b>Networking
Options <br>
&minus;&minus;private&minus;network</b></font></p>


<p style="margin-left:17%;"><font color="#000000">Disconnect
networking of the container from the host. This makes all
network interfaces unavailable in the container, with the
exception of the loopback device and those specified with
<b>&minus;&minus;network&minus;interface=</b> and configured
with <b>&minus;&minus;network&minus;veth</b>. If this option
is specified, the <b>CAP_NET_ADMIN</b> capability will be
added to the set of capabilities the container retains. The
latter may be disabled by using
<b>&minus;&minus;drop&minus;capability=</b>. If this option
is not specified (or implied by one of the options listed
below), the container will have full access to the host
network.</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000"><b>&minus;&minus;network&minus;interface=</b></font></p>

<p style="margin-left:17%;"><font color="#000000">Assign
the specified network interface to the container. This will
remove the specified interface from the calling namespace
and place it in the container. When the container
terminates, it is moved back to the calling namespace. Note
that <b>&minus;&minus;network&minus;interface=</b> implies
<b>&minus;&minus;private&minus;network</b>. This option may
be used more than once to add multiple network interfaces to
the container.</font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000">Note
that any network interface specified this way must already
exist at the time the container is started. If the container
shall be started automatically at boot via a
systemd&minus;nspawn@.service unit file instance, it might
hence make sense to add a unit file drop&minus;in to the
service instance (e.g.
/etc/systemd/system/systemd&minus;nspawn@foobar.service.d/50&minus;network.conf)
with contents like the following:</font></p>


<p style="margin-left:23%; margin-top: 1em"><font color="#000000">[Unit]
<br>

Wants=sys&minus;subsystem&minus;net&minus;devices&minus;ens1.device
<br>

After=sys&minus;subsystem&minus;net&minus;devices&minus;ens1.device</font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000">This
will make sure that activation of the container service will
be delayed until the &quot;ens1&quot; network interface has
shown up. This is required since hardware probing is fully
asynchronous, and network interfaces might be discovered
only later during the boot process, after the container
would normally be started without these explicit
dependencies.</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000"><b>&minus;&minus;network&minus;macvlan=</b></font></p>

<p style="margin-left:17%;"><font color="#000000">Create a
&quot;macvlan&quot; interface of the specified Ethernet
network interface and add it to the container. A
&quot;macvlan&quot; interface is a virtual interface that
adds a second MAC address to an existing physical Ethernet
link. The interface in the container will be named after the
interface on the host, prefixed with &quot;mv&minus;&quot;.
Note that <b>&minus;&minus;network&minus;macvlan=</b>
implies <b>&minus;&minus;private&minus;network</b>. This
option may be used more than once to add multiple network
interfaces to the container.</font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000">As
with <b>&minus;&minus;network&minus;interface=</b>, the
underlying Ethernet network interface must already exist at
the time the container is started, and thus similar unit
file drop&minus;ins as described above might be
useful.</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000"><b>&minus;&minus;network&minus;ipvlan=</b></font></p>

<p style="margin-left:17%;"><font color="#000000">Create an
&quot;ipvlan&quot; interface of the specified Ethernet
network interface and add it to the container. An
&quot;ipvlan&quot; interface is a virtual interface, similar
to a &quot;macvlan&quot; interface, which uses the same MAC
address as the underlying interface. The interface in the
container will be named after the interface on the host,
prefixed with &quot;iv&minus;&quot;. Note that
<b>&minus;&minus;network&minus;ipvlan=</b> implies
<b>&minus;&minus;private&minus;network</b>. This option may
be used more than once to add multiple network interfaces to
the container.</font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000">As
with <b>&minus;&minus;network&minus;interface=</b>, the
underlying Ethernet network interface must already exist at
the time the container is started, and thus similar unit
file drop&minus;ins as described above might be
useful.</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000"><b>&minus;n</b>,
<b>&minus;&minus;network&minus;veth</b></font></p>

<p style="margin-left:17%;"><font color="#000000">Create a
virtual Ethernet link (&quot;veth&quot;) between host and
container. The host side of the Ethernet link will be
available as a network interface named after the container's
name (as specified with <b>&minus;&minus;machine=</b>),
prefixed with &quot;ve&minus;&quot;. The container side of
the Ethernet link will be named &quot;host0&quot;. The
<b>&minus;&minus;network&minus;veth</b> option implies
<b>&minus;&minus;private&minus;network</b>.</font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000">Note
that <b>systemd-networkd.service</b>(8) includes by default
a network file
/usr/lib/systemd/network/80&minus;container&minus;ve.network
matching the host&minus;side interfaces created this way,
which contains settings to enable automatic address
provisioning on the created virtual link via DHCP, as well
as automatic IP routing onto the host's external network
interfaces. It also contains
/usr/lib/systemd/network/80&minus;container&minus;host0.network
matching the container&minus;side interface created this
way, containing settings to enable client side address
assignment via DHCP. In case systemd&minus;networkd is
running on both the host and inside the container, automatic
IP communication from the container to the host is thus
available, with further connectivity to the external
network.</font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000">Note
that <b>&minus;&minus;network&minus;veth</b> is the default
if the systemd&minus;nspawn@.service template unit file is
used.</font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000">Note
that on Linux network interface names may have a length of
15 characters at maximum, while container names may have a
length up to 64 characters. As this option derives the
host&minus;side interface name from the container name the
name is possibly truncated. Thus, care needs to be taken to
ensure that interface names remain unique in this case, or
even better container names are generally not chosen longer
than 12 characters, to avoid the truncation. If the name is
truncated, <b>systemd&minus;nspawn</b> will automatically
append a 4&minus;digit hash value to the name to reduce the
chance of collisions. However, the hash algorithm is not
collision&minus;free. (See
<b>systemd.net-naming-scheme</b>(7) for details on older
naming algorithms for this interface). Alternatively, the
<b>&minus;&minus;network&minus;veth&minus;extra=</b> option
may be used, which allows free configuration of the
host&minus;side interface name independently of the
container name &mdash; but might require a bit more
additional configuration in case bridging in a fashion
similar to <b>&minus;&minus;network&minus;bridge=</b> is
desired.</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000"><b>&minus;&minus;network&minus;veth&minus;extra=</b></font></p>

<p style="margin-left:17%;"><font color="#000000">Adds an
additional virtual Ethernet link between host and container.
Takes a colon&minus;separated pair of host interface name
and container interface name. The latter may be omitted in
which case the container and host sides will be assigned the
same name. This switch is independent of
<b>&minus;&minus;network&minus;veth</b>, and &mdash; in
contrast &mdash; may be used multiple times, and allows
configuration of the network interface names. Note that
<b>&minus;&minus;network&minus;bridge=</b> has no effect on
interfaces created with
<b>&minus;&minus;network&minus;veth&minus;extra=</b>.</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000"><b>&minus;&minus;network&minus;bridge=</b></font></p>

<p style="margin-left:17%;"><font color="#000000">Adds the
host side of the Ethernet link created with
<b>&minus;&minus;network&minus;veth</b> to the specified
Ethernet bridge interface. Expects a valid network interface
name of a bridge device as argument. Note that
<b>&minus;&minus;network&minus;bridge=</b> implies
<b>&minus;&minus;network&minus;veth</b>. If this option is
used, the host side of the Ethernet link will use the
&quot;vb&minus;&quot; prefix instead of
&quot;ve&minus;&quot;. Regardless of the used naming prefix
the same network interface name length limits imposed by
Linux apply, along with the complications this creates (for
details see above).</font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000">As
with <b>&minus;&minus;network&minus;interface=</b>, the
underlying bridge network interface must already exist at
the time the container is started, and thus similar unit
file drop&minus;ins as described above might be
useful.</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000"><b>&minus;&minus;network&minus;zone=</b></font></p>

<p style="margin-left:17%;"><font color="#000000">Creates a
virtual Ethernet link (&quot;veth&quot;) to the container
and adds it to an automatically managed Ethernet bridge
interface. The bridge interface is named after the passed
argument, prefixed with &quot;vz&minus;&quot;. The bridge
interface is automatically created when the first container
configured for its name is started, and is automatically
removed when the last container configured for its name
exits. Hence, each bridge interface configured this way
exists only as long as there's at least one container
referencing it running. This option is very similar to
<b>&minus;&minus;network&minus;bridge=</b>, besides this
automatic creation/removal of the bridge device.</font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000">This
setting makes it easy to place multiple related containers
on a common, virtual Ethernet&minus;based broadcast domain,
here called a &quot;zone&quot;. Each container may only be
part of one zone, but each zone may contain any number of
containers. Each zone is referenced by its name. Names may
be chosen freely (as long as they form valid network
interface names when prefixed with &quot;vz&minus;&quot;),
and it is sufficient to pass the same name to the
<b>&minus;&minus;network&minus;zone=</b> switch of the
various concurrently running containers to join them in one
zone.</font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000">Note
that <b>systemd-networkd.service</b>(8) includes by default
a network file
/usr/lib/systemd/network/80&minus;container&minus;vz.network
matching the bridge interfaces created this way, which
contains settings to enable automatic address provisioning
on the created virtual network via DHCP, as well as
automatic IP routing onto the host's external network
interfaces. Using <b>&minus;&minus;network&minus;zone=</b>
is hence in most cases fully automatic and sufficient to
connect multiple local containers in a joined broadcast
domain to the host, with further connectivity to the
external network.</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000"><b>&minus;&minus;network&minus;namespace&minus;path=</b></font></p>

<p style="margin-left:17%;"><font color="#000000">Takes the
path to a file representing a kernel network namespace that
the container shall run in. The specified path should refer
to a (possibly bind&minus;mounted) network namespace file,
as exposed by the kernel below /proc/$PID/ns/net. This makes
the container enter the given network namespace. One of the
typical use cases is to give a network namespace under
/run/netns created by <b>ip-netns</b>(8), for example,
<b>&minus;&minus;network&minus;namespace&minus;path=/run/netns/foo</b>.
Note that this option cannot be used together with other
network&minus;related options, such as
<b>&minus;&minus;private&minus;network</b> or
<b>&minus;&minus;network&minus;interface=</b>.</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000"><b>&minus;p</b>,
<b>&minus;&minus;port=</b></font></p>

<p style="margin-left:17%;"><font color="#000000">If
private networking is enabled, maps an IP port on the host
onto an IP port on the container. Takes a protocol specifier
(either &quot;tcp&quot; or &quot;udp&quot;), separated by a
colon from a host port number in the range 1 to 65535,
separated by a colon from a container port number in the
range from 1 to 65535. The protocol specifier and its
separating colon may be omitted, in which case
&quot;tcp&quot; is assumed. The container port number and
its colon may be omitted, in which case the same port as the
host port is implied. This option is only supported if
private networking is used, such as with
<b>&minus;&minus;network&minus;veth</b>,
<b>&minus;&minus;network&minus;zone=
&minus;&minus;network&minus;bridge=</b>.</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000"><b>Security
Options <br>
&minus;&minus;capability=</b></font></p>

<p style="margin-left:17%;"><font color="#000000">List one
or more additional capabilities to grant the container.
Takes a comma&minus;separated list of capability names, see
<b>capabilities</b>(7) for more information. Note that the
following capabilities will be granted in any way:
<b>CAP_AUDIT_CONTROL</b>, <b>CAP_AUDIT_WRITE</b>,
<b>CAP_CHOWN</b>, <b>CAP_DAC_OVERRIDE</b>,
<b>CAP_DAC_READ_SEARCH</b>, <b>CAP_FOWNER</b>,
<b>CAP_FSETID</b>, <b>CAP_IPC_OWNER</b>, <b>CAP_KILL</b>,
<b>CAP_LEASE</b>, <b>CAP_LINUX_IMMUTABLE</b>,
<b>CAP_MKNOD</b>, <b>CAP_NET_BIND_SERVICE</b>,
<b>CAP_NET_BROADCAST</b>, <b>CAP_NET_RAW</b>,
<b>CAP_SETFCAP</b>, <b>CAP_SETGID</b>, <b>CAP_SETPCAP</b>,
<b>CAP_SETUID</b>, <b>CAP_SYS_ADMIN</b>,
<b>CAP_SYS_BOOT</b>, <b>CAP_SYS_CHROOT</b>,
<b>CAP_SYS_NICE</b>, <b>CAP_SYS_PTRACE</b>,
<b>CAP_SYS_RESOURCE</b>, <b>CAP_SYS_TTY_CONFIG</b>. Also
<b>CAP_NET_ADMIN</b> is retained if
<b>&minus;&minus;private&minus;network</b> is specified. If
the special value &quot;all&quot; is passed, all
capabilities are retained.</font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000">If
the special value of &quot;help&quot; is passed, the program
will print known capability names and exit.</font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000">This
option sets the bounding set of capabilities which also
limits the ambient capabilities as given with the
<b>&minus;&minus;ambient&minus;capability=</b>.</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000"><b>&minus;&minus;drop&minus;capability=</b></font></p>

<p style="margin-left:17%;"><font color="#000000">Specify
one or more additional capabilities to drop for the
container. This allows running the container with fewer
capabilities than the default (see above).</font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000">If
the special value of &quot;help&quot; is passed, the program
will print known capability names and exit.</font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000">This
option sets the bounding set of capabilities which also
limits the ambient capabilities as given with the
<b>&minus;&minus;ambient&minus;capability=</b>.</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000"><b>&minus;&minus;ambient&minus;capability=</b></font></p>

<p style="margin-left:17%;"><font color="#000000">Specify
one or more additional capabilities to pass in the
inheritable and ambient set to the program started within
the container. The value &quot;all&quot; is not supported
for this setting.</font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000">All
capabilities specified here must be in the set allowed with
the <b>&minus;&minus;capability=</b> and
<b>&minus;&minus;drop&minus;capability=</b> options.
Otherwise, an error message will be shown.</font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000">This
option cannot be combined with the boot mode of the
container (as requested via
<b>&minus;&minus;boot</b>).</font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000">If
the special value of &quot;help&quot; is passed, the program
will print known capability names and exit.</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000"><b>&minus;&minus;no&minus;new&minus;privileges=</b></font></p>

<p style="margin-left:17%;"><font color="#000000">Takes a
boolean argument. Specifies the value of the
<b>PR_SET_NO_NEW_PRIVS</b> flag for the container payload.
Defaults to off. When turned on the payload code of the
container cannot acquire new privileges, i.e. the
&quot;setuid&quot; file bit as well as file system
capabilities will not have an effect anymore. See
<b>prctl</b>(2) for details about this flag.</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000"><b>&minus;&minus;system&minus;call&minus;filter=</b></font></p>

<p style="margin-left:17%;"><font color="#000000">Alter the
system call filter applied to containers. Takes a
space&minus;separated list of system call names or group
names (the latter prefixed with &quot;@&quot;, as listed by
the <b>syscall&minus;filter</b> command of
<b>systemd-analyze</b>(1)). Passed system calls will be
permitted. The list may optionally be prefixed by
&quot;~&quot;, in which case all listed system calls are
prohibited. If this command line option is used multiple
times the configured lists are combined. If both a positive
and a negative list (that is one system call list without
and one with the &quot;~&quot; prefix) are configured, the
negative list takes precedence over the positive list. Note
that <b>systemd&minus;nspawn</b> always implements a system
call allow list (as opposed to a deny list!), and this
command line option hence adds or removes entries from the
default allow list, depending on the &quot;~&quot; prefix.
Note that the applied system call filter is also altered
implicitly if additional capabilities are passed using the
<b>&minus;&minus;capabilities=</b>.</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000"><b>&minus;Z</b>,
<b>&minus;&minus;selinux&minus;context=</b></font></p>

<p style="margin-left:17%;"><font color="#000000">Sets the
SELinux security context to be used to label processes in
the container.</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000"><b>&minus;L</b>,
<b>&minus;&minus;selinux&minus;apifs&minus;context=</b></font></p>

<p style="margin-left:17%;"><font color="#000000">Sets the
SELinux security context to be used to label files in the
virtual API file systems in the container.</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000"><b>Resource
Options <br>
&minus;&minus;rlimit=</b></font></p>

<p style="margin-left:17%;"><font color="#000000">Sets the
specified POSIX resource limit for the container payload.
Expects an assignment of the form
&quot;<i>LIMIT</i>=<i>SOFT</i>:<i>HARD</i>&quot; or
&quot;<i>LIMIT</i>=<i>VALUE</i>&quot;, where <i>LIMIT</i>
should refer to a resource limit type, such as
<b>RLIMIT_NOFILE</b> or <b>RLIMIT_NICE</b>. The <i>SOFT</i>
and <i>HARD</i> fields should refer to the numeric soft and
hard resource limit values. If the second form is used,
<i>VALUE</i> may specify a value that is used both as soft
and hard limit. In place of a numeric value the special
string &quot;infinity&quot; may be used to turn off resource
limiting for the specific type of resource. This command
line option may be used multiple times to control limits on
multiple limit types. If used multiple times for the same
limit type, the last use wins. For details about resource
limits see <b>setrlimit</b>(2). By default resource limits
for the container's init process (PID 1) are set to the same
values the Linux kernel originally passed to the host init
system. Note that some resource limits are enforced on
resources counted per user, in particular
<b>RLIMIT_NPROC</b>. This means that unless user namespacing
is deployed (i.e. <b>&minus;&minus;private&minus;users=</b>
is used, see above), any limits set will be applied to the
resource usage of the same user on all local containers as
well as the host. This means particular care needs to be
taken with these limits as they might be triggered by
possibly less trusted code. Example:
&quot;&minus;&minus;rlimit=RLIMIT_NOFILE=8192:16384&quot;.</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000"><b>&minus;&minus;oom&minus;score&minus;adjust=</b></font></p>

<p style="margin-left:17%;"><font color="#000000">Changes
the OOM (&quot;Out Of Memory&quot;) score adjustment value
for the container payload. This controls
/proc/self/oom_score_adj which influences the preference
with which this container is terminated when memory becomes
scarce. For details see <b>proc</b>(5). Takes an integer in
the range &minus;1000...1000.</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000"><b>&minus;&minus;cpu&minus;affinity=</b></font></p>

<p style="margin-left:17%;"><font color="#000000">Controls
the CPU affinity of the container payload. Takes a comma
separated list of CPU numbers or number ranges (the latter's
start and end value separated by dashes). See
<b>sched_setaffinity</b>(2) for details.</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000"><b>&minus;&minus;personality=</b></font></p>

<p style="margin-left:17%;"><font color="#000000">Control
the architecture (&quot;personality&quot;) reported by
<b>uname</b>(2) in the container. Currently, only
&quot;x86&quot; and &quot;x86&minus;64&quot; are supported.
This is useful when running a 32&minus;bit container on a
64&minus;bit host. If this setting is not used, the
personality reported in the container is the same as the one
reported on the host.</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000"><b>Integration
Options <br>
&minus;&minus;resolv&minus;conf=</b></font></p>


<p style="margin-left:17%;"><font color="#000000">Configures
how /etc/resolv.conf inside of the container shall be
handled (i.e. DNS configuration synchronization from host to
container). Takes one of &quot;off&quot;,
&quot;copy&minus;host&quot;, &quot;copy&minus;static&quot;,
&quot;copy&minus;uplink&quot;, &quot;copy&minus;stub&quot;,
&quot;replace&minus;host&quot;,
&quot;replace&minus;static&quot;,
&quot;replace&minus;uplink&quot;,
&quot;replace&minus;stub&quot;, &quot;bind&minus;host&quot;,
&quot;bind&minus;static&quot;,
&quot;bind&minus;uplink&quot;, &quot;bind&minus;stub&quot;,
&quot;delete&quot; or &quot;auto&quot;.</font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000">If
set to &quot;off&quot; the /etc/resolv.conf file in the
container is left as it is included in the image, and
neither modified nor bind mounted over.</font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000">If
set to &quot;copy&minus;host&quot;, the /etc/resolv.conf
file from the host is copied into the container, unless the
file exists already and is not a regular file (e.g. a
symlink). Similarly, if &quot;replace&minus;host&quot; is
used the file is copied, replacing any existing inode,
including symlinks. Similarly, if
&quot;bind&minus;host&quot; is used, the file is bind
mounted from the host into the container.</font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000">If
set to &quot;copy&minus;static&quot;,
&quot;replace&minus;static&quot; or
&quot;bind&minus;static&quot; the static resolv.conf file
supplied with <b>systemd-resolved.service</b>(8)
(specifically: /usr/lib/systemd/resolv.conf) is copied or
bind mounted into the container.</font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000">If
set to &quot;copy&minus;uplink&quot;,
&quot;replace&minus;uplink&quot; or
&quot;bind&minus;uplink&quot; the uplink resolv.conf file
managed by systemd&minus;resolved.service (specifically:
/run/systemd/resolve/resolv.conf) is copied or bind mounted
into the container.</font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000">If
set to &quot;copy&minus;stub&quot;,
&quot;replace&minus;stub&quot; or
&quot;bind&minus;stub&quot; the stub resolv.conf file
managed by systemd&minus;resolved.service (specifically:
/run/systemd/resolve/stub&minus;resolv.conf) is copied or
bind mounted into the container.</font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000">If
set to &quot;delete&quot; the /etc/resolv.conf file in the
container is deleted if it exists.</font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000">Finally,
if set to &quot;auto&quot; the file is left as it is if
private networking is turned on (see
<b>&minus;&minus;private&minus;network</b>). Otherwise, if
systemd&minus;resolved.service is running its stub
resolv.conf file is used, and if not the host's
/etc/resolv.conf file. In the latter cases the file is
copied if the image is writable, and bind mounted
otherwise.</font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000">It's
recommended to use &quot;copy&minus;...&quot; or
&quot;replace&minus;...&quot; if the container shall be able
to make changes to the DNS configuration on its own,
deviating from the host's settings. Otherwise
&quot;bind&quot; is preferable, as it means direct changes
to /etc/resolv.conf in the container are not allowed, as it
is a read&minus;only bind mount (but note that if the
container has enough privileges, it might simply go ahead
and unmount the bind mount anyway). Note that both if the
file is bind mounted and if it is copied no further
propagation of configuration is generally done after the
one&minus;time early initialization (this is because the
file is usually updated through copying and renaming).
Defaults to &quot;auto&quot;.</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000"><b>&minus;&minus;timezone=</b></font></p>


<p style="margin-left:17%;"><font color="#000000">Configures
how /etc/localtime inside of the container (i.e. local
timezone synchronization from host to container) shall be
handled. Takes one of &quot;off&quot;, &quot;copy&quot;,
&quot;bind&quot;, &quot;symlink&quot;, &quot;delete&quot; or
&quot;auto&quot;. If set to &quot;off&quot; the
/etc/localtime file in the container is left as it is
included in the image, and neither modified nor bind mounted
over. If set to &quot;copy&quot; the /etc/localtime file of
the host is copied into the container. Similarly, if
&quot;bind&quot; is used, the file is bind mounted from the
host into the container. If set to &quot;symlink&quot;, a
symlink is created pointing from /etc/localtime in the
container to the timezone file in the container that matches
the timezone setting on the host. If set to
&quot;delete&quot;, the file in the container is deleted,
should it exist. If set to &quot;auto&quot; and the
/etc/localtime file of the host is a symlink, then
&quot;symlink&quot; mode is used, and &quot;copy&quot;
otherwise, except if the image is read&minus;only in which
case &quot;bind&quot; is used instead. Defaults to
&quot;auto&quot;.</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000"><b>&minus;&minus;link&minus;journal=</b></font></p>

<p style="margin-left:17%;"><font color="#000000">Control
whether the container's journal shall be made visible to the
host system. If enabled, allows viewing the container's
journal files from the host (but not vice versa). Takes one
of &quot;no&quot;, &quot;host&quot;,
&quot;try&minus;host&quot;, &quot;guest&quot;,
&quot;try&minus;guest&quot;, &quot;auto&quot;. If
&quot;no&quot;, the journal is not linked. If
&quot;host&quot;, the journal files are stored on the host
file system (beneath
/var/log/journal/<i>machine&minus;id</i>) and the
subdirectory is bind&minus;mounted into the container at the
same location. If &quot;guest&quot;, the journal files are
stored on the guest file system (beneath
/var/log/journal/<i>machine&minus;id</i>) and the
subdirectory is symlinked into the host at the same
location. &quot;try&minus;host&quot; and
&quot;try&minus;guest&quot; do the same but do not fail if
the host does not have persistent journaling enabled. If
&quot;auto&quot; (the default), and the right subdirectory
of /var/log/journal exists, it will be bind mounted into the
container. If the subdirectory does not exist, no linking is
performed. Effectively, booting a container once with
&quot;guest&quot; or &quot;host&quot; will link the journal
persistently if further on the default of &quot;auto&quot;
is used.</font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000">Note
that <b>&minus;&minus;link&minus;journal=try&minus;guest</b>
is the default if the systemd&minus;nspawn@.service template
unit file is used.</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000"><b>&minus;j</b></font></p>


<p style="margin-left:17%;"><font color="#000000">Equivalent
to
<b>&minus;&minus;link&minus;journal=try&minus;guest</b>.</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000"><b>Mount
Options <br>
&minus;&minus;bind=</b>,
<b>&minus;&minus;bind&minus;ro=</b></font></p>

<p style="margin-left:17%;"><font color="#000000">Bind
mount a file or directory from the host into the container.
Takes one of: a path argument&nbsp;&mdash; in which case the
specified path will be mounted from the host to the same
path in the container, or a colon&minus;separated pair of
paths&nbsp;&mdash; in which case the first specified path is
the source in the host, and the second path is the
destination in the container, or a colon&minus;separated
triple of source path, destination path and mount options.
The source path may optionally be prefixed with a
&quot;+&quot; character. If so, the source path is taken
relative to the image's root directory. This permits setting
up bind mounts within the container image. The source path
may be specified as empty string, in which case a temporary
directory below the host's /var/tmp/ directory is used. It
is automatically removed when the container is shut down. If
the source path is not absolute, it is resolved relative to
the current working directory. The
<b>&minus;&minus;bind&minus;ro=</b> option creates
read&minus;only bind mounts. Backslash escapes are
interpreted, so &quot;\:&quot; may be used to embed colons
in either path. This option may be specified multiple times
for creating multiple independent bind mount
points.</font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000">Mount
options are comma&minus;separated. <b>rbind</b> and
<b>norbind</b> control whether to create a recursive or a
regular bind mount. Defaults to &quot;rbind&quot;.
<b>noidmap</b>, <b>idmap</b>, and <b>rootidmap</b> control
ID mapping.</font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000">Using
<b>idmap</b> or <b>rootidmap</b> requires support by the
source filesystem for user/group ID mapped mounts. Defaults
to &quot;noidmap&quot;. With <b>x</b> being the container's
UID range offset, <b>y</b> being the length of the
container's UID range, and <b>p</b> being the owner UID of
the bind mount source inode on the host:</font></p>


<p style="margin-left:23%; margin-top: 1em"><font color="#000000">&bull;
If <b>noidmap</b> is used, any user <b>z</b> in the range
<b>0 ... y</b> seen from inside of the container is mapped
to <b>x + z</b> in the <b>x ... x + y</b> range on the host.
Other host users are mapped to <b>nobody</b> inside the
container.</font></p>


<p style="margin-left:23%; margin-top: 1em"><font color="#000000">&bull;
If <b>idmap</b> is used, any user <b>z</b> in the UID range
<b>0 ... y</b> as seen from inside the container is mapped
to the same <b>z</b> in the same <b>0 ... y</b> range on the
host. All host users outside of that range are mapped to
<b>nobody</b> inside the container.</font></p>


<p style="margin-left:23%; margin-top: 1em"><font color="#000000">&bull;
If <b>rootidmap</b> is used, the user <b>0</b> seen from
inside of the container is mapped to <b>p</b> on the host.
All host users outside of that range are mapped to
<b>nobody</b> inside the container.</font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000">Whichever
ID mapping option is used, the same mapping will be used for
users and groups IDs. If <b>rootidmap</b> is used, the group
owning the bind mounted directory will have no
effect.</font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000">Note
that when this option is used in combination with
<b>&minus;&minus;private&minus;users</b>, the resulting
mount points will be owned by the <b>nobody</b> user. That's
because the mount and its files and directories continue to
be owned by the relevant host users and groups, which do not
exist in the container, and thus show up under the wildcard
UID 65534 (nobody). If such bind mounts are created, it is
recommended to make them read&minus;only, using
<b>&minus;&minus;bind&minus;ro=</b>. Alternatively you can
use the &quot;idmap&quot; mount option to map the filesystem
IDs.</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000"><b>&minus;&minus;bind&minus;user=</b></font></p>

<p style="margin-left:17%;"><font color="#000000">Binds the
home directory of the specified user on the host into the
container. Takes the name of an existing user on the host as
argument. May be used multiple times to bind multiple users
into the container. This does three things:</font></p>


<p style="margin-left:23%; margin-top: 1em"><font color="#000000">1.
The user's home directory is bind mounted from the host into
/run/host/home/.</font></p>


<p style="margin-left:23%; margin-top: 1em"><font color="#000000">2.
An additional UID/GID mapping is added that maps the host
user's UID/GID to a container UID/GID, allocated from the
60514...60577 range.</font></p>


<p style="margin-left:23%; margin-top: 1em"><font color="#000000">3.
A JSON user and group record is generated in /run/userdb/
that describes the mapped user. It contains a minimized
representation of the host's user record, adjusted to the
UID/GID and home directory path assigned to the user in the
container. The <b>nss-systemd</b>(8) glibc NSS module will
pick up these records from there and make them available in
the container's user/group databases.</font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000">The
combination of the three operations above ensures that it is
possible to log into the container using the same account
information as on the host. The user is only mapped
transiently, while the container is running, and the mapping
itself does not result in persistent changes to the
container (except maybe for log messages generated at login
time, and similar). Note that in particular the UID/GID
assignment in the container is not made persistently. If the
user is mapped transiently, it is best to not allow the user
to make persistent changes to the container. If the user
leaves files or directories owned by the user, and those
UIDs/GIDs are reused during later container invocations
(possibly with a different
<b>&minus;&minus;bind&minus;user=</b> mapping), those files
and directories will be accessible to the &quot;new&quot;
user.</font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000">The
user/group record mapping only works if the container
contains systemd 249 or newer, with <b>nss&minus;systemd</b>
properly configured in nsswitch.conf. See
<b>nss-systemd</b>(8) for details.</font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000">Note
that the user record propagated from the host into the
container will contain the UNIX password hash of the user,
so that seamless logins in the container are possible. If
the container is less trusted than the host it's hence
important to use a strong UNIX password hash function (e.g.
yescrypt or similar, with the &quot;$y$&quot; hash
prefix).</font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000">When
binding a user from the host into the container checks are
executed to ensure that the username is not yet known in the
container. Moreover, it is checked that the UID/GID
allocated for it is not currently defined in the user/group
databases of the container. Both checks directly access the
container's /etc/passwd and /etc/group, and thus might not
detect existing accounts in other databases.</font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000">This
operation is only supported in combination with
<b>&minus;&minus;private&minus;users=</b>/<b>&minus;U</b>.</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000"><b>&minus;&minus;inaccessible=</b></font></p>

<p style="margin-left:17%;"><font color="#000000">Make the
specified path inaccessible in the container. This
over&minus;mounts the specified path (which must exist in
the container) with a file node of the same type that is
empty and has the most restrictive access mode supported.
This is an effective way to mask files, directories and
other file system objects from the container payload. This
option may be used more than once in case all specified
paths are masked.</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000"><b>&minus;&minus;tmpfs=</b></font></p>

<p style="margin-left:17%;"><font color="#000000">Mount a
tmpfs file system into the container. Takes a single
absolute path argument that specifies where to mount the
tmpfs instance to (in which case the directory access mode
will be chosen as 0755, owned by root/root), or optionally a
colon&minus;separated pair of path and mount option string
that is used for mounting (in which case the kernel default
for access mode and owner will be chosen, unless otherwise
specified). Backslash escapes are interpreted in the path,
so &quot;\:&quot; may be used to embed colons in the
path.</font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000">Note
that this option cannot be used to replace the root file
system of the container with a temporary file system.
However, the <b>&minus;&minus;volatile=</b> option described
below provides similar functionality, with a focus on
implementing stateless operating system images.</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000"><b>&minus;&minus;overlay=</b>,
<b>&minus;&minus;overlay&minus;ro=</b></font></p>

<p style="margin-left:17%;"><font color="#000000">Combine
multiple directory trees into one overlay file system and
mount it into the container. Takes a list of
colon&minus;separated paths to the directory trees to
combine and the destination mount point.</font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000">Backslash
escapes are interpreted in the paths, so &quot;\:&quot; may
be used to embed colons in the paths.</font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000">If
three or more paths are specified, then the last specified
path is the destination mount point in the container, all
paths specified before refer to directory trees on the host
and are combined in the specified order into one overlay
file system. The left&minus;most path is hence the lowest
directory tree, the second&minus;to&minus;last path the
highest directory tree in the stacking order. If
<b>&minus;&minus;overlay&minus;ro=</b> is used instead of
<b>&minus;&minus;overlay=</b>, a read&minus;only overlay
file system is created. If a writable overlay file system is
created, all changes made to it are written to the highest
directory tree in the stacking order, i.e. the
second&minus;to&minus;last specified.</font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000">If
only two paths are specified, then the second specified path
is used both as the top&minus;level directory tree in the
stacking order as seen from the host, as well as the mount
point for the overlay file system in the container. At least
two paths have to be specified.</font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000">The
source paths may optionally be prefixed with &quot;+&quot;
character. If so they are taken relative to the image's root
directory. The uppermost source path may also be specified
as an empty string, in which case a temporary directory
below the host's /var/tmp/ is used. The directory is removed
automatically when the container is shut down. This
behaviour is useful in order to make read&minus;only
container directories writable while the container is
running. For example, use
&quot;&minus;&minus;overlay=+/var::/var&quot; in order to
automatically overlay a writable temporary directory on a
read&minus;only /var/ directory. If a source path is not
absolute, it is resolved relative to the current working
directory.</font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000">For
details about overlay file systems, see</font>
<b><font color="#0000FF">Overlay Filesystem</font></b>
<small><font color="#000000">[5]</font></small>
<font color="#000000">. Note that the semantics of overlay
file systems are substantially different from normal file
systems, in particular regarding reported device and inode
information. Device and inode information may change for a
file while it is being written to, and processes might see
out&minus;of&minus;date versions of files at times. Note
that this switch automatically derives the
&quot;workdir=&quot; mount option for the overlay file
system from the top&minus;level directory tree, making it a
sibling of it. It is hence essential that the
top&minus;level directory tree is not a mount point itself
(since the working directory must be on the same file system
as the top&minus;most directory tree). Also note that the
&quot;lowerdir=&quot; mount option receives the paths to
stack in the opposite order of this switch.</font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000">Note
that this option cannot be used to replace the root file
system of the container with an overlay file system.
However, the <b>&minus;&minus;volatile=</b> option described
above provides similar functionality, with a focus on
implementing stateless operating system images.</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000"><b>Input/Output
Options <br>
&minus;&minus;console=</b><i>MODE</i></font></p>


<p style="margin-left:17%;"><font color="#000000">Configures
how to set up standard input, output and error output for
the container payload, as well as the /dev/console device
for the container. Takes one of <b>interactive</b>,
<b>read&minus;only</b>, <b>passive</b>, <b>pipe</b> or
<b>autopipe</b>. If <b>interactive</b>, a pseudo&minus;TTY
is allocated and made available as /dev/console in the
container. It is then bi&minus;directionally connected to
the standard input and output passed to
<b>systemd&minus;nspawn</b>. <b>read&minus;only</b> is
similar but only the output of the container is propagated
and no input from the caller is read. If <b>passive</b>, a
pseudo TTY is allocated, but it is not connected anywhere.
In <b>pipe</b> mode no pseudo TTY is allocated, but the
standard input, output and error output file descriptors
passed to <b>systemd&minus;nspawn</b> are passed on &mdash;
as they are &mdash; to the container payload, see the
following paragraph. Finally, <b>autopipe</b> mode operates
like <b>interactive</b> when <b>systemd&minus;nspawn</b> is
invoked on a terminal, and like <b>pipe</b> otherwise.
Defaults to <b>interactive</b> if
<b>systemd&minus;nspawn</b> is invoked from a terminal, and
<b>read&minus;only</b> otherwise.</font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000">In
<b>pipe</b> mode, /dev/console will not exist in the
container. This means that the container payload generally
cannot be a full init system as init systems tend to require
/dev/console to be available. On the other hand, in this
mode container invocations can be used within shell
pipelines. This is because intermediary pseudo TTYs do not
permit independent bidirectional propagation of the
end&minus;of&minus;file (EOF) condition, which is necessary
for shell pipelines to work correctly. <i>Note that the</i>
<b>pipe</b> <i>mode should be used carefully</i>, as passing
arbitrary file descriptors to less trusted container
payloads might open up unwanted interfaces for access by the
container payload. For example, if a passed file descriptor
refers to a TTY of some form, APIs such as <b>TIOCSTI</b>
may be used to synthesize input that might be used for
escaping the container. Hence <b>pipe</b> mode should only
be used if the payload is sufficiently trusted or when the
standard input/output/error output file descriptors are
known safe, for example pipes.</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000"><b>&minus;&minus;pipe</b>,
<b>&minus;P</b></font></p>


<p style="margin-left:17%;"><font color="#000000">Equivalent
to <b>&minus;&minus;console=pipe</b>.</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000"><b>Credentials
<br>

&minus;&minus;load&minus;credential=</b><i>ID</i>:<i>PATH</i>,
<b>&minus;&minus;set&minus;credential=</b><i>ID</i>:<i>VALUE</i></font></p>

<p style="margin-left:17%;"><font color="#000000">Pass a
credential to the container. These two options correspond to
the <i>LoadCredential=</i> and <i>SetCredential=</i>
settings in unit files. See <b>systemd.exec</b>(5) for
details about these concepts, as well as the syntax of the
option's arguments.</font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000">Note:
when <b>systemd&minus;nspawn</b> runs as systemd system
service it can propagate the credentials it received via
<i>LoadCredential=</i>/<i>SetCredential=</i> to the
container payload. A systemd service manager running as PID
1 in the container can further propagate them to the
services it itself starts. It is thus possible to easily
propagate credentials from a parent service manager to a
container manager service and from there into its payload.
This can even be done recursively.</font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000">In
order to embed binary data into the credential data for
<b>&minus;&minus;set&minus;credential=</b> use C&minus;style
escaping (i.e. &quot;\n&quot; to embed a newline, or
&quot;\x00&quot; to embed a <b>NUL</b> byte. Note that the
invoking shell might already apply unescaping once, hence
this might require double escaping!).</font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000">The
<b>systemd-sysusers.service</b>(8) and
<b>systemd-firstboot</b>(1) services read credentials
configured this way for the purpose of configuring the
container's root user's password and shell, as well as
system locale, keymap and timezone during the first boot
process of the container. This is particularly useful in
combination with <b>&minus;&minus;volatile=yes</b> where
every single boot appears as first boot, since configuration
applied to /etc/ is lost on container reboot cycles. See the
respective man pages for details. Example:</font></p>


<p style="margin-left:23%; margin-top: 1em"><font color="#000000">#
systemd&minus;nspawn &minus;i image.raw \ <br>
&minus;&minus;volatile=yes \ <br>

&minus;&minus;set&minus;credential=firstboot.locale:de_DE.UTF&minus;8
\ <br>

&minus;&minus;set&minus;credential=passwd.hashed&minus;password.root:'$y$j9T$yAuRJu1o5HioZAGDYPU5d.$F64ni6J2y2nNQve90M/p0ZP0ECP/qqzipNyaY9fjGpC'
\ <br>
&minus;b</font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000">The
above command line will invoke the specified image file
image.raw in volatile mode, i.e. with empty /etc/ and /var/.
The container payload will recognize this as a first boot,
and will invoke systemd&minus;firstboot.service, which then
reads the two passed credentials to configure the system's
initial locale and root password.</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000"><b>Other
<br>
&minus;&minus;no&minus;pager</b></font></p>

<p style="margin-left:17%;"><font color="#000000">Do not
pipe output into a pager.</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000"><b>&minus;h</b>,
<b>&minus;&minus;help</b></font></p>

<p style="margin-left:17%;"><font color="#000000">Print a
short help text and exit.</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000"><b>&minus;&minus;version</b></font></p>

<p style="margin-left:17%;"><font color="#000000">Print a
short version string and exit.</font></p>

<h2>ENVIRONMENT
<a name="ENVIRONMENT"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em"><font color="#000000"><i>$SYSTEMD_LOG_LEVEL</i></font></p>

<p style="margin-left:17%;"><font color="#000000">The
maximum log level of emitted messages (messages with a
higher log level, i.e. less important ones, will be
suppressed). Either one of (in order of decreasing
importance) <b>emerg</b>, <b>alert</b>, <b>crit</b>,
<b>err</b>, <b>warning</b>, <b>notice</b>, <b>info</b>,
<b>debug</b>, or an integer in the range 0...7. See
<b>syslog</b>(3) for more information.</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000"><i>$SYSTEMD_LOG_COLOR</i></font></p>

<p style="margin-left:17%;"><font color="#000000">A
boolean. If true, messages written to the tty will be
colored according to priority.</font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000">This
setting is only useful when messages are written directly to
the terminal, because <b>journalctl</b>(1) and other tools
that display logs will color messages based on the log level
on their own.</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000"><i>$SYSTEMD_LOG_TIME</i></font></p>

<p style="margin-left:17%;"><font color="#000000">A
boolean. If true, console log messages will be prefixed with
a timestamp.</font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000">This
setting is only useful when messages are written directly to
the terminal or a file, because <b>journalctl</b>(1) and
other tools that display logs will attach timestamps based
on the entry metadata on their own.</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000"><i>$SYSTEMD_LOG_LOCATION</i></font></p>

<p style="margin-left:17%;"><font color="#000000">A
boolean. If true, messages will be prefixed with a filename
and line number in the source code where the message
originates.</font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000">Note
that the log location is often attached as metadata to
journal entries anyway. Including it directly in the message
text can nevertheless be convenient when debugging
programs.</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000"><i>$SYSTEMD_LOG_TID</i></font></p>

<p style="margin-left:17%;"><font color="#000000">A
boolean. If true, messages will be prefixed with the current
numerical thread ID (TID).</font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000">Note
that the this information is attached as metadata to journal
entries anyway. Including it directly in the message text
can nevertheless be convenient when debugging
programs.</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000"><i>$SYSTEMD_LOG_TARGET</i></font></p>

<p style="margin-left:17%;"><font color="#000000">The
destination for log messages. One of <b>console</b> (log to
the attached tty), <b>console&minus;prefixed</b> (log to the
attached tty but with prefixes encoding the log level and
&quot;facility&quot;, see <b>syslog</b>(3), <b>kmsg</b> (log
to the kernel circular log buffer), <b>journal</b> (log to
the journal), <b>journal&minus;or&minus;kmsg</b> (log to the
journal if available, and to kmsg otherwise), <b>auto</b>
(determine the appropriate log target automatically, the
default), <b>null</b> (disable log output).</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000"><i>$SYSTEMD_PAGER</i></font></p>

<p style="margin-left:17%;"><font color="#000000">Pager to
use when <b>&minus;&minus;no&minus;pager</b> is not given;
overrides <i>$PAGER</i>. If neither <i>$SYSTEMD_PAGER</i>
nor <i>$PAGER</i> are set, a set of well&minus;known pager
implementations are tried in turn, including <b>less</b>(1)
and <b>more</b>(1), until one is found. If no pager
implementation is discovered no pager is invoked. Setting
this environment variable to an empty string or the value
&quot;cat&quot; is equivalent to passing
<b>&minus;&minus;no&minus;pager</b>.</font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000">Note:
if <i>$SYSTEMD_PAGERSECURE</i> is not set,
<i>$SYSTEMD_PAGER</i> (as well as <i>$PAGER</i>) will be
silently ignored.</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000"><i>$SYSTEMD_LESS</i></font></p>

<p style="margin-left:17%;"><font color="#000000">Override
the options passed to <b>less</b> (by default
&quot;FRSXMK&quot;).</font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000">Users
might want to change two options in particular:</font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000"><b>K</b></font></p>

<p style="margin-left:23%;"><font color="#000000">This
option instructs the pager to exit immediately when Ctrl+C
is pressed. To allow <b>less</b> to handle Ctrl+C itself to
switch back to the pager command prompt, unset this
option.</font></p>


<p style="margin-left:23%; margin-top: 1em"><font color="#000000">If
the value of <i>$SYSTEMD_LESS</i> does not include
&quot;K&quot;, and the pager that is invoked is <b>less</b>,
Ctrl+C will be ignored by the executable, and needs to be
handled by the pager.</font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000"><b>X</b></font></p>

<p style="margin-left:23%;"><font color="#000000">This
option instructs the pager to not send termcap
initialization and deinitialization strings to the terminal.
It is set by default to allow command output to remain
visible in the terminal even after the pager exits.
Nevertheless, this prevents some pager functionality from
working, in particular paged output cannot be scrolled with
the mouse.</font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000">See
<b>less</b>(1) for more discussion.</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000"><i>$SYSTEMD_LESSCHARSET</i></font></p>

<p style="margin-left:17%;"><font color="#000000">Override
the charset passed to <b>less</b> (by default
&quot;utf&minus;8&quot;, if the invoking terminal is
determined to be UTF&minus;8 compatible).</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000"><i>$SYSTEMD_PAGERSECURE</i></font></p>

<p style="margin-left:17%;"><font color="#000000">Takes a
boolean argument. When true, the &quot;secure&quot; mode of
the pager is enabled; if false, disabled. If
<i>$SYSTEMD_PAGERSECURE</i> is not set at all, secure mode
is enabled if the effective UID is not the same as the owner
of the login session, see <b>geteuid</b>(2) and
<b>sd_pid_get_owner_uid</b>(3). In secure mode,
<b>LESSSECURE=1</b> will be set when invoking the pager, and
the pager shall disable commands that open or create new
files or start new subprocesses. When
<i>$SYSTEMD_PAGERSECURE</i> is not set at all, pagers which
are not known to implement secure mode will not be used.
(Currently only <b>less</b>(1) implements secure
mode.)</font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000">Note:
when commands are invoked with elevated privileges, for
example under <b>sudo</b>(8) or <b>pkexec</b>(1), care must
be taken to ensure that unintended interactive features are
not enabled. &quot;Secure&quot; mode for the pager may be
enabled automatically as describe above. Setting
<i>SYSTEMD_PAGERSECURE=0</i> or not removing it from the
inherited environment allows the user to invoke arbitrary
commands. Note that if the <i>$SYSTEMD_PAGER</i> or
<i>$PAGER</i> variables are to be honoured,
<i>$SYSTEMD_PAGERSECURE</i> must be set too. It might be
reasonable to completely disable the pager using
<b>&minus;&minus;no&minus;pager</b> instead.</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000"><i>$SYSTEMD_COLORS</i></font></p>

<p style="margin-left:17%;"><font color="#000000">Takes a
boolean argument. When true, <b>systemd</b> and related
utilities will use colors in their output, otherwise the
output will be monochrome. Additionally, the variable can
take one of the following special values: &quot;16&quot;,
&quot;256&quot; to restrict the use of colors to the base 16
or 256 ANSI colors, respectively. This can be specified to
override the automatic decision based on <i>$TERM</i> and
what the console is connected to.</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000"><i>$SYSTEMD_URLIFY</i></font></p>

<p style="margin-left:17%;"><font color="#000000">The value
must be a boolean. Controls whether clickable links should
be generated in the output for terminal emulators supporting
this. This can be specified to override the decision that
<b>systemd</b> makes based on <i>$TERM</i> and other
conditions.</font></p>

<h2>EXAMPLES
<a name="EXAMPLES"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em"><font color="#000000"><b>Example&nbsp;1.&nbsp;Download
a Fedora image and start a shell in it</b></font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000">#
machinectl pull&minus;raw &minus;&minus;verify=no \ <br>

https://download.fedoraproject.org/pub/fedora/linux/releases/37/Cloud/x86_64/images/Fedora&minus;Cloud&minus;Base&minus;37&minus;1.7.x86_64.raw.xz
\ <br>

Fedora&minus;Cloud&minus;Base&minus;37&minus;1.7.x86&minus;64
<br>
# systemd&minus;nspawn &minus;M
Fedora&minus;Cloud&minus;Base&minus;37&minus;1.7.x86&minus;64</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000">This
downloads an image using <b>machinectl</b>(1) and opens a
shell in it.</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000"><b>Example&nbsp;2.&nbsp;Build
and boot a minimal Fedora distribution in a
container</b></font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000">#
dnf &minus;y &minus;&minus;releasever=37
&minus;&minus;installroot=/var/lib/machines/f37 \ <br>
&minus;&minus;repo=fedora &minus;&minus;repo=updates
&minus;&minus;setopt=install_weak_deps=False install \ <br>
passwd dnf fedora&minus;release vim&minus;minimal
util&minus;linux systemd systemd&minus;networkd <br>
# systemd&minus;nspawn &minus;bD
/var/lib/machines/f37</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000">This
installs a minimal Fedora distribution into the directory
/var/lib/machines/f37 and then boots that OS in a namespace
container. Because the installation is located underneath
the standard /var/lib/machines/ directory, it is also
possible to start the machine using <b>systemd&minus;nspawn
&minus;M f37</b>.</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000"><b>Example&nbsp;3.&nbsp;Spawn
a shell in a container of a minimal Debian unstable
distribution</b></font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000">#
debootstrap unstable ~/debian&minus;tree/ <br>
# systemd&minus;nspawn &minus;D
~/debian&minus;tree/</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000">This
installs a minimal Debian unstable distribution into the
directory ~/debian&minus;tree/ and then spawns a shell from
this image in a namespace container.</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000"><b>debootstrap</b>
supports</font> <b><font color="#0000FF">Debian</font></b>
<small><font color="#000000">[7]</font></small>
<font color="#000000">,</font>
<b><font color="#0000FF">Ubuntu</font></b>
<small><font color="#000000">[8]</font></small>
<font color="#000000">, and</font>
<b><font color="#0000FF">Tanglu</font></b>
<small><font color="#000000">[9]</font></small>
<font color="#000000">out of the box, so the same command
can be used to install any of those. For other distributions
from the Debian family, a mirror has to be specified, see
<b>debootstrap</b>(8).</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000"><b>Example&nbsp;4.&nbsp;Boot
a minimal Arch Linux distribution in a
container</b></font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000">#
pacstrap &minus;c ~/arch&minus;tree/ base <br>
# systemd&minus;nspawn &minus;bD
~/arch&minus;tree/</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000">This
installs a minimal Arch Linux distribution into the
directory ~/arch&minus;tree/ and then boots an OS in a
namespace container in it.</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000"><b>Example&nbsp;5.&nbsp;Install
the OpenSUSE Tumbleweed rolling distribution</b></font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000">#
zypper &minus;&minus;root=/var/lib/machines/tumbleweed ar
&minus;c \ <br>
https://download.opensuse.org/tumbleweed/repo/oss tumbleweed
<br>
# zypper &minus;&minus;root=/var/lib/machines/tumbleweed
refresh <br>
# zypper &minus;&minus;root=/var/lib/machines/tumbleweed
install &minus;&minus;no&minus;recommends \ <br>
systemd shadow zypper openSUSE&minus;release vim <br>
# systemd&minus;nspawn &minus;M tumbleweed passwd root <br>
# systemd&minus;nspawn &minus;M tumbleweed
&minus;b</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000"><b>Example&nbsp;6.&nbsp;Boot
into an ephemeral snapshot of the host system</b></font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000">#
systemd&minus;nspawn &minus;D / &minus;xb</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000">This
runs a copy of the host system in a snapshot which is
removed immediately when the container exits. All file
system changes made during runtime will be lost on shutdown,
hence.</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000"><b>Example&nbsp;7.&nbsp;Run
a container with SELinux sandbox security
contexts</b></font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000">#
chcon system_u:object_r:svirt_sandbox_file_t:s0:c0,c1
&minus;R /srv/container <br>
# systemd&minus;nspawn &minus;L
system_u:object_r:svirt_sandbox_file_t:s0:c0,c1 \ <br>
&minus;Z system_u:system_r:svirt_lxc_net_t:s0:c0,c1 &minus;D
/srv/container /bin/sh</font></p>


<p style="margin-left:11%; margin-top: 1em"><font color="#000000"><b>Example&nbsp;8.&nbsp;Run
a container with an OSTree deployment</b></font></p>


<p style="margin-left:17%; margin-top: 1em"><font color="#000000">#
systemd&minus;nspawn &minus;b &minus;i ~/image.raw \ <br>

&minus;&minus;pivot&minus;root=/ostree/deploy/$OS/deploy/$CHECKSUM:/sysroot
\ <br>

&minus;&minus;bind=+/sysroot/ostree/deploy/$OS/var:/var</font></p>

<h2>EXIT STATUS
<a name="EXIT STATUS"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em"><font color="#000000">The
exit code of the program executed in the container is
returned.</font></p>

<h2>SEE ALSO
<a name="SEE ALSO"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em"><font color="#000000"><b>systemd</b>(1),
<b>systemd.nspawn</b>(5), <b>chroot</b>(1), <b>dnf</b>(8),
<b>debootstrap</b>(8), <b>pacman</b>(8), <b>zypper</b>(8),
<b>systemd.slice</b>(5), <b>machinectl</b>(1),
<b>btrfs</b>(8)</font></p>

<h2>NOTES
<a name="NOTES"></a>
</h2>


<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="12%"></td>
<td width="3%">



<p style="margin-top: 1em"><font color="#000000">1.</font></p> </td>
<td width="2%"></td>
<td width="29%">


<p style="margin-top: 1em"><font color="#000000">Container
Interface</font></p> </td>
<td width="54%">
</td></tr>
</table>


<p style="margin-left:17%;"><font color="#000000">https://systemd.io/CONTAINER_INTERFACE</font></p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="12%"></td>
<td width="3%">



<p style="margin-top: 1em"><font color="#000000">2.</font></p> </td>
<td width="2%"></td>
<td width="57%">



<p style="margin-top: 1em"><font color="#000000">Discoverable
Partitions Specification</font></p></td>
<td width="26%">
</td></tr>
</table>


<p style="margin-left:17%;"><font color="#000000">https://uapi-group.org/specifications/specs/discoverable_partitions_specification</font></p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="12%"></td>
<td width="3%">



<p style="margin-top: 1em"><font color="#000000">3.</font></p> </td>
<td width="2%"></td>
<td width="38%">


<p style="margin-top: 1em"><font color="#000000">OCI
Runtime Specification</font></p></td>
<td width="45%">
</td></tr>
</table>


<p style="margin-left:17%;"><font color="#000000">https://github.com/opencontainers/runtime-spec/blob/master/spec.md</font></p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="12%"></td>
<td width="3%">



<p style="margin-top: 1em"><font color="#000000">4.</font></p> </td>
<td width="2%"></td>
<td width="9%">



<p style="margin-top: 1em"><font color="#000000">OSTree</font></p> </td>
<td width="74%">
</td></tr>
</table>


<p style="margin-left:17%;"><font color="#000000">https://ostree.readthedocs.io/en/latest/</font></p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="12%"></td>
<td width="3%">



<p style="margin-top: 1em"><font color="#000000">5.</font></p> </td>
<td width="2%"></td>
<td width="28%">


<p style="margin-top: 1em"><font color="#000000">Overlay
Filesystem</font></p> </td>
<td width="55%">
</td></tr>
</table>


<p style="margin-left:17%;"><font color="#000000">https://docs.kernel.org/filesystems/overlayfs.html</font></p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="12%"></td>
<td width="3%">



<p style="margin-top: 1em"><font color="#000000">6.</font></p> </td>
<td width="2%"></td>
<td width="9%">



<p style="margin-top: 1em"><font color="#000000">Fedora</font></p> </td>
<td width="74%">
</td></tr>
</table>


<p style="margin-left:17%;"><font color="#000000">https://getfedora.org</font></p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="12%"></td>
<td width="3%">



<p style="margin-top: 1em"><font color="#000000">7.</font></p> </td>
<td width="2%"></td>
<td width="9%">



<p style="margin-top: 1em"><font color="#000000">Debian</font></p> </td>
<td width="74%">
</td></tr>
</table>


<p style="margin-left:17%;"><font color="#000000">https://www.debian.org</font></p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="12%"></td>
<td width="3%">



<p style="margin-top: 1em"><font color="#000000">8.</font></p> </td>
<td width="2%"></td>
<td width="9%">



<p style="margin-top: 1em"><font color="#000000">Ubuntu</font></p> </td>
<td width="74%">
</td></tr>
</table>


<p style="margin-left:17%;"><font color="#000000">https://www.ubuntu.com</font></p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="12%"></td>
<td width="3%">



<p style="margin-top: 1em"><font color="#000000">9.</font></p> </td>
<td width="2%"></td>
<td width="9%">



<p style="margin-top: 1em"><font color="#000000">Tanglu</font></p> </td>
<td width="74%">
</td></tr>
</table>


<p style="margin-left:17%;"><font color="#000000">https://www.tanglu.org</font></p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="4%">



<p style="margin-top: 1em"><font color="#000000">10.</font></p> </td>
<td width="2%"></td>
<td width="15%">


<p style="margin-top: 1em"><font color="#000000">Arch
Linux</font></p> </td>
<td width="68%">
</td></tr>
</table>


<p style="margin-left:17%;"><font color="#000000">https://www.archlinux.org</font></p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="4%">



<p style="margin-top: 1em"><font color="#000000">11.</font></p> </td>
<td width="2%"></td>
<td width="29%">


<p style="margin-top: 1em"><font color="#000000">OpenSUSE
Tumbleweed</font></p> </td>
<td width="54%">
</td></tr>
</table>


<p style="margin-left:17%;"><font color="#000000">https://software.opensuse.org/distributions/tumbleweed</font></p>
<hr>
</body>
</html>
