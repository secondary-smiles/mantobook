<!-- Creator     : groff version 1.22.4 -->
<!-- CreationDate: Mon May 29 22:54:01 2023 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title>SEM</title>

</head>
<body>
<h1>sem</h1>



<h2>NAME
<a name="NAME"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">sem &minus;
semaphore for executing shell command lines in parallel</p>

<h2>SYNOPSIS
<a name="SYNOPSIS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em"><b>sem</b>
[&minus;&minus;fg] [&minus;&minus;id &lt;id&gt;]
[&minus;&minus;semaphoretimeout &lt;secs&gt;] [&minus;j
&lt;num&gt;] [&minus;&minus;wait] command</p>

<h2>DESCRIPTION
<a name="DESCRIPTION"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em"><small>GNU</small>
<b>sem</b> is an alias for <small>GNU</small> <b>parallel
&minus;&minus;semaphore</b>.</p>


<p style="margin-left:11%; margin-top: 1em"><small>GNU</small>
<b>sem</b> acts as a counting semaphore. When
<small>GNU</small> <b>sem</b> is called with command it
starts the command in the background. When <i>num</i> number
of commands are running in the background,
<small>GNU</small> <b>sem</b> waits for one of these to
complete before starting the command.</p>


<p style="margin-left:11%; margin-top: 1em"><small>GNU</small>
<b>sem</b> does not read any arguments to build the command
(no &minus;a, :::, and ::::). It simply waits for a
semaphore to become available and then runs the command
given.</p>

<p style="margin-left:11%; margin-top: 1em">Before looking
at the options you may want to check out the examples after
the list of options. That will give you an idea of what
<small>GNU</small> <b>sem</b> is capable of.</p>

<h2>OPTIONS
<a name="OPTIONS"></a>
</h2>


<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="11%">


<p style="margin-top: 1em"><i>command</i></p></td>
<td width="3%"></td>
<td width="75%">


<p style="margin-top: 1em">Command to execute. The command
may be followed by arguments for the command.</p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="11%">


<p><b>&minus;&minus;bg</b></p></td>
<td width="3%"></td>
<td width="75%">


<p>Run command in background thus <small>GNU</small>
<b>sem</b> will not wait for completion of the command
before exiting. This is the default.</p></td></tr>
</table>

<p style="margin-left:25%; margin-top: 1em">In toilet
analogy: <small>GNU</small> <b>sem</b> waits for a toilet to
be available, gives the toilet to a person, and exits
immediately.</p>

<p style="margin-left:25%; margin-top: 1em">See also:
<b>&minus;&minus;fg</b></p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="12%">


<p style="margin-top: 1em"><b>&minus;&minus;jobs</b>
<i>N</i></p> </td>
<td width="77%">
</td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="12%">


<p><b>&minus;j</b> <i>N</i></p></td>
<td width="77%">
</td></tr>
</table>


<p style="margin-left:11%;"><b>&minus;&minus;max&minus;procs</b>
<i>N</i></p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="6%">


<p><b>&minus;P</b> <i>N</i></p></td>
<td width="8%"></td>
<td width="75%">


<p>Run up to N commands in parallel. Default is 1 thus
acting like a mutex.</p></td></tr>
</table>

<p style="margin-left:25%; margin-top: 1em">In toilet
analogy: <b>&minus;j</b> is the number of toilets.</p>

<p style="margin-left:11%;"><b>&minus;&minus;jobs</b>
<i>+N</i></p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="7%">


<p><b>&minus;j</b> <i>+N</i></p></td>
<td width="82%">
</td></tr>
</table>


<p style="margin-left:11%;"><b>&minus;&minus;max&minus;procs</b>
<i>+N</i></p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="7%">


<p><b>&minus;P</b> <i>+N</i></p></td>
<td width="7%"></td>
<td width="75%">


<p>Add N to the number of <small>CPU</small> cores. Run up
to this many jobs in parallel. For compute intensive jobs
<b>&minus;j</b> +0 is useful as it will run
number-of-cpu-cores jobs simultaneously.</p></td></tr>
</table>

<p style="margin-left:11%;"><b>&minus;&minus;jobs</b>
<i>&minus;N</i></p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="7%">


<p><b>&minus;j</b> <i>&minus;N</i></p></td>
<td width="82%">
</td></tr>
</table>


<p style="margin-left:11%;"><b>&minus;&minus;max&minus;procs</b>
<i>&minus;N</i></p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="7%">


<p><b>&minus;P</b> <i>&minus;N</i></p></td>
<td width="7%"></td>
<td width="75%">


<p>Subtract N from the number of <small>CPU</small> cores.
Run up to this many jobs in parallel. If the evaluated
number is less than 1 then 1 will be used. See also
<b>&minus;&minus;use&minus;cpus&minus;instead&minus;of&minus;cores</b>.</p> </td></tr>
</table>

<p style="margin-left:11%;"><b>&minus;&minus;jobs</b>
<i>N</i>%</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="7%">


<p><b>&minus;j</b> <i>N</i>%</p></td>
<td width="82%">
</td></tr>
</table>


<p style="margin-left:11%;"><b>&minus;&minus;max&minus;procs</b>
<i>N</i>%</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="7%">


<p><b>&minus;P</b> <i>N</i>%</p></td>
<td width="7%"></td>
<td width="75%">


<p>Multiply N% with the number of <small>CPU</small> cores.
Run up to this many jobs in parallel. If the evaluated
number is less than 1 then 1 will be used. See also
<b>&minus;&minus;use&minus;cpus&minus;instead&minus;of&minus;cores</b>.</p> </td></tr>
</table>

<p style="margin-left:11%;"><b>&minus;&minus;jobs</b>
<i>procfile</i> <b><br>
&minus;j</b> <i>procfile</i> <b><br>
&minus;&minus;max&minus;procs</b> <i>procfile</i> <b><br>
&minus;P</b> <i>procfile</i></p>

<p style="margin-left:25%;">Read parameter from file. Use
the content of <i>procfile</i> as parameter for
<i>&minus;j</i>. E.g. <i>procfile</i> could contain the
string 100% or +2 or 10.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="9%">


<p><b>&minus;&minus;pipe</b></p></td>
<td width="5%"></td>
<td width="60%">


<p>Pass stdin (standard input) to <i>command</i>.</p></td>
<td width="15%">
</td></tr>
</table>

<p style="margin-left:25%; margin-top: 1em">If
<i>command</i> read from stdin (standard input), use
<b>&minus;&minus;pipe</b>.</p>


<p style="margin-left:11%;"><b>&minus;&minus;semaphorename</b>
<i>name</i> <b><br>
&minus;&minus;id</b> <i>name</i></p>

<p style="margin-left:25%;">Use <b>name</b> as the name of
the semaphore. Default is the name of the controlling tty
(output from <b>tty</b>).</p>

<p style="margin-left:25%; margin-top: 1em">The default
normally works as expected when used interactively, but when
used in a script <i>name</i> should be set. <i>$$</i> or
<i>my_task_name</i> are often a good value.</p>

<p style="margin-left:25%; margin-top: 1em">The semaphore
is stored in ~/.parallel/semaphores/</p>

<p style="margin-left:25%; margin-top: 1em">In toilet
analogy the name corresponds to different types of toilets:
e.g. male, female, customer, staff.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="6%">


<p><b>&minus;&minus;fg</b></p></td>
<td width="8%"></td>
<td width="50%">


<p>Do not put command in background.</p></td>
<td width="25%">
</td></tr>
</table>

<p style="margin-left:25%; margin-top: 1em">In toilet
analogy: <small>GNU</small> <b>sem</b> waits for a toilet to
be available, takes a person to the toilet, waits for the
person to finish, and exits.</p>


<p style="margin-left:11%;"><b>&minus;&minus;semaphoretimeout</b>
<i>secs</i> <b><br>
&minus;&minus;st</b> <i>secs</i></p>

<p style="margin-left:25%;">If <i>secs</i> &gt; 0: If the
semaphore is not released within <i>secs</i> seconds, take
it anyway.</p>

<p style="margin-left:25%; margin-top: 1em">If <i>secs</i>
&lt; 0: If the semaphore is not released within <i>secs</i>
seconds, exit.</p>

<p style="margin-left:25%; margin-top: 1em">In toilet
analogy: <i>secs</i> &gt; 0: If no toilet becomes available
within <i>secs</i> seconds, pee on the floor. <i>secs</i>
&lt; 0: If no toilet becomes available within <i>secs</i>
seconds, exit without doing anything.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="9%">


<p><b>&minus;&minus;wait</b></p></td>
<td width="5%"></td>
<td width="52%">


<p>Wait for all commands to complete.</p></td>
<td width="23%">
</td></tr>
</table>

<p style="margin-left:25%; margin-top: 1em">In toilet
analogy: Wait until all toilets are empty, then exit.</p>

<h2>UNDERSTANDING A SEMAPHORE
<a name="UNDERSTANDING A SEMAPHORE"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Try the
following example:</p>

<p style="margin-left:11%; margin-top: 1em">sem &minus;j 2
'sleep 1;echo 1 finished'; echo sem 1 exited <br>
sem &minus;j 2 'sleep 2;echo 2 finished'; echo sem 2 exited
<br>
sem &minus;j 2 'sleep 3;echo 3 finished'; echo sem 3 exited
<br>
sem &minus;j 2 'sleep 4;echo 4 finished'; echo sem 4 exited
<br>
sem &minus;&minus;wait; echo sem &minus;&minus;wait done</p>

<p style="margin-left:11%; margin-top: 1em">In toilet
analogy this uses 2 toilets (<b>&minus;j 2</b>).
<small>GNU</small> <b>sem</b> takes &rsquo;1&rsquo; to a
toilet, and exits immediately. While &rsquo;1&rsquo; is
sleeping, another <small>GNU</small> <b>sem</b> takes
&rsquo;2&rsquo; to a toilet, and exits immediately.</p>

<p style="margin-left:11%; margin-top: 1em">While
&rsquo;1&rsquo; and &rsquo;2&rsquo; are sleeping, another
<small>GNU</small> <b>sem</b> waits for a free toilet. When
&rsquo;1&rsquo; finishes, a toilet becomes available, and
this <small>GNU</small> <b>sem</b> stops waiting, and takes
&rsquo;3&rsquo; to a toilet, and exits immediately.</p>

<p style="margin-left:11%; margin-top: 1em">While
&rsquo;2&rsquo; and &rsquo;3&rsquo; are sleeping, another
<small>GNU</small> <b>sem</b> waits for a free toilet. When
&rsquo;2&rsquo; finishes, a toilet becomes available, and
this <small>GNU</small> <b>sem</b> stops waiting, and takes
&rsquo;4&rsquo; to a toilet, and exits immediately.</p>

<p style="margin-left:11%; margin-top: 1em">Finally another
<small>GNU</small> <b>sem</b> waits for all toilets to
become free.</p>

<h2>EXAMPLE: Gzipping *.log
<a name="EXAMPLE: Gzipping *.log"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Run one gzip
process per <small>CPU</small> core. Block until a
<small>CPU</small> core becomes available.</p>

<p style="margin-left:11%; margin-top: 1em">for i in *.log
; do <br>
echo $i <br>
sem &minus;j+0 gzip $i &quot;;&quot; echo done <br>
done <br>
sem &minus;&minus;wait</p>

<h2>EXAMPLE: Protecting pod2html from itself
<a name="EXAMPLE: Protecting pod2html from itself"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">pod2html
creates two files: pod2htmd.tmp and pod2htmi.tmp which it
does not clean up. It uses these two files for a short time.
But if you run multiple pod2html in parallel (e.g. in a
Makefile with make &minus;j) there is a risk that two
different instances of pod2html will write to the files at
the same time:</p>

<p style="margin-left:11%; margin-top: 1em"># This may fail
due to shared pod2htmd.tmp/pod2htmi.tmp files <br>
foo.html: <br>
pod2html foo.pod &minus;&minus;outfile foo.html <br>
bar.html: <br>
pod2html bar.pod &minus;&minus;outfile bar.html <br>
$ make &minus;j foo.html bar.html</p>

<p style="margin-left:11%; margin-top: 1em">You need to
protect pod2html from running twice at the same time.
<b>sem</b> running as a mutex will make sure only one
runs:</p>

<p style="margin-left:11%; margin-top: 1em">foo.html: <br>
sem &minus;&minus;id pod2html pod2html foo.pod
&minus;&minus;outfile foo.html <br>
bar.html: <br>
sem &minus;&minus;id pod2html pod2html bar.pod
&minus;&minus;outfile bar.html <br>
clean: foo.html bar.html <br>
sem &minus;&minus;id pod2html &minus;&minus;wait <br>
rm &minus;f pod2htmd.tmp pod2htmi.tmp <br>
$ make &minus;j foo.html bar.html clean</p>

<h2>BUGS
<a name="BUGS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">None known.</p>

<h2>REPORTING BUGS
<a name="REPORTING BUGS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Report bugs to
&lt;bug&minus;parallel@gnu.org&gt;.</p>

<h2>AUTHOR
<a name="AUTHOR"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Copyright (C)
2010&minus;2023 Ole Tange, http://ole.tange.dk and Free
Software Foundation, Inc.</p>

<h2>LICENSE
<a name="LICENSE"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">This program is
free software; you can redistribute it and/or modify it
under the terms of the <small>GNU</small> General Public
License as published by the Free Software Foundation; either
version 3 of the License, or at your option any later
version.</p>

<p style="margin-left:11%; margin-top: 1em">This program is
distributed in the hope that it will be useful, but
<small>WITHOUT ANY WARRANTY</small> ; without even the
implied warranty of <small>MERCHANTABILITY</small> or
<small>FITNESS FOR A PARTICULAR PURPOSE.</small> See the
<small>GNU</small> General Public License for more
details.</p>

<p style="margin-left:11%; margin-top: 1em">You should have
received a copy of the <small>GNU</small> General Public
License along with this program. If not, see
&lt;https://www.gnu.org/licenses/&gt;.</p>


<p style="margin-left:11%; margin-top: 1em"><b>Documentation
license I</b> <br>
Permission is granted to copy, distribute and/or modify this
documentation under the terms of the <small>GNU</small> Free
Documentation License, Version 1.3 or any later version
published by the Free Software Foundation; with no Invariant
Sections, with no Front-Cover Texts, and with no Back-Cover
Texts. A copy of the license is included in the file
<small>LICENSES/GFDL&minus;1</small>
.3&minus;or&minus;later.txt.</p>


<p style="margin-left:11%; margin-top: 1em"><b>Documentation
license <small>II</small></b> <br>
You are free:</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="12%">


<p style="margin-top: 1em"><b>to Share</b></p></td>
<td width="2%"></td>
<td width="63%">


<p style="margin-top: 1em">to copy, distribute and transmit
the work</p></td>
<td width="12%">
</td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="12%">


<p><b>to Remix</b></p></td>
<td width="2%"></td>
<td width="63%">


<p>to adapt the work</p></td>
<td width="12%">
</td></tr>
</table>

<p style="margin-left:11%; margin-top: 1em">Under the
following conditions: <b><br>
Attribution</b></p>

<p style="margin-left:25%;">You must attribute the work in
the manner specified by the author or licensor (but not in
any way that suggests that they endorse you or your use of
the work).</p>

<p style="margin-left:11%;"><b>Share Alike</b></p>

<p style="margin-left:25%;">If you alter, transform, or
build upon this work, you may distribute the resulting work
only under the same, similar or a compatible license.</p>

<p style="margin-left:11%; margin-top: 1em">With the
understanding that:</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="9%">


<p><b>Waiver</b></p></td>
<td width="5%"></td>
<td width="75%">


<p>Any of the above conditions can be waived if you get
permission from the copyright holder.</p></td></tr>
</table>

<p style="margin-left:11%;"><b>Public Domain</b></p>

<p style="margin-left:25%;">Where the work or any of its
elements is in the public domain under applicable law, that
status is in no way affected by the license.</p>

<p style="margin-left:11%;"><b>Other Rights</b></p>

<p style="margin-left:25%;">In no way are any of the
following rights affected by the license:</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="15%">


<p>&bull;</p></td>
<td width="2%"></td>
<td width="72%">


<p>Your fair dealing or fair use rights, or other
applicable copyright exceptions and limitations;</p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="15%">


<p>&bull;</p></td>
<td width="2%"></td>
<td width="72%">


<p>The author&rsquo;s moral rights;</p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="15%">


<p>&bull;</p></td>
<td width="2%"></td>
<td width="72%">


<p>Rights other persons may have either in the work itself
or in how the work is used, such as publicity or privacy
rights.</p> </td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="15%">


<p><b>Notice</b></p></td>
<td width="2%"></td>
<td width="72%">
</td></tr>
</table>

<p style="margin-left:25%; margin-top: 1em">For any reuse
or distribution, you must make clear to others the license
terms of this work.</p>

<p style="margin-left:11%; margin-top: 1em">A copy of the
full license is included in the file as
<small>LICENCES/CC&minus;BY&minus;SA&minus;4.0</small>
.txt</p>

<h2>DEPENDENCIES
<a name="DEPENDENCIES"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em"><small>GNU</small>
<b>sem</b> uses Perl, and the Perl modules Getopt::Long,
Symbol, Fcntl.</p>

<h2>SEE ALSO
<a name="SEE ALSO"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em"><b>parallel</b>(1)</p>
<hr>
</body>
</html>
