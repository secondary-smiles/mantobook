<!-- Creator     : groff version 1.22.4 -->
<!-- CreationDate: Mon May 29 22:54:07 2023 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title>IOCTL-XFS-FSGEOMETRY</title>

</head>
<body>
<h1>ioctl_xfs_fsgeometry</h1>



<h2>NAME
<a name="NAME"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em">ioctl_xfs_fsgeometry
&minus; report XFS filesystem layout and features</p>

<h2>SYNOPSIS
<a name="SYNOPSIS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em"><b>#include
&lt;xfs/xfs_fs.h&gt;</b></p>

<p style="margin-left:11%; margin-top: 1em"><b>int
ioctl(int</b> <i>fd</i><b>, XFS_IOC_FSGEOMETRY, struct
xfs_fsop_geom *</b><i>arg</i><b>); <br>
int ioctl(int</b> <i>fd</i><b>, XFS_IOC_FSGEOMETRY_V4,
struct xfs_fsop_geom_v4 *</b><i>arg</i><b>); <br>
int ioctl(int</b> <i>fd</i><b>, XFS_IOC_FSGEOMETRY_V1,
struct xfs_fsop_geom_v1 *</b><i>arg</i><b>);</b></p>

<h2>DESCRIPTION
<a name="DESCRIPTION"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Report the
details of an XFS filesystem layout, features, and other
descriptive items. This information is conveyed in a
structure of the following form:</p>

<p style="margin-left:17%; margin-top: 1em">struct
xfs_fsop_geom {</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="8%"></td>
<td width="7%"></td>
<td width="85%">


<p>__u32 blocksize;</p></td></tr>
<tr valign="top" align="left">
<td width="8%"></td>
<td width="7%"></td>
<td width="85%">


<p>__u32 rtextsize;</p></td></tr>
<tr valign="top" align="left">
<td width="8%"></td>
<td width="7%"></td>
<td width="85%">


<p>__u32 agblocks;</p></td></tr>
<tr valign="top" align="left">
<td width="8%"></td>
<td width="7%"></td>
<td width="85%">


<p>__u32 agcount;</p></td></tr>
<tr valign="top" align="left">
<td width="8%"></td>
<td width="7%"></td>
<td width="85%">


<p>__u32 logblocks;</p></td></tr>
<tr valign="top" align="left">
<td width="8%"></td>
<td width="7%"></td>
<td width="85%">


<p>__u32 sectsize;</p></td></tr>
<tr valign="top" align="left">
<td width="8%"></td>
<td width="7%"></td>
<td width="85%">


<p>__u32 inodesize;</p></td></tr>
<tr valign="top" align="left">
<td width="8%"></td>
<td width="7%"></td>
<td width="85%">


<p>__u32 imaxpct;</p></td></tr>
<tr valign="top" align="left">
<td width="8%"></td>
<td width="7%"></td>
<td width="85%">


<p>__u64 datablocks;</p></td></tr>
<tr valign="top" align="left">
<td width="8%"></td>
<td width="7%"></td>
<td width="85%">


<p>__u64 rtblocks;</p></td></tr>
<tr valign="top" align="left">
<td width="8%"></td>
<td width="7%"></td>
<td width="85%">


<p>__u64 rtextents;</p></td></tr>
<tr valign="top" align="left">
<td width="8%"></td>
<td width="7%"></td>
<td width="85%">


<p>__u64 logstart;</p></td></tr>
<tr valign="top" align="left">
<td width="8%"></td>
<td width="7%"></td>
<td width="85%">


<p>unsigned char uuid[16];</p></td></tr>
<tr valign="top" align="left">
<td width="8%"></td>
<td width="7%"></td>
<td width="85%">


<p>__u32 sunit;</p></td></tr>
<tr valign="top" align="left">
<td width="8%"></td>
<td width="7%"></td>
<td width="85%">


<p>__u32 swidth;</p></td></tr>
<tr valign="top" align="left">
<td width="8%"></td>
<td width="7%"></td>
<td width="85%">


<p>__s32 version;</p></td></tr>
<tr valign="top" align="left">
<td width="8%"></td>
<td width="7%"></td>
<td width="85%">


<p>__u32 flags;</p></td></tr>
<tr valign="top" align="left">
<td width="8%"></td>
<td width="7%"></td>
<td width="85%">


<p>__u32 logsectsize;</p></td></tr>
<tr valign="top" align="left">
<td width="8%"></td>
<td width="7%"></td>
<td width="85%">


<p>__u32 rtsectsize;</p></td></tr>
<tr valign="top" align="left">
<td width="8%"></td>
<td width="7%"></td>
<td width="85%">


<p>__u32 dirblocksize;</p></td></tr>
<tr valign="top" align="left">
<td width="8%"></td>
<td width="7%"></td>
<td width="85%">


<p>/* struct xfs_fsop_geom_v1 stops here. */</p></td></tr>
<tr valign="top" align="left">
<td width="8%"></td>
<td width="7%"></td>
<td width="85%">


<p>__u32 logsunit;</p></td></tr>
<tr valign="top" align="left">
<td width="8%"></td>
<td width="7%"></td>
<td width="85%">


<p>/* struct xfs_fsop_geom_v4 stops here. */</p></td></tr>
<tr valign="top" align="left">
<td width="8%"></td>
<td width="7%"></td>
<td width="85%">


<p>__u32 sick;</p></td></tr>
<tr valign="top" align="left">
<td width="8%"></td>
<td width="7%"></td>
<td width="85%">


<p>__u32 checked;</p></td></tr>
<tr valign="top" align="left">
<td width="8%"></td>
<td width="7%"></td>
<td width="85%">


<p>__u64 reserved[17];</p></td></tr>
</table>

<p style="margin-left:17%;">};</p>


<p style="margin-left:11%; margin-top: 1em"><i>blocksize</i>
is the size of a fundamental filesystem block, in bytes.</p>


<p style="margin-left:11%; margin-top: 1em"><i>rtextsize</i>
is the size of an extent on the realtime volume, in
bytes.</p>


<p style="margin-left:11%; margin-top: 1em"><i>agblocks</i>
is the size of an allocation group, in units of filesystem
blocks.</p>

<p style="margin-left:11%; margin-top: 1em"><i>agcount</i>
is the number of allocation groups in the filesystem.</p>


<p style="margin-left:11%; margin-top: 1em"><i>logblocks</i>
is the size of the log, in units of filesystem blocks.</p>


<p style="margin-left:11%; margin-top: 1em"><i>sectsize</i>
is the smallest amount of data that can be written to the
data device atomically, in bytes.</p>


<p style="margin-left:11%; margin-top: 1em"><i>inodesize</i>
is the size of an inode record, in bytes.</p>

<p style="margin-left:11%; margin-top: 1em"><i>imaxpct</i>
is the maximum percentage of the filesystem that can be
allocated to inode record blocks.</p>


<p style="margin-left:11%; margin-top: 1em"><i>datablocks</i>
is the size of the data device, in units of filesystem
blocks.</p>


<p style="margin-left:11%; margin-top: 1em"><i>rtblocks</i>
is the size of the realtime device, in units of filesystem
blocks.</p>


<p style="margin-left:11%; margin-top: 1em"><i>rtextents</i>
is the number of extents that can be allocated on the
realtime device.</p>


<p style="margin-left:11%; margin-top: 1em"><i>logstart</i>
is the start of the log, in units of filesystem blocks. If
the filesystem has an external log, this will be zero.</p>

<p style="margin-left:11%; margin-top: 1em"><i>uuid</i> is
the universal unique identifier of the filesystem.</p>

<p style="margin-left:11%; margin-top: 1em"><i>sunit</i> is
what the filesystem has been told is the size of a RAID
stripe unit on the underlying data device, in filesystem
blocks.</p>

<p style="margin-left:11%; margin-top: 1em"><i>swidth</i>
is what the filesystem has been told is the width of a RAID
stripe on the underlying data device, in units of RAID
stripe units.</p>

<p style="margin-left:11%; margin-top: 1em"><i>version</i>
is the version of this structure. This value will be
XFS_FSOP_GEOM_VERSION.</p>

<p style="margin-left:11%; margin-top: 1em"><i>flags</i>
tell us what features are enabled on the filesystem. Refer
to the section <b>FILESYSTEM FEATURE FLAGS</b> below for
more information about each feature.</p>


<p style="margin-left:11%; margin-top: 1em"><i>logsectsize</i>
is the smallest amount of data that can be written to the
log device atomically, in bytes.</p>


<p style="margin-left:11%; margin-top: 1em"><i>rtsectsize</i>
is the smallest amount of data that can be written to the
realtime device atomically, in bytes.</p>


<p style="margin-left:11%; margin-top: 1em"><i>dirblocksize</i>
is the size of directory blocks, in bytes.</p>


<p style="margin-left:11%; margin-top: 1em"><i>logsunit</i>
is what the filesystem has been told is the size of a RAID
stripe unit on the underlying log device, in filesystem
blocks. This field is meaningful only if the flag
<b>XFS_FSOP_GEOM_FLAGS_LOGV2</b> is set.</p>

<p style="margin-left:11%; margin-top: 1em">The fields
<i>sick</i> and <i>checked</i> indicate the relative health
of various whole-filesystem metadata. Please see the section
<b>XFS METADATA HEALTH REPORTING</b> for more details.</p>


<p style="margin-left:11%; margin-top: 1em"><i>reserved</i>
is set to zero.</p>

<h2>FILESYSTEM FEATURE FLAGS
<a name="FILESYSTEM FEATURE FLAGS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Filesystem
features are reported to userspace as a combination the
following flags: <b><br>
XFS_FSOP_GEOM_FLAGS_ATTR</b></p>

<p style="margin-left:22%;">Extended attributes are
present.</p>


<p style="margin-left:11%;"><b>XFS_FSOP_GEOM_FLAGS_NLINK</b></p>

<p style="margin-left:22%;">Files on this filesystem
support up to 2^32 hard links. If this flag is not set,
files on this filesystem support only up to 2^16 hard
links.</p>


<p style="margin-left:11%;"><b>XFS_FSOP_GEOM_FLAGS_QUOTA</b></p>

<p style="margin-left:22%;">Quotas are enabled.</p>


<p style="margin-left:11%;"><b>XFS_FSOP_GEOM_FLAGS_IALIGN</b></p>

<p style="margin-left:22%;">Inodes are aligned for better
performance.</p>


<p style="margin-left:11%;"><b>XFS_FSOP_GEOM_FLAGS_DALIGN</b></p>

<p style="margin-left:22%;">Filesystem tries to align data
block allocations to RAID stripe units for better
performance.</p>


<p style="margin-left:11%;"><b>XFS_FSOP_GEOM_FLAGS_SHARED</b></p>

<p style="margin-left:22%;">Unused.</p>


<p style="margin-left:11%;"><b>XFS_FSOP_GEOM_FLAGS_EXTFLG</b></p>

<p style="margin-left:22%;">Filesystem supports unwritten
extents.</p>


<p style="margin-left:11%;"><b>XFS_FSOP_GEOM_FLAGS_DIRV2</b></p>

<p style="margin-left:22%;">Directories are in version 2
format and maintain free space data for better performance.
Version 1 format directories are no longer supported.</p>


<p style="margin-left:11%;"><b>XFS_FSOP_GEOM_FLAGS_LOGV2</b></p>

<p style="margin-left:22%;">Log uses the V2 format.</p>


<p style="margin-left:11%;"><b>XFS_FSOP_GEOM_FLAGS_SECTOR</b></p>

<p style="margin-left:22%;">The log device has a sector
size larger than 512 bytes.</p>


<p style="margin-left:11%;"><b>XFS_FSOP_GEOM_FLAGS_ATTR2</b></p>

<p style="margin-left:22%;">Filesystem contains V2 extended
attributes.</p>


<p style="margin-left:11%;"><b>XFS_FSOP_GEOM_FLAGS_PROJID32</b></p>

<p style="margin-left:22%;">Project IDs can be as large as
2^32. If this flag is not set, the filesystem supports only
2^16 project IDs.</p>


<p style="margin-left:11%;"><b>XFS_FSOP_GEOM_FLAGS_DIRV2CI</b></p>

<p style="margin-left:22%;">Case-insensitive lookups are
supported on directories.</p>


<p style="margin-left:11%;"><b>XFS_FSOP_GEOM_FLAGS_LAZYSB</b></p>

<p style="margin-left:22%;">On-disk superblock counters are
updated only at unmount time.</p>


<p style="margin-left:11%;"><b>XFS_FSOP_GEOM_FLAGS_V5SB</b></p>

<p style="margin-left:22%;">Metadata blocks are self
describing and contain checksums.</p>


<p style="margin-left:11%;"><b>XFS_FSOP_GEOM_FLAGS_FTYPE</b></p>

<p style="margin-left:22%;">Directories contain inode types
in directory entries.</p>


<p style="margin-left:11%;"><b>XFS_FSOP_GEOM_FLAGS_FINOBT</b></p>

<p style="margin-left:22%;">Filesystem maintains an index
of free inodes.</p>


<p style="margin-left:11%;"><b>XFS_FSOP_GEOM_FLAGS_SPINODES</b></p>

<p style="margin-left:22%;">Filesystem may allocate
discontiguous inode chunks when free space is
fragmented.</p>


<p style="margin-left:11%;"><b>XFS_FSOP_GEOM_FLAGS_RMAPBT</b></p>

<p style="margin-left:22%;">Filesystem stores reverse
mappings of blocks to owners.</p>


<p style="margin-left:11%;"><b>XFS_FSOP_GEOM_FLAGS_REFLINK</b></p>

<p style="margin-left:22%;">Filesystem supports sharing
blocks between files.</p>

<h2>XFS METADATA HEALTH REPORTING
<a name="XFS METADATA HEALTH REPORTING"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">The online
filesystem checking utility scans metadata and records what
it finds in the kernel incore state. The following scheme is
used for userspace to read the incore health status of the
filesystem:</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="1%">


<p>&bull;</p></td>
<td width="2%"></td>
<td width="86%">


<p>If a given sick flag is set in <i>sick</i>, then that
piece of metadata has been observed to be damaged. The same
bit should be set in <i>checked</i>.</p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="1%">


<p>&bull;</p></td>
<td width="2%"></td>
<td width="86%">


<p>If a given sick flag is set in <i>checked</i> but is not
set in <i>sick</i>, then that piece of metadata has been
checked and is not faulty.</p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="1%">


<p>&bull;</p></td>
<td width="2%"></td>
<td width="86%">


<p>If a given sick flag is not set in <i>checked</i>, then
no conclusion can be made.</p></td></tr>
</table>

<p style="margin-left:11%; margin-top: 1em">The following
flags apply to these fields:</p>


<p style="margin-left:17%;"><b>XFS_FSOP_GEOM_SICK_COUNTERS</b></p>

<p style="margin-left:28%;">Inode and space summary
counters.</p>


<p style="margin-left:17%;"><b>XFS_FSOP_GEOM_SICK_UQUOTA</b></p>

<p style="margin-left:28%;">User quota information.</p>


<p style="margin-left:17%;"><b>XFS_FSOP_GEOM_SICK_GQUOTA</b></p>

<p style="margin-left:28%;">Group quota information.</p>


<p style="margin-left:17%;"><b>XFS_FSOP_GEOM_SICK_PQUOTA</b></p>

<p style="margin-left:28%;">Project quota information.</p>


<p style="margin-left:17%;"><b>XFS_FSOP_GEOM_SICK_RT_BITMAP</b></p>

<p style="margin-left:28%;">Free space bitmap for the
realtime device.</p>


<p style="margin-left:17%;"><b>XFS_FSOP_GEOM_SICK_RT_SUMMARY</b></p>

<p style="margin-left:28%;">Free space summary for the
realtime device.</p>

<h2>RETURN VALUE
<a name="RETURN VALUE"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">On error,
&minus;1 is returned, and <i>errno</i> is set to indicate
the error.</p>

<h2>ERRORS
<a name="ERRORS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Error codes can
be one of, but are not limited to, the following:</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="9%">


<p><b>EFAULT</b></p></td>
<td width="2%"></td>
<td width="78%">


<p>The kernel was not able to copy into the userspace
buffer.</p> </td></tr>
</table>

<p style="margin-left:11%;"><b>EFSBADCRC</b></p>

<p style="margin-left:22%;">Metadata checksum validation
failed while performing the query.</p>

<p style="margin-left:11%;"><b>EFSCORRUPTED</b></p>

<p style="margin-left:22%;">Metadata corruption was
encountered while performing the query.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="4%">


<p><b>EIO</b></p></td>
<td width="7%"></td>
<td width="78%">


<p>An I/O error was encountered while performing the
query.</p> </td></tr>
</table>

<h2>CONFORMING TO
<a name="CONFORMING TO"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">This API is
specific to XFS filesystem on the Linux kernel.</p>

<h2>SEE ALSO
<a name="SEE ALSO"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em"><b>ioctl</b>(2)</p>
<hr>
</body>
</html>
