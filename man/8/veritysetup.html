<!-- Creator     : groff version 1.22.4 -->
<!-- CreationDate: Mon May 29 22:57:10 2023 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title>VERITYSETUP</title>

</head>
<body>
<h1>veritysetup</h1>



<h2>NAME
<a name="NAME"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">veritysetup
&minus; manage dm&minus;verity (block level verification)
volumes</p>

<h2>SYNOPSIS
<a name="SYNOPSIS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em"><b>veritysetup
&lt;action&gt; [&lt;options&gt;] &lt;action args&gt;</b></p>

<h2>DESCRIPTION
<a name="DESCRIPTION"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Veritysetup is
used to configure dm&minus;verity managed
device&minus;mapper mappings.</p>


<p style="margin-left:11%; margin-top: 1em">Device&minus;mapper
verity target provides read&minus;only transparent integrity
checking of block devices using kernel crypto API.</p>

<p style="margin-left:11%; margin-top: 1em">The
dm&minus;verity devices are always read&minus;only.</p>

<h2>BASIC ACTIONS
<a name="BASIC ACTIONS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Veritysetup
supports these operations:</p>

<p style="margin-left:11%; margin-top: 1em"><b>FORMAT <br>
format &lt;data_device&gt; &lt;hash_device&gt;</b></p>

<p style="margin-left:11%; margin-top: 1em">Calculates and
permanently stores hash verification data for data_device.
Hash area can be located on the same device after data if
specified by &minus;&minus;hash&minus;offset option.</p>

<p style="margin-left:11%; margin-top: 1em">Note you need
to provide root hash string for device verification or
activation. Root hash must be trusted.</p>

<p style="margin-left:11%; margin-top: 1em">The data or
hash device argument can be block device or file image. If
hash device path doesn&rsquo;t exist, it will be created as
file.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&lt;options&gt;</b>
can be [&minus;&minus;hash,
&minus;&minus;no&minus;superblock, &minus;&minus;format,
&minus;&minus;data&minus;block&minus;size,
&minus;&minus;hash&minus;block&minus;size,
&minus;&minus;data&minus;blocks,
&minus;&minus;hash&minus;offset, &minus;&minus;salt,
&minus;&minus;uuid,
&minus;&minus;root&minus;hash&minus;file].</p>

<p style="margin-left:11%; margin-top: 1em">If option
&minus;&minus;root&minus;hash&minus;file is used, the root
hash is stored in hex&minus;encoded text format in
&lt;path&gt;.</p>

<p style="margin-left:11%; margin-top: 1em"><b>OPEN <br>
open &lt;data_device&gt; &lt;name&gt; &lt;hash_device&gt;
&lt;root_hash&gt; <br>
open &lt;data_device&gt; &lt;name&gt; &lt;hash_device&gt;
&minus;&minus;root&minus;hash&minus;file &lt;path&gt;</b>
<br>
create &lt;name&gt; &lt;data_device&gt; &lt;hash_device&gt;
&lt;root_hash&gt; (<b>OBSOLETE syntax</b>)</p>

<p style="margin-left:11%; margin-top: 1em">Creates a
mapping with &lt;name&gt; backed by device
&lt;data_device&gt; and using &lt;hash_device&gt; for
in&minus;kernel verification.</p>

<p style="margin-left:11%; margin-top: 1em">The
&lt;root_hash&gt; is a hexadecimal string.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&lt;options&gt;</b>
can be [&minus;&minus;hash&minus;offset,
&minus;&minus;no&minus;superblock,
&minus;&minus;ignore&minus;corruption or
&minus;&minus;restart&minus;on&minus;corruption,
&minus;&minus;panic&minus;on&minus;corruption,
&minus;&minus;ignore&minus;zero&minus;blocks,
&minus;&minus;check&minus;at&minus;most&minus;once,
&minus;&minus;root&minus;hash&minus;signature,
&minus;&minus;root&minus;hash&minus;file,
&minus;&minus;use&minus;tasklets].</p>

<p style="margin-left:11%; margin-top: 1em">If option
&minus;&minus;root&minus;hash&minus;file is used, the root
hash is read from &lt;path&gt; instead of from the command
line parameter. Expects hex&minus;encoded text, without
terminating newline.</p>

<p style="margin-left:11%; margin-top: 1em">If option
&minus;&minus;no&minus;superblock is used, you have to use
as the same options as in initial format operation.</p>

<p style="margin-left:11%; margin-top: 1em"><b>VERIFY <br>
verify &lt;data_device&gt; &lt;hash_device&gt;
&lt;root_hash&gt; <br>
verify &lt;data_device&gt; &lt;hash_device&gt;
&minus;&minus;root&minus;hash&minus;file
&lt;path&gt;</b></p>

<p style="margin-left:11%; margin-top: 1em">Verifies data
on data_device with use of hash blocks stored on
hash_device.</p>

<p style="margin-left:11%; margin-top: 1em">This command
performs userspace verification, no kernel device is
created.</p>

<p style="margin-left:11%; margin-top: 1em">The
&lt;root_hash&gt; is a hexadecimal string.</p>

<p style="margin-left:11%; margin-top: 1em">If option
&minus;&minus;root&minus;hash&minus;file is used, the root
hash is read from &lt;path&gt; instead of from the command
line parameter. Expects hex&minus;encoded text, without
terminating newline.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&lt;options&gt;</b>
can be [&minus;&minus;hash&minus;offset,
&minus;&minus;no&minus;superblock,
&minus;&minus;root&minus;hash&minus;file].</p>

<p style="margin-left:11%; margin-top: 1em">If option
&minus;&minus;no&minus;superblock is used, you have to use
as the same options as in initial format operation.</p>

<p style="margin-left:11%; margin-top: 1em"><b>CLOSE <br>
close &lt;name&gt;</b> <br>
remove &lt;name&gt; (<b>OBSOLETE syntax</b>)</p>

<p style="margin-left:11%; margin-top: 1em">Removes
existing mapping &lt;name&gt;.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&lt;options&gt;</b>
can be [&minus;&minus;deferred] or
[&minus;&minus;cancel&minus;deferred].</p>

<p style="margin-left:11%; margin-top: 1em"><b>STATUS <br>
status &lt;name&gt;</b></p>

<p style="margin-left:11%; margin-top: 1em">Reports status
for the active verity mapping &lt;name&gt;.</p>

<p style="margin-left:11%; margin-top: 1em"><b>DUMP <br>
dump &lt;hash_device&gt;</b></p>

<p style="margin-left:11%; margin-top: 1em">Reports
parameters of verity device from on&minus;disk stored
superblock.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&lt;options&gt;</b>
can be [&minus;&minus;hash&minus;offset].</p>

<h2>OPTIONS
<a name="OPTIONS"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;no&minus;superblock</b></p>

<p style="margin-left:17%;">Create or use dm&minus;verity
without permanent on&minus;disk superblock.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;format=number</b></p>

<p style="margin-left:17%;">Specifies the hash version
type. Format type 0 is original Chrome OS version. Format
type 1 is current version.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;data&minus;block&minus;size=bytes</b></p>

<p style="margin-left:17%;">Used block size for the data
device. (Note kernel supports only page&minus;size as
maximum here.)</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;hash&minus;block&minus;size=bytes</b></p>

<p style="margin-left:17%;">Used block size for the hash
device. (Note kernel supports only page&minus;size as
maximum here.)</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;data&minus;blocks=blocks</b></p>

<p style="margin-left:17%;">Size of data device used in
verification. If not specified, the whole device is
used.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;hash&minus;offset=bytes</b></p>

<p style="margin-left:17%;">Offset of hash area/superblock
on hash_device. Value must be aligned to disk sector
offset.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;salt=hex
string</b></p>

<p style="margin-left:17%;">Salt used for format or
verification. Format is a hexadecimal string.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;uuid=UUID</b></p>

<p style="margin-left:17%;">Use the provided UUID for
format command instead of generating new one.</p>

<p style="margin-left:17%; margin-top: 1em">The UUID must
be provided in standard UUID format, e.g.
12345678&minus;1234&minus;1234&minus;1234&minus;123456789abc.
*&minus;&minus;ignore&minus;corruption ,
&minus;&minus;restart&minus;on&minus;corruption ,</p>


<p style="margin-left:11%; margin-top: 1em">&minus;&minus;panic&minus;on&minus;corruption*</p>

<p style="margin-left:17%;">Defines what to do if data
integrity problem is detected (data corruption).</p>

<p style="margin-left:17%; margin-top: 1em">Without these
options kernel fails the IO operation with I/O error. With
&minus;&minus;ignore&minus;corruption option the corruption
is only logged. With
&minus;&minus;restart&minus;on&minus;corruption or
&minus;&minus;panic&minus;on&minus;corruption the kernel is
restarted (panicked) immediately. (You have to provide way
how to avoid restart loops.)</p>


<p style="margin-left:17%; margin-top: 1em"><b>WARNING:</b>
Use these options only for very specific cases. These
options are available since Linux kernel version 4.1.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;ignore&minus;zero&minus;blocks</b></p>

<p style="margin-left:17%;">Instruct kernel to not verify
blocks that are expected to contain zeroes and always
directly return zeroes instead.</p>


<p style="margin-left:17%; margin-top: 1em"><b>WARNING:</b>
Use this option only in very specific cases. This option is
available since Linux kernel version 4.5.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;check&minus;at&minus;most&minus;once</b></p>

<p style="margin-left:17%;">Instruct kernel to verify
blocks only the first time they are read from the data
device, rather than every time.</p>


<p style="margin-left:17%; margin-top: 1em"><b>WARNING:</b>
It provides a reduced level of security because only offline
tampering of the data device&rsquo;s content will be
detected, not online tampering. This option is available
since Linux kernel version 4.17.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;hash=hash</b></p>

<p style="margin-left:17%;">Hash algorithm for
dm&minus;verity. For default see &minus;&minus;help
option.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;fec&minus;device=fec_device</b></p>

<p style="margin-left:17%;">Use forward error correction
(FEC) to recover from corruption if hash verification fails.
Use encoding data from the specified device.</p>

<p style="margin-left:17%; margin-top: 1em">The fec device
argument can be block device or file image. For format, if
fec device path doesn&rsquo;t exist, it will be created as
file.</p>

<p style="margin-left:17%; margin-top: 1em">Block sizes for
data and hash devices must match. Also, if the verity
data_device is encrypted the fec_device should be too.</p>

<p style="margin-left:17%; margin-top: 1em">FEC calculation
covers data, hash area, and optional foreign metadata stored
on the same device with the hash tree (additional space
after hash area). Size of this optional additional area
protected by FEC is calculated from image sizes, so you must
be sure that you use the same images for activation.</p>

<p style="margin-left:17%; margin-top: 1em">If the hash
device is in a separate image, metadata covers the whole
rest of the image after the hash area.</p>

<p style="margin-left:17%; margin-top: 1em">If hash and FEC
device is in the image, metadata ends on the FEC area
offset.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;fec&minus;offset=bytes</b></p>

<p style="margin-left:17%;">This is the offset, in bytes,
from the start of the FEC device to the beginning of the
encoding data.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;fec&minus;roots=num</b></p>

<p style="margin-left:17%;">Number of generator roots. This
equals to the number of parity bytes in the encoding data.
In RS(M, N) encoding, the number of roots is M&minus;N. M is
255 and M&minus;N is between 2 and 24 (including).</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;root&minus;hash&minus;file=FILE</b></p>

<p style="margin-left:17%;">Path to file with stored root
hash in hex&minus;encoded text.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;root&minus;hash&minus;signature=FILE</b></p>

<p style="margin-left:17%;">Path to root hash signature
file used to verify the root hash (in kernel). This feature
requires Linux kernel version 5.4 or more recent.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;use&minus;tasklets</b></p>

<p style="margin-left:17%;">Try to use kernel tasklets in
dm&minus;verity driver for performance reasons. This option
is available since Linux kernel version 6.0.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;deferred</b></p>

<p style="margin-left:17%;">Defers device removal in
<b>close</b> command until the last user closes it.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;cancel&minus;deferred</b></p>

<p style="margin-left:17%;">Removes a previously configured
deferred device removal in <b>close</b> command.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;verbose,
&minus;v</b></p>

<p style="margin-left:17%;">Print more information on
command execution.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;debug</b></p>

<p style="margin-left:17%;">Run in debug mode with full
diagnostic logs. Debug output lines are always prefixed by
<b>#</b>.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;version,
&minus;V</b></p>

<p style="margin-left:17%;">Show the program version.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;batch&minus;mode,
&minus;q</b></p>

<p style="margin-left:17%;">Do not ask for
confirmation.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;usage</b></p>

<p style="margin-left:17%;">Show short option help.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;help,
&minus;?</b></p>

<p style="margin-left:17%;">Show help text and default
parameters.</p>

<h2>RETURN CODES
<a name="RETURN CODES"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Veritysetup
returns <b>0</b> on success and a non&minus;zero value on
error.</p>

<p style="margin-left:11%; margin-top: 1em">Error codes
are: <b>1</b> wrong parameters, <b>2</b> no permission,
<b>3</b> out of memory, <b>4</b> wrong device specified,
<b>5</b> device already exists or device is busy.</p>

<h2>EXAMPLES
<a name="EXAMPLES"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em"><b>veritysetup
&minus;&minus;data&minus;blocks=256 format
&lt;data_device&gt; &lt;hash_device&gt;</b></p>

<p style="margin-left:11%; margin-top: 1em">Calculates and
stores verification data on hash_device for the first 256
blocks (of block&minus;size). If hash_device does not exist,
it is created (as file image).</p>

<p style="margin-left:11%; margin-top: 1em"><b>veritysetup
format &minus;&minus;root&minus;hash&minus;file &lt;path&gt;
&lt;data_device&gt; &lt;hash_device&gt;</b></p>

<p style="margin-left:11%; margin-top: 1em">Calculates and
stores verification data on hash_device for the whole
data_device, and store the root hash as hex&minus;encoded
text in &lt;path&gt;.</p>

<p style="margin-left:11%; margin-top: 1em"><b>veritysetup
&minus;&minus;data&minus;blocks=256
&minus;&minus;hash&minus;offset=1052672 format
&lt;device&gt; &lt;device&gt;</b></p>

<p style="margin-left:11%; margin-top: 1em">Verification
data (hashes) is stored on the same device as data (starting
at hash&minus;offset). Hash&minus;offset must be greater
than number of blocks in data&minus;area.</p>

<p style="margin-left:11%; margin-top: 1em"><b>veritysetup
&minus;&minus;data&minus;blocks=256
&minus;&minus;hash&minus;offset=1052672 create
test&minus;device &lt;device&gt; &lt;device&gt;
&lt;root_hash&gt;</b></p>

<p style="margin-left:11%; margin-top: 1em">Activates the
verity device named test&minus;device. Options
&minus;&minus;data&minus;blocks and
&minus;&minus;hash&minus;offset are the same as in the
format command. The &lt;root_hash&gt; was calculated in
format command.</p>

<p style="margin-left:11%; margin-top: 1em"><b>veritysetup
&minus;&minus;data&minus;blocks=256
&minus;&minus;hash&minus;offset=1052672 verify
&lt;data_device&gt; &lt;hash_device&gt;
&lt;root_hash&gt;</b></p>

<p style="margin-left:11%; margin-top: 1em">Verifies device
without activation (in userspace).</p>

<p style="margin-left:11%; margin-top: 1em"><b>veritysetup
&minus;&minus;data&minus;blocks=256
&minus;&minus;hash&minus;offset=1052672
&minus;&minus;root&minus;hash&minus;file &lt;path&gt; verify
&lt;data_device&gt; &lt;hash_device&gt;</b></p>

<p style="margin-left:11%; margin-top: 1em">Verifies device
without activation (in userspace). Root hash passed via a
file rather than inline.</p>

<p style="margin-left:11%; margin-top: 1em"><b>veritysetup
&minus;&minus;fec&minus;device=&lt;fec_device&gt;
&minus;&minus;fec&minus;roots=10 format &lt;data_device&gt;
&lt;hash_device&gt;</b></p>

<p style="margin-left:11%; margin-top: 1em">Calculates and
stores verification and encoding data for data_device.</p>

<h2>DM&minus;VERITY ON&minus;DISK SPECIFICATION
<a name="DM&minus;VERITY ON&minus;DISK SPECIFICATION"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">The
on&minus;disk format specification is available at
<b>DMVerity
&lt;https://gitlab.com/cryptsetup/cryptsetup/wikis/DMVerity&gt;
page.</b></p>

<h2>AUTHORS
<a name="AUTHORS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">The first
implementation of veritysetup was written by Chrome OS
authors.</p>

<p style="margin-left:11%; margin-top: 1em">This version is
based on verification code written by <i>Mikulas Patocka</i>
&lt;mpatocka@redhat.com&gt; and rewritten for libcryptsetup
by <i>Milan Broz</i> &lt;gmazyland@gmail.com&gt;.</p>

<h2>REPORTING BUGS
<a name="REPORTING BUGS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Report bugs at
<b>cryptsetup mailing list
&lt;cryptsetup@lists.linux.dev&gt; or in Issues project
section
&lt;https://gitlab.com/cryptsetup/cryptsetup/&minus;/issues/new&gt;.</b></p>

<p style="margin-left:11%; margin-top: 1em"><b>Please
attach output of the failed command with &minus;&minus;debug
option added.</b></p>

<h2>SEE ALSO
<a name="SEE ALSO"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em"><b>Cryptsetup
FAQ
&lt;https://gitlab.com/cryptsetup/cryptsetup/wikis/FrequentlyAskedQuestions&gt;</b></p>


<p style="margin-left:11%; margin-top: 1em"><b>cryptsetup(8),
integritysetup(8) and veritysetup(8)</b></p>

<h2>CRYPTSETUP
<a name="CRYPTSETUP"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Part of
<b>cryptsetup project
&lt;https://gitlab.com/cryptsetup/cryptsetup/&gt;.</b></p>
<hr>
</body>
</html>
