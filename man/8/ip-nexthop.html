<!-- Creator     : groff version 1.22.4 -->
<!-- CreationDate: Mon May 29 22:57:05 2023 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title>IP&minus;NEXTHOP</title>

</head>
<body>
<h1>ip-nexthop</h1>



<h2>NAME
<a name="NAME"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">ip-nexthop
&minus; nexthop object management</p>

<h2>SYNOPSIS
<a name="SYNOPSIS"></a>
</h2>


<p style="margin-left:23%; margin-top: 1em"><b>ip</b> [
<i>ip-OPTIONS</i> ] <b>nexthop</b> { <i>COMMAND</i> |
<b>help</b> }</p>

<p style="margin-left:23%; margin-top: 1em"><b>ip
nexthop</b> { <b>show</b> | <b>flush</b> }
<i>SELECTOR</i></p>

<p style="margin-left:23%; margin-top: 1em"><b>ip
nexthop</b> { <b>add</b> | <b>replace</b> } id <i>ID
NH</i></p>

<p style="margin-left:23%; margin-top: 1em"><b>ip
nexthop</b> { <b>get</b> | <b>del</b> } id <i>ID</i></p>

<p style="margin-left:23%; margin-top: 1em"><b>ip nexthop
bucket list</b> <i>BUCKET_SELECTOR</i></p>

<p style="margin-left:23%; margin-top: 1em"><b>ip nexthop
bucket get</b> id <i>ID</i> index <i>INDEX</i></p>


<p style="margin-left:23%; margin-top: 1em"><i>SELECTOR</i>
:= [ <b>id</b> <i>ID</i> ] [ <b>dev</b> <i>DEV</i> ] [
<b>vrf</b> <i>NAME</i> ] [ <b>master</b> <i>DEV</i> ] [
<b>groups</b> ] [ <b>fdb</b> ]</p>


<p style="margin-left:23%; margin-top: 1em"><i>BUCKET_SELECTOR</i>
:= <i>SELECTOR</i> | [ <b>nhid</b> <i>ID</i> ]</p>

<p style="margin-left:23%; margin-top: 1em"><i>NH</i> := {
<b>blackhole</b> | [ <b>via</b> <i>ADDRESS</i> ] [
<b>dev</b> <i>DEV</i> ] [ <b>onlink</b> ] [ <b>encap</b>
<i>ENCAP</i> ] [ <b>fdb</b> ] | <b>group</b> <i>GROUP</i> [
<b>fdb</b> ] [ <b>type</b> <i>TYPE</i> [ <i>TYPE_ARGS</i> ]
] }</p>

<p style="margin-left:23%; margin-top: 1em"><i>ENCAP</i> :=
[ <i>ENCAP_MPLS</i> ]</p>


<p style="margin-left:23%; margin-top: 1em"><i>ENCAP_MPLS</i>
:= <b>mpls</b> [ <i>LABEL</i> ] [ <b>ttl</b> <i>TTL</i>
]</p>

<p style="margin-left:23%; margin-top: 1em"><i>GROUP</i> :=
<b>id</b>[,<b>weight</b>[/...]</p>

<p style="margin-left:23%; margin-top: 1em"><i>TYPE</i> :=
{ <b>mpath</b> | <b>resilient</b> }</p>


<p style="margin-left:23%; margin-top: 1em"><i>TYPE_ARGS</i>
:= [ <i>RESILIENT_ARGS</i> ]</p>


<p style="margin-left:23%; margin-top: 1em"><i>RESILIENT_ARGS</i>
:= [ <b>buckets</b> <i>BUCKETS</i> ] [ <b>idle_timer</b>
<i>IDLE</i> ] [ <b>unbalanced_timer</b> <i>UNBALANCED</i>
]</p>

<h2>DESCRIPTION
<a name="DESCRIPTION"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em"><b>ip
nexthop</b> is used to manipulate entries in the
kernel&rsquo;s nexthop tables. <br>
ip nexthop add id ID</p>

<p style="margin-left:22%;">add new nexthop entry</p>

<p style="margin-left:11%;">ip nexthop replace id ID</p>

<p style="margin-left:22%;">change the configuration of a
nexthop or add new one <b><br>
via</b> <i>[ FAMILY ] ADDRESS</i></p>

<p style="margin-left:32%;">the address of the nexthop
router, in the address family FAMILY. Address family must
match address family of nexthop instance.</p>

<p style="margin-left:22%;"><b>dev</b> <i>NAME</i></p>

<p style="margin-left:32%;">is the output device.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="22%"></td>
<td width="9%">


<p><b>onlink</b></p></td>
<td width="1%"></td>
<td width="68%">


<p>pretend that the nexthop is directly attached to this
link, even if it does not match any interface prefix.</p></td></tr>
</table>

<p style="margin-left:22%;"><b>encap</b> <i>ENCAPTYPE
ENCAPHDR</i></p>

<p style="margin-left:32%;">attach tunnel encapsulation
attributes to this route.</p>


<p style="margin-left:32%; margin-top: 1em"><i>ENCAPTYPE</i>
is a string specifying the supported encapsulation type.
Namely:</p>

<p style="margin-left:45%; margin-top: 1em"><b>mpls</b> -
encapsulation type MPLS</p>


<p style="margin-left:32%; margin-top: 1em"><i>ENCAPHDR</i>
is a set of encapsulation attributes specific to the
<i>ENCAPTYPE.</i></p>


<p style="margin-left:45%; margin-top: 1em"><b>mpls</b></p>

<p style="margin-left:48%;"><i>MPLSLABEL</i> - mpls label
stack with labels separated by <i>/</i></p>

<p style="margin-left:48%; margin-top: 1em"><b>ttl</b>
<i>TTL</i> - TTL to use for MPLS header or 0 to inherit from
IP header</p>

<p style="margin-left:22%;"><b>group</b> <i>GROUP [</i>
<b>type</b> <i>TYPE [ TYPE_ARGS ] ]</i></p>

<p style="margin-left:32%;">create a nexthop group. Group
specification is id with an optional weight (id,weight) and
a &rsquo;/&rsquo; as a separator between entries.</p>

<p style="margin-left:32%; margin-top: 1em"><i>TYPE</i> is
a string specifying the nexthop group type. Namely:</p>

<p style="margin-left:45%; margin-top: 1em"><b>mpath</b> -
Multipath nexthop group backed by the hash-threshold
algorithm. The default when the type is unspecified.</p>


<p style="margin-left:45%; margin-top: 1em"><b>resilient</b>
- Resilient nexthop group. Group is resilient to addition
and deletion of nexthops.</p>


<p style="margin-left:32%; margin-top: 1em"><i>TYPE_ARGS</i>
is a set of attributes specific to the <i>TYPE.</i></p>


<p style="margin-left:45%; margin-top: 1em"><b>resilient</b></p>

<p style="margin-left:48%;"><b>buckets</b> <i>BUCKETS</i> -
Number of nexthop buckets. Cannot be changed for an existing
group</p>


<p style="margin-left:48%; margin-top: 1em"><b>idle_timer</b>
<i>IDLE</i> - Time in seconds in which a nexthop bucket does
not see traffic and is therefore considered idle. Default is
120 seconds</p>


<p style="margin-left:48%; margin-top: 1em"><b>unbalanced_timer</b>
<i>UNBALANCED</i> - Time in seconds in which a nexthop group
is unbalanced and is therefore considered unbalanced. The
kernel will try to rebalance unbalanced groups, which might
result in some flows being reset. A value of 0 means that no
rebalancing will take place. Default is 0 seconds</p>

<p style="margin-left:22%;"><b>blackhole</b></p>

<p style="margin-left:32%;">create a blackhole nexthop</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="22%"></td>
<td width="4%">


<p><b>fdb</b></p></td>
<td width="6%"></td>
<td width="68%">


<p>nexthop and nexthop groups for use with layer-2 fdb
entries. A fdb nexthop group can only have fdb nexthops.
Example: Used to represent a vxlan remote vtep ip. layer-2
vxlan fdb entry pointing to an ecmp nexthop group containing
multiple remote vtep ips.</p></td></tr>
</table>

<p style="margin-left:11%;">ip nexthop delete id ID</p>

<p style="margin-left:22%;">delete nexthop with given
id.</p>

<p style="margin-left:11%;">ip nexthop show</p>

<p style="margin-left:22%;">show the contents of the
nexthop table or the nexthops selected by some criteria.
<b><br>
dev</b> <i>DEV</i></p>

<p style="margin-left:32%;">show the nexthops using the
given device.</p>

<p style="margin-left:22%;"><b>vrf</b> <i>NAME</i></p>

<p style="margin-left:32%;">show the nexthops using devices
associated with the vrf name</p>

<p style="margin-left:22%;"><b>master</b> <i>DEV</i></p>

<p style="margin-left:32%;">show the nexthops using devices
enslaved to given master device</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="22%"></td>
<td width="9%">


<p><b>groups</b></p></td>
<td width="1%"></td>
<td width="63%">


<p>show only nexthop groups</p></td>
<td width="5%">
</td></tr>
<tr valign="top" align="left">
<td width="22%"></td>
<td width="9%">


<p><b>fdb</b></p></td>
<td width="1%"></td>
<td width="63%">


<p>show only fdb nexthops and nexthop groups</p></td>
<td width="5%">
</td></tr>
</table>

<p style="margin-left:11%;">ip nexthop flush</p>

<p style="margin-left:22%;">flushes nexthops selected by
some criteria. Criteria options are the same as show.</p>

<p style="margin-left:11%;">ip nexthop get id ID</p>

<p style="margin-left:22%;">get a single nexthop by id</p>

<p style="margin-left:11%;">ip nexthop bucket show</p>

<p style="margin-left:22%;">show the contents of the
nexthop bucket table or the nexthop buckets selected by some
criteria.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="22%"></td>
<td width="7%">


<p><b>id</b> <i>ID</i></p></td>
<td width="3%"></td>
<td width="68%">


<p>show the nexthop buckets that belong to a nexthop group
with a given id</p></td></tr>
</table>

<p style="margin-left:22%;"><b>nhid</b> <i>ID</i></p>

<p style="margin-left:32%;">show the nexthop buckets that
hold a nexthop with a given id</p>

<p style="margin-left:22%;"><b>dev</b> <i>DEV</i></p>

<p style="margin-left:32%;">show the nexthop buckets using
the given device</p>

<p style="margin-left:22%;"><b>vrf</b> <i>NAME</i></p>

<p style="margin-left:32%;">show the nexthop buckets using
devices associated with the vrf name</p>

<p style="margin-left:22%;"><b>master</b> <i>DEV</i></p>

<p style="margin-left:32%;">show the nexthop buckets using
devices enslaved to given master device</p>

<p style="margin-left:11%;">ip nexthop bucket get id ID
index INDEX</p>

<p style="margin-left:22%;">get a single nexthop bucket by
nexthop group id and bucket index</p>

<h2>EXAMPLES
<a name="EXAMPLES"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">ip nexthop
ls</p>

<p style="margin-left:17%;">Show all nexthop entries in the
kernel.</p>

<p style="margin-left:11%; margin-top: 1em">ip nexthop add
id 1 via 192.168.1.1 dev eth0</p>

<p style="margin-left:17%;">Adds an IPv4 nexthop with id 1
using the gateway 192.168.1.1 out device eth0.</p>

<p style="margin-left:11%; margin-top: 1em">ip nexthop add
id 2 encap mpls 200/300 via 10.1.1.1 dev eth0</p>

<p style="margin-left:17%;">Adds an IPv4 nexthop with mpls
encapsulation attributes attached to it.</p>

<p style="margin-left:11%; margin-top: 1em">ip nexthop add
id 3 group 1/2</p>

<p style="margin-left:17%;">Adds a nexthop with id 3. The
nexthop is a group using nexthops with ids 1 and 2 at equal
weight.</p>

<p style="margin-left:11%; margin-top: 1em">ip nexthop add
id 4 group 1,5/2,11</p>

<p style="margin-left:17%;">Adds a nexthop with id 4. The
nexthop is a group using nexthops with ids 1 and 2 with
nexthop 1 at weight 5 and nexthop 2 at weight 11.</p>

<p style="margin-left:11%; margin-top: 1em">ip nexthop add
id 5 via 192.168.1.2 fdb</p>

<p style="margin-left:17%;">Adds a fdb nexthop with id
5.</p>

<p style="margin-left:11%; margin-top: 1em">ip nexthop add
id 7 group 5/6 fdb</p>

<p style="margin-left:17%;">Adds a fdb nexthop group with
id 7. A fdb nexthop group can only have fdb nexthops.</p>

<p style="margin-left:11%; margin-top: 1em">ip nexthop add
id 10 group 1/2 type resilient buckets 32</p>

<p style="margin-left:17%;">Add a resilient nexthop group
with id 10 and 32 nexthop buckets.</p>

<h2>SEE ALSO
<a name="SEE ALSO"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em"><b>ip</b>(8)</p>

<h2>AUTHOR
<a name="AUTHOR"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Original
Manpage by David Ahern &lt;dsahern@kernel.org&gt;</p>
<hr>
</body>
</html>
