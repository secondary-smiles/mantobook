<!-- Creator     : groff version 1.22.4 -->
<!-- CreationDate: Mon May 29 22:57:04 2023 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title>CRYPTSETUP</title>

</head>
<body>
<h1>cryptsetup</h1>



<h2>NAME
<a name="NAME"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">cryptsetup
&minus; manage plain dm&minus;crypt, LUKS, and other
encrypted volumes</p>

<h2>SYNOPSIS
<a name="SYNOPSIS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em"><b>cryptsetup
&lt;action&gt; [&lt;options&gt;] &lt;action args&gt;</b></p>

<h2>DESCRIPTION
<a name="DESCRIPTION"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">cryptsetup is
used to conveniently setup dm&minus;crypt managed
device&minus;mapper mappings. These include plain
dm&minus;crypt volumes and LUKS volumes. The difference is
that LUKS uses a metadata header and can hence offer more
features than plain dm&minus;crypt. On the other hand, the
header is visible and vulnerable to damage.</p>

<p style="margin-left:11%; margin-top: 1em">In addition,
cryptsetup provides limited support for the use of
loop&minus;AES volumes, TrueCrypt, VeraCrypt, BitLocker and
FileVault2 compatible volumes.</p>

<p style="margin-left:11%; margin-top: 1em">For more
information about specific cryptsetup action see
<b>cryptsetup&minus;&lt;action&gt;</b>(8), where
<b>&lt;action&gt;</b> is the name of the cryptsetup
action.</p>

<h2>BASIC ACTIONS
<a name="BASIC ACTIONS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">The following
are valid actions for all supported device types.</p>

<p style="margin-left:11%; margin-top: 1em"><b>OPEN <br>
open &lt;device&gt; &lt;name&gt; &minus;&minus;type
&lt;device_type&gt;</b></p>

<p style="margin-left:11%; margin-top: 1em">Opens (creates
a mapping with) &lt;name&gt; backed by device
&lt;device&gt;. <br>
See <b>cryptsetup&minus;open</b>(8).</p>

<p style="margin-left:11%; margin-top: 1em"><b>CLOSE <br>
close &lt;name&gt;</b></p>

<p style="margin-left:11%; margin-top: 1em">Removes the
existing mapping &lt;name&gt; and wipes the key from kernel
memory. <br>
See <b>cryptsetup&minus;close</b>(8).</p>

<p style="margin-left:11%; margin-top: 1em"><b>STATUS <br>
status &lt;name&gt;</b></p>

<p style="margin-left:11%; margin-top: 1em">Reports the
status for the mapping &lt;name&gt;. <br>
See <b>cryptsetup&minus;status</b>(8).</p>

<p style="margin-left:11%; margin-top: 1em"><b>RESIZE <br>
resize &lt;name&gt;</b></p>

<p style="margin-left:11%; margin-top: 1em">Resizes an
active mapping &lt;name&gt;. <br>
See <b>cryptsetup&minus;resize</b>(8).</p>

<p style="margin-left:11%; margin-top: 1em"><b>REFRESH <br>
refresh &lt;name&gt;</b></p>

<p style="margin-left:11%; margin-top: 1em">Refreshes
parameters of active mapping &lt;name&gt;. <br>
See <b>cryptsetup&minus;refresh</b>(8).</p>

<p style="margin-left:11%; margin-top: 1em"><b>REENCRYPT
<br>
reencrypt &lt;device&gt; or &minus;&minus;active&minus;name
&lt;name&gt; [&lt;new_name&gt;]</b></p>

<p style="margin-left:11%; margin-top: 1em">Run LUKS device
reencryption. <br>
See <b>cryptsetup&minus;reencrypt</b>(8).</p>

<h2>PLAIN MODE
<a name="PLAIN MODE"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Plain
dm&minus;crypt encrypts the device
sector&minus;by&minus;sector with a single, non&minus;salted
hash of the passphrase. No checks are performed, no metadata
is used. There is no formatting operation. When the raw
device is mapped (opened), the usual device operations can
be used on the mapped device, including filesystem creation.
Mapped devices usually reside in
/dev/mapper/&lt;name&gt;.</p>

<p style="margin-left:11%; margin-top: 1em">The following
are valid plain device type actions:</p>

<p style="margin-left:11%; margin-top: 1em"><b>OPEN <br>
open &minus;&minus;type plain &lt;device&gt;
&lt;name&gt;</b> <br>
create &lt;name&gt; &lt;device&gt; (<b>OBSOLETE
syntax</b>)</p>

<p style="margin-left:11%; margin-top: 1em">Opens (creates
a mapping with) &lt;name&gt; backed by device
&lt;device&gt;. <br>
See <b>cryptsetup&minus;open</b>(8).</p>

<h2>LUKS EXTENSION
<a name="LUKS EXTENSION"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">LUKS, the Linux
Unified Key Setup, is a standard for disk encryption. It
adds a standardized header at the start of the device, a
key&minus;slot area directly behind the header and the bulk
data area behind that. The whole set is called a 'LUKS
container'. The device that a LUKS container resides on is
called a 'LUKS device'. For most purposes, both terms can be
used interchangeably. But note that when the LUKS header is
at a nonzero offset in a device, then the device is not a
LUKS device anymore, but has a LUKS container stored in it
at an offset.</p>

<p style="margin-left:11%; margin-top: 1em">LUKS can manage
multiple passphrases that can be individually revoked or
changed and that can be securely scrubbed from persistent
media due to the use of anti&minus;forensic stripes.
Passphrases are protected against brute&minus;force and
dictionary attacks by Password&minus;Based Key Derivation
Function (PBKDF).</p>

<p style="margin-left:11%; margin-top: 1em">LUKS2 is a new
version of header format that allows additional extensions
like different PBKDF algorithm or authenticated encryption.
You can format device with LUKS2 header if you specify
<b>&minus;&minus;type luks2</b> in <b>luksFormat</b>
command. For activation, the format is already recognized
automatically.</p>

<p style="margin-left:11%; margin-top: 1em">Each
passphrase, also called a <b>key</b> in this document, is
associated with one of 8 key&minus;slots. Key operations
that do not specify a slot affect the first slot that
matches the supplied passphrase or the first empty slot if a
new passphrase is added.</p>

<p style="margin-left:11%; margin-top: 1em">The
<b>&lt;device&gt;</b> parameter can also be specified by a
LUKS UUID in the format UUID=&lt;uuid&gt;. Translation to
real device name uses symlinks in /dev/disk/by&minus;uuid
directory.</p>

<p style="margin-left:11%; margin-top: 1em">To specify a
detached header, the <b>&minus;&minus;header</b> parameter
can be used in all LUKS commands and always takes precedence
over the positional <b>&lt;device&gt;</b> parameter.</p>

<p style="margin-left:11%; margin-top: 1em">The following
are valid LUKS actions:</p>

<p style="margin-left:11%; margin-top: 1em"><b>FORMAT <br>
luksFormat &lt;device&gt; [&lt;key file&gt;]</b></p>

<p style="margin-left:11%; margin-top: 1em">Initializes a
LUKS partition and sets the initial passphrase (for
key&minus;slot 0). <br>
See <b>cryptsetup&minus;luksFormat</b>(8).</p>

<p style="margin-left:11%; margin-top: 1em"><b>OPEN <br>
open &minus;&minus;type luks &lt;device&gt; &lt;name&gt;</b>
<br>
luksOpen &lt;device&gt; &lt;name&gt; (<b>old syntax</b>)</p>

<p style="margin-left:11%; margin-top: 1em">Opens the LUKS
device &lt;device&gt; and sets up a mapping &lt;name&gt;
after successful verification of the supplied passphrase.
<br>
See <b>cryptsetup&minus;open</b>(8).</p>

<p style="margin-left:11%; margin-top: 1em"><b>SUSPEND <br>
luksSuspend &lt;name&gt;</b></p>

<p style="margin-left:11%; margin-top: 1em">Suspends an
active device (all IO operations will block and accesses to
the device will wait indefinitely) and wipes the encryption
key from kernel memory. <br>
See <b>cryptsetup&minus;luksSuspend</b>(8).</p>

<p style="margin-left:11%; margin-top: 1em"><b>RESUME <br>
luksResume &lt;name&gt;</b></p>

<p style="margin-left:11%; margin-top: 1em">Resumes a
suspended device and reinstates the encryption key. <br>
See <b>cryptsetup&minus;luksResume</b>(8).</p>

<p style="margin-left:11%; margin-top: 1em"><b>ADD KEY <br>
luksAddKey &lt;device&gt; [&lt;key file with new
key&gt;]</b></p>

<p style="margin-left:11%; margin-top: 1em">Adds a new
passphrase using an existing passphrase. <br>
See <b>cryptsetup&minus;luksAddKey</b>(8).</p>

<p style="margin-left:11%; margin-top: 1em"><b>REMOVE KEY
<br>
luksRemoveKey &lt;device&gt; [&lt;key file with passphrase
to be removed&gt;]</b></p>

<p style="margin-left:11%; margin-top: 1em">Removes the
supplied passphrase from the LUKS device. <br>
See <b>cryptsetup&minus;luksRemoveKey</b>(8).</p>

<p style="margin-left:11%; margin-top: 1em"><b>CHANGE KEY
<br>
luksChangeKey &lt;device&gt; [&lt;new key file&gt;]</b></p>

<p style="margin-left:11%; margin-top: 1em">Changes an
existing passphrase. <br>
See <b>cryptsetup&minus;luksChangeKey</b>(8).</p>

<p style="margin-left:11%; margin-top: 1em"><b>CONVERT KEY
<br>
luksConvertKey &lt;device&gt;</b></p>

<p style="margin-left:11%; margin-top: 1em">Converts an
existing LUKS2 keyslot to new PBKDF parameters. <br>
See <b>cryptsetup&minus;luksConvertKey</b>(8).</p>

<p style="margin-left:11%; margin-top: 1em"><b>KILL SLOT
<br>
luksKillSlot &lt;device&gt; &lt;key slot number&gt;</b></p>

<p style="margin-left:11%; margin-top: 1em">Wipe the
key&minus;slot number &lt;key slot&gt; from the LUKS device.
<br>
See <b>cryptsetup&minus;luksKillSlot</b>(8).</p>

<p style="margin-left:11%; margin-top: 1em"><b>ERASE <br>
erase &lt;device&gt;</b> <br>
luksErase &lt;device&gt; (<b>old syntax</b>)</p>

<p style="margin-left:11%; margin-top: 1em">Erase all
keyslots and make the LUKS container permanently
inaccessible. <br>
See <b>cryptsetup&minus;erase</b>(8).</p>

<p style="margin-left:11%; margin-top: 1em"><b>UUID <br>
luksUUID &lt;device&gt;</b></p>

<p style="margin-left:11%; margin-top: 1em">Print or set
the UUID of a LUKS device. <br>
See <b>cryptsetup&minus;luksUUID</b>(8).</p>

<p style="margin-left:11%; margin-top: 1em"><b>IS LUKS <br>
isLuks &lt;device&gt;</b></p>

<p style="margin-left:11%; margin-top: 1em">Returns true,
if &lt;device&gt; is a LUKS device, false otherwise. <br>
See <b>cryptsetup&minus;isLuks</b>(8).</p>

<p style="margin-left:11%; margin-top: 1em"><b>DUMP <br>
luksDump &lt;device&gt;</b></p>

<p style="margin-left:11%; margin-top: 1em">Dump the header
information of a LUKS device. <br>
See <b>cryptsetup&minus;luksDump</b>(8).</p>

<p style="margin-left:11%; margin-top: 1em"><b>HEADER
BACKUP <br>
luksHeaderBackup &lt;device&gt;
&minus;&minus;header&minus;backup&minus;file
&lt;file&gt;</b></p>

<p style="margin-left:11%; margin-top: 1em">Stores a binary
backup of the LUKS header and keyslot area. <br>
See <b>cryptsetup&minus;luksHeaderBackup</b>(8).</p>

<p style="margin-left:11%; margin-top: 1em"><b>HEADER
RESTORE <br>
luksHeaderRestore &lt;device&gt;
&minus;&minus;header&minus;backup&minus;file
&lt;file&gt;</b></p>

<p style="margin-left:11%; margin-top: 1em">Restores a
binary backup of the LUKS header and keyslot area from the
specified file. <br>
See <b>cryptsetup&minus;luksHeaderRestore</b>(8).</p>

<p style="margin-left:11%; margin-top: 1em"><b>TOKEN <br>
token &lt;add|remove|import|export&gt;
&lt;device&gt;</b></p>

<p style="margin-left:11%; margin-top: 1em">Manipulate
token objects used for obtaining passphrases. <br>
See <b>cryptsetup&minus;token</b>(8).</p>

<p style="margin-left:11%; margin-top: 1em"><b>CONVERT <br>
convert &lt;device&gt; &minus;&minus;type
&lt;format&gt;</b></p>

<p style="margin-left:11%; margin-top: 1em">Converts the
device between LUKS1 and LUKS2 format (if possible). <br>
See <b>cryptsetup&minus;convert</b>(8).</p>

<p style="margin-left:11%; margin-top: 1em"><b>CONFIG <br>
config &lt;device&gt;</b></p>

<p style="margin-left:11%; margin-top: 1em">Set permanent
configuration options (store to LUKS header). <br>
See <b>cryptsetup&minus;config</b>(8).</p>

<h2>LOOP&minus;AES EXTENSION
<a name="LOOP&minus;AES EXTENSION"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">cryptsetup
supports mapping loop&minus;AES encrypted partition using a
compatibility mode.</p>

<p style="margin-left:11%; margin-top: 1em"><b>OPEN <br>
open &minus;&minus;type loopaes &lt;device&gt; &lt;name&gt;
&minus;&minus;key&minus;file &lt;keyfile&gt;</b> <br>
loopaesOpen &lt;device&gt; &lt;name&gt;
&minus;&minus;key&minus;file &lt;keyfile&gt; (<b>old
syntax</b>)</p>

<p style="margin-left:11%; margin-top: 1em">Opens the
loop&minus;AES &lt;device&gt; and sets up a mapping
&lt;name&gt;. <br>
See <b>cryptsetup&minus;open</b>(8).</p>

<p style="margin-left:11%; margin-top: 1em">See also
section 7 of the FAQ and <i>loop&minus;AES</i>
&lt;http://loop&minus;aes.sourceforge.net&gt; for more
information regarding loop&minus;AES.</p>

<h2>TCRYPT (TRUECRYPT AND VERACRYPT COMPATIBLE) EXTENSION
<a name="TCRYPT (TRUECRYPT AND VERACRYPT COMPATIBLE) EXTENSION"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">cryptsetup
supports mapping of TrueCrypt, tcplay or VeraCrypt encrypted
partition using a native Linux kernel API. Header formatting
and TCRYPT header change is not supported, cryptsetup never
changes TCRYPT header on&minus;device.</p>

<p style="margin-left:11%; margin-top: 1em">TCRYPT
extension requires kernel userspace crypto API to be
available (introduced in Linux kernel 2.6.38). If you are
configuring kernel yourself, enable &quot;User&minus;space
interface for symmetric key cipher algorithms&quot; in
&quot;Cryptographic API&quot; section
(CRYPTO_USER_API_SKCIPHER .config option).</p>

<p style="margin-left:11%; margin-top: 1em">Because TCRYPT
header is encrypted, you have to always provide valid
passphrase and keyfiles.</p>

<p style="margin-left:11%; margin-top: 1em">Cryptsetup
should recognize all header variants, except legacy cipher
chains using LRW encryption mode with 64 bits encryption
block (namely Blowfish in LRW mode is not recognized, this
is limitation of kernel crypto API).</p>

<p style="margin-left:11%; margin-top: 1em">VeraCrypt is
extension of TrueCrypt header with increased iteration count
so unlocking can take quite a lot of time.</p>

<p style="margin-left:11%; margin-top: 1em">To open a
VeraCrypt device with a custom Personal Iteration Multiplier
(PIM) value, use either the
<b>&minus;&minus;veracrypt&minus;pim=&lt;PIM&gt;</b> option
to directly specify the PIM on the command&minus; line or
use <b>&minus;&minus;veracrypt&minus;query&minus;pim</b> to
be prompted for the PIM.</p>

<p style="margin-left:11%; margin-top: 1em">The PIM value
affects the number of iterations applied during key
derivation. Please refer to <i>PIM</i>
&lt;https://www.veracrypt.fr/en/Personal%20Iterations%20Multiplier%20%28PIM%29.html&gt;
for more detailed information.</p>

<p style="margin-left:11%; margin-top: 1em">If you need to
disable VeraCrypt device support, use
<b>&minus;&minus;disable&minus;veracrypt</b> option.</p>

<p style="margin-left:11%; margin-top: 1em"><b>NOTE:</b>
Activation with <b>tcryptOpen</b> is supported only for
cipher chains using LRW or XTS encryption modes.</p>

<p style="margin-left:11%; margin-top: 1em">The
<b>tcryptDump</b> command should work for all recognized
TCRYPT devices and doesn&rsquo;t require superuser
privilege.</p>

<p style="margin-left:11%; margin-top: 1em">To map system
device (device with boot loader where the whole encrypted
system resides) use <b>&minus;&minus;tcrypt&minus;system</b>
option. You can use partition device as the parameter
(parameter must be real partition device, not an image in a
file), then only this partition is mapped.</p>

<p style="margin-left:11%; margin-top: 1em">If you have the
whole TCRYPT device as a file image and you want to map
multiple partition encrypted with system encryption, please
create loopback mapping with partitions first (<b>losetup
&minus;P</b>, see <b>losetup(8)</b> man page for more info),
and use loop partition as the device parameter.</p>

<p style="margin-left:11%; margin-top: 1em">If you use the
whole base device as a parameter, one device for the whole
system encryption is mapped. This mode is available only for
backward compatibility with older cryptsetup versions which
mapped TCRYPT system encryption using the whole device.</p>

<p style="margin-left:11%; margin-top: 1em">To use hidden
header (and map hidden device, if available), use
<b>&minus;&minus;tcrypt&minus;hidden</b> option.</p>

<p style="margin-left:11%; margin-top: 1em">To explicitly
use backup (secondary) header, use
<b>&minus;&minus;tcrypt&minus;backup</b> option.</p>

<p style="margin-left:11%; margin-top: 1em"><b>NOTE:</b>
There is no protection for a hidden volume if the outer
volume is mounted. The reason is that if there were any
protection, it would require some metadata describing what
to protect in the outer volume and the hidden volume would
become detectable.</p>

<p style="margin-left:11%; margin-top: 1em"><b>OPEN <br>
open &minus;&minus;type tcrypt &lt;device&gt;
&lt;name&gt;</b> <br>
tcryptOpen_ &lt;device&gt; &lt;name&gt; (<b>old
syntax</b>)</p>

<p style="margin-left:11%; margin-top: 1em">Opens the
TCRYPT (a TrueCrypt&minus;compatible) &lt;device&gt; and
sets up a mapping &lt;name&gt;. <br>
See <b>cryptsetup&minus;open</b>(8).</p>

<p style="margin-left:11%; margin-top: 1em"><b>DUMP <br>
tcryptDump &lt;device&gt;</b></p>

<p style="margin-left:11%; margin-top: 1em">Dump the header
information of a TCRYPT device. <br>
See <b>cryptsetup&minus;tcryptDump</b>(8).</p>

<p style="margin-left:11%; margin-top: 1em">See also
<b>TrueCrypt &lt;https://en.wikipedia.org/wiki/TrueCrypt&gt;
and VeraCrypt
&lt;https://en.wikipedia.org/wiki/VeraCrypt&gt; pages for
more information.</b></p>

<p style="margin-left:11%; margin-top: 1em"><b>Please note
that cryptsetup does not use TrueCrypt or VeraCrypt code,
please report all problems related to this compatibility
extension to the cryptsetup project.</b></p>

<h2>BITLK (WINDOWS BITLOCKER COMPATIBLE) EXTENSION
<a name="BITLK (WINDOWS BITLOCKER COMPATIBLE) EXTENSION"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">cryptsetup
supports mapping of BitLocker and BitLocker to Go encrypted
partition using a native Linux kernel API. Header formatting
and BITLK header changes are not supported, cryptsetup never
changes BITLK header on&minus;device.</p>

<p style="margin-left:11%; margin-top: 1em">BITLK extension
requires kernel userspace crypto API to be available (for
details see TCRYPT section).</p>

<p style="margin-left:11%; margin-top: 1em">Cryptsetup
should recognize all BITLK header variants, except legacy
header used in Windows Vista systems and partially decrypted
BitLocker devices. Activation of legacy devices encrypted in
CBC mode requires at least Linux kernel version 5.3 and for
devices using Elephant diffuser kernel 5.6.</p>

<p style="margin-left:11%; margin-top: 1em">The
<b>bitlkDump</b> command should work for all recognized
BITLK devices and doesn&rsquo;t require superuser
privilege.</p>

<p style="margin-left:11%; margin-top: 1em">For unlocking
with the <b>open</b> a password or a recovery passphrase or
a startup key must be provided.</p>

<p style="margin-left:11%; margin-top: 1em">Additionally
unlocking using volume key is supported. You must provide
BitLocker Full Volume Encryption Key (FVEK) using the
&minus;&minus;volume&minus;key&minus;file option. The key
must be decrypted and without the header (only 128/256/512
bits of key data depending on used cipher and mode).</p>

<p style="margin-left:11%; margin-top: 1em">Other unlocking
methods (TPM, SmartCard) are not supported.</p>

<p style="margin-left:11%; margin-top: 1em"><b>OPEN <br>
open &minus;&minus;type bitlk &lt;device&gt;
&lt;name&gt;</b> <br>
bitlkOpen &lt;device&gt; &lt;name&gt; (<b>old
syntax</b>)</p>

<p style="margin-left:11%; margin-top: 1em">Opens the BITLK
(a BitLocker&minus;compatible) &lt;device&gt; and sets up a
mapping &lt;name&gt;. <br>
See <b>cryptsetup&minus;open</b>(8).</p>

<p style="margin-left:11%; margin-top: 1em"><b>DUMP <br>
bitlkDump &lt;device&gt;</b></p>

<p style="margin-left:11%; margin-top: 1em">Dump the header
information of a BITLK device. <br>
See <b>cryptsetup&minus;bitlkDump</b>(8).</p>

<p style="margin-left:11%; margin-top: 1em">Please note
that cryptsetup does not use any Windows BitLocker code,
please report all problems related to this compatibility
extension to the cryptsetup project.</p>

<h2>FVAULT2 (APPLE MACOS FILEVAULT2 COMPATIBLE) EXTENSION
<a name="FVAULT2 (APPLE MACOS FILEVAULT2 COMPATIBLE) EXTENSION"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">cryptsetup
supports the mapping of FileVault2 (FileVault2
full&minus;disk encryption) by Apple for the macOS operating
system using a native Linux kernel API.</p>

<p style="margin-left:11%; margin-top: 1em"><b>NOTE:</b>
cryptsetup supports only FileVault2 based on Core Storage
and HFS+ filesystem (introduced in MacOS X 10.7 Lion). It
does NOT support the new version of FileVault based on the
APFS filesystem used in recent macOS versions.</p>

<p style="margin-left:11%; margin-top: 1em">Header
formatting and FVAULT2 header changes are not supported;
cryptsetup never changes the FVAULT2 header
on&minus;device.</p>

<p style="margin-left:11%; margin-top: 1em">FVAULT2
extension requires kernel userspace crypto API to be
available (for details, see TCRYPT section) and kernel
driver for HFS+ (hfsplus) filesystem.</p>

<p style="margin-left:11%; margin-top: 1em">Cryptsetup
should recognize the basic configuration for portable
drives.</p>

<p style="margin-left:11%; margin-top: 1em">The
<b>fvault2Dump</b> command should work for all recognized
FVAULT2 devices and doesn&rsquo;t require superuser
privilege.</p>

<p style="margin-left:11%; margin-top: 1em">For unlocking
with the <b>open</b>, a password must be provided. Other
unlocking methods are not supported.</p>

<p style="margin-left:11%; margin-top: 1em"><b>OPEN <br>
open &minus;&minus;type fvault2 &lt;device&gt;
&lt;name&gt;</b> <br>
fvault2Open &lt;device&gt; &lt;name&gt; (<b>old
syntax</b>)</p>

<p style="margin-left:11%; margin-top: 1em">Opens the
FVAULT2 (a FileVault2&minus;compatible) &lt;device&gt;
(usually the second partition on the device) and sets up a
mapping &lt;name&gt;. <br>
See <b>cryptsetup&minus;open</b>(8).</p>

<p style="margin-left:11%; margin-top: 1em"><b>DUMP <br>
fvault2Dump &lt;device&gt;</b></p>

<p style="margin-left:11%; margin-top: 1em">Dump the header
information of an FVAULT2 device. <br>
See <b>cryptsetup&minus;fvault2Dump</b>(8).</p>

<p style="margin-left:11%; margin-top: 1em">Note that
cryptsetup does not use any macOS code or proprietary
specifications. Please report all problems related to this
compatibility extension to the cryptsetup project.</p>

<h2>MISCELLANEOUS ACTIONS
<a name="MISCELLANEOUS ACTIONS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em"><b>REPAIR <br>
repair &lt;device&gt;</b></p>

<p style="margin-left:11%; margin-top: 1em">Tries to repair
the device metadata if possible. Currently supported only
for LUKS device type. <br>
See <b>cryptsetup&minus;repair</b>(8).</p>

<p style="margin-left:11%; margin-top: 1em"><b>BENCHMARK
<br>
benchmark &lt;options&gt;</b></p>

<p style="margin-left:11%; margin-top: 1em">Benchmarks
ciphers and KDF (key derivation function). <br>
See <b>cryptsetup&minus;benchmark</b>(8).</p>

<h2>PLAIN DM&minus;CRYPT OR LUKS?
<a name="PLAIN DM&minus;CRYPT OR LUKS?"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Unless you
understand the cryptographic background well, use LUKS. With
plain dm&minus;crypt there are a number of possible user
errors that massively decrease security. While LUKS cannot
fix them all, it can lessen the impact for many of them.</p>

<h2>WARNINGS
<a name="WARNINGS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">A lot of good
information on the risks of using encrypted storage, on
handling problems and on security aspects can be found in
the Cryptsetup FAQ. Read it. Nonetheless, some risks deserve
to be mentioned here.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Backup:</b>
Storage media die. Encryption has no influence on that.
Backup is mandatory for encrypted data as well, if the data
has any worth. See the Cryptsetup FAQ for advice on how to
do a backup of an encrypted volume.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Character
encoding:</b> If you enter a passphrase with special
symbols, the passphrase can change depending on character
encoding. Keyboard settings can also change, which can make
blind input hard or impossible. For example, switching from
some ASCII 8&minus;bit variant to UTF&minus;8 can lead to a
different binary encoding and hence different passphrase
seen by cryptsetup, even if what you see on the terminal is
exactly the same. It is therefore highly recommended to
select passphrase characters only from 7&minus;bit ASCII, as
the encoding for 7&minus;bit ASCII stays the same for all
ASCII variants and UTF&minus;8.</p>

<p style="margin-left:11%; margin-top: 1em"><b>LUKS
header:</b> If the header of a LUKS volume gets damaged, all
data is permanently lost unless you have a
header&minus;backup. If a key&minus;slot is damaged, it can
only be restored from a header&minus;backup or if another
active key&minus;slot with known passphrase is undamaged.
Damaging the LUKS header is something people manage to do
with surprising frequency. This risk is the result of a
trade&minus;off between security and safety, as LUKS is
designed for fast and secure wiping by just overwriting
header and key&minus;slot area.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Previously
used partitions:</b> If a partition was previously used, it
is a very good idea to wipe filesystem signatures, data,
etc. before creating a LUKS or plain dm&minus;crypt
container on it. For a quick removal of filesystem
signatures, use <b>wipefs</b>(8). Take care though that this
may not remove everything. In particular, MD RAID signatures
at the end of a device may survive. It also does not remove
data. For a full wipe, overwrite the whole partition before
container creation. If you do not know how to do that, the
cryptsetup FAQ describes several options.</p>

<h2>EXAMPLES
<a name="EXAMPLES"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Example 1:
Create LUKS 2 container on block device /dev/sdX.</p>

<p style="margin-left:17%;">sudo cryptsetup
&minus;&minus;type luks2 luksFormat /dev/sdX</p>

<p style="margin-left:11%; margin-top: 1em">Example 2: Add
an additional passphrase to key slot 5.</p>

<p style="margin-left:17%;">sudo cryptsetup luksAddKey
&minus;&minus;key&minus;slot 5 /dev/sdX</p>

<p style="margin-left:11%; margin-top: 1em">Example 3:
Create LUKS header backup and save it to file.</p>

<p style="margin-left:17%;">sudo cryptsetup
luksHeaderBackup /dev/sdX
&minus;&minus;header&minus;backup&minus;file
/var/tmp/NameOfBackupFile</p>

<p style="margin-left:11%; margin-top: 1em">Example 4: Open
LUKS container on /dev/sdX and map it to sdX_crypt.</p>

<p style="margin-left:17%;">sudo cryptsetup open /dev/sdX
sdX_crypt</p>

<p style="margin-left:11%; margin-top: 1em"><b>WARNING: The
command in example 5 will erase all key slots.</b></p>

<p style="margin-left:17%;">Your cannot use your LUKS
container afterward anymore unless you have a backup to
restore.</p>

<p style="margin-left:11%; margin-top: 1em">Example 5:
Erase all key slots on /dev/sdX.</p>

<p style="margin-left:17%;">sudo cryptsetup erase
/dev/sdX</p>

<p style="margin-left:11%; margin-top: 1em">Example 6:
Restore LUKS header from backup file.</p>

<p style="margin-left:17%;">sudo cryptsetup
luksHeaderRestore /dev/sdX
&minus;&minus;header&minus;backup&minus;file
/var/tmp/NameOfBackupFile</p>

<h2>RETURN CODES
<a name="RETURN CODES"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Cryptsetup
returns <b>0</b> on success and a non&minus;zero value on
error.</p>

<p style="margin-left:11%; margin-top: 1em">Error codes
are: <b>1</b> wrong parameters, <b>2</b> no permission (bad
passphrase), <b>3</b> out of memory, <b>4</b> wrong device
specified, <b>5</b> device already exists or device is
busy.</p>

<h2>NOTES
<a name="NOTES"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em"><b>Passphrase
processing for PLAIN mode</b> <br>
Note that no iterated hashing or salting is done in plain
mode. If hashing is done, it is a single direct hash. This
means that low&minus;entropy passphrases are easy to attack
in plain mode.</p>

<p style="margin-left:11%; margin-top: 1em"><b>From a
terminal</b>: The passphrase is read until the first
newline, i.e. '\n'. The input without the newline character
is processed with the default hash or the hash specified
with &minus;&minus;hash. The hash result will be truncated
to the key size of the used cipher, or the size specified
with &minus;s.</p>

<p style="margin-left:11%; margin-top: 1em"><b>From
stdin</b>: Reading will continue until a newline (or until
the maximum input size is reached), with the trailing
newline stripped. The maximum input size is defined by the
same compiled&minus;in default as for the maximum key file
size and can be overwritten using
&minus;&minus;keyfile&minus;size option.</p>

<p style="margin-left:11%; margin-top: 1em">The data read
will be hashed with the default hash or the hash specified
with &minus;&minus;hash. The hash result will be truncated
to the key size of the used cipher, or the size specified
with &minus;s.</p>

<p style="margin-left:11%; margin-top: 1em">Note that if
&minus;&minus;key&minus;file=&minus; is used for reading the
key from stdin, trailing newlines are not stripped from the
input.</p>

<p style="margin-left:11%; margin-top: 1em">If
&quot;plain&quot; is used as argument to &minus;&minus;hash,
the input data will not be hashed. Instead, it will be zero
padded (if shorter than the key size) or truncated (if
longer than the key size) and used directly as the binary
key. This is useful for directly specifying a binary key. No
warning will be given if the amount of data read from stdin
is less than the key size.</p>

<p style="margin-left:11%; margin-top: 1em"><b>From a key
file</b>: It will be truncated to the key size of the used
cipher or the size given by &minus;s and directly used as a
binary key.</p>


<p style="margin-left:11%; margin-top: 1em"><b>WARNING</b>:
The &minus;&minus;hash argument is being ignored. The
&minus;&minus;hash option is usable only for stdin input in
plain mode.</p>

<p style="margin-left:11%; margin-top: 1em">If the key file
is shorter than the key, cryptsetup will quit with an error.
The maximum input size is defined by the same
compiled&minus;in default as for the maximum key file size
and can be overwritten using
&minus;&minus;keyfile&minus;size option.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Passphrase
processing for LUKS</b> <br>
LUKS uses PBKDF to protect against dictionary attacks and to
give some protection to low&minus;entropy passphrases (see
cryptsetup FAQ).</p>

<p style="margin-left:11%; margin-top: 1em"><b>From a
terminal</b>: The passphrase is read until the first newline
and then processed by PBKDF2 without the newline
character.</p>

<p style="margin-left:11%; margin-top: 1em"><b>From
stdin</b>: LUKS will read passphrases from stdin up to the
first newline character or the compiled&minus;in maximum key
file length. If &minus;&minus;keyfile&minus;size is given,
it is ignored.</p>

<p style="margin-left:11%; margin-top: 1em"><b>From key
file</b>: The complete keyfile is read up to the
compiled&minus;in maximum size. Newline characters do not
terminate the input. The &minus;&minus;keyfile&minus;size
option can be used to limit what is read.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Passphrase
processing</b>: Whenever a passphrase is added to a LUKS
header (luksAddKey, luksFormat), the user may specify how
much the time the passphrase processing should consume. The
time is used to determine the iteration count for PBKDF2 and
higher times will offer better protection for
low&minus;entropy passphrases, but open will take longer to
complete. For passphrases that have entropy higher than the
used key length, higher iteration times will not increase
security.</p>

<p style="margin-left:11%; margin-top: 1em">The default
setting of one or two seconds is sufficient for most
practical cases. The only exception is a low&minus;entropy
passphrase used on a device with a slow CPU, as this will
result in a low iteration count. On a slow device, it may be
advisable to increase the iteration time using the
&minus;&minus;iter&minus;time option in order to obtain a
higher iteration count. This does slow down all later
luksOpen operations accordingly.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Incoherent
behavior for invalid passphrases/keys</b> <br>
LUKS checks for a valid passphrase when an encrypted
partition is unlocked. The behavior of plain dm&minus;crypt
is different. It will always decrypt with the passphrase
given. If the given passphrase is wrong, the device mapped
by plain dm&minus;crypt will essentially still contain
encrypted data and will be unreadable.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Supported
ciphers, modes, hashes and key sizes</b> <br>
The available combinations of ciphers, modes, hashes and key
sizes depend on kernel support. See /proc/crypto for a list
of available options. You might need to load additional
kernel crypto modules in order to get more options.</p>

<p style="margin-left:11%; margin-top: 1em">For the
&minus;&minus;hash option, if the crypto backend is
libgcrypt, then all algorithms supported by the gcrypt
library are available. For other crypto backends, some
algorithms may be missing.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Notes on
passphrases</b> <br>
Mathematics can&rsquo;t be bribed. Make sure you keep your
passphrases safe. There are a few nice tricks for
constructing a fallback, when suddenly out of the blue, your
brain refuses to cooperate. These fallbacks need LUKS, as
it&rsquo;s only possible with LUKS to have multiple
passphrases. Still, if your attacker model does not prevent
it, storing your passphrase in a sealed envelope somewhere
may be a good idea as well.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Notes on
Random Number Generators</b> <br>
Random Number Generators (RNG) used in cryptsetup are always
the kernel RNGs without any modifications or additions to
data stream produced.</p>

<p style="margin-left:11%; margin-top: 1em">There are two
types of randomness cryptsetup/LUKS needs. One type (which
always uses /dev/urandom) is used for salts, the AF splitter
and for wiping deleted keyslots.</p>

<p style="margin-left:11%; margin-top: 1em">The second type
is used for the volume key. You can switch between using
/dev/random and /dev/urandom here, see
<b>&minus;&minus;use&minus;random</b> and
<b>&minus;&minus;use&minus;urandom</b> options. Using
/dev/random on a system without enough entropy sources can
cause <b>luksFormat</b> to block until the requested amount
of random data is gathered. In a low&minus;entropy situation
(embedded system), this can take a very long time and
potentially forever. At the same time, using /dev/urandom in
a low&minus;entropy situation will produce low&minus;quality
keys. This is a serious problem, but solving it is out of
scope for a mere man&minus;page. See <b>urandom(4)</b> for
more information.</p>


<p style="margin-left:11%; margin-top: 1em"><b>Authenticated
disk encryption (EXPERIMENTAL)</b> <br>
Since Linux kernel version 4.12 dm&minus;crypt supports
authenticated disk encryption.</p>

<p style="margin-left:11%; margin-top: 1em">Normal disk
encryption modes are length&minus;preserving (plaintext
sector is of the same size as a ciphertext sector) and can
provide only confidentiality protection, but not
cryptographically sound data integrity protection.</p>

<p style="margin-left:11%; margin-top: 1em">Authenticated
modes require additional space per&minus;sector for
authentication tag and use Authenticated Encryption with
Additional Data (AEAD) algorithms.</p>

<p style="margin-left:11%; margin-top: 1em">If you
configure LUKS2 device with data integrity protection, there
will be an underlying dm&minus;integrity device, which
provides additional per&minus;sector metadata space and also
provide data journal protection to ensure atomicity of data
and metadata update. Because there must be additional space
for metadata and journal, the available space for the device
will be smaller than for length&minus;preserving modes.</p>

<p style="margin-left:11%; margin-top: 1em">The
dm&minus;crypt device then resides on top of such a
dm&minus;integrity device. All activation and deactivation
of this device stack is performed by cryptsetup, there is no
difference in using <b>luksOpen</b> for integrity protected
devices. If you want to format LUKS2 device with data
integrity protection, use <b>&minus;&minus;integrity</b>
option.</p>

<p style="margin-left:11%; margin-top: 1em">Since
dm&minus;integrity doesn&rsquo;t support discards (TRIM),
dm&minus;crypt device on top of it inherits this, so
integrity protection mode doesn&rsquo;t support discards
either.</p>

<p style="margin-left:11%; margin-top: 1em">Some integrity
modes requires two independent keys (key for encryption and
for authentication). Both these keys are stored in one LUKS
keyslot.</p>


<p style="margin-left:11%; margin-top: 1em"><b>WARNING:</b>
All support for authenticated modes is experimental and
there are only some modes available for now. Note that there
are a very few authenticated encryption algorithms that are
suitable for disk encryption. You also cannot use CRC32 or
any other non&minus;cryptographic checksums (other than the
special integrity mode &quot;none&quot;). If for some reason
you want to have integrity control without using
authentication mode, then you should separately configure
dm&minus;integrity independently of LUKS2.</p>

<p style="margin-left:11%; margin-top: 1em"><b>Notes on
loopback device use</b> <br>
Cryptsetup is usually used directly on a block device (disk
partition or LVM volume). However, if the device argument is
a file, cryptsetup tries to allocate a loopback device and
map it into this file. This mode requires Linux kernel
2.6.25 or more recent which supports the loop autoclear flag
(loop device is cleared on the last close automatically). Of
course, you can always map a file to a loop&minus;device
manually. See the cryptsetup FAQ for an example.</p>

<p style="margin-left:11%; margin-top: 1em">When device
mapping is active, you can see the loop backing file in the
status command output. Also see losetup(8).</p>

<p style="margin-left:11%; margin-top: 1em"><b>LUKS2 header
locking</b> <br>
The LUKS2 on&minus;disk metadata is updated in several steps
and to achieve proper atomic update, there is a locking
mechanism. For an image in file, code uses <b>flock(2)</b>
system call. For a block device, lock is performed over a
special file stored in a locking directory (by default
<b>/run/cryptsetup</b>). The locking directory should be
created with the proper security context by the distribution
during the boot&minus;up phase. Only LUKS2 uses locks, other
formats do not use this mechanism.</p>

<p style="margin-left:11%; margin-top: 1em"><b>LUKS
on&minus;disk format specification</b> <br>
For LUKS on&minus;disk metadata specification see <b>LUKS1
&lt;https://gitlab.com/cryptsetup/cryptsetup/wikis/Specification&gt;
and LUKS2
&lt;https://gitlab.com/cryptsetup/LUKS2&minus;docs&gt;.</b></p>

<h2>AUTHORS
<a name="AUTHORS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Cryptsetup is
originally written by <i>Jana Saout</i>
&lt;jana@saout.de&gt;. <br>
The LUKS extensions and original man page were written by
<i>Clemens Fruhwirth</i> &lt;clemens@endorphin.org&gt;. <br>
Man page extensions by <i>Milan Broz</i>
&lt;gmazyland@gmail.com&gt;. <br>
Man page rewrite and extension by <i>Arno Wagner</i>
&lt;arno@wagner.name&gt;.</p>

<h2>REPORTING BUGS
<a name="REPORTING BUGS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Report bugs at
<b>cryptsetup mailing list
&lt;cryptsetup@lists.linux.dev&gt; or in Issues project
section
&lt;https://gitlab.com/cryptsetup/cryptsetup/&minus;/issues/new&gt;.</b></p>

<p style="margin-left:11%; margin-top: 1em"><b>Please
attach output of the failed command with &minus;&minus;debug
option added.</b></p>

<h2>SEE ALSO
<a name="SEE ALSO"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em"><b>Cryptsetup
FAQ
&lt;https://gitlab.com/cryptsetup/cryptsetup/wikis/FrequentlyAskedQuestions&gt;</b></p>


<p style="margin-left:11%; margin-top: 1em"><b>cryptsetup(8),
integritysetup(8) and veritysetup(8)</b></p>

<h2>CRYPTSETUP
<a name="CRYPTSETUP"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Part of
<b>cryptsetup project
&lt;https://gitlab.com/cryptsetup/cryptsetup/&gt;.</b></p>
<hr>
</body>
</html>
