<!-- Creator     : groff version 1.22.4 -->
<!-- CreationDate: Mon May 29 22:57:04 2023 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title>CRYPTSETUP&minus;LUKSADDKEY</title>

</head>
<body>
<h1>cryptsetup-luksAddKey</h1>



<h2>NAME
<a name="NAME"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em">cryptsetup-luksAddKey
&minus; add a new passphrase</p>

<h2>SYNOPSIS
<a name="SYNOPSIS"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em"><b>cryptsetup</b>
<i>luksAddKey</i> <b>[&lt;options&gt;] &lt;device&gt;
[&lt;key file with new key&gt;]</b></p>

<h2>DESCRIPTION
<a name="DESCRIPTION"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Adds a keyslot
protected by a new passphrase. An existing passphrase must
be supplied interactively, via &minus;&minus;key&minus;file
or LUKS2 token (plugin). Alternatively to existing
passphrase user may pass directly volume key (via
&minus;&minus;volume&minus;key&minus;file). The new
passphrase to be added can be specified interactively, read
from the file given as the positional argument (also via
&minus;&minus;new&minus;keyfile parameter) or via LUKS2
token.</p>

<p style="margin-left:11%; margin-top: 1em"><b>NOTE:</b>
with &minus;&minus;unbound option the action creates new
unbound LUKS2 keyslot. The keyslot cannot be used for device
activation. If you don&rsquo;t pass new key via
&minus;&minus;volume&minus;key&minus;file option, new random
key is generated. Existing passphrase for any active keyslot
is not required.</p>

<p style="margin-left:11%; margin-top: 1em"><b>NOTE:</b>
some parameters are effective only if used with LUKS2 format
that supports per&minus;keyslot parameters. For LUKS1, PBKDF
type and hash algorithm is always the same for all
keyslots.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&lt;options&gt;</b>
can be [&minus;&minus;key&minus;file,
&minus;&minus;keyfile&minus;offset,
&minus;&minus;keyfile&minus;size,
&minus;&minus;new&minus;keyfile,
&minus;&minus;new&minus;keyfile&minus;offset,
&minus;&minus;new&minus;keyfile&minus;size,
&minus;&minus;key&minus;slot,
&minus;&minus;new&minus;key&minus;slot,
&minus;&minus;volume&minus;key&minus;file,
&minus;&minus;force&minus;password, &minus;&minus;hash,
&minus;&minus;header, &minus;&minus;disable&minus;locks,
&minus;&minus;iter&minus;time, &minus;&minus;pbkdf,
&minus;&minus;pbkdf&minus;force&minus;iterations,
&minus;&minus;pbkdf&minus;memory,
&minus;&minus;pbkdf&minus;parallel, &minus;&minus;unbound,
&minus;&minus;type, &minus;&minus;keyslot&minus;cipher,
&minus;&minus;keyslot&minus;key&minus;size,
&minus;&minus;key&minus;size, &minus;&minus;timeout,
&minus;&minus;token&minus;id,
&minus;&minus;token&minus;type,
&minus;&minus;token&minus;only,
&minus;&minus;new&minus;token&minus;id,
&minus;&minus;verify&minus;passphrase].</p>

<h2>OPTIONS
<a name="OPTIONS"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;type
&lt;device&minus;type&gt;</b></p>

<p style="margin-left:17%;">Specifies required device type,
for more info read <i>BASIC ACTIONS</i> section in
<b>cryptsetup</b>(8).</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;hash,
&minus;h</b> <i>&lt;hash&minus;spec&gt;</i></p>

<p style="margin-left:17%;">The specified hash is used for
PBKDF2 and AF splitter.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;verify&minus;passphrase,
&minus;y</b></p>

<p style="margin-left:17%;">When interactively asking for a
passphrase, ask for it twice and complain if both inputs do
not match. Ignored on input from file or stdin.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;key&minus;file,
&minus;d</b> <i>name</i></p>

<p style="margin-left:17%;">Read the passphrase from
file.</p>

<p style="margin-left:17%; margin-top: 1em">If the name
given is &quot;&minus;&quot;, then the passphrase will be
read from stdin. In this case, reading will not stop at
newline characters.</p>

<p style="margin-left:17%; margin-top: 1em">The passphrase
supplied via &minus;&minus;key&minus;file is always the
passphrase for existing keyslot requested by the
command.</p>

<p style="margin-left:17%; margin-top: 1em">If you want to
set a new passphrase via key file, you have to use a
positional argument or parameter
&minus;&minus;new&minus;keyfile.</p>

<p style="margin-left:17%; margin-top: 1em">See section
<i>NOTES ON PASSPHRASE PROCESSING</i> in
<b>cryptsetup</b>(8) for more information.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;keyfile&minus;offset</b>
<i>value</i></p>

<p style="margin-left:17%;">Skip <i>value</i> bytes at the
beginning of the key file.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;keyfile&minus;size,
&minus;l</b> <i>value</i></p>

<p style="margin-left:17%;">Read a maximum of <i>value</i>
bytes from the key file. The default is to read the whole
file up to the compiled&minus;in maximum that can be queried
with &minus;&minus;help. Supplying more data than the
compiled&minus;in maximum aborts the operation.</p>

<p style="margin-left:17%; margin-top: 1em">This option is
useful to cut trailing newlines, for example. If
&minus;&minus;keyfile&minus;offset is also given, the size
count starts after the offset.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;new&minus;keyfile</b>
<i>name</i></p>

<p style="margin-left:17%;">Read the passphrase for a new
keyslot from file.</p>

<p style="margin-left:17%; margin-top: 1em">If the name
given is &quot;&minus;&quot;, then the passphrase will be
read from stdin. In this case, reading will not stop at
newline characters.</p>

<p style="margin-left:17%; margin-top: 1em">This is
alternative method to positional argument when adding new
passphrase via kefile.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;new&minus;keyfile&minus;offset</b>
<i>value</i></p>

<p style="margin-left:17%;">Skip <i>value</i> bytes at the
start when adding a new passphrase from key file.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;new&minus;keyfile&minus;size</b>
<i>value</i></p>

<p style="margin-left:17%;">Read a maximum of <i>value</i>
bytes when adding a new passphrase from key file. The
default is to read the whole file up to the
compiled&minus;in maximum length that can be queried with
&minus;&minus;help. Supplying more than the compiled in
maximum aborts the operation. When
&minus;&minus;new&minus;keyfile&minus;offset is also given,
reading starts after the offset.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;volume&minus;key&minus;file,
&minus;&minus;master&minus;key&minus;file (OBSOLETE
alias)</b></p>

<p style="margin-left:17%;">Use a volume key stored in a
file. This allows adding a new keyslot without having to
know passphrase to existing one. It may be also used when no
keyslot is active.</p>


<p style="margin-left:17%; margin-top: 1em"><b>WARNING:</b>
If you create your own volume key, you need to make sure to
do it right. Otherwise, you can end up with a
low&minus;entropy or otherwise partially predictable volume
key which will compromise security.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;key&minus;slot,
&minus;S &lt;0&minus;N&gt;</b></p>

<p style="margin-left:17%;">When used together with
parameter &minus;&minus;new&minus;key&minus;slot this option
allows you to specify which key slot is selected for
unlocking volume key.</p>

<p style="margin-left:17%; margin-top: 1em"><b>NOTE:</b>
This option is ignored if existing volume key gets unlocked
via LUKS2 token (&minus;&minus;token&minus;id,
&minus;&minus;token&minus;type or
&minus;&minus;token&minus;only parameters) or when volume
key is provided directly via
&minus;&minus;volume&minus;key&minus;file parameter.</p>

<p style="margin-left:17%; margin-top: 1em"><b>NOTE:</b> To
maintain backward compatibility, without
&minus;&minus;new&minus;key&minus;slot parameter, this
option allows you to specify which key slot is selected for
the new key.</p>

<p style="margin-left:17%; margin-top: 1em">The maximum
number of key slots depends on the LUKS version. LUKS1 can
have up to 8 key slots. LUKS2 can have up to 32 key slots
based on key slot area size and key size, but a valid key
slot ID can always be between 0 and 31 for LUKS2.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;new&minus;key&minus;slot
&lt;0&minus;N&gt;</b></p>

<p style="margin-left:17%;">This option allows you to
specify which key slot is selected for the new key.</p>

<p style="margin-left:17%; margin-top: 1em"><b>NOTE:</b>
When used this option affects &minus;&minus;key&minus;slot
option.</p>

<p style="margin-left:17%; margin-top: 1em">The maximum
number of key slots depends on the LUKS version. LUKS1 can
have up to 8 key slots. LUKS2 can have up to 32 key slots
based on key slot area size and key size, but a valid key
slot ID can always be between 0 and 31 for LUKS2.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;key&minus;size,
&minus;s</b> <i>bits</i></p>

<p style="margin-left:17%;">Provide volume key size in
<i>bits</i>. The argument has to be a multiple of 8.</p>

<p style="margin-left:17%; margin-top: 1em">This option is
required when parameter
&minus;&minus;volume&minus;key&minus;file is used to provide
current volume key. Also, it is used when new unbound
keyslot is created by specifying &minus;&minus;unbound
parameter.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;pbkdf
&lt;PBKDF spec&gt;</b></p>

<p style="margin-left:17%;">Set Password&minus;Based Key
Derivation Function (PBKDF) algorithm for LUKS keyslot. The
PBKDF can be: <i>pbkdf2</i> (for PBKDF2 according to
RFC2898), <i>argon2i</i> for Argon2i or <i>argon2id</i> for
Argon2id (see <i>Argon2</i>
&lt;https://www.cryptolux.org/index.php/Argon2&gt; for more
info).</p>

<p style="margin-left:17%; margin-top: 1em">For LUKS1, only
PBKDF2 is accepted (no need to use this option). The default
PBKDF for LUKS2 is set during compilation time and is
available in <i>cryptsetup &minus;&minus;help</i>
output.</p>

<p style="margin-left:17%; margin-top: 1em">A PBKDF is used
for increasing dictionary and brute&minus;force attack cost
for keyslot passwords. The parameters can be time, memory
and parallel cost.</p>

<p style="margin-left:17%; margin-top: 1em">For PBKDF2,
only time cost (number of iterations) applies. For
Argon2i/id, there is also memory cost (memory required
during the process of key derivation) and parallel cost
(number of threads that run in parallel during the key
derivation.</p>

<p style="margin-left:17%; margin-top: 1em">Note that
increasing memory cost also increases time, so the final
parameter values are measured by a benchmark. The benchmark
tries to find iteration time
(<i>&minus;&minus;iter&minus;time</i>) with required memory
cost <i>&minus;&minus;pbkdf&minus;memory</i>. If it is not
possible, the memory cost is decreased as well. The parallel
cost <i>&minus;&minus;pbkdf&minus;parallel</i> is constant
and is checked against available CPU cores.</p>

<p style="margin-left:17%; margin-top: 1em">You can see all
PBKDF parameters for particular LUKS2 keyslot with
<b>cryptsetup&minus;luksDump</b>(8) command.</p>

<p style="margin-left:17%; margin-top: 1em"><b>NOTE:</b> If
you do not want to use benchmark and want to specify all
parameters directly, use
<i>&minus;&minus;pbkdf&minus;force&minus;iterations</i> with
<i>&minus;&minus;pbkdf&minus;memory</i> and
<i>&minus;&minus;pbkdf&minus;parallel</i>. This will
override the values without benchmarking. Note it can cause
extremely long unlocking time. Use only in specific cases,
for example, if you know that the formatted device will be
used on some small embedded system.</p>

<p style="margin-left:17%; margin-top: 1em"><b>MINIMAL AND
MAXIMAL PBKDF COSTS:</b> For <b>PBKDF2</b>, the minimum
iteration count is 1000 and maximum is 4294967295 (maximum
for 32bit unsigned integer). Memory and parallel costs are
unused for PBKDF2. For <b>Argon2i</b> and <b>Argon2id</b>,
minimum iteration count (CPU cost) is 4 and maximum is
4294967295 (maximum for 32bit unsigned integer). Minimum
memory cost is 32 KiB and maximum is 4 GiB. (Limited by
addressable memory on some CPU platforms.) If the memory
cost parameter is benchmarked (not specified by a parameter)
it is always in range from 64 MiB to 1 GiB. The parallel
cost minimum is 1 and maximum 4 (if enough CPUs cores are
available, otherwise it is decreased).</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;iter&minus;time,
&minus;i &lt;number of milliseconds&gt;</b></p>

<p style="margin-left:17%;">The number of milliseconds to
spend with PBKDF passphrase processing. Specifying 0 as
parameter selects the compiled&minus;in default.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;pbkdf&minus;memory
&lt;number&gt;</b></p>

<p style="margin-left:17%;">Set the memory cost for PBKDF
(for Argon2i/id the number represents kilobytes). Note that
it is maximal value, PBKDF benchmark or available physical
memory can decrease it. This option is not available for
PBKDF2.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;pbkdf&minus;parallel
&lt;number&gt;</b></p>

<p style="margin-left:17%;">Set the parallel cost for PBKDF
(number of threads, up to 4). Note that it is maximal value,
it is decreased automatically if CPU online count is lower.
This option is not available for PBKDF2.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;pbkdf&minus;force&minus;iterations
&lt;num&gt;</b></p>

<p style="margin-left:17%;">Avoid PBKDF benchmark and set
time cost (iterations) directly. It can be used for
LUKS/LUKS2 device only. See <i>&minus;&minus;pbkdf</i>
option for more info.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;timeout,
&minus;t &lt;number of seconds&gt;</b></p>

<p style="margin-left:17%;">The number of seconds to wait
before timeout on passphrase input via terminal. It is
relevant every time a passphrase is asked. It has no effect
if used in conjunction with
&minus;&minus;key&minus;file.</p>

<p style="margin-left:17%; margin-top: 1em">This option is
useful when the system should not stall if the user does not
input a passphrase, e.g. during boot. The default is a value
of 0 seconds, which means to wait forever.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;header
&lt;device or file storing the LUKS header&gt;</b></p>

<p style="margin-left:17%;">Use a detached (separated)
metadata device or file where the LUKS header is stored.
This option allows one to store ciphertext and LUKS header
on different devices.</p>

<p style="margin-left:17%; margin-top: 1em">For commands
that change the LUKS header (e.g. <i>luksAddKey</i>),
specify the device or file with the LUKS header directly as
the LUKS device.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;force&minus;password</b></p>

<p style="margin-left:17%;">Do not use password quality
checking for new LUKS passwords.</p>

<p style="margin-left:17%; margin-top: 1em">This option is
ignored if cryptsetup is built without password quality
checking support.</p>

<p style="margin-left:17%; margin-top: 1em">For more info
about password quality check, see the manual page for
<b>pwquality.conf(5)</b> and <b>passwdqc.conf(5)</b>.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;disable&minus;locks</b></p>

<p style="margin-left:17%;">Disable lock protection for
metadata on disk. This option is valid only for LUKS2 and
ignored for other formats.</p>


<p style="margin-left:17%; margin-top: 1em"><b>WARNING:</b>
Do not use this option unless you run cryptsetup in a
restricted environment where locking is impossible to
perform (where /run directory cannot be used).</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;token&minus;id</b></p>

<p style="margin-left:17%;">Specify what token to use when
unlocking existing keyslot to get volume key.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;new&minus;token&minus;id</b></p>

<p style="margin-left:17%;">Specify what token to use to
get the passphrase for a new keyslot.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;token&minus;only</b></p>

<p style="margin-left:17%;">Use only LUKS2 tokens to unlock
existing volume key.</p>

<p style="margin-left:17%; margin-top: 1em"><b>NOTE</b>: To
create a new keyslot using passphrase provided by a token
use &minus;&minus;new&minus;token&minus;id parameter.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;token&minus;type</b>
<i>type</i></p>

<p style="margin-left:17%;">Specify what token type (all
<i>type</i> tokens) to use when unlocking existing keyslot
to get volume key.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;keyslot&minus;cipher
&lt;cipher&minus;spec&gt;</b></p>

<p style="margin-left:17%;">This option can be used to set
specific cipher encryption for the LUKS2 keyslot area.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;keyslot&minus;key&minus;size
&lt;bits&gt;</b></p>

<p style="margin-left:17%;">This option can be used to set
specific key size for the LUKS2 keyslot area.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;unbound</b></p>

<p style="margin-left:17%;">Creates new LUKS2 unbound
keyslot.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;batch&minus;mode,
&minus;q</b></p>

<p style="margin-left:17%;">Suppresses all confirmation
questions. Use with care!</p>

<p style="margin-left:17%; margin-top: 1em">If the
&minus;&minus;verify&minus;passphrase option is not
specified, this option also switches off the passphrase
verification.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;debug
or &minus;&minus;debug&minus;json</b></p>

<p style="margin-left:17%;">Run in debug mode with full
diagnostic logs. Debug output lines are always prefixed by
<b>#</b>.</p>

<p style="margin-left:17%; margin-top: 1em">If
&minus;&minus;debug&minus;json is used, additional LUKS2
JSON data structures are printed.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;version,
&minus;V</b></p>

<p style="margin-left:17%;">Show the program version.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;usage</b></p>

<p style="margin-left:17%;">Show short option help.</p>


<p style="margin-left:11%; margin-top: 1em"><b>&minus;&minus;help,
&minus;?</b></p>

<p style="margin-left:17%;">Show help text and default
parameters.</p>

<h2>EXAMPLES
<a name="EXAMPLES"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em"><b>NOTE</b>:
When not specified otherwise interactive passphrase prompt
is always default method.</p>

<p style="margin-left:11%; margin-top: 1em">Add new keyslot
using interactive passphrase prompt for both existing and
new passphrase:</p>

<p style="margin-left:11%; margin-top: 1em"><b>cryptsetup
luksAddKey /dev/device</b></p>

<p style="margin-left:11%; margin-top: 1em">Add new keyslot
using LUKS2 tokens to unlock existing keyslot with
interactive passphrase prompt for new passphrase:</p>

<p style="margin-left:11%; margin-top: 1em"><b>cryptsetup
luksAddKey &minus;&minus;token&minus;only
/dev/device</b></p>

<p style="margin-left:11%; margin-top: 1em">Add new keyslot
using LUKS2 systemd&minus;tpm2 tokens to unlock existing
keyslot with interactive passphrase prompt for new
passphrase (systemd&minus;tpm2 token plugin must be
available):</p>

<p style="margin-left:11%; margin-top: 1em"><b>cryptsetup
luksAddKey &minus;&minus;token&minus;type systemd&minus;tpm2
/dev/device</b></p>

<p style="margin-left:11%; margin-top: 1em">Add new keyslot
using interactive passphrase prompt for existing keyslot,
reading new passphrase from key_file:</p>

<p style="margin-left:11%; margin-top: 1em"><b>cryptsetup
luksAddKey &minus;&minus;new&minus;keyfile key_file
/dev/device</b> or <b>cryptsetup luksAddKey /dev/device
key_file</b></p>

<p style="margin-left:11%; margin-top: 1em">Add new keyslot
using volume stored in volume_key_file and LUKS2 token in
slot 5 to get new keyslot passphrase (token in slot 5 must
exist and respective token plugin must be available):</p>

<p style="margin-left:11%; margin-top: 1em"><b>cryptsetup
luksAddKey &minus;&minus;volume&minus;key&minus;file
volume_key_file &minus;&minus;new&minus;token&minus;id 5
/dev/device</b></p>

<h2>REPORTING BUGS
<a name="REPORTING BUGS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Report bugs at
<b>cryptsetup mailing list
&lt;cryptsetup@lists.linux.dev&gt; or in Issues project
section
&lt;https://gitlab.com/cryptsetup/cryptsetup/&minus;/issues/new&gt;.</b></p>

<p style="margin-left:11%; margin-top: 1em"><b>Please
attach output of the failed command with &minus;&minus;debug
option added.</b></p>

<h2>SEE ALSO
<a name="SEE ALSO"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em"><b>Cryptsetup
FAQ
&lt;https://gitlab.com/cryptsetup/cryptsetup/wikis/FrequentlyAskedQuestions&gt;</b></p>


<p style="margin-left:11%; margin-top: 1em"><b>cryptsetup(8),
integritysetup(8) and veritysetup(8)</b></p>

<h2>CRYPTSETUP
<a name="CRYPTSETUP"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Part of
<b>cryptsetup project
&lt;https://gitlab.com/cryptsetup/cryptsetup/&gt;.</b></p>
<hr>
</body>
</html>
